!function(){function t(t){function e(){if(o&&t>a){var n=o,r=n[0],u=Array.prototype.slice.call(n,1),c=n.index;o=o===i?i=null:o.next,++a,u.push(function(t,n){--a,s||(t?l&&d(s=t,l=p=o=i=null):(p[c]=n,--l?e():d(null,p)))}),r.apply(null,u)}}var o,i,r={},a=0,l=0,u=-1,s=null,p=[],d=n;return arguments.length<1&&(t=1/0),r.defer=function(){if(!s){var t=arguments;t.index=++u,i?(i.next=t,i=i.next):o=i=t,++l,e()}return r},r.await=function(t){return d=t,l||d(s,p),r},r}function n(){}"undefined"==typeof module?self.queue=t:module.exports=t,t.version="0.0.2"}(),function(t,n,e){"use strict";function o(t){return"undefined"==typeof t}function i(t,n){if(n)for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t}function r(t,n){var e=!1;return t&&n&&(e=t===n?!0:t.contains?t.contains(n):n.compareDocumentPosition?!!(8&n.compareDocumentPosition(t)):!1),e}function a(t){t>0&&clearTimeout(t),t=0}function l(t){return t=t&&(t.originalEvent?t.originalEvent:t)||n.event,t.dataTransfer?t:null}function u(t,n,e){return t&&n&&!o(t[n])?t[n]:e}function s(t,n,e){t[n]=e}function p(t){return t&&t.length&&0<t.length?!0:!1}function d(t){return parseInt(t||0,10)}function c(t,n){return function(){return t.apply(o(n)?null:n,Array.prototype.slice.call(arguments))}}function f(t){var n="",e="0123456789abcdefghijklmnopqrstuvwxyz";for(t=o(t)?32:d(t);n.length<t;)n+=e.substr(Math.round(Math.random()*e.length),1);return n}function h(){return"jua-uid-"+f(16)+"-"+(new Date).getTime().toString()}function m(t,n){var e=o(t.fileName)?o(t.name)?null:t.name:t.fileName,i=o(t.fileSize)?o(t.size)?null:t.size:t.fileSize,r=o(t.type)?null:t.type;return{FileName:e,Size:i,Type:r,Folder:o(n)?"":n,File:t}}function D(t,n,e,i,r,a){var l=0,u=0,s=0,c=null,f=null,h=!1,D=!1,v=function(t,n,e,u){if(t&&!o(t.name))if(n=n||"",t.isFile)t.file(function(t){!h||0<=--r?e(m(t,n)):h&&!D&&0>r&&a&&(D=!0,a(l))});else if(i&&t.isDirectory&&t.createReader){var s=t.createReader(),d=0,c=0;s&&s.readEntries&&s.readEntries(function(o){if(o&&p(o))for(d=0,c=o.length;c>d;d++)v(o[d],n+t.name+"/",e,u)})}};if(i=o(i)?!0:!!i,e=o(e)?!1:!!e,r=o(r)?w:d(r),l=r,h=r>0,t=t&&0<t.length?t:null)for(s=0,u=t.length;u>s;s++)c=t[s],c&&(e?"file"===c.kind&&c.webkitGetAsEntry&&(f=c.webkitGetAsEntry(),f&&v(f,"",n,a)):!h||0<=--r?n(m(c)):h&&!D&&0>r&&a&&(D=!0,a(l)))}function v(t,n,e,o){var i=t&&t.files&&0<t.files.length?t.files:null;i?D(i,n,!1,!1,e,o):n({FileName:t.value.split("\\").pop().split("/").pop(),Size:null,Type:null,Folder:"",File:null})}function g(t){var n=!1;if(t&&t.dataTransfer&&t.dataTransfer.types&&t.dataTransfer.types.length)for(var e=0,o=t.dataTransfer.types.length;o>e;e++)if("files"===t.dataTransfer.types[e].toLowerCase()){n=!0;break}return n}function y(t,n,e,o,i){var r=null,a=null;t=l(t),t&&(r=(t.dataTransfer?u(t.dataTransfer,"items",null):null)||u(t,"items",null),r&&0<r.length&&r[0]&&r[0].webkitGetAsEntry?D(r,n,!0,i,e,o):g(t)&&(a=u(t,"files",null)||(t.dataTransfer?u(t.dataTransfer,"files",null):null),a&&0<a.length&&D(a,n,!1,!1,e,o)))}function E(){return t('<label style="position: absolute; background-color:#fff; right: 0px; top: 0px; left: 0px; bottom: 0px; margin: 0px; padding: 0px; cursor: pointer;"></label>').css({opacity:0})}function b(n){return t('<input type="file" tabindex="-1" hidefocus="hidefocus" style="position: absolute; '+n+': -9999px;" />')}function O(t,n,e){t=o(t)?"":t.toString(),e=o(e)?"left":e.toString();var i=b(e);return 0<t.length&&i.attr("name",t),(o(n)?!0:n)&&i.prop("multiple",!0),i}function T(n,e){return t.isFunction(n)?n.apply(null,t.isArray(e)?e:[]).toString():n.toString()}function S(t,n){this.oXhrs={},this.oUids={},this.oJua=t,this.oOptions=n}function A(t,n){this.oUids={},this.oForms={},this.oJua=t,this.oOptions=n}function F(n){n=o(n)?{}:n;var p=this;p.bEnableDnD=!0,p.bEnableButton=!0,p.oEvents={onDialog:null,onSelect:null,onStart:null,onComplete:null,onCompleteAll:null,onProgress:null,onDragEnter:null,onDragLeave:null,onDrop:null,onBodyDragEnter:null,onBodyDragLeave:null,onLimitReached:null},p.oOptions=i({action:"",name:"",hidden:{},queueSize:10,clickElement:!1,dragAndDropElement:!1,dragAndDropBodyElement:!1,disableAjaxUpload:!1,disableFolderDragAndDrop:!0,disableDragAndDrop:!1,disableMultiple:!1,disableDocumentDropPrevent:!1,disableAutoUploadOnDrop:!1,multipleSizeLimit:50,hiddenElementsPosition:"left"},n),p.oQueue=e(d(u(p.oOptions,"queueSize",10))),p.runEvent("onCompleteAll")&&p.oQueue.await(function(){p.runEvent("onCompleteAll")}),p.oDriver=p.isAjaxUploaderSupported()&&!u(p.oOptions,"disableAjaxUpload",!1)?new S(p,p.oOptions):new A(p,p.oOptions),p.oClickElement=u(p.oOptions,"clickElement",null),p.oClickElement&&(t(p.oClickElement).css({position:"relative",overflow:"hidden"}),"inline"===t(this.oClickElement).css("display")&&t(this.oClickElement).css("display","inline-block"),this.oDriver.generateNewInput(this.oClickElement)),this.oDriver.isDragAndDropSupported()&&u(this.oOptions,"dragAndDropElement",!1)&&!u(this.oOptions,"disableAjaxUpload",!1)?!function(n){var e=t(document),o=t(u(n.oOptions,"dragAndDropBodyElement",!1)||e),i=u(n.oOptions,"dragAndDropElement",!1),s=function(t){if(n.bEnableDnD&&t&&(t=l(t),t&&t.dataTransfer&&g(t)))try{var e=t.dataTransfer.effectAllowed;a(n.iDocTimer),t.dataTransfer.dropEffect="move"===e||"linkMove"===e?"move":"copy",t.stopPropagation(),t.preventDefault(),o.trigger("dragover",t)}catch(i){}},p=function(t){n.bEnableDnD&&t&&(t=l(t),t&&g(t)&&(t.preventDefault(),y(t,function(e){e&&(u(n.oOptions,"disableAutoUploadOnDrop",!1)?n.runEvent("onDrop",[e,t,function(){n.addNewFile(e),a(n.iDocTimer)}]):(n.runEvent("onDrop",[e,t]),n.addNewFile(e),a(n.iDocTimer)))},u(n.oOptions,"multipleSizeLimit",w),n.getEvent("onLimitReached"),!u(n.oOptions,"disableFolderDragAndDrop",!0)))),n.runEvent("onDragLeave",[t])},d=function(t){n.bEnableDnD&&t&&(t=l(t),t&&g(t)&&(a(n.iDocTimer),t.preventDefault(),n.runEvent("onDragEnter",[i,t])))},c=function(t){if(n.bEnableDnD&&t){if(t=l(t)){var e=document.elementFromPoint?document.elementFromPoint(t.clientX,t.clientY):null;if(e&&r(this,e))return;a(n.iDocTimer),n.runEvent("onDragLeave",[i,t])}}else;};i&&(u(n.oOptions,"disableDocumentDropPrevent",!1)||e.on("dragover",function(t){if(n.bEnableDnD&&t&&(t=l(t),t&&t.dataTransfer&&g(t)))try{t.dataTransfer.dropEffect="none",t.preventDefault()}catch(e){}}),o&&o[0]&&o.on("dragover",function(t){n.bEnableDnD&&t&&a(n.iDocTimer)}).on("dragenter",function(t){n.bEnableDnD&&t&&(t=l(t),t&&g(t)&&(a(n.iDocTimer),t.preventDefault(),n.runEvent("onBodyDragEnter",[t])))}).on("dragleave",function(t){n.bEnableDnD&&t&&(t=l(t),t&&(a(n.iDocTimer),n.iDocTimer=setTimeout(function(){n.runEvent("onBodyDragLeave",[t])},200)))}).on("drop",function(t){if(n.bEnableDnD&&t&&(t=l(t))){var e=g(t);return e&&t.preventDefault(),n.runEvent("onBodyDragLeave",[t]),!e}return!1}),t(i).bind("dragenter",d).bind("dragover",s).bind("dragleave",c).bind("drop",p))}(p):p.bEnableDnD=!1,s(p,"on",p.on),s(p,"cancel",p.cancel),s(p,"isDragAndDropSupported",p.isDragAndDropSupported),s(p,"isAjaxUploaderSupported",p.isAjaxUploaderSupported),s(p,"setDragAndDropEnabledStatus",p.setDragAndDropEnabledStatus)}var w=20,x=function(){var t=document.createElement("input");return t.type="file",!!("XMLHttpRequest"in n&&"multiple"in t&&"FormData"in n&&(new XMLHttpRequest).upload)}();S.prototype.oXhrs={},S.prototype.oUids={},S.prototype.oJua=null,S.prototype.oOptions={},S.prototype.isDragAndDropSupported=function(){return!0},S.prototype.regTaskUid=function(t){this.oUids[t]=!0},S.prototype.uploadTask=function(n,e,i){if(!1===this.oUids[n]||!e||!e.File)return i(null,n),!1;try{var r=this,a=new XMLHttpRequest,l=new FormData,s=u(this.oOptions,"action",""),p=u(this.oOptions,"hidden",{}),d=this.oJua.getEvent("onStart"),c=this.oJua.getEvent("onComplete"),f=this.oJua.getEvent("onProgress");return a.open("POST",s,!0),f&&a.upload&&(a.upload.onprogress=function(t){t&&t.lengthComputable&&!o(t.loaded)&&!o(t.total)&&f(n,t.loaded,t.total)}),a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){if(c){var e=!1,l=null;try{l=t.parseJSON(a.responseText),e=!0}catch(u){l=null}c(n,e,l)}o(r.oXhrs[n])||(r.oXhrs[n]=null),i(null,n)}else 4===a.readyState&&(c(n,!1,null),i(null,n))},d&&d(n),l.append("jua-post-type","ajax"),l.append(u(this.oOptions,"name","juaFile"),e.File),t.each(p,function(t,n){l.append(t,T(n,[e]))}),a.send(l),this.oXhrs[n]=a,!0}catch(h){}return i(null,n),!1},S.prototype.generateNewInput=function(n){var e=this,o=null,i=null;n&&(i=O("",!u(this.oOptions,"disableMultiple",!1),u(this.oOptions,"hiddenElementsPosition","left")),o=E(),o.append(i),t(n).append(o),i.on("click",function(t){if(!e.oJua.bEnableButton)return void t.preventDefault();var n=e.oJua.getEvent("onDialog");n&&n()}).on("change",function(){v(this,function(t){e.oJua.addNewFile(t),e.generateNewInput(n),setTimeout(function(){o.remove()},10)},u(e.oOptions,"multipleSizeLimit",w),e.oJua.getEvent("onLimitReached"))}))},S.prototype.cancel=function(t){if(this.oUids[t]=!1,this.oXhrs[t]){try{this.oXhrs[t].abort&&this.oXhrs[t].abort()}catch(n){}this.oXhrs[t]=null}},A.prototype.oUids={},A.prototype.oForms={},A.prototype.oJua=null,A.prototype.oOptions={},A.prototype.isDragAndDropSupported=function(){return!1},A.prototype.regTaskUid=function(t){this.oUids[t]=!0},A.prototype.uploadTask=function(e,o,i){if(!1===this.oUids[e])return i(null,e),!1;var r=this.oForms[e],a=u(this.oOptions,"hidden",{}),l=this.oJua.getEvent("onStart"),s=this.oJua.getEvent("onComplete");return r?(r.append(t('<input type="hidden" />').attr("name","jua-post-type").val("iframe")),t.each(a,function(n,e){r.append(t('<input type="hidden" />').attr("name",n).val(T(e,[o])))}),r.trigger("submit"),l&&l(e),r.find("iframe").on("load",function(o){var a=!1,l=null,u={};if(s){try{l=this.contentDocument?this.contentDocument:this.contentWindow.document,u=t.parseJSON(l.body.innerHTML),a=!0}catch(p){u={}}s(e,a,u)}i(null,e),n.setTimeout(function(){r.remove()},100)})):i(null,e),!0},A.prototype.generateNewInput=function(n){var e=this,o="",i=null,r=null,a=u(this.oOptions,"action",""),l=null,s=u(this.oOptions,"hiddenElementsPosition","left");n&&(o=h(),i=O(u(this.oOptions,"name","juaFile"),!u(this.oOptions,"disableMultiple",!1),u(this.oOptions,"hiddenElementsPosition","left")),l=t('<form action="'+a+'" target="iframe-'+o+'"  method="POST" enctype="multipart/form-data" style="display: block; cursor: pointer;"></form>'),r=t('<iframe name="iframe-'+o+'" tabindex="-1" src="javascript:void(0);"  style="position: absolute; top: -1000px; '+s+': -1000px; cursor: pointer;" />').css({opacity:0}),l.append(E().append(i)).append(r),t(n).append(l),this.oForms[o]=l,i.on("click",function(t){if(!e.oJua.bEnableButton)return void t.preventDefault();var n=e.oJua.getEvent("onDialog");n&&n()}).on("change",function(){v(this,function(t){if(t){var i=u(e.oOptions,"hiddenElementsPosition","left");l.css({position:"absolute",top:-1e3}),l.css(i,-1e3),e.oJua.addFile(o,t),e.generateNewInput(n)}},u(e.oOptions,"multipleSizeLimit",w),e.oJua.getEvent("onLimitReached"))}))},A.prototype.cancel=function(t){this.oUids[t]=!1,this.oForms[t]&&(this.oForms[t].remove(),this.oForms[t]=!1)},F.prototype.bEnableDnD=!0,F.prototype.iDocTimer=0,F.prototype.oOptions={},F.prototype.oEvents={},F.prototype.oQueue=null,F.prototype.oDriver=null,F.prototype.on=function(t,n){return this.oEvents[t]=n,this},F.prototype.runEvent=function(t,n){this.oEvents[t]&&this.oEvents[t].apply(null,n||[])},F.prototype.getEvent=function(t){return this.oEvents[t]||null},F.prototype.cancel=function(t){this.oDriver.cancel(t)},F.prototype.isAjaxUploaderSupported=function(){return x},F.prototype.setDragAndDropEnabledStatus=function(t){this.bEnableDnD=!!t},F.prototype.isDragAndDropSupported=function(){return this.oDriver.isDragAndDropSupported()},F.prototype.addNewFile=function(t){this.addFile(h(),t)},F.prototype.addFile=function(t,n){var e=this.getEvent("onSelect");!n||e&&!1===e(t,n)?this.oDriver.cancel(t):(this.oDriver.regTaskUid(t),this.oQueue.defer(c(this.oDriver.uploadTask,this.oDriver),t,n))},F.prototype.setOption=function(t,n){this.oOptions[t]=n},n.Jua=F}(jQuery,window,queue);
