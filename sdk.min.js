/*
 * Copyright Â© Acision 2015. All rights reserved.
 */

!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.AcisionSDK=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){function c(b){var c,d,e;return b?/^ws/.test(b)?b:/:\d{1,5}/.test(b)?(c="https:"===a.location.protocol?"wss://":"ws://",c+b):(c="https:"===a.location.protocol?"wss://":"ws://",d=""!==a.location.port?":"+a.location.port:"",e="/"===b[0]?b:"/"+b,c+a.location.hostname+d+e):(c="https:"===a.location.protocol?"wss://":"ws://",d=""!==a.location.port?":"+a.location.port:"",c+a.location.hostname+d+"/ws")}function d(){for(var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",b=16,c="",d=a.length;b--;)c+=a.charAt(Math.floor(Math.random()*d));return c}function e(){if("WebSocket"in a)return WebSocket;if("MozWebSocket"in a)return MozWebSocket;try{return("undefined"!=typeof window?window.WebSocket:"undefined"!=typeof a?a.WebSocket:null).w3cwebsocket}catch(b){}return null}var f={TYPE_ID_WELCOME:0,TYPE_ID_PREFIX:1,TYPE_ID_CALL:2,TYPE_ID_CALLRESULT:3,TYPE_ID_CALLERROR:4,TYPE_ID_SUBSCRIBE:5,TYPE_ID_UNSUBSCRIBE:6,TYPE_ID_PUBLISH:7,TYPE_ID_EVENT:8},g=function(){this._pref2uri={},this._uri2pref={}};g.prototype.get=function(a){return this._pref2uri[a]},g.prototype.set=function(a,b){this._pref2uri[a]=b,this._uri2pref[a]=b},g.prototype.remove=function(a){this._pref2uri[a]&&(delete this._uri2pref[this._pref2uri[a]],delete this._pref2uri[a])},g.prototype.reset=function(){this._pref2uri={},this._uri2pref={}},g.prototype.resolve=function(a){var b,c=/^http(s)?:\/\//.test(a),d=a.indexOf(":");return!c&&d>=0?(b=a.substring(0,d),this._pref2uri[b]?this._pref2uri[b]+a.substring(d+1):null):a};var h=function(a,b,d){switch(this._url=c(a),this._protocols=[],this._cache={sessionId:null,protocolVersion:1,timer:null,reconnectingAttempts:0,welcome:!1,onConnect:null,onClose:null,onError:null,onReconnect:null},this._serverIdent=null,this._ws=null,this._queue=[],this._calls={},this._subscriptions={},this._isInitialized=!1,this._options={autoReconnect:!0,reconnectInterval:2e3,maxRetries:25},this._prefixMap=new g,arguments.length){case 1:"string"==typeof arguments[0]?this._url=c(arguments[0]):this._options=this._merge(this._options,arguments[0]);break;case 2:"string"==typeof arguments[0]&&arguments[1]instanceof Array?(this._url=c(arguments[0]),this._protocols=arguments[1]):(this._url=c(arguments[0]),this._options=this._merge(this._options,arguments[1]));break;case 3:this._url=c(arguments[0]),this._protocols=arguments[1],this._options=this._merge(this._options,arguments[2])}this._url&&this.connect()};h.prototype._merge=function(){var a,b,c={},d=arguments.length;for(a=0;d>a;a++)for(b in arguments[a])c[b]=arguments[a][b];return c},h.prototype._send=function(a){if(a&&this._queue.push(JSON.stringify(a)),this._isInitialized&&1===this._ws.readyState)for(;this._queue.length;)this._ws.send(this._queue.shift())},h.prototype._initWsCallbacks=function(){var a=this;this._ws.onopen=function(){a._wsOnOpen.call(a)},this._ws.onclose=function(b){a._wsOnClose.call(a,b)},this._ws.onmessage=function(b){a._wsOnMessage.call(a,b)},this._ws.onerror=function(b){a._wsOnError.call(a,b)}},h.prototype._wsOnOpen=function(){console.log("[wampy] websocket connected")},h.prototype._wsOnClose=function(b){var c=this;console.log("[wampy] websocket disconnected"),this._cache.welcome=!1,this._isInitialized&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries?this._cache.timer=a.setTimeout(function(){c._wsReconnect.call(c)},this._options.reconnectInterval):(this._options.onClose&&this._options.onClose(),this.disconnect())},h.prototype._wsOnMessage=function(a){var b,c,d;switch(console.log("[wampy] websocket message received: ",a.data),b=JSON.parse(a.data),b[0]){case f.TYPE_ID_WELCOME:this._cache.sessionId=b[1],this._cache.protocolVersion=b[2],this._serverIdent=b[3],this._isInitialized=!0,this._cache.reconnectingAttempts>0?this._options.onReconnect&&this._options.onReconnect():this._options.onConnect&&this._options.onConnect(),this._send(),this._cache.reconnectingAttempts=0;break;case f.TYPE_ID_CALLRESULT:this._calls[b[1]]&&this._calls[b[1]].callRes&&this._calls[b[1]].callRes(b[2]);break;case f.TYPE_ID_CALLERROR:this._calls[b[1]]&&this._calls[b[1]].callErr&&this._calls[b[1]].callErr(b[2],b[3],b[4]);break;case f.TYPE_ID_EVENT:if(d=this._prefixMap.resolve(b[1]),this._subscriptions[d])for(c=this._subscriptions[d].length;c--;)this._subscriptions[d][c](b[2])}},h.prototype._wsOnError=function(a){console.log("[wampy] websocket error"),this._options.onError&&this._options.onError()},h.prototype._wsReconnect=function(){console.log("[wampy] websocket reconnecting..."),this._cache.reconnectingAttempts++;var a=e();this._ws=new a(this._url,this._protocols,this._options.origin,this._options.headers),this._initWsCallbacks()},h.prototype.options=function(a){return void 0===a?this._options:"object"==typeof a?(this._options=this._merge(this._options,a),this):void 0},h.prototype.connect=function(a,b){a&&(this._url=c(a)),b instanceof Array&&(this._protocols=b);var d=e();return this._ws=new d(this._url,this._protocols,this._options.origin,this._options.headers),this._initWsCallbacks(),this},h.prototype.disconnect=function(){return this._isInitialized&&(this._isInitialized=!1,this._ws.close(),this._serverIdent=null,this._prefixMap.reset(),this._ws=null,this._queue=[],this._subscriptions={},this._calls={},this._cache={protocolVersion:1,reconnectingAttempts:0}),this},h.prototype.prefix=function(a,b){return this._prefixMap.set(a,b),this._send([f.TYPE_ID_PREFIX,a,b]),this},h.prototype.unprefix=function(a){return this._prefixMap.remove(a),this},h.prototype.call=function(a,b){for(var c,e=d(),g=arguments.length,h=[f.TYPE_ID_CALL];e in this._calls;)e=d();for(this._calls[e]=b,h.push(e),h.push(a),c=2;g>c;c++)h.push(arguments[c]);return this._send(h),this},h.prototype.subscribe=function(a,b){var c=this._prefixMap.resolve(a);return this._subscriptions[c]||(this._subscriptions[c]=[],this._send([f.TYPE_ID_SUBSCRIBE,a])),this._subscriptions[c].indexOf(b)<0&&this._subscriptions[c].push(b),this},h.prototype.unsubscribe=function(a,b){var c,d=this._prefixMap.resolve(a);if(this._subscriptions[d]){if(void 0!==b&&(c=this._subscriptions[d].indexOf(b),c>=0&&this._subscriptions[d].splice(c,1),this._subscriptions[d].length))return this;this._send([f.TYPE_ID_UNSUBSCRIBE,a]),delete this._subscriptions[d]}return this},h.prototype.resubscribe=function(){for(var a=Object.keys(this._subscriptions),b=0,c=a.length;c>b;b++)this._send([f.TYPE_ID_SUBSCRIBE,a[b]])},h.prototype.publish=function(a,b,c,d){var e=[f.TYPE_ID_PUBLISH,a,b];switch(arguments.length){case 2:this._send(e);break;case 3:("boolean"==typeof c||c instanceof Array)&&(e.push(c),this._send(e));break;case 4:c instanceof Array&&d instanceof Array&&(e.push(c),e.push(d),this._send(e))}return this},b.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(b,c,d){!function(b){"use strict";var d={};d.VERSION="1.1.1";var e,f={},g=function(a,b){return function(){return b.apply(a,arguments)}},h=function(){var a,b,c=arguments,d=c[0];for(b=1;b<c.length;b++)for(a in c[b])a in d||!c[b].hasOwnProperty(a)||(d[a]=c[b][a]);return d},i=function(a,b){return{value:a,name:b}};d.DEBUG=i(1,"DEBUG"),d.INFO=i(2,"INFO"),d.TIME=i(3,"TIME"),d.WARN=i(4,"WARN"),d.ERROR=i(8,"ERROR"),d.OFF=i(99,"OFF");var j=function(a){this.context=a,this.setLevel(a.filterLevel),this.log=this.info};j.prototype={setLevel:function(a){a&&"value"in a&&(this.context.filterLevel=a)},enabledFor:function(a){var b=this.context.filterLevel;return a.value>=b.value},debug:function(){this.invoke(d.DEBUG,arguments)},info:function(){this.invoke(d.INFO,arguments)},warn:function(){this.invoke(d.WARN,arguments)},error:function(){this.invoke(d.ERROR,arguments)},time:function(a){"string"==typeof a&&a.length>0&&this.invoke(d.TIME,[a,"start"])},timeEnd:function(a){"string"==typeof a&&a.length>0&&this.invoke(d.TIME,[a,"end"])},invoke:function(a,b){e&&this.enabledFor(a)&&e(b,h({level:a},this.context))}};var k=new j({filterLevel:d.OFF});!function(){var a=d;a.enabledFor=g(k,k.enabledFor),a.debug=g(k,k.debug),a.time=g(k,k.time),a.timeEnd=g(k,k.timeEnd),a.info=g(k,k.info),a.warn=g(k,k.warn),a.error=g(k,k.error),a.log=a.info}(),d.setHandler=function(a){e=a},d.setLevel=function(a){k.setLevel(a);for(var b in f)f.hasOwnProperty(b)&&f[b].setLevel(a)},d.get=function(a){return f[a]||(f[a]=new j(h({name:a},k.context)))},d.useDefaults=function(a){if("undefined"!=typeof console){var b={},c=function(a,b){Function.prototype.apply.call(a,console,b)};d.setLevel(a||d.DEBUG),d.setHandler(function(a,e){var f,g=console.log;e.level===d.TIME?(f=(e.name?"["+e.name+"] ":"")+a[0],"start"===a[1]?console.time?console.time(f):b[f]=(new Date).getTime():console.timeEnd?console.timeEnd(f):c(g,[f+": "+((new Date).getTime()-b[f])+"ms"])):(e.level===d.WARN&&console.warn?g=console.warn:e.level===d.ERROR&&console.error?g=console.error:e.level===d.INFO&&console.info&&(g=console.info),e.name&&Array.prototype.unshift.call(a,"["+e.name+"] "),c(g,a))})}},"function"==typeof a&&a.amd?a(d):"undefined"!=typeof c&&c.exports?c.exports=d:(d._prevLogger=b.Logger,d.noConflict=function(){return b.Logger=d._prevLogger,d},b.Logger=d)}(this)},{}],3:[function(a,b,c){var d=a("../package.json"),e={USER_AGENT:d.title+" "+d.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INVALID_REFER_TO_TARGET:"Invalid Refer-To Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout",SESSION_TIMER:"Session Timer Expired"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REFER:"REFER",SIP_EXTENSIONS:{TIMER:"timer",TARGET_DIALOG:"tdialog",GRUU:"gruu"},REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}};b.exports=e},{"../package.json":35}],4:[function(a,b,c){(function(c){function d(a,b,c,d){var h;return b.hasHeader("contact")?(b instanceof f.IncomingResponse?d=b.status_code<200?e.STATUS_EARLY:e.STATUS_CONFIRMED:(d=d||e.STATUS_CONFIRMED,b.method===g.INVITE&&(this.last_invite_tx=b.server_transaction)),h=b.parseHeader("contact"),"UAS"===c?(this.id=new j(b.call_id,b.to_tag,b.from_tag),this.state=d,this.remote_seqnum=b.cseq,this.local_uri=b.parseHeader("to").uri,this.remote_uri=b.parseHeader("from").uri,this.remote_target=h.uri,this.route_set=b.getHeaderAll("record-route")):"UAC"===c&&(this.id=new j(b.call_id,b.from_tag,b.to_tag),this.state=d,this.local_seqnum=b.cseq,this.local_uri=b.parseHeader("from").uri,this.remote_uri=b.parseHeader("to").uri,this.remote_target=h.uri,this.route_set=b.getHeaderAll("record-route").reverse()),this.session_timer={localRefresher:!0,interval:null,min_interval:e.DEFAULT_MIN_SE,timer_id:null},this.owner=a,a.ua.dialogs[this.id.toString()]=this,void console.log(m+"new "+c+" dialog created with status "+(this.state===e.STATUS_EARLY?"EARLY":"CONFIRMED"))):(console.error(m+"unable to create a Dialog without Contact header field"),!1)}b.exports=d;var e={STATUS_EARLY:1,STATUS_CONFIRMED:2,DEFAULT_MIN_SE:90};d.C=e;var f=a("./SIPMessage"),g=a("./Constants"),h=a("./Transactions"),i=a("./RTCSession"),j=a("./DialogId"),k=a("./JsSIP"),l=a("./Utils"),m=k.name+" | DIALOG | ";d.prototype={update:function(a,b){this.state=e.STATUS_CONFIRMED,console.log(m+"dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===b&&(this.route_set=a.getHeaderAll("record-route").reverse())},isConfirmed:function(){return this.state===e.STATUS_CONFIRMED},terminate:function(){console.log(m+"dialog "+this.id.toString()+" deleted"),this.clearSessionRefreshTimer(),delete this.owner.ua.dialogs[this.id.toString()]},createRequest:function(a,b){var c,d,h=null;if(b=b||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),c=a===g.CANCEL||a===g.ACK?this.local_seqnum:this.local_seqnum+=1,a===g.INVITE||a===g.UPDATE){var j=this.session_timer.min_interval,k=this.session_timer.interval;if(j>e.DEFAULT_MIN_SE&&b.push("Min-SE: "+j),null!==k){var m=j>k?j:k,n=this.session_timer.localRefresher?"uac":"uas";b.push("Session-Expires: "+m+";refresher="+n)}}return this.owner instanceof i&&(h=l.getSessionExtensions(this.owner,a)),d=new f.OutgoingRequest(a,this.remote_target,this.owner.ua,{cseq:c,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set,extra_supported:h},b),d.dialog=this,d},checkInDialogRequest:function(a){var b;if(this.remote_seqnum){if(a.cseq<this.remote_seqnum)return a.method!==g.ACK&&a.reply(500),!1;a.cseq>this.remote_seqnum&&(this.remote_seqnum=a.cseq)}else this.remote_seqnum=a.cseq;switch(a.method){case g.INVITE:if(this.last_invite_tx&&this.last_invite_tx.state===h.C.STATUS_PROCEEDING)return b=(10*Math.random()|0)+1,a.reply(500,null,["Retry-After:"+b]),!1;this.last_invite_tx=a.server_transaction;break;case g.UPDATE:if(this.last_update_tx)switch(this.last_update_tx.state){case h.C.STATUS_TRYING:case h.C.STATUS_PROCEEDING:return b=(10*Math.random()|0)+1,a.reply(500,null,["Retry-After:"+b]),!1}this.last_update_tx=a.server_transaction}return!0},receiveRequest:function(a){if(this.checkInDialogRequest(a)&&this.owner.receiveRequest(a))switch(a.method){case g.INVITE:case g.UPDATE:case g.NOTIFY:a.hasHeader("contact")&&(this.remote_target=a.parseHeader("contact").uri)}},updateMinSessionExpires:function(a){a>this.session_timer.min_interval&&(this.session_timer.min_interval=a)},setSessionRefreshTimer:function(){var a,b,d=this.session_timer.localRefresher,e=this.session_timer.interval,f=this;d?(a=e/2,b=function(){f.session_timer.timer_id=null,f.owner.emit("refresh",f.owner,{})}):(a=e-Math.max(e/3,32),b=function(){f.session_timer.timer_id=null,f.owner.sendBye({status_code:408,reason_phrase:g.causes.SESSION_TIMER}),f.owner.ended("system",null,g.causes.SESSION_TIMER)}),this.session_timer.timer_id=c.setTimeout(b,1e3*a)},clearSessionRefreshTimer:function(){null!==this.session_timer.timer_id&&(c.clearTimeout(this.session_timer.timer_id),this.session_timer.timer_id=null)},disableSessionRefresh:function(){this.session_timer.interval=null,this.clearSessionRefreshTimer()},processSessionTimerHeaders:function(a){if(a.hasHeader("min-se")&&this.updateMinSessionExpires(a.parseHeader("min-se")),!a.hasHeader("session-expires"))return void this.disableSessionRefresh();this.clearSessionRefreshTimer();var b=a.parseHeader("session-expires"),c=!0;if(a instanceof f.IncomingRequest)b.params&&b.params.refresher&&(c="uas"===b.params.refresher);else{if(!(a instanceof f.IncomingResponse))throw new TypeError("Unexpected message type");c="uac"===b.params.refresher}this.session_timer.interval=b.interval,this.session_timer.localRefresher=c,this.setSessionRefreshTimer()},addSessionTimerResponseHeaders:function(a){var b=this.session_timer.interval;if(b){var c=this.session_timer.localRefresher?"uas":"uac";a.push("Session-Expires: "+b+";refresher="+c)}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./DialogId":5,"./JsSIP":11,"./RTCSession":16,"./SIPMessage":26,"./Transactions":29,"./Utils":33}],5:[function(a,b,c){var d=function(a,b,c){this.call_id=a,this.local_tag=b,this.remote_tag=c};d.prototype.toString=function(){return this.call_id+this.local_tag+this.remote_tag},d.prototype.toTargetDialogHeader=function(){return this.call_id+";remote-tag="+this.local_tag+";local-tag="+this.remote_tag},b.exports=d},{}],6:[function(a,b,c){function d(a){this.username=a.configuration.authorization_user,this.password=a.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null}b.exports=d;var e=a("./Utils"),f=a("./JsSIP"),g=f.name+" | DIGEST AUTHENTICATION | ";d.prototype.authenticate=function(a,b){if(this.algorithm=b.algorithm,this.realm=b.realm,this.nonce=b.nonce,this.opaque=b.opaque,this.stale=b.stale,this.algorithm){if("MD5"!==this.algorithm)return console.warn(g+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(g+"challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return console.warn(g+"challenge without Digest nonce, authentication aborted"),!1;if(b.qop)if(b.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(b.qop.indexOf("auth-int")>-1))return console.warn(g+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=a.method,this.uri=a.ruri,this.cnonce=e.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},d.prototype.calculateResponse=function(){var a,b;a=e.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(b=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+b)):"auth-int"===this.qop?(b=e.calculateMD5(this.method+":"+this.uri+":"+e.calculateMD5(this.body?this.body:"")),this.response=e.calculateMD5(a+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+b)):null===this.qop&&(b=e.calculateMD5(this.method+":"+this.uri),this.response=e.calculateMD5(a+":"+this.nonce+":"+b))},d.prototype.toString=function(){var a=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return a.push("algorithm="+this.algorithm),a.push('username="'+this.username+'"'),a.push('realm="'+this.realm+'"'),a.push('nonce="'+this.nonce+'"'),a.push('uri="'+this.uri+'"'),a.push('response="'+this.response+'"'),this.opaque&&a.push('opaque="'+this.opaque+'"'),this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex)),"Digest "+a.join(", ")},d.prototype.updateNcHex=function(){var a=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-a.length)+a}},{"./JsSIP":11,"./Utils":33}],7:[function(a,b,c){function d(){}b.exports=d;var e=a("./JsSIP"),f=e.name+" | EVENT EMITTER | ";d.prototype={initEvents:function(a){var b=a.length;for(this.events={},this.onceNotFired=[],this.maxListeners=10,this.events.newListener=function(a){console.log(f+"new listener added to event "+a)};b--;)console.log(f+"adding event "+a[b]),this.events[a[b]]=[]},checkEvent:function(a){return this.events[a]?!0:(console.error(f+"no event named "+a),!1)},addListener:function(a,b){this.checkEvent(a)&&(this.events[a].length>=this.maxListeners&&console.warn(f+"max listeners exceeded for event "+a),this.events[a].push(b),this.events.newListener.call(null,a))},on:function(a,b){this.addListener(a,b)},once:function(a,b){this.events[a].unshift(b),this.onceNotFired.push(a)},removeListener:function(a,b){if(this.checkEvent(a))for(var c=this.events[a],d=0,e=c.length;e>d;)c[d]&&c[d].toString()===b.toString()?c.splice(d,1):d++},removeAllListener:function(a){this.checkEvent(a)&&(this.events[a]=[])},setMaxListeners:function(a){Number(a)&&(this.maxListeners=a)},listeners:function(a){return this.events[a]},emit:function(a,b,c){var d,e,h=0;if(this.checkEvent(a)){console.log(f+"emitting event "+a),d=this.events[a],e=d.length;var i=new g(a,b,c);if(i)for(h;e>h;h++)try{d[h].apply(null,[i])}catch(j){console.warn(f+"event handler threw exception:\n",j.stack)}else for(h;e>h;h++)try{d[h].call()}catch(j){console.warn(f+"event handler threw exception:\n",j.stack)}h=this.onceNotFired.indexOf(a),-1!==h&&(this.onceNotFired.splice(h,1),this.events[a].shift())}},newListener:function(a){this.events.newListener=a}};var g=function(a,b,c){this.type=a,this.sender=b,this.data=c}},{"./JsSIP":11}],8:[function(a,b,c){(function(a){var c={ConfigurationError:function(){var b=function(b,c){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=b,this.value=c,this.message=this.value?"Invalid value "+a.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return b.prototype=new Error,b}(),InvalidTargetError:function(){var a=function(a){this.code=2,this.name="INVALID_TARGET_ERROR",this.target=a,this.message="Invalid target: "+this.target};return a.prototype=new Error,a}(),InvalidStateError:function(){var a=function(a){this.code=3,this.name="INVALID_STATE_ERROR",this.status=a};return a.prototype=new Error,a}(),RemoteSupportError:function(){var a=function(a){this.code=4,this.name="REMOTE_SUPPORT_ERROR",this.option=a,this.message="Remote UA does not support method/extension: "+a};return a.prototype=new Error,a}()};b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(a,b,c){b.exports=function(){function b(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var c={parse:function(c,d){function e(a){yd>wd||(wd>yd&&(yd=wd,zd=[]),zd.push(a))}function f(){var a;return"\r\n"===c.substr(wd,2)?(a="\r\n",wd+=2):(a=null,0===xd&&e('"\\r\\n"')),a}function g(){var a;return/^[0-9]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[0-9]")),a}function h(){var a;return/^[a-zA-Z]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[a-zA-Z]")),a}function i(){var a;return/^[0-9a-fA-F]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[0-9a-fA-F]")),a}function j(){var a;return a=m(),null===a&&(a=n()),a}function k(){var a;return/^[\0-\xFF]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[\\0-\\xFF]")),a}function l(){var a;return/^["]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e('["]')),a}function m(){var a;return 32===c.charCodeAt(wd)?(a=" ",wd++):(a=null,0===xd&&e('" "')),a}function n(){var a;return 9===c.charCodeAt(wd)?(a="	",wd++):(a=null,0===xd&&e('"\\t"')),a}function o(){var a;return/^[a-zA-Z0-9]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[a-zA-Z0-9]")),a}function p(){var a;return 59===c.charCodeAt(wd)?(a=";",wd++):(a=null,0===xd&&e('";"')),null===a&&(47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"')),null===a&&(63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(64===c.charCodeAt(wd)?(a="@",wd++):(a=null,0===xd&&e('"@"')),null===a&&(38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","'))))))))))),a}function q(){var a;return a=o(),null===a&&(a=r()),a}function r(){var a;return 45===c.charCodeAt(wd)?(a="-",wd++):(a=null,0===xd&&e('"-"')),null===a&&(95===c.charCodeAt(wd)?(a="_",wd++):(a=null,0===xd&&e('"_"')),null===a&&(46===c.charCodeAt(wd)?(a=".",wd++):(a=null,0===xd&&e('"."')),null===a&&(33===c.charCodeAt(wd)?(a="!",wd++):(a=null,0===xd&&e('"!"')),null===a&&(126===c.charCodeAt(wd)?(a="~",wd++):(a=null,0===xd&&e('"~"')),null===a&&(42===c.charCodeAt(wd)?(a="*",wd++):(a=null,0===xd&&e('"*"')),null===a&&(39===c.charCodeAt(wd)?(a="'",wd++):(a=null,0===xd&&e('"\'"')),null===a&&(40===c.charCodeAt(wd)?(a="(",wd++):(a=null,0===xd&&e('"("')),null===a&&(41===c.charCodeAt(wd)?(a=")",wd++):(a=null,0===xd&&e('")"')))))))))),a}function s(){var a,b,d,f;return f=wd,37===c.charCodeAt(wd)?(a="%",wd++):(a=null,0===xd&&e('"%"')),null!==a?(b=i(),null!==b?(d=i(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function t(){var a,b,c,d,e,g;for(d=wd,e=wd,g=wd,a=[],b=j();null!==b;)a.push(b),b=j();if(null!==a?(b=f(),null!==b?a=[a,b]:(a=null,wd=g)):(a=null,wd=g),a=null!==a?a:"",null!==a){if(c=j(),null!==c)for(b=[];null!==c;)b.push(c),c=j();else b=null;null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return null!==a&&(a=function(a){return" "}(d)),null===a&&(wd=d),a}function u(){var a;return a=t(),a=null!==a?a:""}function v(){var a,b,d,f,g;for(f=wd,g=wd,a=[],b=m(),null===b&&(b=n());null!==b;)a.push(b),b=m(),null===b&&(b=n());return null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(wd=f),a}function w(){var a,b,d,e,f,g,h;if(f=wd,g=wd,b=x(),null!==b)for(a=[];null!==b;)a.push(b),b=x();else a=null;if(null!==a){for(b=[],h=wd,d=[],e=t();null!==e;)d.push(e),e=t();for(null!==d?(e=x(),null!==e?d=[d,e]:(d=null,wd=h)):(d=null,wd=h);null!==d;){for(b.push(d),h=wd,d=[],e=t();null!==e;)d.push(e),e=t();null!==d?(e=x(),null!==e?d=[d,e]:(d=null,wd=h)):(d=null,wd=h)}null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return null!==a&&(a=function(a){return c.substring(wd,a)}(f)),null===a&&(wd=f),a}function x(){var a;return/^[!-~]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[!-~]")),null===a&&(a=y()),a}function y(){var a;return/^[\x80-\uFFFF]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[\\x80-\\uFFFF]")),a}function z(){var a;return/^[\x80-\xBF]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[\\x80-\\xBF]")),a}function A(){var a;return a=g(),null===a&&(/^[a-f]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[a-f]"))),a}function B(){var a,b,d;if(d=wd,b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"')))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"'))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(wd,a)}(d)),null===a&&(wd=d),a}function C(){var a,b,d;if(d=wd,b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"')))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(wd,a)}(d)),null===a&&(wd=d),a}function D(){var a;return 40===c.charCodeAt(wd)?(a="(",wd++):(a=null,0===xd&&e('"("')),null===a&&(41===c.charCodeAt(wd)?(a=")",wd++):(a=null,0===xd&&e('")"')),null===a&&(60===c.charCodeAt(wd)?(a="<",wd++):(a=null,0===xd&&e('"<"')),null===a&&(62===c.charCodeAt(wd)?(a=">",wd++):(a=null,0===xd&&e('">"')),
null===a&&(64===c.charCodeAt(wd)?(a="@",wd++):(a=null,0===xd&&e('"@"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","')),null===a&&(59===c.charCodeAt(wd)?(a=";",wd++):(a=null,0===xd&&e('";"')),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(92===c.charCodeAt(wd)?(a="\\",wd++):(a=null,0===xd&&e('"\\\\"')),null===a&&(a=l(),null===a&&(47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"')),null===a&&(91===c.charCodeAt(wd)?(a="[",wd++):(a=null,0===xd&&e('"["')),null===a&&(93===c.charCodeAt(wd)?(a="]",wd++):(a=null,0===xd&&e('"]"')),null===a&&(63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')),null===a&&(123===c.charCodeAt(wd)?(a="{",wd++):(a=null,0===xd&&e('"{"')),null===a&&(125===c.charCodeAt(wd)?(a="}",wd++):(a=null,0===xd&&e('"}"')),null===a&&(a=m(),null===a&&(a=n())))))))))))))))))),a}function E(){var a,b,d;if(d=wd,b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"')),null===b&&(40===c.charCodeAt(wd)?(b="(",wd++):(b=null,0===xd&&e('"("')),null===b&&(41===c.charCodeAt(wd)?(b=")",wd++):(b=null,0===xd&&e('")"')),null===b&&(60===c.charCodeAt(wd)?(b="<",wd++):(b=null,0===xd&&e('"<"')),null===b&&(62===c.charCodeAt(wd)?(b=">",wd++):(b=null,0===xd&&e('">"')),null===b&&(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null===b&&(92===c.charCodeAt(wd)?(b="\\",wd++):(b=null,0===xd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(wd)?(b="/",wd++):(b=null,0===xd&&e('"/"')),null===b&&(91===c.charCodeAt(wd)?(b="[",wd++):(b=null,0===xd&&e('"["')),null===b&&(93===c.charCodeAt(wd)?(b="]",wd++):(b=null,0===xd&&e('"]"')),null===b&&(63===c.charCodeAt(wd)?(b="?",wd++):(b=null,0===xd&&e('"?"')),null===b&&(123===c.charCodeAt(wd)?(b="{",wd++):(b=null,0===xd&&e('"{"')),null===b&&(125===c.charCodeAt(wd)?(b="}",wd++):(b=null,0===xd&&e('"}"'))))))))))))))))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=o(),null===b&&(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null===b&&(46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null===b&&(33===c.charCodeAt(wd)?(b="!",wd++):(b=null,0===xd&&e('"!"')),null===b&&(37===c.charCodeAt(wd)?(b="%",wd++):(b=null,0===xd&&e('"%"')),null===b&&(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null===b&&(95===c.charCodeAt(wd)?(b="_",wd++):(b=null,0===xd&&e('"_"')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(96===c.charCodeAt(wd)?(b="`",wd++):(b=null,0===xd&&e('"`"')),null===b&&(39===c.charCodeAt(wd)?(b="'",wd++):(b=null,0===xd&&e('"\'"')),null===b&&(126===c.charCodeAt(wd)?(b="~",wd++):(b=null,0===xd&&e('"~"')),null===b&&(40===c.charCodeAt(wd)?(b="(",wd++):(b=null,0===xd&&e('"("')),null===b&&(41===c.charCodeAt(wd)?(b=")",wd++):(b=null,0===xd&&e('")"')),null===b&&(60===c.charCodeAt(wd)?(b="<",wd++):(b=null,0===xd&&e('"<"')),null===b&&(62===c.charCodeAt(wd)?(b=">",wd++):(b=null,0===xd&&e('">"')),null===b&&(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null===b&&(92===c.charCodeAt(wd)?(b="\\",wd++):(b=null,0===xd&&e('"\\\\"')),null===b&&(b=l(),null===b&&(47===c.charCodeAt(wd)?(b="/",wd++):(b=null,0===xd&&e('"/"')),null===b&&(91===c.charCodeAt(wd)?(b="[",wd++):(b=null,0===xd&&e('"["')),null===b&&(93===c.charCodeAt(wd)?(b="]",wd++):(b=null,0===xd&&e('"]"')),null===b&&(63===c.charCodeAt(wd)?(b="?",wd++):(b=null,0===xd&&e('"?"')),null===b&&(123===c.charCodeAt(wd)?(b="{",wd++):(b=null,0===xd&&e('"{"')),null===b&&(125===c.charCodeAt(wd)?(b="}",wd++):(b=null,0===xd&&e('"}"')))))))))))))))))))))))));else a=null;return null!==a&&(a=function(a){return c.substring(wd,a)}(d)),null===a&&(wd=d),a}function F(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(42===c.charCodeAt(wd)?(b="*",wd++):(b=null,0===xd&&e('"*"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return"*"}(f)),null===a&&(wd=f),a}function G(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(47===c.charCodeAt(wd)?(b="/",wd++):(b=null,0===xd&&e('"/"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return"/"}(f)),null===a&&(wd=f),a}function H(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return"="}(f)),null===a&&(wd=f),a}function I(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(40===c.charCodeAt(wd)?(b="(",wd++):(b=null,0===xd&&e('"("')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return"("}(f)),null===a&&(wd=f),a}function J(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(41===c.charCodeAt(wd)?(b=")",wd++):(b=null,0===xd&&e('")"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return")"}(f)),null===a&&(wd=f),a}function K(){var a,b,d,f;return d=wd,f=wd,62===c.charCodeAt(wd)?(a=">",wd++):(a=null,0===xd&&e('">"')),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a){return">"}(d)),null===a&&(wd=d),a}function L(){var a,b,d,f;return d=wd,f=wd,a=u(),null!==a?(60===c.charCodeAt(wd)?(b="<",wd++):(b=null,0===xd&&e('"<"')),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a){return"<"}(d)),null===a&&(wd=d),a}function M(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(44===c.charCodeAt(wd)?(b=",",wd++):(b=null,0===xd&&e('","')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return","}(f)),null===a&&(wd=f),a}function N(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(59===c.charCodeAt(wd)?(b=";",wd++):(b=null,0===xd&&e('";"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return";"}(f)),null===a&&(wd=f),a}function O(){var a,b,d,f,g;return f=wd,g=wd,a=u(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=u(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return":"}(f)),null===a&&(wd=f),a}function P(){var a,b,c,d;return c=wd,d=wd,a=u(),null!==a?(b=l(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(wd=c),a}function Q(){var a,b,c,d;return c=wd,d=wd,a=l(),null!==a?(b=u(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),null!==a&&(a=function(a){return'"'}(c)),null===a&&(wd=c),a}function R(){var a,b,c,d;if(d=wd,a=I(),null!==a){for(b=[],c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==c;)b.push(c),c=S(),null===c&&(c=W(),null===c&&(c=R()));null!==b?(c=J(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)}else a=null,wd=d;return a}function S(){var a;return/^[!-']/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[!-']")),null===a&&(/^[*-[]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[*-[]")),null===a&&(/^[\]-~]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[\\]-~]")),null===a&&(a=y(),null===a&&(a=t())))),a}function T(){var a,b,d,e,f,g;if(f=wd,g=wd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,wd=g)):(a=null,wd=g)}else a=null,wd=g;else a=null,wd=g;return null!==a&&(a=function(a){return c.substring(wd,a)}(f)),null===a&&(wd=f),a}function U(){var a,b,d,e,f,g;if(f=wd,g=wd,a=u(),null!==a)if(b=l(),null!==b){for(d=[],e=V(),null===e&&(e=W());null!==e;)d.push(e),e=V(),null===e&&(e=W());null!==d?(e=l(),null!==e?a=[a,b,d,e]:(a=null,wd=g)):(a=null,wd=g)}else a=null,wd=g;else a=null,wd=g;return null!==a&&(a=function(a){return c.substring(wd-1,a+1)}(f)),null===a&&(wd=f),a}function V(){var a;return a=t(),null===a&&(33===c.charCodeAt(wd)?(a="!",wd++):(a=null,0===xd&&e('"!"')),null===a&&(/^[#-[]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[#-[]")),null===a&&(/^[\]-~]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[\\]-~]")),null===a&&(a=y())))),a}function W(){var a,b,d;return d=wd,92===c.charCodeAt(wd)?(a="\\",wd++):(a=null,0===xd&&e('"\\\\"')),null!==a?(/^[\0-\t]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[\\0-\\t]")),null===b&&(/^[\x0B-\f]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[\\x0B-\\f]")),null===b&&(/^[\x0E-]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[\\x0E-]")))),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a}function X(){var a,b,d,f,g,h;return g=wd,h=wd,a=Z(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=$(),d=null!==d?d:"",null!==d?(f=ca(),null!==f?a=[a,b,d,f]:(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h),null!==a&&(a=function(a){try{Cd.uri=new Ad(Cd.scheme,Cd.user,Cd.host,Cd.port),delete Cd.scheme,delete Cd.user,delete Cd.host,delete Cd.host_type,delete Cd.port}catch(b){Cd=-1}}(g)),null===a&&(wd=g),a}function Y(){var a,b,f,g,h,i,j,k;return j=wd,k=wd,a=Z(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(f=$(),f=null!==f?f:"",null!==f?(g=ca(),null!==g?(h=oa(),null!==h?(i=Ba(),i=null!==i?i:"",null!==i?a=[a,b,f,g,h,i]:(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k),null!==a&&(a=function(a){try{Cd.uri=new Ad(Cd.scheme,Cd.user,Cd.host,Cd.port,Cd.uri_params,Cd.uri_headers),delete Cd.scheme,delete Cd.user,delete Cd.host,delete Cd.host_type,delete Cd.port,delete Cd.uri_params,"SIP_URI"===d&&(Cd=Cd.uri)}catch(b){Cd=-1}}(j)),null===a&&(wd=j),a}function Z(){var a,b;return b=wd,"sip"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"sip"')),null!==a&&(a=function(a,b){Cd.scheme=b.toLowerCase()}(b,a)),null===a&&(wd=b),a}function $(){var a,b,d,f,g,h;return f=wd,g=wd,a=_(),null!==a?(h=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ba(),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h),b=null!==b?b:"",null!==b?(64===c.charCodeAt(wd)?(d="@",wd++):(d=null,0===xd&&e('"@"')),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){Cd.user=decodeURIComponent(c.substring(wd-1,a))}(f)),null===a&&(wd=f),a}function _(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(b=aa())),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(b=aa()));else a=null;return a}function aa(){var a;return 38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","')),null===a&&(59===c.charCodeAt(wd)?(a=";",wd++):(a=null,0===xd&&e('";"')),null===a&&(63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null===a&&(47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"'))))))))),a}function ba(){var a,b,d;for(d=wd,a=[],b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(wd)?(b="&",wd++):(b=null,0===xd&&e('"&"')),null===b&&(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(36===c.charCodeAt(wd)?(b="$",wd++):(b=null,0===xd&&e('"$"')),null===b&&(44===c.charCodeAt(wd)?(b=",",wd++):(b=null,0===xd&&e('","'))))))));null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(38===c.charCodeAt(wd)?(b="&",wd++):(b=null,0===xd&&e('"&"')),null===b&&(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')),null===b&&(36===c.charCodeAt(wd)?(b="$",wd++):(b=null,0===xd&&e('"$"')),null===b&&(44===c.charCodeAt(wd)?(b=",",wd++):(b=null,0===xd&&e('","'))))))));return null!==a&&(a=function(a){Cd.password=c.substring(wd,a)}(d)),null===a&&(wd=d),a}function ca(){var a,b,d,f,g;return f=wd,a=da(),null!==a?(g=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=na(),null!==d?b=[b,d]:(b=null,wd=g)):(b=null,wd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),a}function da(){var a,b;return b=wd,a=ea(),null===a&&(a=la(),null===a&&(a=ha())),null!==a&&(a=function(a){return Cd.host=c.substring(wd,a).toLowerCase(),Cd.host}(b)),null===a&&(wd=b),a}function ea(){var a,b,d,f,g,h;for(f=wd,g=wd,a=[],h=wd,b=fa(),null!==b?(46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."')),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h);null!==b;)a.push(b),h=wd,b=fa(),null!==b?(46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."')),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h);return null!==a?(b=ga(),null!==b?(46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."')),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return Cd.host_type="domain",c.substring(wd,a)}(f)),null===a&&(wd=f),a}function fa(){var a,b;if(/^[a-zA-Z0-9_\-]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[a-zA-Z0-9_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z0-9_\-]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[a-zA-Z0-9_\\-]"));else a=null;return a}function ga(){var a,b;if(/^[a-zA-Z_\-]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[a-zA-Z_\\-]")),null!==b)for(a=[];null!==b;)a.push(b),/^[a-zA-Z_\-]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[a-zA-Z_\\-]"));else a=null;return a}function ha(){var a,b,d,f,g;return f=wd,g=wd,91===c.charCodeAt(wd)?(a="[",wd++):(a=null,0===xd&&e('"["')),null!==a?(b=ia(),null!==b?(93===c.charCodeAt(wd)?(d="]",wd++):(d=null,0===xd&&e('"]"')),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return Cd.host_type="IPv6",c.substring(wd,a)}(f)),null===a&&(wd=f),a}function ia(){var a,b,d,f,g,h,i,j,k,l,m,n,o,p,q,r;return p=wd,q=wd,a=ja(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(wd)?(h=":",wd++):(h=null,0===xd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(wd)?(j=":",wd++):(j=null,0===xd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(wd)?(l=":",wd++):(l=null,0===xd&&e('":"')),null!==l?(m=ja(),null!==m?(58===c.charCodeAt(wd)?(n=":",wd++):(n=null,0===xd&&e('":"')),null!==n?(o=ka(),null!==o?a=[a,b,d,f,g,h,i,j,k,l,m,n,o]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(wd)?(k=":",wd++):(k=null,0===xd&&e('":"')),null!==k?(l=ja(),null!==l?(58===c.charCodeAt(wd)?(m=":",wd++):(m=null,0===xd&&e('":"')),null!==m?(n=ka(),null!==n?a=[a,b,d,f,g,h,i,j,k,l,m,n]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(wd)?(k=":",wd++):(k=null,0===xd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ka(),null!==h?a=[a,b,d,f,g,h]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?(58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ka(),null!==f?a=[a,b,d,f]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ka(),null!==b?a=[a,b]:(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,"::"===c.substr(wd,2)?(a="::",wd+=2):(a=null,0===xd&&e('"::"')),null!==a?(b=ja(),null!==b?a=[a,b]:(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?("::"===c.substr(wd,2)?(b="::",wd+=2):(b=null,0===xd&&e('"::"')),null!==b?(d=ja(),null!==d?(58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(wd)?(h=":",wd++):(h=null,0===xd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(wd)?(j=":",wd++):(j=null,0===xd&&e('":"')),null!==j?(k=ja(),null!==k?(58===c.charCodeAt(wd)?(l=":",wd++):(l=null,0===xd&&e('":"')),null!==l?(m=ka(),null!==m?a=[a,b,d,f,g,h,i,j,k,l,m]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?("::"===c.substr(wd,2)?(d="::",wd+=2):(d=null,0===xd&&e('"::"')),null!==d?(f=ja(),null!==f?(58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ja(),null!==j?(58===c.charCodeAt(wd)?(k=":",wd++):(k=null,0===xd&&e('":"')),null!==k?(l=ka(),null!==l?a=[a,b,d,f,g,h,i,j,k,l]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?(r=wd,58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,wd=r)):(d=null,wd=r),d=null!==d?d:"",null!==d?("::"===c.substr(wd,2)?(f="::",wd+=2):(f=null,0===xd&&e('"::"')),null!==f?(g=ja(),null!==g?(58===c.charCodeAt(wd)?(h=":",wd++):(h=null,0===xd&&e('":"')),null!==h?(i=ja(),null!==i?(58===c.charCodeAt(wd)?(j=":",wd++):(j=null,0===xd&&e('":"')),null!==j?(k=ka(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?(r=wd,58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,wd=r)):(d=null,wd=r),d=null!==d?d:"",null!==d?(r=wd,58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,wd=r)):(f=null,wd=r),f=null!==f?f:"",null!==f?("::"===c.substr(wd,2)?(g="::",wd+=2):(g=null,0===xd&&e('"::"')),null!==g?(h=ja(),null!==h?(58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ka(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?(r=wd,58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,wd=r)):(d=null,wd=r),d=null!==d?d:"",null!==d?(r=wd,58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,wd=r)):(f=null,wd=r),f=null!==f?f:"",null!==f?(r=wd,58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,wd=r)):(g=null,wd=r),g=null!==g?g:"",null!==g?("::"===c.substr(wd,2)?(h="::",wd+=2):(h=null,0===xd&&e('"::"')),null!==h?(i=ka(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?(r=wd,58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,wd=r)):(d=null,wd=r),d=null!==d?d:"",null!==d?(r=wd,58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,wd=r)):(f=null,wd=r),f=null!==f?f:"",null!==f?(r=wd,58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,wd=r)):(g=null,wd=r),g=null!==g?g:"",null!==g?(r=wd,58===c.charCodeAt(wd)?(h=":",wd++):(h=null,0===xd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,wd=r)):(h=null,wd=r),h=null!==h?h:"",null!==h?("::"===c.substr(wd,2)?(i="::",wd+=2):(i=null,0===xd&&e('"::"')),null!==i?(j=ja(),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q),null===a&&(q=wd,a=ja(),null!==a?(r=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?b=[b,d]:(b=null,wd=r)):(b=null,wd=r),b=null!==b?b:"",null!==b?(r=wd,58===c.charCodeAt(wd)?(d=":",wd++):(d=null,0===xd&&e('":"')),null!==d?(f=ja(),null!==f?d=[d,f]:(d=null,wd=r)):(d=null,wd=r),d=null!==d?d:"",null!==d?(r=wd,58===c.charCodeAt(wd)?(f=":",wd++):(f=null,0===xd&&e('":"')),null!==f?(g=ja(),null!==g?f=[f,g]:(f=null,wd=r)):(f=null,wd=r),f=null!==f?f:"",null!==f?(r=wd,58===c.charCodeAt(wd)?(g=":",wd++):(g=null,0===xd&&e('":"')),null!==g?(h=ja(),null!==h?g=[g,h]:(g=null,wd=r)):(g=null,wd=r),g=null!==g?g:"",null!==g?(r=wd,58===c.charCodeAt(wd)?(h=":",wd++):(h=null,0===xd&&e('":"')),null!==h?(i=ja(),null!==i?h=[h,i]:(h=null,wd=r)):(h=null,wd=r),h=null!==h?h:"",null!==h?(r=wd,58===c.charCodeAt(wd)?(i=":",wd++):(i=null,0===xd&&e('":"')),null!==i?(j=ja(),null!==j?i=[i,j]:(i=null,wd=r)):(i=null,wd=r),i=null!==i?i:"",null!==i?("::"===c.substr(wd,2)?(j="::",wd+=2):(j=null,0===xd&&e('"::"')),null!==j?a=[a,b,d,f,g,h,i,j]:(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q)):(a=null,wd=q))))))))))))))),null!==a&&(a=function(a){return Cd.host_type="IPv6",c.substring(wd,a)}(p)),null===a&&(wd=p),a}function ja(){var a,b,c,d,e;return e=wd,a=i(),null!==a?(b=i(),b=null!==b?b:"",null!==b?(c=i(),c=null!==c?c:"",null!==c?(d=i(),d=null!==d?d:"",null!==d?a=[a,b,c,d]:(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e),a}function ka(){var a,b,d,f;return f=wd,a=ja(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=ja(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),null===a&&(a=la()),a}function la(){var a,b,d,f,g,h,i,j,k;return j=wd,k=wd,a=ma(),null!==a?(46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null!==b?(d=ma(),null!==d?(46===c.charCodeAt(wd)?(f=".",wd++):(f=null,0===xd&&e('"."')),null!==f?(g=ma(),null!==g?(46===c.charCodeAt(wd)?(h=".",wd++):(h=null,0===xd&&e('"."')),null!==h?(i=ma(),null!==i?a=[a,b,d,f,g,h,i]:(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k)):(a=null,wd=k),null!==a&&(a=function(a){return Cd.host_type="IPv4",c.substring(wd,a)}(j)),null===a&&(wd=j),a}function ma(){var a,b,d,f;return f=wd,"25"===c.substr(wd,2)?(a="25",wd+=2):(a=null,0===xd&&e('"25"')),null!==a?(/^[0-5]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[0-5]")),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null===a&&(f=wd,50===c.charCodeAt(wd)?(a="2",wd++):(a=null,0===xd&&e('"2"')),null!==a?(/^[0-4]/.test(c.charAt(wd))?(b=c.charAt(wd),wd++):(b=null,0===xd&&e("[0-4]")),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),null===a&&(f=wd,49===c.charCodeAt(wd)?(a="1",wd++):(a=null,0===xd&&e('"1"')),null!==a?(b=g(),null!==b?(d=g(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),null===a&&(f=wd,/^[1-9]/.test(c.charAt(wd))?(a=c.charAt(wd),wd++):(a=null,0===xd&&e("[1-9]")),null!==a?(b=g(),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null===a&&(a=g())))),a}function na(){var a,b,c,d,e,f,h;return f=wd,h=wd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h),null!==a&&(a=function(a,b){return b=parseInt(b.join("")),Cd.port=b,b}(f,a)),null===a&&(wd=f),a}function oa(){var a,b,d,f;for(a=[],f=wd,59===c.charCodeAt(wd)?(b=";",wd++):(b=null,0===xd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,wd=f)):(b=null,wd=f);null!==b;)a.push(b),f=wd,59===c.charCodeAt(wd)?(b=";",wd++):(b=null,0===xd&&e('";"')),null!==b?(d=pa(),null!==d?b=[b,d]:(b=null,wd=f)):(b=null,wd=f);return a}function pa(){var a;return a=qa(),null===a&&(a=ra(),null===a&&(a=sa(),null===a&&(a=ta(),null===a&&(a=ua(),null===a&&(a=va(),null===a&&(a=wa())))))),a}function qa(){var a,b,d,f;return d=wd,f=wd,"transport="===c.substr(wd,10).toLowerCase()?(a=c.substr(wd,10),wd+=10):(a=null,0===xd&&e('"transport="')),null!==a?("udp"===c.substr(wd,3).toLowerCase()?(b=c.substr(wd,3),wd+=3):(b=null,0===xd&&e('"udp"')),null===b&&("tcp"===c.substr(wd,3).toLowerCase()?(b=c.substr(wd,3),wd+=3):(b=null,0===xd&&e('"tcp"')),null===b&&("sctp"===c.substr(wd,4).toLowerCase()?(b=c.substr(wd,4),wd+=4):(b=null,0===xd&&e('"sctp"')),null===b&&("tls"===c.substr(wd,3).toLowerCase()?(b=c.substr(wd,3),wd+=3):(b=null,0===xd&&e('"tls"')),null===b&&(b=B())))),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a,b){Cd.uri_params||(Cd.uri_params={}),Cd.uri_params.transport=b.toLowerCase()}(d,a[1])),null===a&&(wd=d),a}function ra(){var a,b,d,f;return d=wd,f=wd,"user="===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"user="')),null!==a?("phone"===c.substr(wd,5).toLowerCase()?(b=c.substr(wd,5),wd+=5):(b=null,0===xd&&e('"phone"')),null===b&&("ip"===c.substr(wd,2).toLowerCase()?(b=c.substr(wd,2),wd+=2):(b=null,0===xd&&e('"ip"')),null===b&&(b=B())),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a,b){Cd.uri_params||(Cd.uri_params={}),Cd.uri_params.user=b.toLowerCase()}(d,a[1])),null===a&&(wd=d),a}function sa(){var a,b,d,f;return d=wd,f=wd,"method="===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"method="')),null!==a?(b=gb(),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a,b){Cd.uri_params||(Cd.uri_params={}),Cd.uri_params.method=b}(d,a[1])),null===a&&(wd=d),a}function ta(){var a,b,d,f;return d=wd,f=wd,"ttl="===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"ttl="')),null!==a?(b=ad(),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a,b){Cd.params||(Cd.params={}),Cd.params.ttl=b}(d,a[1])),null===a&&(wd=d),a}function ua(){var a,b,d,f;return d=wd,f=wd,"maddr="===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"maddr="')),null!==a?(b=da(),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),null!==a&&(a=function(a,b){Cd.uri_params||(Cd.uri_params={}),Cd.uri_params.maddr=b}(d,a[1])),null===a&&(wd=d),a}function va(){var a,b,d,f,g,h;return f=wd,g=wd,"lr"===c.substr(wd,2).toLowerCase()?(a=c.substr(wd,2),wd+=2):(a=null,0===xd&&e('"lr"')),null!==a?(h=wd,61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null!==b?(d=B(),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){Cd.uri_params||(Cd.uri_params={}),Cd.uri_params.lr=void 0}(f)),null===a&&(wd=f),a}function wa(){var a,b,d,f,g,h;return f=wd,g=wd,a=xa(),null!==a?(h=wd,61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null!==b?(d=ya(),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b,c){Cd.uri_params||(Cd.uri_params={}),c="undefined"==typeof c?void 0:c[1],Cd.uri_params[b.toLowerCase()]=c&&c.toLowerCase()}(f,a[0],a[1])),null===a&&(wd=f),a}function xa(){var a,b,c;if(c=wd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(wd=c),a}function ya(){var a,b,c;if(c=wd,b=za(),null!==b)for(a=[];null!==b;)a.push(b),b=za();else a=null;return null!==a&&(a=function(a,b){return b.join("")}(c,a)),null===a&&(wd=c),a}function za(){var a;return a=Aa(),null===a&&(a=q(),null===a&&(a=s())),a}function Aa(){var a;return 91===c.charCodeAt(wd)?(a="[",wd++):(a=null,0===xd&&e('"["')),null===a&&(93===c.charCodeAt(wd)?(a="]",wd++):(a=null,0===xd&&e('"]"')),null===a&&(47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"')),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')))))))),a}function Ba(){var a,b,d,f,g,h,i;if(h=wd,63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null!==a)if(b=Ca(),null!==b){for(d=[],i=wd,38===c.charCodeAt(wd)?(f="&",wd++):(f=null,0===xd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,wd=i)):(f=null,wd=i);null!==f;)d.push(f),i=wd,38===c.charCodeAt(wd)?(f="&",wd++):(f=null,0===xd&&e('"&"')),null!==f?(g=Ca(),null!==g?f=[f,g]:(f=null,wd=i)):(f=null,wd=i);null!==d?a=[a,b,d]:(a=null,wd=h)}else a=null,wd=h;else a=null,wd=h;return a}function Ca(){var a,b,d,f,g;return f=wd,g=wd,a=Da(),null!==a?(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null!==b?(d=Ea(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b,c){b=b.join("").toLowerCase(),c=c.join(""),Cd.uri_headers||(Cd.uri_headers={}),Cd.uri_headers[b]?Cd.uri_headers[b].push(c):Cd.uri_headers[b]=[c]}(f,a[0],a[2])),null===a&&(wd=f),a}function Da(){
var a,b;if(b=Fa(),null===b&&(b=q(),null===b&&(b=s())),null!==b)for(a=[];null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));else a=null;return a}function Ea(){var a,b;for(a=[],b=Fa(),null===b&&(b=q(),null===b&&(b=s()));null!==b;)a.push(b),b=Fa(),null===b&&(b=q(),null===b&&(b=s()));return a}function Fa(){var a;return 91===c.charCodeAt(wd)?(a="[",wd++):(a=null,0===xd&&e('"["')),null===a&&(93===c.charCodeAt(wd)?(a="]",wd++):(a=null,0===xd&&e('"]"')),null===a&&(47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"')),null===a&&(63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')))))))),a}function Ga(){var a;return a=hb(),null===a&&(a=Ha()),a}function Ha(){var a,b,c,d,e,f;return f=wd,a=gb(),null!==a?(b=m(),null!==b?(c=Ia(),null!==c?(d=m(),null!==d?(e=Za(),null!==e?a=[a,b,c,d,e]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function Ia(){var a;return a=Y(),null===a&&(a=Ja()),a}function Ja(){var a,b,d,f;return f=wd,a=Ua(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=Ka(),null===d&&(d=Na()),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function Ka(){var a,b,d,f,g;return f=wd,a=La(),null===a&&(a=Ma()),null!==a?(g=wd,63===c.charCodeAt(wd)?(b="?",wd++):(b=null,0===xd&&e('"?"')),null!==b?(d=Ya(),null!==d?b=[b,d]:(b=null,wd=g)):(b=null,wd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),a}function La(){var a,b,d,f;return f=wd,"//"===c.substr(wd,2)?(a="//",wd+=2):(a=null,0===xd&&e('"//"')),null!==a?(b=Va(),null!==b?(d=Ma(),d=null!==d?d:"",null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function Ma(){var a,b,d;return d=wd,47===c.charCodeAt(wd)?(a="/",wd++):(a=null,0===xd&&e('"/"')),null!==a?(b=Qa(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a}function Na(){var a,b,c,d;if(d=wd,a=Pa(),null!==a){for(b=[],c=Oa();null!==c;)b.push(c),c=Oa();null!==b?a=[a,b]:(a=null,wd=d)}else a=null,wd=d;return a}function Oa(){var a;return a=p(),null===a&&(a=q(),null===a&&(a=s())),a}function Pa(){var a;return a=q(),null===a&&(a=s(),null===a&&(59===c.charCodeAt(wd)?(a=";",wd++):(a=null,0===xd&&e('";"')),null===a&&(63===c.charCodeAt(wd)?(a="?",wd++):(a=null,0===xd&&e('"?"')),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(64===c.charCodeAt(wd)?(a="@",wd++):(a=null,0===xd&&e('"@"')),null===a&&(38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","')))))))))))),a}function Qa(){var a,b,d,f,g,h;if(g=wd,a=Ra(),null!==a){for(b=[],h=wd,47===c.charCodeAt(wd)?(d="/",wd++):(d=null,0===xd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==d;)b.push(d),h=wd,47===c.charCodeAt(wd)?(d="/",wd++):(d=null,0===xd&&e('"/"')),null!==d?(f=Ra(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return a}function Ra(){var a,b,d,f,g,h;for(g=wd,a=[],b=Ta();null!==b;)a.push(b),b=Ta();if(null!==a){for(b=[],h=wd,59===c.charCodeAt(wd)?(d=";",wd++):(d=null,0===xd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==d;)b.push(d),h=wd,59===c.charCodeAt(wd)?(d=";",wd++):(d=null,0===xd&&e('";"')),null!==d?(f=Sa(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return a}function Sa(){var a,b;for(a=[],b=Ta();null!==b;)a.push(b),b=Ta();return a}function Ta(){var a;return a=q(),null===a&&(a=s(),null===a&&(58===c.charCodeAt(wd)?(a=":",wd++):(a=null,0===xd&&e('":"')),null===a&&(64===c.charCodeAt(wd)?(a="@",wd++):(a=null,0===xd&&e('"@"')),null===a&&(38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","')))))))))),a}function Ua(){var a,b,d,f,i;if(f=wd,i=wd,a=h(),null!==a){for(b=[],d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(wd)?(d="+",wd++):(d=null,0===xd&&e('"+"')),null===d&&(45===c.charCodeAt(wd)?(d="-",wd++):(d=null,0===xd&&e('"-"')),null===d&&(46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."'))))));null!==d;)b.push(d),d=h(),null===d&&(d=g(),null===d&&(43===c.charCodeAt(wd)?(d="+",wd++):(d=null,0===xd&&e('"+"')),null===d&&(45===c.charCodeAt(wd)?(d="-",wd++):(d=null,0===xd&&e('"-"')),null===d&&(46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."'))))));null!==b?a=[a,b]:(a=null,wd=i)}else a=null,wd=i;return null!==a&&(a=function(a){Cd.scheme=c.substring(wd,a)}(f)),null===a&&(wd=f),a}function Va(){var a;return a=Wa(),null===a&&(a=Xa()),a}function Wa(){var a,b,d,f;return d=wd,f=wd,a=$(),null!==a?(64===c.charCodeAt(wd)?(b="@",wd++):(b=null,0===xd&&e('"@"')),null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),a=null!==a?a:"",null!==a?(b=ca(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a=null!==a?a:""}function Xa(){var a,b;if(b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(wd)?(b="$",wd++):(b=null,0===xd&&e('"$"')),null===b&&(44===c.charCodeAt(wd)?(b=",",wd++):(b=null,0===xd&&e('","')),null===b&&(59===c.charCodeAt(wd)?(b=";",wd++):(b=null,0===xd&&e('";"')),null===b&&(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null===b&&(64===c.charCodeAt(wd)?(b="@",wd++):(b=null,0===xd&&e('"@"')),null===b&&(38===c.charCodeAt(wd)?(b="&",wd++):(b=null,0===xd&&e('"&"')),null===b&&(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"'))))))))))),null!==b)for(a=[];null!==b;)a.push(b),b=q(),null===b&&(b=s(),null===b&&(36===c.charCodeAt(wd)?(b="$",wd++):(b=null,0===xd&&e('"$"')),null===b&&(44===c.charCodeAt(wd)?(b=",",wd++):(b=null,0===xd&&e('","')),null===b&&(59===c.charCodeAt(wd)?(b=";",wd++):(b=null,0===xd&&e('";"')),null===b&&(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null===b&&(64===c.charCodeAt(wd)?(b="@",wd++):(b=null,0===xd&&e('"@"')),null===b&&(38===c.charCodeAt(wd)?(b="&",wd++):(b=null,0===xd&&e('"&"')),null===b&&(61===c.charCodeAt(wd)?(b="=",wd++):(b=null,0===xd&&e('"="')),null===b&&(43===c.charCodeAt(wd)?(b="+",wd++):(b=null,0===xd&&e('"+"')))))))))));else a=null;return a}function Ya(){var a,b;for(a=[],b=Oa();null!==b;)a.push(b),b=Oa();return a}function Za(){var a,b,d,f,h,i,j,k;if(j=wd,k=wd,"sip"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"SIP"')),null!==a)if(47===c.charCodeAt(wd)?(b="/",wd++):(b=null,0===xd&&e('"/"')),null!==b){if(f=g(),null!==f)for(d=[];null!==f;)d.push(f),f=g();else d=null;if(null!==d)if(46===c.charCodeAt(wd)?(f=".",wd++):(f=null,0===xd&&e('"."')),null!==f){if(i=g(),null!==i)for(h=[];null!==i;)h.push(i),i=g();else h=null;null!==h?a=[a,b,d,f,h]:(a=null,wd=k)}else a=null,wd=k;else a=null,wd=k}else a=null,wd=k;else a=null,wd=k;return null!==a&&(a=function(a){Cd.sip_version=c.substring(wd,a)}(j)),null===a&&(wd=j),a}function $a(){var a;return"INVITE"===c.substr(wd,6)?(a="INVITE",wd+=6):(a=null,0===xd&&e('"INVITE"')),a}function _a(){var a;return"ACK"===c.substr(wd,3)?(a="ACK",wd+=3):(a=null,0===xd&&e('"ACK"')),a}function ab(){var a;return"OPTIONS"===c.substr(wd,7)?(a="OPTIONS",wd+=7):(a=null,0===xd&&e('"OPTIONS"')),a}function bb(){var a;return"BYE"===c.substr(wd,3)?(a="BYE",wd+=3):(a=null,0===xd&&e('"BYE"')),a}function cb(){var a;return"CANCEL"===c.substr(wd,6)?(a="CANCEL",wd+=6):(a=null,0===xd&&e('"CANCEL"')),a}function db(){var a;return"REGISTER"===c.substr(wd,8)?(a="REGISTER",wd+=8):(a=null,0===xd&&e('"REGISTER"')),a}function eb(){var a;return"SUBSCRIBE"===c.substr(wd,9)?(a="SUBSCRIBE",wd+=9):(a=null,0===xd&&e('"SUBSCRIBE"')),a}function fb(){var a;return"NOTIFY"===c.substr(wd,6)?(a="NOTIFY",wd+=6):(a=null,0===xd&&e('"NOTIFY"')),a}function gb(){var a,b;return b=wd,a=$a(),null===a&&(a=_a(),null===a&&(a=ab(),null===a&&(a=bb(),null===a&&(a=cb(),null===a&&(a=db(),null===a&&(a=eb(),null===a&&(a=fb(),null===a&&(a=B())))))))),null!==a&&(a=function(a){return Cd.method=c.substring(wd,a),Cd.method}(b)),null===a&&(wd=b),a}function hb(){var a,b,c,d,e,f;return f=wd,a=Za(),null!==a?(b=m(),null!==b?(c=ib(),null!==c?(d=m(),null!==d?(e=kb(),null!==e?a=[a,b,c,d,e]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function ib(){var a,b;return b=wd,a=jb(),null!==a&&(a=function(a,b){Cd.status_code=parseInt(b.join(""))}(b,a)),null===a&&(wd=b),a}function jb(){var a,b,c,d;return d=wd,a=g(),null!==a?(b=g(),null!==b?(c=g(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function kb(){var a,b,d;for(d=wd,a=[],b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));null!==b;)a.push(b),b=p(),null===b&&(b=q(),null===b&&(b=s(),null===b&&(b=y(),null===b&&(b=z(),null===b&&(b=m(),null===b&&(b=n()))))));return null!==a&&(a=function(a){Cd.reason_phrase=c.substring(wd,a)}(d)),null===a&&(wd=d),a}function lb(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=mb(),null!==a){for(b=[],g=wd,c=M(),null!==c?(d=mb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=M(),null!==c?(d=mb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){Cd=Cd.methods}(e)),null===a&&(wd=e),a}function mb(){var a,b;return b=wd,a=gb(),null!==a&&(a=function(a,b){Cd.methods||(Cd.methods=[]),Cd.methods.push(b)}(b,a)),null===a&&(wd=b),a}function nb(){var a,b,c,d,e,f;if(e=wd,a=Vb(),null!==a){for(b=[],f=wd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=M(),null!==c?(d=Vb(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function ob(){var a,b;return b=wd,a=pb(),null!==a&&(a=function(a,b){Cd=b}(b,a)),null===a&&(wd=b),a}function pb(){var a,b,d,f,g,h;return f=wd,g=wd,a=E(),null!==a?(h=wd,64===c.charCodeAt(wd)?(b="@",wd++):(b=null,0===xd&&e('"@"')),null!==b?(d=E(),null!==d?b=[b,d]:(b=null,wd=h)):(b=null,wd=h),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a){return c.substring(wd,a)}(f)),null===a&&(wd=f),a}function qb(){var a,b,c,d,e,f,g;if(e=wd,a=F(),null===a)if(f=wd,a=rb(),null!==a){for(b=[],g=wd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=M(),null!==c?(d=rb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){Cd.multi_header.forEach(function(a){null===a.parsed&&(Cd=null)}),Cd=null!==Cd?Cd.multi_header:-1}(e)),null===a&&(wd=e),a}function rb(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=ub(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){var b;Cd.multi_header||(Cd.multi_header=[]);try{b=new Bd(Cd.uri,Cd.display_name,Cd.params),delete Cd.uri,delete Cd.display_name,delete Cd.params}catch(c){b=null}Cd.multi_header.push({possition:wd,offset:a,parsed:b})}(e)),null===a&&(wd=e),a}function sb(){var a,b,c,d,e;return e=wd,a=tb(),a=null!==a?a:"",null!==a?(b=L(),null!==b?(c=Y(),null!==c?(d=K(),null!==d?a=[a,b,c,d]:(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e),a}function tb(){var a,b,d,e,f,g,h;if(f=wd,g=wd,a=B(),null!==a){for(b=[],h=wd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,wd=h)):(d=null,wd=h);null!==d;)b.push(d),h=wd,d=t(),null!==d?(e=B(),null!==e?d=[d,e]:(d=null,wd=h)):(d=null,wd=h);null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return null===a&&(a=T()),null!==a&&(a=function(a,b){b=c.substring(wd,a).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),Cd.display_name=b}(f,a)),null===a&&(wd=f),a}function ub(){var a;return a=vb(),null===a&&(a=wb(),null===a&&(a=zb())),a}function vb(){var a,b,d,f,g;return f=wd,g=wd,"q"===c.substr(wd,1).toLowerCase()?(a=c.substr(wd,1),wd++):(a=null,0===xd&&e('"q"')),null!==a?(b=H(),null!==b?(d=yb(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.params||(Cd.params={}),Cd.params.q=b}(f,a[2])),null===a&&(wd=f),a}function wb(){var a,b,d,f,g;return f=wd,g=wd,"expires"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.params||(Cd.params={}),Cd.params.expires=b}(f,a[2])),null===a&&(wd=f),a}function xb(){var a,b,c;if(c=wd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){return parseInt(b.join(""))}(c,a)),null===a&&(wd=c),a}function yb(){var a,b,d,f,h,i,j,k;return i=wd,j=wd,48===c.charCodeAt(wd)?(a="0",wd++):(a=null,0===xd&&e('"0"')),null!==a?(k=wd,46===c.charCodeAt(wd)?(b=".",wd++):(b=null,0===xd&&e('"."')),null!==b?(d=g(),d=null!==d?d:"",null!==d?(f=g(),f=null!==f?f:"",null!==f?(h=g(),h=null!==h?h:"",null!==h?b=[b,d,f,h]:(b=null,wd=k)):(b=null,wd=k)):(b=null,wd=k)):(b=null,wd=k),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=j)):(a=null,wd=j),null!==a&&(a=function(a){return parseFloat(c.substring(wd,a))}(i)),null===a&&(wd=i),a}function zb(){var a,b,c,d,e,f;return d=wd,e=wd,a=B(),null!==a?(f=wd,b=H(),null!==b?(c=Ab(),null!==c?b=[b,c]:(b=null,wd=f)):(b=null,wd=f),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=e)):(a=null,wd=e),null!==a&&(a=function(a,b,c){Cd.params||(Cd.params={}),c="undefined"==typeof c?void 0:c[1],Cd.params[b.toLowerCase()]=c}(d,a[0],a[1])),null===a&&(wd=d),a}function Ab(){var a;return a=B(),null===a&&(a=da(),null===a&&(a=T())),a}function Bb(){var a,b,c,d,e,f;if(e=wd,a=Cb(),null!==a){for(b=[],f=wd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=N(),null!==c?(d=Db(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function Cb(){var a;return"render"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"render"')),null===a&&("session"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"session"')),null===a&&("icon"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"icon"')),null===a&&("alert"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"alert"')),null===a&&(a=B())))),a}function Db(){var a;return a=Eb(),null===a&&(a=zb()),a}function Eb(){var a,b,d,f;return f=wd,"handling"===c.substr(wd,8).toLowerCase()?(a=c.substr(wd,8),wd+=8):(a=null,0===xd&&e('"handling"')),null!==a?(b=H(),null!==b?("optional"===c.substr(wd,8).toLowerCase()?(d=c.substr(wd,8),wd+=8):(d=null,0===xd&&e('"optional"')),null===d&&("required"===c.substr(wd,8).toLowerCase()?(d=c.substr(wd,8),wd+=8):(d=null,0===xd&&e('"required"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function Fb(){var a,b,c,d,e,f;if(e=wd,a=B(),null!==a){for(b=[],f=wd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=M(),null!==c?(d=B(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function Gb(){var a,b,c;if(c=wd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){Cd=parseInt(b.join(""))}(c,a)),null===a&&(wd=c),a}function Hb(){var a,b;return b=wd,a=Ib(),null!==a&&(a=function(a){Cd=c.substring(wd,a)}(b)),null===a&&(wd=b),a}function Ib(){var a,b,c,d,e,f,g,h;if(g=wd,a=Jb(),null!==a)if(b=G(),null!==b)if(c=Ob(),null!==c){for(d=[],h=wd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==e;)d.push(e),h=wd,e=N(),null!==e?(f=Pb(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==d?a=[a,b,c,d]:(a=null,wd=g)}else a=null,wd=g;else a=null,wd=g;else a=null,wd=g;return a}function Jb(){var a;return a=Kb(),null===a&&(a=Lb()),a}function Kb(){var a;return"text"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"text"')),null===a&&("image"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"image"')),null===a&&("audio"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"audio"')),null===a&&("video"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"video"')),null===a&&("application"===c.substr(wd,11).toLowerCase()?(a=c.substr(wd,11),wd+=11):(a=null,0===xd&&e('"application"')),null===a&&(a=Mb()))))),a}function Lb(){var a;return"message"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"message"')),null===a&&("multipart"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"multipart"')),null===a&&(a=Mb())),a}function Mb(){var a;return a=B(),null===a&&(a=Nb()),a}function Nb(){var a,b,d;return d=wd,"x-"===c.substr(wd,2).toLowerCase()?(a=c.substr(wd,2),wd+=2):(a=null,0===xd&&e('"x-"')),null!==a?(b=B(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a}function Ob(){var a;return a=Mb(),null===a&&(a=B()),a}function Pb(){var a,b,c,d;return d=wd,a=B(),null!==a?(b=H(),null!==b?(c=Qb(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function Qb(){var a;return a=B(),null===a&&(a=T()),a}function Rb(){var a,b,c,d;return d=wd,a=Sb(),null!==a?(b=t(),null!==b?(c=gb(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function Sb(){var a,b,c;if(c=wd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){Cd.value=parseInt(b.join(""))}(c,a)),null===a&&(wd=c),a}function Tb(){var a,b;return b=wd,a=xb(),null!==a&&(a=function(a,b){Cd=b}(b,a)),null===a&&(wd=b),a}function Ub(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=Vb(),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a,b){Cd.event=b.join("").toLowerCase()}(e,a[0])),null===a&&(wd=e),a}function Vb(){var a,b,d,f,g,h;if(g=wd,a=C(),null!==a){for(b=[],h=wd,46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==d;)b.push(d),h=wd,46===c.charCodeAt(wd)?(d=".",wd++):(d=null,0===xd&&e('"."')),null!==d?(f=C(),null!==f?d=[d,f]:(d=null,wd=h)):(d=null,wd=h);null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return a}function Wb(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=Xb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){var b=Cd.tag;try{Cd=new Bd(Cd.uri,Cd.display_name,Cd.params),b&&Cd.setParam("tag",b)}catch(c){Cd=-1}}(e)),null===a&&(wd=e),a}function Xb(){var a;return a=Yb(),null===a&&(a=zb()),a}function Yb(){var a,b,d,f,g;return f=wd,g=wd,"tag"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.tag=b}(f,a[2])),null===a&&(wd=f),a}function Zb(){var a,b,c;if(c=wd,b=g(),null!==b)for(a=[];null!==b;)a.push(b),b=g();else a=null;return null!==a&&(a=function(a,b){Cd=parseInt(b.join(""))}(c,a)),null===a&&(wd=c),a}function $b(){var a,b;return b=wd,a=xb(),null!==a&&(a=function(a,b){Cd=b}(b,a)),null===a&&(wd=b),a}function _b(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=xb(),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a,b){Cd=b>=90?b:-1}(e,a[0])),null===a&&(wd=e),a}function ac(){var a,b,c,d,e,f,g,h,i,j;for(h=wd,i=wd,a=[],b=tb();null!==b;)a.push(b),b=tb();if(null!==a)if(b=L(),null!==b)if(c=Y(),null!==c)if(d=K(),null!==d){for(e=[],j=wd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,wd=j)):(f=null,wd=j);null!==f;)e.push(f),j=wd,f=N(),null!==f?(g=zb(),null!==g?f=[f,g]:(f=null,wd=j)):(f=null,wd=j);null!==e?a=[a,b,c,d,e]:(a=null,wd=i)}else a=null,wd=i;else a=null,wd=i;else a=null,wd=i;else a=null,wd=i;return null!==a&&(a=function(a){try{Cd=new Bd(Cd.uri,Cd.display_name,Cd.params)}catch(b){Cd=-1}}(h)),null===a&&(wd=h),a}function bc(){var a;return a=cc()}function cc(){var a,b,d,f,g,h,i,j;if(i=wd,"digest"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"Digest"')),null!==a)if(b=t(),null!==b)if(d=fc(),null!==d){for(f=[],j=wd,g=M(),null!==g?(h=fc(),null!==h?g=[g,h]:(g=null,wd=j)):(g=null,wd=j);null!==g;)f.push(g),j=wd,g=M(),null!==g?(h=fc(),null!==h?g=[g,h]:(g=null,wd=j)):(g=null,wd=j);null!==f?a=[a,b,d,f]:(a=null,wd=i)}else a=null,wd=i;else a=null,wd=i;else a=null,wd=i;return null===a&&(a=dc()),a}function dc(){var a,b,c,d,e,f,g,h;if(g=wd,a=B(),null!==a)if(b=t(),null!==b)if(c=ec(),null!==c){for(d=[],h=wd,e=M(),null!==e?(f=ec(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==e;)d.push(e),h=wd,e=M(),null!==e?(f=ec(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==d?a=[a,b,c,d]:(a=null,wd=g)}else a=null,wd=g;else a=null,wd=g;else a=null,wd=g;return a}function ec(){var a,b,c,d;return d=wd,a=B(),null!==a?(b=H(),null!==b?(c=B(),null===c&&(c=T()),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function fc(){var a;return a=gc(),null===a&&(a=ic(),null===a&&(a=kc(),null===a&&(a=mc(),null===a&&(a=nc(),null===a&&(a=oc(),null===a&&(a=pc(),null===a&&(a=ec()))))))),a}function gc(){var a,b,d,f;return f=wd,"realm"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"realm"')),null!==a?(b=H(),null!==b?(d=hc(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function hc(){var a,b;return b=wd,a=U(),null!==a&&(a=function(a,b){Cd.realm=b}(b,a)),null===a&&(wd=b),a}function ic(){var a,b,d,f,g,h,i,j,k;if(j=wd,"domain"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"domain"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d)if(f=jc(),null!==f){if(g=[],k=wd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;for(null!==h?(i=jc(),null!==i?h=[h,i]:(h=null,wd=k)):(h=null,wd=k);null!==h;){if(g.push(h),k=wd,i=m(),null!==i)for(h=[];null!==i;)h.push(i),i=m();else h=null;null!==h?(i=jc(),null!==i?h=[h,i]:(h=null,wd=k)):(h=null,wd=k)}null!==g?(h=Q(),null!==h?a=[a,b,d,f,g,h]:(a=null,wd=j)):(a=null,wd=j)}else a=null,wd=j;else a=null,wd=j;else a=null,wd=j;else a=null,wd=j;return a}function jc(){var a;return a=Ja(),null===a&&(a=Ma()),a}function kc(){var a,b,d,f;return f=wd,"nonce"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"nonce"')),null!==a?(b=H(),null!==b?(d=lc(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function lc(){var a,b;return b=wd,a=U(),null!==a&&(a=function(a,b){Cd.nonce=b}(b,a)),null===a&&(wd=b),a}function mc(){var a,b,d,f,g;return f=wd,g=wd,"opaque"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"opaque"')),null!==a?(b=H(),null!==b?(d=U(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.opaque=b}(f,a[2])),null===a&&(wd=f),a}function nc(){var a,b,d,f,g;return f=wd,"stale"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"stale"')),null!==a?(b=H(),null!==b?(g=wd,"true"===c.substr(wd,4).toLowerCase()?(d=c.substr(wd,4),wd+=4):(d=null,0===xd&&e('"true"')),null!==d&&(d=function(a){Cd.stale=!0}(g)),null===d&&(wd=g),null===d&&(g=wd,"false"===c.substr(wd,5).toLowerCase()?(d=c.substr(wd,5),wd+=5):(d=null,0===xd&&e('"false"')),null!==d&&(d=function(a){Cd.stale=!1}(g)),null===d&&(wd=g)),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function oc(){var a,b,d,f,g;return f=wd,g=wd,"algorithm"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"algorithm"')),null!==a?(b=H(),null!==b?("md5"===c.substr(wd,3).toLowerCase()?(d=c.substr(wd,3),wd+=3):(d=null,0===xd&&e('"MD5"')),null===d&&("md5-sess"===c.substr(wd,8).toLowerCase()?(d=c.substr(wd,8),wd+=8):(d=null,0===xd&&e('"MD5-sess"')),null===d&&(d=B())),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.algorithm=b.toUpperCase()}(f,a[2])),null===a&&(wd=f),a}function pc(){var a,b,d,f,g,h,i,j,k,l;if(j=wd,"qop"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"qop"')),null!==a)if(b=H(),null!==b)if(d=P(),null!==d){if(k=wd,f=qc(),null!==f){for(g=[],l=wd,44===c.charCodeAt(wd)?(h=",",wd++):(h=null,0===xd&&e('","')),null!==h?(i=qc(),null!==i?h=[h,i]:(h=null,wd=l)):(h=null,wd=l);null!==h;)g.push(h),l=wd,44===c.charCodeAt(wd)?(h=",",wd++):(h=null,0===xd&&e('","')),null!==h?(i=qc(),null!==i?h=[h,i]:(h=null,wd=l)):(h=null,wd=l);null!==g?f=[f,g]:(f=null,wd=k)}else f=null,wd=k;null!==f?(g=Q(),null!==g?a=[a,b,d,f,g]:(a=null,wd=j)):(a=null,wd=j)}else a=null,wd=j;else a=null,wd=j;else a=null,wd=j;return a}function qc(){var a,b;return b=wd,"auth-int"===c.substr(wd,8).toLowerCase()?(a=c.substr(wd,8),wd+=8):(a=null,0===xd&&e('"auth-int"')),null===a&&("auth"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"auth"')),null===a&&(a=B())),null!==a&&(a=function(a,b){Cd.qop||(Cd.qop=[]),Cd.qop.push(b.toLowerCase())}(b,a)),null===a&&(wd=b),a}function rc(){var a,b,c,d,e,f;if(e=wd,a=sc(),null!==a){for(b=[],f=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function sc(){var a,b;return b=wd,a=B(),null!==a&&(a=function(a,b){Cd.options||(Cd.options=[]),Cd.options.push(b)}(b,a)),null===a&&(wd=b),a}function tc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=uc(),null!==a){for(b=[],g=wd,c=M(),null!==c?(d=uc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=M(),null!==c?(d=uc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){Cd.multi_header.forEach(function(a){null===a.parsed&&(Cd=null)}),Cd=null!==Cd?Cd.multi_header:-1}(e)),null===a&&(wd=e),a}function uc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=sb(),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){var b;Cd.multi_header||(Cd.multi_header=[]);try{b=new Bd(Cd.uri,Cd.display_name,Cd.params),delete Cd.uri,delete Cd.display_name,delete Cd.params}catch(c){b=null}Cd.multi_header.push({possition:wd,offset:a,parsed:b})}(e)),null===a&&(wd=e),a}function vc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){try{Cd=new Bd(Cd.uri,Cd.display_name,Cd.params)}catch(b){Cd=-1}}(e)),null===a&&(wd=e),a}function wc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=sc(),null!==a){for(b=[],g=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){Cd=Cd.options}(e)),null===a&&(wd=e),a}function xc(){var a,b,c,d,e,f;if(e=wd,a=yc(),null!==a){for(b=[],f=wd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=M(),null!==c?(d=yc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function yc(){var a,b,c,d,e,f;if(e=wd,a=sb(),null!==a){for(b=[],f=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=N(),null!==c?(d=zb(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function zc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=xb(),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=Ac(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=Ac(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a,b){Cd.interval=b}(e,a[0])),null===a&&(wd=e),a}function Ac(){var a;return a=Bc(),null===a&&(a=zb()),a}function Bc(){var a,b,d,f,g;return f=wd,g=wd,"refresher"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"refresher"')),null!==a?(b=H(),null!==b?("uas"===c.substr(wd,3).toLowerCase()?(d=c.substr(wd,3),wd+=3):(d=null,0===xd&&e('"uas"')),null===d&&("uac"===c.substr(wd,3).toLowerCase()?(d=c.substr(wd,3),wd+=3):(d=null,0===xd&&e('"uac"'))),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.params||(Cd.params={}),Cd.params.refresher=b}(f,a[2])),null===a&&(wd=f),a}function Cc(){var a,b,c,d,e,f;if(e=wd,a=Dc(),null!==a){for(b=[],f=wd,c=N(),null!==c?(d=Ec(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=N(),null!==c?(d=Ec(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function Dc(){var a,b;return b=wd,"active"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"active"')),null===a&&("pending"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"pending"')),null===a&&("terminated"===c.substr(wd,10).toLowerCase()?(a=c.substr(wd,10),wd+=10):(a=null,0===xd&&e('"terminated"')),null===a&&(a=B()))),null!==a&&(a=function(a){Cd.state=c.substring(wd,a)}(b)),null===a&&(wd=b),a}function Ec(){var a,b,d,f,g;return f=wd,g=wd,"reason"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"reason"')),null!==a?(b=H(),null!==b?(d=Fc(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Cd.reason=b)}(f,a[2])),null===a&&(wd=f),null===a&&(f=wd,g=wd,"expires"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"expires"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Cd.expires=b)}(f,a[2])),null===a&&(wd=f),null===a&&(f=wd,g=wd,"retry_after"===c.substr(wd,11).toLowerCase()?(a=c.substr(wd,11),wd+=11):(a=null,0===xd&&e('"retry_after"')),null!==a?(b=H(),null!==b?(d=xb(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){"undefined"!=typeof b&&(Cd.retry_after=b)}(f,a[2])),null===a&&(wd=f),null===a&&(a=zb()))),a}function Fc(){var a;return"deactivated"===c.substr(wd,11).toLowerCase()?(a=c.substr(wd,11),wd+=11):(a=null,0===xd&&e('"deactivated"')),null===a&&("probation"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"probation"')),null===a&&("rejected"===c.substr(wd,8).toLowerCase()?(a=c.substr(wd,8),wd+=8):(a=null,0===xd&&e('"rejected"')),null===a&&("timeout"===c.substr(wd,7).toLowerCase()?(a=c.substr(wd,7),wd+=7):(a=null,0===xd&&e('"timeout"')),null===a&&("giveup"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"giveup"')),
null===a&&("noresource"===c.substr(wd,10).toLowerCase()?(a=c.substr(wd,10),wd+=10):(a=null,0===xd&&e('"noresource"')),null===a&&("invariant"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"invariant"')),null===a&&(a=B()))))))),a}function Gc(){var a;return a=w(),a=null!==a?a:""}function Hc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=sc(),null!==a){for(b=[],g=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=M(),null!==c?(d=sc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return a=null!==a?a:"",null!==a&&(a=function(a){Cd=Cd.options||[]}(e)),null===a&&(wd=e),a}function Ic(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=pb(),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=Jc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=Jc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a,b){Cd.call_id=b}(e,a[0])),null===a&&(wd=e),a}function Jc(){var a;return a=Kc(),null===a&&(a=Lc(),null===a&&(a=zb())),a}function Kc(){var a,b,d,f,g;return f=wd,g=wd,"remote-tag"===c.substr(wd,10).toLowerCase()?(a=c.substr(wd,10),wd+=10):(a=null,0===xd&&e('"remote-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.remote_tag=b}(f,a[2])),null===a&&(wd=f),a}function Lc(){var a,b,d,f,g;return f=wd,g=wd,"local-tag"===c.substr(wd,9).toLowerCase()?(a=c.substr(wd,9),wd+=9):(a=null,0===xd&&e('"local-tag"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.local_tag=b}(f,a[2])),null===a&&(wd=f),a}function Mc(){var a,b,c,d,e,f,g;if(e=wd,f=wd,a=X(),null===a&&(a=sb()),null!==a){for(b=[],g=wd,c=N(),null!==c?(d=Nc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==c;)b.push(c),g=wd,c=N(),null!==c?(d=Nc(),null!==d?c=[c,d]:(c=null,wd=g)):(c=null,wd=g);null!==b?a=[a,b]:(a=null,wd=f)}else a=null,wd=f;return null!==a&&(a=function(a){var b=Cd.tag;try{Cd=new Bd(Cd.uri,Cd.display_name,Cd.params),b&&Cd.setParam("tag",b)}catch(c){Cd=-1}}(e)),null===a&&(wd=e),a}function Nc(){var a;return a=Yb(),null===a&&(a=zb()),a}function Oc(){var a,b,c,d,e,f;if(e=wd,a=Pc(),null!==a){for(b=[],f=wd,c=M(),null!==c?(d=Pc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==c;)b.push(c),f=wd,c=M(),null!==c?(d=Pc(),null!==d?c=[c,d]:(c=null,wd=f)):(c=null,wd=f);null!==b?a=[a,b]:(a=null,wd=e)}else a=null,wd=e;return a}function Pc(){var a,b,c,d,e,f,g,h;if(g=wd,a=Wc(),null!==a)if(b=t(),null!==b)if(c=Zc(),null!==c){for(d=[],h=wd,e=N(),null!==e?(f=Qc(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==e;)d.push(e),h=wd,e=N(),null!==e?(f=Qc(),null!==f?e=[e,f]:(e=null,wd=h)):(e=null,wd=h);null!==d?a=[a,b,c,d]:(a=null,wd=g)}else a=null,wd=g;else a=null,wd=g;else a=null,wd=g;return a}function Qc(){var a;return a=Rc(),null===a&&(a=Sc(),null===a&&(a=Tc(),null===a&&(a=Uc(),null===a&&(a=Vc(),null===a&&(a=zb()))))),a}function Rc(){var a,b,d,f,g;return f=wd,g=wd,"ttl"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"ttl"')),null!==a?(b=H(),null!==b?(d=ad(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.ttl=b}(f,a[2])),null===a&&(wd=f),a}function Sc(){var a,b,d,f,g;return f=wd,g=wd,"maddr"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"maddr"')),null!==a?(b=H(),null!==b?(d=da(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.maddr=b}(f,a[2])),null===a&&(wd=f),a}function Tc(){var a,b,d,f,g;return f=wd,g=wd,"received"===c.substr(wd,8).toLowerCase()?(a=c.substr(wd,8),wd+=8):(a=null,0===xd&&e('"received"')),null!==a?(b=H(),null!==b?(d=la(),null===d&&(d=ia()),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.received=b}(f,a[2])),null===a&&(wd=f),a}function Uc(){var a,b,d,f,g;return f=wd,g=wd,"branch"===c.substr(wd,6).toLowerCase()?(a=c.substr(wd,6),wd+=6):(a=null,0===xd&&e('"branch"')),null!==a?(b=H(),null!==b?(d=B(),null!==d?a=[a,b,d]:(a=null,wd=g)):(a=null,wd=g)):(a=null,wd=g),null!==a&&(a=function(a,b){Cd.branch=b}(f,a[2])),null===a&&(wd=f),a}function Vc(){var a,b,d,f,h,i,j;if(h=wd,i=wd,"rport"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"rport"')),null!==a){if(j=wd,b=H(),null!==b){for(d=[],f=g();null!==f;)d.push(f),f=g();null!==d?b=[b,d]:(b=null,wd=j)}else b=null,wd=j;b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=i)}else a=null,wd=i;return null!==a&&(a=function(a){"undefined"!=typeof response_port&&(Cd.rport=response_port.join(""))}(h)),null===a&&(wd=h),a}function Wc(){var a,b,c,d,e,f;return f=wd,a=Xc(),null!==a?(b=G(),null!==b?(c=B(),null!==c?(d=G(),null!==d?(e=Yc(),null!==e?a=[a,b,c,d,e]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function Xc(){var a,b;return b=wd,"sip"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"SIP"')),null===a&&(a=B()),null!==a&&(a=function(a,b){Cd.protocol=b}(b,a)),null===a&&(wd=b),a}function Yc(){var a,b;return b=wd,"udp"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"UDP"')),null===a&&("tcp"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"TCP"')),null===a&&("tls"===c.substr(wd,3).toLowerCase()?(a=c.substr(wd,3),wd+=3):(a=null,0===xd&&e('"TLS"')),null===a&&("sctp"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"SCTP"')),null===a&&(a=B())))),null!==a&&(a=function(a,b){Cd.transport=b}(b,a)),null===a&&(wd=b),a}function Zc(){var a,b,c,d,e;return d=wd,a=$c(),null!==a?(e=wd,b=O(),null!==b?(c=_c(),null!==c?b=[b,c]:(b=null,wd=e)):(b=null,wd=e),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a}function $c(){var a,b;return b=wd,a=ea(),null===a&&(a=la(),null===a&&(a=ha())),null!==a&&(a=function(a){Cd.host=c.substring(wd,a)}(b)),null===a&&(wd=b),a}function _c(){var a,b,c,d,e,f,h;return f=wd,h=wd,a=g(),a=null!==a?a:"",null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?(d=g(),d=null!==d?d:"",null!==d?(e=g(),e=null!==e?e:"",null!==e?a=[a,b,c,d,e]:(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h),null!==a&&(a=function(a,b){Cd.port=parseInt(b.join(""))}(f,a)),null===a&&(wd=f),a}function ad(){var a,b,c,d,e;return d=wd,e=wd,a=g(),null!==a?(b=g(),b=null!==b?b:"",null!==b?(c=g(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e),null!==a&&(a=function(a,b){return parseInt(b.join(""))}(d,a)),null===a&&(wd=d),a}function bd(){var a;return a=cc()}function cd(){var a,b,c,d;return d=wd,a=B(),null!==a?(b=v(),null!==b?(c=dd(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function dd(){var a,b;for(a=[],b=x(),null===b&&(b=z(),null===b&&(b=t()));null!==b;)a.push(b),b=x(),null===b&&(b=z(),null===b&&(b=t()));return a}function ed(){var a,b;for(a=[],b=k();null!==b;)a.push(b),b=k();return a}function fd(){var a,b,d,f;return f=wd,a=gd(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=hd(),null!==d?a=[a,b,d]:(a=null,wd=f)):(a=null,wd=f)):(a=null,wd=f),a}function gd(){var a,b;return b=wd,"stuns"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"stuns"')),null===a&&("stun"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"stun"'))),null!==a&&(a=function(a,b){Cd.scheme=b}(b,a)),null===a&&(wd=b),a}function hd(){var a,b,d,f,g;return f=wd,a=id(),null!==a?(g=wd,58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=na(),null!==d?b=[b,d]:(b=null,wd=g)):(b=null,wd=g),b=null!==b?b:"",null!==b?a=[a,b]:(a=null,wd=f)):(a=null,wd=f),a}function id(){var a,b;return b=wd,a=la(),null===a&&(a=ha(),null===a&&(a=Xa())),null!==a&&(a=function(a,b){Cd.host=b}(b,a)),null===a&&(wd=b),a}function Xa(){var a,b,d;for(d=wd,a=[],b=jd(),null===b&&(b=s(),null===b&&(b=kd()));null!==b;)a.push(b),b=jd(),null===b&&(b=s(),null===b&&(b=kd()));return null!==a&&(a=function(a){return c.substring(wd,a)}(d)),null===a&&(wd=d),a}function jd(){var a;return a=h(),null===a&&(a=g(),null===a&&(45===c.charCodeAt(wd)?(a="-",wd++):(a=null,0===xd&&e('"-"')),null===a&&(46===c.charCodeAt(wd)?(a=".",wd++):(a=null,0===xd&&e('"."')),null===a&&(95===c.charCodeAt(wd)?(a="_",wd++):(a=null,0===xd&&e('"_"')),null===a&&(126===c.charCodeAt(wd)?(a="~",wd++):(a=null,0===xd&&e('"~"'))))))),a}function kd(){var a;return 33===c.charCodeAt(wd)?(a="!",wd++):(a=null,0===xd&&e('"!"')),null===a&&(36===c.charCodeAt(wd)?(a="$",wd++):(a=null,0===xd&&e('"$"')),null===a&&(38===c.charCodeAt(wd)?(a="&",wd++):(a=null,0===xd&&e('"&"')),null===a&&(39===c.charCodeAt(wd)?(a="'",wd++):(a=null,0===xd&&e('"\'"')),null===a&&(40===c.charCodeAt(wd)?(a="(",wd++):(a=null,0===xd&&e('"("')),null===a&&(41===c.charCodeAt(wd)?(a=")",wd++):(a=null,0===xd&&e('")"')),null===a&&(42===c.charCodeAt(wd)?(a="*",wd++):(a=null,0===xd&&e('"*"')),null===a&&(43===c.charCodeAt(wd)?(a="+",wd++):(a=null,0===xd&&e('"+"')),null===a&&(44===c.charCodeAt(wd)?(a=",",wd++):(a=null,0===xd&&e('","')),null===a&&(59===c.charCodeAt(wd)?(a=";",wd++):(a=null,0===xd&&e('";"')),null===a&&(61===c.charCodeAt(wd)?(a="=",wd++):(a=null,0===xd&&e('"="')))))))))))),a}function ld(){var a,b,d,f,g,h,i;return h=wd,a=md(),null!==a?(58===c.charCodeAt(wd)?(b=":",wd++):(b=null,0===xd&&e('":"')),null!==b?(d=hd(),null!==d?(i=wd,"?transport="===c.substr(wd,11)?(f="?transport=",wd+=11):(f=null,0===xd&&e('"?transport="')),null!==f?(g=Yc(),null!==g?f=[f,g]:(f=null,wd=i)):(f=null,wd=i),f=null!==f?f:"",null!==f?a=[a,b,d,f]:(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h)):(a=null,wd=h),a}function md(){var a,b;return b=wd,"turns"===c.substr(wd,5).toLowerCase()?(a=c.substr(wd,5),wd+=5):(a=null,0===xd&&e('"turns"')),null===a&&("turn"===c.substr(wd,4).toLowerCase()?(a=c.substr(wd,4),wd+=4):(a=null,0===xd&&e('"turn"'))),null!==a&&(a=function(a,b){Cd.scheme=b}(b,a)),null===a&&(wd=b),a}function nd(){var a,b,d,f,g;if(f=wd,g=wd,a=Yc(),null!==a){if("udp"===c.substr(wd,3).toLowerCase()?(b=c.substr(wd,3),wd+=3):(b=null,0===xd&&e('"udp"')),null===b&&("tcp"===c.substr(wd,3).toLowerCase()?(b=c.substr(wd,3),wd+=3):(b=null,0===xd&&e('"tcp"')),null===b))for(b=[],d=q();null!==d;)b.push(d),d=q();null!==b?a=[a,b]:(a=null,wd=g)}else a=null,wd=g;return null!==a&&(a=function(a){Cd.transport=transport}(f)),null===a&&(wd=f),a}function od(){var a,b,d;return d=wd,"uuid:"===c.substr(wd,5)?(a="uuid:",wd+=5):(a=null,0===xd&&e('"uuid:"')),null!==a?(b=pd(),null!==b?a=[a,b]:(a=null,wd=d)):(a=null,wd=d),a}function pd(){var a,b,d,f,g,h,i,j,k,l,m;return l=wd,m=wd,a=rd(),null!==a?(45===c.charCodeAt(wd)?(b="-",wd++):(b=null,0===xd&&e('"-"')),null!==b?(d=qd(),null!==d?(45===c.charCodeAt(wd)?(f="-",wd++):(f=null,0===xd&&e('"-"')),null!==f?(g=qd(),null!==g?(45===c.charCodeAt(wd)?(h="-",wd++):(h=null,0===xd&&e('"-"')),null!==h?(i=qd(),null!==i?(45===c.charCodeAt(wd)?(j="-",wd++):(j=null,0===xd&&e('"-"')),null!==j?(k=sd(),null!==k?a=[a,b,d,f,g,h,i,j,k]:(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m)):(a=null,wd=m),null!==a&&(a=function(a,b){Cd=c.substring(wd+5,a)}(l,a[0])),null===a&&(wd=l),a}function qd(){var a,b,c,d,e;return e=wd,a=i(),null!==a?(b=i(),null!==b?(c=i(),null!==c?(d=i(),null!==d?a=[a,b,c,d]:(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e)):(a=null,wd=e),a}function rd(){var a,b,c;return c=wd,a=qd(),null!==a?(b=qd(),null!==b?a=[a,b]:(a=null,wd=c)):(a=null,wd=c),a}function sd(){var a,b,c,d;return d=wd,a=qd(),null!==a?(b=qd(),null!==b?(c=qd(),null!==c?a=[a,b,c]:(a=null,wd=d)):(a=null,wd=d)):(a=null,wd=d),a}function td(a){a.sort();for(var b=null,c=[],d=0;d<a.length;d++)a[d]!==b&&(c.push(a[d]),b=a[d]);return c}function ud(){for(var a=1,b=1,d=!1,e=0;e<Math.max(wd,yd);e++){var f=c.charAt(e);"\n"===f?(d||a++,b=1,d=!1):"\r"===f||"\u2028"===f||"\u2029"===f?(a++,b=1,d=!0):(b++,d=!1)}return{line:a,column:b}}var vd={CRLF:f,DIGIT:g,ALPHA:h,HEXDIG:i,WSP:j,OCTET:k,DQUOTE:l,SP:m,HTAB:n,alphanum:o,reserved:p,unreserved:q,mark:r,escaped:s,LWS:t,SWS:u,HCOLON:v,TEXT_UTF8_TRIM:w,TEXT_UTF8char:x,UTF8_NONASCII:y,UTF8_CONT:z,LHEX:A,token:B,token_nodot:C,separators:D,word:E,STAR:F,SLASH:G,EQUAL:H,LPAREN:I,RPAREN:J,RAQUOT:K,LAQUOT:L,COMMA:M,SEMI:N,COLON:O,LDQUOT:P,RDQUOT:Q,comment:R,ctext:S,quoted_string:T,quoted_string_clean:U,qdtext:V,quoted_pair:W,SIP_URI_noparams:X,SIP_URI:Y,uri_scheme:Z,userinfo:$,user:_,user_unreserved:aa,password:ba,hostport:ca,host:da,hostname:ea,domainlabel:fa,toplabel:ga,IPv6reference:ha,IPv6address:ia,h16:ja,ls32:ka,IPv4address:la,dec_octet:ma,port:na,uri_parameters:oa,uri_parameter:pa,transport_param:qa,user_param:ra,method_param:sa,ttl_param:ta,maddr_param:ua,lr_param:va,other_param:wa,pname:xa,pvalue:ya,paramchar:za,param_unreserved:Aa,headers:Ba,header:Ca,hname:Da,hvalue:Ea,hnv_unreserved:Fa,Request_Response:Ga,Request_Line:Ha,Request_URI:Ia,absoluteURI:Ja,hier_part:Ka,net_path:La,abs_path:Ma,opaque_part:Na,uric:Oa,uric_no_slash:Pa,path_segments:Qa,segment:Ra,param:Sa,pchar:Ta,scheme:Ua,authority:Va,srvr:Wa,reg_name:Xa,query:Ya,SIP_Version:Za,INVITEm:$a,ACKm:_a,OPTIONSm:ab,BYEm:bb,CANCELm:cb,REGISTERm:db,SUBSCRIBEm:eb,NOTIFYm:fb,Method:gb,Status_Line:hb,Status_Code:ib,extension_code:jb,Reason_Phrase:kb,Allow:lb,allow_method:mb,Allow_Events:nb,Call_ID:ob,call_id:pb,Contact:qb,contact_param:rb,name_addr:sb,display_name:tb,contact_params:ub,c_p_q:vb,c_p_expires:wb,delta_seconds:xb,qvalue:yb,generic_param:zb,gen_value:Ab,Content_Disposition:Bb,disp_type:Cb,disp_param:Db,handling_param:Eb,Content_Encoding:Fb,Content_Length:Gb,Content_Type:Hb,media_type:Ib,m_type:Jb,discrete_type:Kb,composite_type:Lb,extension_token:Mb,x_token:Nb,m_subtype:Ob,m_parameter:Pb,m_value:Qb,CSeq:Rb,CSeq_value:Sb,Expires:Tb,Event:Ub,event_type:Vb,From:Wb,from_param:Xb,tag_param:Yb,Max_Forwards:Zb,Min_Expires:$b,Min_SE:_b,Name_Addr_Header:ac,Proxy_Authenticate:bc,challenge:cc,other_challenge:dc,auth_param:ec,digest_cln:fc,realm:gc,realm_value:hc,domain:ic,URI:jc,nonce:kc,nonce_value:lc,opaque:mc,stale:nc,algorithm:oc,qop_options:pc,qop_value:qc,Proxy_Require:rc,option_tag:sc,Record_Route:tc,rec_route:uc,Refer_To:vc,Require:wc,Route:xc,route_param:yc,Session_Expires:zc,se_param:Ac,refresher_param:Bc,Subscription_State:Cc,substate_value:Dc,subexp_params:Ec,event_reason_value:Fc,Subject:Gc,Supported:Hc,Target_Dialog:Ic,td_param:Jc,remote_param:Kc,local_param:Lc,To:Mc,to_param:Nc,Via:Oc,via_parm:Pc,via_params:Qc,via_ttl:Rc,via_maddr:Sc,via_received:Tc,via_branch:Uc,response_port:Vc,sent_protocol:Wc,protocol_name:Xc,transport:Yc,sent_by:Zc,via_host:$c,via_port:_c,ttl:ad,WWW_Authenticate:bd,extension_header:cd,header_value:dd,message_body:ed,stun_URI:fd,stun_scheme:gd,stun_host_port:hd,stun_host:id,reg_name:Xa,stun_unreserved:jd,sub_delims:kd,turn_URI:ld,turn_scheme:md,turn_transport:nd,uuid_URI:od,uuid:pd,hex4:qd,hex8:rd,hex12:sd};if(void 0!==d){if(void 0===vd[d])throw new Error("Invalid rule name: "+b(d)+".")}else d="CRLF";var wd=0,xd=0,yd=0,zd=[],Ad=a("./URI"),Bd=a("./NameAddrHeader"),Cd={},Dd=vd[d]();if(null===Dd||wd!==c.length){var Ed=Math.max(wd,yd),Fd=Ed<c.length?c.charAt(Ed):null,Gd=ud();return new this.SyntaxError(td(zd),Fd,Ed,Gd.line,Gd.column),-1}return Cd},toSource:function(){return this._source}};return c.SyntaxError=function(a,c,d,e,f){function g(a,c){var d,e;switch(a.length){case 0:d="end of input";break;case 1:d=a[0];break;default:d=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}return e=c?b(c):"end of input","Expected "+d+" but "+e+" found."}this.name="SyntaxError",this.expected=a,this.found=c,this.message=g(a,c),this.offset=d,this.line=e,this.column=f},c.SyntaxError.prototype=Error.prototype,c}()},{"./NameAddrHeader":13,"./URI":32}],10:[function(a,b,c){function d(a){this.applicant=a,this.request=a.request}b.exports=d;var e=a("./Constants"),f=a("./RequestSender");d.prototype={send:function(){var a=new f(this,this.applicant.session.ua);a.send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout(),this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError(),this.applicant.onTransportError()},receiveResponse:function(a){(408===a.status_code||481===a.status_code)&&(this.request.method!==e.BYE&&this.applicant.session.sendBye({status_code:a.status_code,reason_phrase:a.reason_phrase}),this.applicant.session.ended("remote",a,e.causes.DIALOG_ERROR)),this.applicant.receiveResponse(a)}}},{"./Constants":3,"./RequestSender":25}],11:[function(a,b,c){var d=a("../package.json"),e=b.exports={};Object.defineProperties(e,{name:{get:function(){return d.title}},version:{get:function(){return d.version}}}),e.C=a("./Constants"),e.Exceptions=a("./Exceptions"),e.Utils=a("./Utils"),e.UA=a("./UA"),e.URI=a("./URI"),e.NameAddrHeader=a("./NameAddrHeader"),e.Grammar=a("./Grammar")},{"../package.json":35,"./Constants":3,"./Exceptions":8,"./Grammar":9,"./NameAddrHeader":13,"./UA":31,"./URI":32,"./Utils":33}],12:[function(a,b,c){function d(a){this.ua=a,this.direction=null,this.local_identity=null,this.remote_identity=null,this.data={}}b.exports=d;var e=a("./Constants"),f=a("./SIPMessage"),g=a("./Utils"),h=a("./RequestSender"),i=a("./Transactions"),j=a("./URI"),k=a("./EventEmitter");d.prototype=new k,d.prototype.send=function(a,b,c){var d,i,k,l,m,n=["succeeded","failed"],o=!1;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");this.initEvents(n),c=c||{},m=c.extraHeaders||[],l=c.eventHandlers||{},k=c.contentType||"text/plain";for(i in l)l.hasOwnProperty(i)&&this.on(i,l[i]);try{a=g.normalizeURI(a,this.ua.configuration.hostport_params)}catch(p){a=j.parse(e.INVALID_TARGET_URI),o=!0}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=a,this.closed=!1,this.ua.applicants[this]=this,m.push("Content-Type: "+k),this.request=new f.OutgoingRequest(e.MESSAGE,a,this.ua,null,m),b&&(this.request.body=b),d=new h(this,this.ua),this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request}),o?this.emit("failed",this,{originator:"local",cause:e.causes.INVALID_TARGET}):d.send()},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:a});break;default:delete this.ua.applicants[this],b=g.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.causes.CONNECTION_ERROR})},d.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},d.prototype.init_incoming=function(a){var b;this.direction="incoming",this.request=a,this.local_identity=a.to.uri,this.remote_identity=a.from.uri,this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:a}),b=this.ua.transactions.nist[a.via_branch],!b||b.state!==i.C.STATUS_TRYING&&b.state!==i.C.STATUS_PROCEEDING||a.reply(200)},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,b,c)},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e)}},{"./Constants":3,"./EventEmitter":7,"./RequestSender":25,"./SIPMessage":26,"./Transactions":29,"./URI":32,"./Utils":33}],13:[function(a,b,c){(function(c){function d(a,b,c){var d;if(!(a&&a instanceof e))throw new TypeError('missing or invalid "uri" parameter');this.uri=a,this.parameters={};for(d in c)c.hasOwnProperty(d)&&this.setParam(d,c[d]);Object.defineProperties(this,{display_name:{get:function(){return b},set:function(a){b=0===a?"0":a}}})}b.exports=d;var e=a("./URI"),f=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={}},clone:function(){return new d(this.uri.clone(),this.display_name,c.JSON.parse(c.JSON.stringify(this.parameters)))},toString:function(){var a,b;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",a+="<"+this.uri.toString()+">";for(b in this.parameters)this.parameters.hasOwnProperty(b)&&(a+=";"+b,null!==this.parameters[b]&&(a+="="+this.parameters[b]));return a}},d.parse=function(a){return a=f.parse(a,"Name_Addr_Header"),-1!==a?a:void 0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Grammar":9,"./URI":32}],14:[function(a,b,c){function d(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.request=null,this.initEvents(b)}b.exports=d;var e=a("./EventEmitter"),f=a("./Exceptions"),g=a("./Constants"),h=a("./RequestSender"),i=a("./Utils");d.prototype=new e,d.prototype.send=function(a,b,c){var d,e,i,j,k;if(this.direction="outgoing","active"!==this.session.subscription_state&&"pending"!==this.session.subscription_state)throw new f.InvalidStateError(this.session.subscription_state);c=c||{},j=c.extraHeaders?c.extraHeaders.slice():[],i=c.eventHandlers||{};for(e in i)i.hasOwnProperty(e)&&this.on(e,i[e]);k=this.session.dialog.createRequest(g.NOTIFY,j),this.request=k,k.setHeader("contact",this.session.contact),k.setHeader("event",a),k.setHeader("subscription-state",b),c.content_type&&k.setHeader("content-type",c.content_type),c.body&&(k.body=c.body),d=new h(this,this.session.ua),this.session.emit("notify",this.session,{originator:"local",notify:this,request:k}),d.send()},d.prototype.receiveResponse=function(a){var b;if("terminated"!==this.session.subscription_state)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",this,{originator:"remote",response:a});break;default:b=i.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:g.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:g.causes.CONNECTION_ERROR})}},{"./Constants":3,"./EventEmitter":7,"./Exceptions":8,"./RequestSender":25,"./Utils":33}],15:[function(a,b,c){function d(a,b){var c=b,d=0,e=0;if(a.substring(c,c+2).match(/(^\r\n)/))return-2;for(;0===d;){if(e=a.indexOf("\r\n",c),-1===e)return e;!a.substring(e+2,e+4).match(/(^\r\n)/)&&a.charAt(e+2).match(/(^\s+)/)?c=e+2:d=e}return d}function e(a,b,c,d){var e,f,g,j=b.indexOf(":",c),k=b.substring(c,j).trim(),l=b.substring(j+1,d).trim();switch(k.toLowerCase()){case"via":case"v":a.addHeader("via",l),1===a.countHeader("via")?(g=a.parseHeader("Via"),g&&(a.via=g,a.via_branch=g.branch)):g=0;break;case"from":case"f":a.setHeader("from",l),g=a.parseHeader("from"),g&&(a.from=g,a.from_tag=g.getParam("tag"));break;case"to":case"t":a.setHeader("to",l),g=a.parseHeader("to"),g&&(a.to=g,a.to_tag=g.getParam("tag"));break;case"record-route":g=h.parse(l,"Record_Route"),-1===g&&(g=void 0);for(f in g)g.hasOwnProperty(f)&&(e=g[f],a.addHeader("record-route",l.substring(e.possition,e.offset)),a.headers["Record-Route"][a.countHeader("record-route")-1].parsed=e.parsed);break;case"call-id":case"i":a.setHeader("call-id",l),g=a.parseHeader("call-id"),g&&(a.call_id=l);break;case"contact":case"m":g=h.parse(l,"Contact"),-1===g&&(g=void 0);for(f in g)g.hasOwnProperty(f)&&(e=g[f],a.addHeader("contact",l.substring(e.possition,e.offset)),a.headers.Contact[a.countHeader("contact")-1].parsed=e.parsed);break;case"content-length":case"l":a.setHeader("content-length",l),g=a.parseHeader("content-length");break;case"content-type":case"c":a.setHeader("content-type",l),g=a.parseHeader("content-type");break;case"cseq":a.setHeader("cseq",l),g=a.parseHeader("cseq"),g&&(a.cseq=g.value),a instanceof i.IncomingResponse&&(a.method=g.method);break;case"max-forwards":a.setHeader("max-forwards",l),g=a.parseHeader("max-forwards");break;case"www-authenticate":a.setHeader("www-authenticate",l),g=a.parseHeader("www-authenticate");break;case"proxy-authenticate":a.setHeader("proxy-authenticate",l),g=a.parseHeader("proxy-authenticate");break;case"session-expires":case"x":a.setHeader("session-expires",l),g=a.parseHeader("session-expires");break;case"min-se":a.setHeader("min-se",l),g=a.parseHeader("min-se");break;case"supported":case"k":a.setHeader("supported",l),g=a.parseHeader("supported");break;case"require":a.setHeader("require",l),g=a.parseHeader("require");break;case"allow":a.setHeader("allow",l),g=a.parseHeader("allow");break;case"refer-to":case"r":a.setHeader("refer-to",l),g=a.parseHeader("refer-to");break;case"target-dialog":a.setHeader("target-dialog",l),g=a.parseHeader("target-dialog");break;case"event":case"o":a.setHeader("event",l),g=a.parseHeader("event");break;case"subscription-state":a.setHeader("subscription-state",l),g=a.parseHeader("subscription-state");break;default:a.setHeader(k,l),g=0}return void 0===g?!1:!0}var f={};b.exports=f;var g=a("./JsSIP"),h=a("./Grammar"),i=a("./SIPMessage"),j=g.name+" | PARSER | ";f.parseMessage=function(a,b){var c,f,g,k,l,m=0,n=a.indexOf("\r\n");if(-1===n)return void console.warn(j+"no CRLF found, not a SIP message, discarded");if(f=a.substring(0,n),l=h.parse(f,"Request_Response"),-1===l)return void console.warn(j+'error parsing first line of SIP message: "'+f+'"');for(l.status_code?(c=new i.IncomingResponse,c.status_code=l.status_code,c.reason_phrase=l.reason_phrase):(c=new i.IncomingRequest,c.method=l.method,c.ruri=l.uri),c.data=a,m=n+2;m<a.length;){if(n=d(a,m),-2===n){k=m+2;break}if(-1===n){if(b)break;return void console.warn(j+"error parsing message: no empty line terminating headers")}if(l=e(c,a,m,n),!l)return void console.warn(j+'error parsing header: "'+a.substring(m,n)+'"');m=n+2}return k&&(c.hasHeader("content-length")?(g=c.getHeader("content-length"),c.body=a.substr(k,g)):c.body=a.substring(k)),c}},{"./Grammar":9,"./JsSIP":11,"./SIPMessage":26}],16:[function(a,b,c){(function(c){function d(a){var b=["progress","failed","started","ended","newDTMF","reinvite","refresh","update"];this.ua=a,this.status=e.STATUS_NULL,this.lastReinvite=null,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.tones=null,this.allowed=null,this.supported=null,this.incoming_refer=null,this.outgoing_refer=null,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.data={},this.initEvents(b)}b.exports=d;var e={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};d.C=e;var f=a("./RTCSession/RequestSender"),g=a("./RequestSender"),h=a("./RTCSession/RTCMediaHandler"),i=a("./RTCSession/DTMF"),j=a("./RTCSession/Reinvite"),k=a("./RTCSession/Update"),l=a("./RTCSession/Refer"),m=a("./JsSIP"),n=a("./Constants"),o=a("./Exceptions"),p=a("./Utils"),q=a("./Timers"),r=a("./SIPMessage"),s=a("./Dialog"),t=a("./URI"),g=a("./RequestSender"),u=a("./EventEmitter"),v=m.name+" | RTC SESSION | ";d.prototype=new u,d.prototype.terminate=function(a){a=a||{};var b,c=a.status_code,d=a.reason_phrase,f=a.extraHeaders||[],g=a.body;if(this.status===e.STATUS_TERMINATED)throw new o.InvalidStateError(this.status);switch(this.status){case e.STATUS_NULL:case e.STATUS_INVITE_SENT:case e.STATUS_1XX_RECEIVED:if(console.log(v+"canceling RTCSession"),c&&(200>c||c>=700))throw new TypeError("Invalid status_code: "+c);c&&(d=d||n.REASON_PHRASE[c]||"",b="SIP ;cause="+c+' ;text="'+d+'"'),this.status===e.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=b):this.status===e.STATUS_INVITE_SENT?this.received_100?this.request.cancel(b):(this.isCanceled=!0,this.cancelReason=b):this.status===e.STATUS_1XX_RECEIVED&&this.request.cancel(b),this.failed("local",null,n.causes.CANCELED);break;case e.STATUS_WAITING_FOR_ANSWER:if(console.log(v+"rejecting RTCSession"),c=c||480,300>c||c>=700)throw new TypeError("Invalid status_code: "+c);this.request.reply(c,d,f,g),this.failed("local",null,n.causes.REJECTED);break;case e.STATUS_WAITING_FOR_ACK:case e.STATUS_CONFIRMED:console.log(v+"terminating RTCSession"),this.sendBye(a),this.ended("local",null,n.causes.BYE)}this.close()},d.prototype.answer=function(a){a=a||{};var b=this,f=this.request,g=a.extraHeaders||[],h=a.mediaConstraints||{audio:!0,video:!0},i=a.sdp,j=function(a){b.rtcMediaHandler.addStream(a,l,m)},k=function(){f.reply(480),b.failed("local",null,n.causes.USER_DENIED_MEDIA_ACCESS)},l=function(){b.rtcMediaHandler.createAnswer(r,s)},m=function(){b.status!==e.STATUS_TERMINATED&&b.failed("local",null,n.causes.WEBRTC_ERROR)},r=function(a){var h,i=function(){var g=1,h=q.T1;b.status=e.STATUS_WAITING_FOR_ACK,b.timers.invite2xxTimer=c.setTimeout(function i(){b.status===d.C.STATUS_WAITING_FOR_ACK&&(console.log(v+"Retransmitting 2xx:",g++),f.reply(200,null,["Contact: "+b.contact],a),h<q.T2&&(h=2*h,h>q.T2&&(h=q.T2)),b.timers.invite2xxTimer=c.setTimeout(i,h))},h),b.timers.ackTimer=c.setTimeout(function(){b.status===e.STATUS_WAITING_FOR_ACK&&(console.log(v+"no ACK received, terminating the call"),c.clearTimeout(b.timers.invite2xxTimer),b.sendBye(),b.ended("remote",null,n.causes.NO_ACK))},q.TIMER_H),b.started("local")},j=function(){b.failed("system",null,n.causes.CONNECTION_ERROR)};g.push("Contact: "+b.contact),g.push("Allow: "+p.getAllowedMethods(b.ua)),h=p.getSupportedExtensions(b.ua,p.getSessionExtensions(b,n.INVITE)),g.push("Supported: "+h.join(",")),f.reply(200,null,g,a,i,j)},s=function(){b.status!==e.STATUS_TERMINATED&&b.failed("local",null,n.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==e.STATUS_WAITING_FOR_ANSWER)throw new o.InvalidStateError(this.status);return this.createDialog(f,"UAS")?(c.clearTimeout(this.timers.userNoAnswerTimer),this.dialog.processSessionTimerHeaders(f),this.dialog.addSessionTimerResponseHeaders(g),void(i?r(i):this.rtcMediaHandler.getUserMedia(j,k,h))):void f.reply(500,"Missing Contact header field")},d.prototype.sendDTMF=function(a,b){var d,f,g=0,h=this;if(b=b||{},d=b.duration||null,f=b.interToneGap||null,void 0===a)throw new TypeError("Not enough arguments");if(this.status!==e.STATUS_CONFIRMED&&this.status!==e.STATUS_WAITING_FOR_ACK)throw new o.InvalidStateError(this.status);if(!a||"string"!=typeof a&&"number"!=typeof a||!a.toString().match(/^[0-9A-D#*,]+$/i))throw new TypeError("Invalid tones: "+a);if(a=a.toString(),d&&!p.isDecimal(d))throw new TypeError("Invalid tone duration: "+d);if(d?d<i.C.MIN_DURATION?(console.warn(v+'"duration" value is lower than the minimum allowed, setting it to '+i.C.MIN_DURATION+" milliseconds"),d=i.C.MIN_DURATION):d>i.C.MAX_DURATION?(console.warn(v+'"duration" value is greater than the maximum allowed, setting it to '+i.C.MAX_DURATION+" milliseconds"),d=i.C.MAX_DURATION):d=Math.abs(d):d=i.C.DEFAULT_DURATION,b.duration=d,f&&!p.isDecimal(f))throw new TypeError("Invalid interToneGap: "+f);if(f?f<i.C.MIN_INTER_TONE_GAP?(console.warn(v+'"interToneGap" value is lower than the minimum allowed, setting it to '+i.C.MIN_INTER_TONE_GAP+" milliseconds"),
f=i.C.MIN_INTER_TONE_GAP):f=Math.abs(f):f=i.C.DEFAULT_INTER_TONE_GAP,this.tones)return void(this.tones+=a);this.tones=a;var j=function(){var a,k,l=h.tones;if(h.status===e.STATUS_TERMINATED||!l||g>=l.length)return void(h.tones=null);if(a=l[g],g+=1,","===a)k=2e3;else{var m=new i(h);m.on("failed",function(){h.tones=null}),m.send(a,b),k=d+f}c.setTimeout(j,k)};j()},d.prototype.sendReinvite=function(a){var b;if(a=a||{},b=a.sdp,this.lastReinvite)switch(this.lastReinvite.status){case e.STATUS_CONFIRMED:case e.STATUS_CANCELED:case e.STATUS_TERMINATED:break;default:throw new o.InvalidStateError(this.lastReinvite.status)}var c=new j(this);c.send(b,a),this.lastReinvite=c},d.prototype.sendUpdate=function(a){var b;a=a||{},b=a.sdp;var c=new k(this);c.send(a)},d.prototype.sendRefer=function(a,b){var c,d=this.dialog.remote_target;if(b=b||{},b.targetDialog=this.dialog,!this.isMethodAllowed(n.REFER,!1))throw new o.RemoteSupportError(n.REFER);if(this.isOptionSupported(n.SIP_EXTENSIONS.GRUU)&&d.hasParam("gr")&&this.isOptionSupported(n.SIP_EXTENSIONS.TARGET_DIALOG))return c=new l(this.ua),void c.send(d,a,b);if(c=this.outgoing_refer,c&&!c.closed)throw new o.InvalidStateError("Refer in progress");c=new l(this),c.send(a,b),this.outgoing_refer=c},d.prototype.isMethodAllowed=function(a,b){return this.allowed?this.allowed.indexOf(a)>=0?!0:!1:b},d.prototype.isOptionSupported=function(a){return this.supported&&this.supported.indexOf(a)>=0?!0:!1},d.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},d.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},d.prototype.init_incoming=function(a){var b,d=this,f=a.getHeader("Content-Type");if(!a.body||"application/sdp"!==f)return void a.reply(415);if(this.status=e.STATUS_INVITE_RECEIVED,this.from_tag=a.from_tag,this.id=a.call_id+this.from_tag,this.request=a,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,a.hasHeader("allow")&&(this.allowed=a.parseHeader("allow")),a.hasHeader("supported")&&(this.supported=a.parseHeader("supported")),a.hasHeader("expires")&&(b=1e3*a.getHeader("expires")),a.to_tag=p.newTag(),!this.createDialog(a,"UAS",!0))return void a.reply(500,"Missing Contact header field");var g=function(){a.reply(180,null,["Contact: "+d.contact]),d.status=e.STATUS_WAITING_FOR_ANSWER,d.timers.userNoAnswerTimer=c.setTimeout(function(){a.reply(480),d.failed("local",null,n.causes.NO_ANSWER)},d.ua.configuration.no_answer_timeout),b&&(d.timers.expiresTimer=c.setTimeout(function(){d.status===e.STATUS_WAITING_FOR_ANSWER&&(a.reply(487),d.failed("system",null,n.causes.EXPIRES))},b))},i=function(){a.reply(488),d.failed("remote",a,n.causes.BAD_MEDIA_DESCRIPTION)},j=function(){d.rtcMediaHandler=new h(d),d.rtcMediaHandler.onMessage("offer",a.body,function(){g(),d.newRTCSession("remote",a)},function(a){console.warn(v+"invalid SDP"),console.warn(a),i()})};this.ua.configuration.handle_media?j():this.newRTCSession("remote",a,g,i,j)},d.prototype.connect=function(a,b){b=b||{};var c,d,f,i=!1,j=b.eventHandlers||{},k=b.extraHeaders||[],l=b.mediaConstraints||{audio:!0,video:!0},m=b.RTCConstraints||{},q=b.featureTags||"",s=b.sdp;if(void 0===a)throw new TypeError("Not enough arguments");if(this.status!==e.STATUS_NULL)throw new o.InvalidStateError(this.status);for(c in j)j.hasOwnProperty(c)&&this.on(c,j[c]);try{a=p.normalizeURI(a,this.ua.configuration.hostport_params)}catch(u){a=t.parse(n.INVALID_TARGET_URI),i=!0}if(this.from_tag=p.newTag(),s||(this.rtcMediaHandler=new h(this,m)),this.anonymous=b.anonymous,this.isCanceled=!1,this.received_100=!1,d={from_tag:this.from_tag,extra_supported:p.getSessionExtensions(this,n.INVITE)},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0})+q,this.anonymous?(d.from_display_name="Anonymous",d.from_uri="sip:anonymous@anonymous.invalid",k.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),k.push("Privacy: id")):b.from&&(d.from_uri=p.normalizeURI(b.from,this.ua.configuration.hostport_params),k.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),k.push("Privacy: id")),f=new r.OutgoingRequest(n.INVITE,a,this.ua,d,k),this.request=f,f.setHeader("contact",this.contact),f.setHeader("content-type","application/sdp"),this.id=this.request.call_id+this.from_tag,this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),i)this.failed("local",null,n.causes.INVALID_TARGET);else if(s){var v=new g(this,this.ua);this.request.body=s,this.status=e.STATUS_INVITE_SENT,v.send()}else this.sendInitialRequest(l)},d.prototype.close=function(){var a;if(this.status!==e.STATUS_TERMINATED){console.log(v+"closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close(),this.incoming_refer&&this.incoming_refer.close(),this.outgoing_refer&&this.outgoing_refer.close();for(a in this.timers)this.timers.hasOwnProperty(a)&&c.clearTimeout(this.timers[a]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs.hasOwnProperty(a)&&(this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a]);this.status=e.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},d.prototype.calcDialogId=function(a,b){var c="UAS"===b?a.to_tag:a.from_tag,d="UAS"===b?a.from_tag:a.to_tag;return a.call_id+c+d},d.prototype.createDialog=function(a,b,c){var d,e,f=this.calcDialogId(a,b);return e=this.earlyDialogs[f],c?e?!0:(e=new s(this,a,b,s.C.STATUS_EARLY),e.id?(this.earlyDialogs[f]=e,!0):(this.failed("remote",a,n.causes.INTERNAL_ERROR),!1)):e?(e.update(a,b),this.dialog=e,delete this.earlyDialogs[f],!0):(d=new s(this,a,b),d.id?(this.to_tag=a.to_tag,this.dialog=d,!0):(this.failed("remote",a,n.causes.INTERNAL_ERROR),!1))},d.prototype.receiveRequest=function(a){var b,d,f,g,h;if(a.method===n.CANCEL)return this.status===e.STATUS_WAITING_FOR_ANSWER?(this.status=e.STATUS_CANCELED,this.request.reply(487),a.reply(200),this.failed("remote",a,n.causes.CANCELED),!0):(a.reply(481),!1);switch(a.method){case n.ACK:this.status===e.STATUS_WAITING_FOR_ACK?(c.clearTimeout(this.timers.ackTimer),c.clearTimeout(this.timers.invite2xxTimer),this.status=e.STATUS_CONFIRMED):this.lastReinvite&&this.lastReinvite.status===e.STATUS_WAITING_FOR_ACK&&this.lastReinvite.receiveAck();break;case n.BYE:this.status===e.STATUS_CONFIRMED&&(a.reply(200),this.ended("remote",a,n.causes.BYE));break;case n.INVITE:if(this.status!==e.STATUS_CONFIRMED)return a.reply(491),!1;if(this.lastReinvite)switch(this.lastReinvite.status){case e.STATUS_CONFIRMED:case e.STATUS_CANCELED:case e.STATUS_TERMINATED:break;default:return a.reply(491),!1}d=new j(this),d.init_incoming(a),this.lastReinvite=d;break;case n.INFO:(this.status===e.STATUS_CONFIRMED||this.status===e.STATUS_WAITING_FOR_ACK)&&(b=a.getHeader("content-type"),b&&b.match(/^application\/dtmf-relay/i)&&new i(this).init_incoming(a));break;case n.UPDATE:return f=new k(this),f.init_incoming(a);case n.REFER:return this.incoming_refer&&!this.incoming_refer.closed?(a.reply(491,"Existing Refer In Progress"),!1):(g=new l(this),this.incoming_refer=g,g.init_incoming(a));case n.NOTIFY:return a.hasHeader("event")?(h=a.parseHeader("event"),h&&"refer"===h.event?(g=this.outgoing_refer)?g.receiveRequest(a):(a.reply(481,"Subscription Does Not Exist"),!1):(a.reply(489),!1)):(a.reply(400,"Missing Event Header"),!1);case n.SUBSCRIBE:return a.hasHeader("event")?(h=a.parseHeader("event"),h&&"refer"===h.event?(g=this.incoming_refer)?g.receiveRequest(a):(a.reply(403),!1):(a.reply(489),!1)):(a.reply(400,"Missing Event Header"),!1)}return!0},d.prototype.sendInitialRequest=function(a){var b=this,c=new g(b,this.ua),d=function(a){b.rtcMediaHandler.addStream(a,h,i)},f=function(){b.status!==e.STATUS_TERMINATED&&b.failed("local",null,n.causes.USER_DENIED_MEDIA_ACCESS)},h=function(){b.rtcMediaHandler.createOffer(j,k)},i=function(){b.status!==e.STATUS_TERMINATED&&b.failed("local",null,n.causes.WEBRTC_ERROR)},j=function(a){b.isCanceled||b.status===e.STATUS_TERMINATED||(b.request.body=a,b.status=e.STATUS_INVITE_SENT,c.send())},k=function(){b.status!==e.STATUS_TERMINATED&&b.failed("local",null,n.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(d,f,a)},d.prototype.receiveResponse=function(a){switch(a.method){case n.INVITE:this.receiveInviteResponse(a);break;case n.BYE:break;default:console.warn(v+"Unexpected response received:",a)}},d.prototype.receiveInviteResponse=function(a){var b,c=this;if(this.status!==e.STATUS_INVITE_SENT&&this.status!==e.STATUS_1XX_RECEIVED&&this.status!==e.STATUS_CONFIRMED)return void console.warn(v+"Unexpected INVITE response:",a);if(this.isCanceled)return void(a.status_code>=100&&a.status_code<200?this.request.cancel(this.cancelReason):a.status_code>=200&&a.status_code<299&&this.acceptAndTerminate(a));switch(!0){case/^100$/.test(a.status_code):this.received_100=!0;break;case/^1[0-9]{2}$/.test(a.status_code):if(!a.to_tag){console.warn(v+"1xx response received without to tag");break}a.hasHeader("contact")&&this.createDialog(a,"UAC",!0),this.status=e.STATUS_1XX_RECEIVED,this.progress("remote",a);break;case/^2[0-9]{2}$/.test(a.status_code):if(this.status===e.STATUS_CONFIRMED){var d=this.calcDialogId(a,"UAC");d===this.dialog.id.toString()?(console.info(v+"Retransmitting ACK"),this.sendACK()):(console.info(v+"Accepting and terminating fork, did:",d),this.acceptAndTerminate(a));break}if(this.status=e.STATUS_CONFIRMED,!a.body){this.acceptAndTerminate(a,400,"Missing session description"),this.failed("remote",a,n.causes.BAD_MEDIA_DESCRIPTION);break}if(!this.createDialog(a,"UAC"))break;this.sendACK(),a.hasHeader("allow")&&(this.allowed=a.parseHeader("allow")),a.hasHeader("supported")&&(this.supported=a.parseHeader("supported")),this.dialog.processSessionTimerHeaders(a),this.rtcMediaHandler?this.rtcMediaHandler.onMessage("answer",a.body,function(){c.started("remote",a)},function(b){console.warn(b),c.sendBye({status_code:488,reason_phrase:"Not Acceptable Here"}),c.failed("remote",a,n.causes.BAD_MEDIA_DESCRIPTION)}):c.started("remote",a);break;default:b=p.sipErrorCause(a.status_code),this.failed("remote",a,b)}},d.prototype.acceptAndTerminate=function(a,b,c){var d=this.calcDialogId(a,"UAC"),e=null;this.dialog?this.dialog&&d===this.dialog.id.toString()?e=this.dialog:this.earlyDialogs[d]?e=this.earlyDialogs[d]:this.createDialog(a,"UAC",!0)&&(e=this.earlyDialogs[d]):this.createDialog(a,"UAC")&&(e=this.dialog),e&&(this.sendACK({dialog:e}),this.sendBye({dialog:e,status_code:b,reason_phrase:c}))},d.prototype.sendACK=function(a){a=a||{};var b=a.dialog||this.dialog,c=b.createRequest(n.ACK);this.sendRequest(c)},d.prototype.sendBye=function(a){a=a||{};var b,c,d=a.status_code,e=a.reason_phrase||n.REASON_PHRASE[d]||"",f=a.extraHeaders||[],g=a.body,h=a.dialog||this.dialog;if(d&&(200>d||d>=700))throw new TypeError("Invalid status_code: "+d);d&&(c="SIP ;cause="+d+'; text="'+e+'"',f.push("Reason: "+c)),b=h.createRequest(n.BYE,f),b.body=g,this.sendRequest(b)},d.prototype.sendRequest=function(a){var b=new f(this,a);b.send()},d.prototype.onTransportError=function(){this.status!==e.STATUS_TERMINATED&&(this.status===e.STATUS_CONFIRMED?this.ended("system",null,n.causes.CONNECTION_ERROR):this.failed("system",null,n.causes.CONNECTION_ERROR))},d.prototype.onRequestTimeout=function(){this.status!==e.STATUS_TERMINATED&&(this.status===e.STATUS_CONFIRMED?this.ended("system",null,n.causes.REQUEST_TIMEOUT):this.failed("system",null,n.causes.CONNECTION_ERROR))},d.prototype.newRTCSession=function(a,b,c,d,e){var f=this,g="newRTCSession";"remote"===a?(f.direction="incoming",f.local_identity=b.to,f.remote_identity=b.from):"local"===a&&(f.direction="outgoing",f.local_identity=b.from,f.remote_identity=b.to),f.ua.emit(g,f.ua,{originator:a,session:f,request:b,sdpValid:c||null,sdpInvalid:d||null,handleMedia:e||null})},d.prototype.connecting=function(a,b){var c=this,d="connecting";c.emit(d,c,{originator:"local",request:b})},d.prototype.progress=function(a,b){var c=this,d="progress";c.emit(d,c,{originator:a,response:b||null})},d.prototype.started=function(a,b){var c=this,d="started";c.start_time=new Date,c.emit(d,c,{originator:a,response:b||null})},d.prototype.ended=function(a,b,c){var d=this,e="ended";d.end_time=new Date,d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})},d.prototype.failed=function(a,b,c){var d=this,e="failed";d.close(),d.emit(e,d,{originator:a,message:b||null,cause:c})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./Dialog":4,"./EventEmitter":7,"./Exceptions":8,"./JsSIP":11,"./RTCSession/DTMF":17,"./RTCSession/RTCMediaHandler":18,"./RTCSession/Refer":19,"./RTCSession/Reinvite":20,"./RTCSession/RequestSender":21,"./RTCSession/Update":22,"./RequestSender":25,"./SIPMessage":26,"./Timers":28,"./URI":32,"./Utils":33}],17:[function(a,b,c){function d(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.tone=null,this.duration=null,this.initEvents(b)}b.exports=d;var e={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};d.C=e;var f=a("../Constants"),g=a("../Exceptions"),h=a("../RTCSession"),i=a("../EventEmitter"),j=a("../Utils"),k=a("./RequestSender"),l=a("../JsSIP"),m=l.name+" | RTC SESSION | ";d.prototype=new i,d.prototype.send=function(a,b){var c,d,e,i;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==h.C.STATUS_CONFIRMED&&this.session.status!==h.C.STATUS_WAITING_FOR_ACK)throw new g.InvalidStateError(this.session.status);if(b=b||{},i=b.extraHeaders?b.extraHeaders.slice():[],e=b.eventHandlers||{},"string"==typeof a)a=a.toUpperCase();else{if("number"!=typeof a)throw new TypeError("Invalid tone: "+a);a=a.toString()}if(!a.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+a);this.tone=a,this.duration=b.duration;for(d in e)e.hasOwnProperty(d)&&this.on(d,e[d]);i.push("Content-Type: application/dtmf-relay"),this.request=this.session.dialog.createRequest(f.INFO,i),this.request.body="Signal= "+this.tone+"\r\n",this.request.body+="Duration= "+this.duration,c=new k(this),this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request}),c.send()},d.prototype.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.emit("succeeded",this,{originator:"remote",response:a});break;default:b=j.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:f.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:f.causes.CONNECTION_ERROR})},d.prototype.init_incoming=function(a){var b,c=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,d=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=a,a.reply(200),a.body&&(b=a.body.split("\r\n"),2===b.length&&(c.test(b[0])&&(this.tone=b[0].replace(c,"$2")),d.test(b[1])&&(this.duration=parseInt(b[1].replace(d,"$2"),10)))),this.tone&&this.duration?this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:a}):console.warn(m+"invalid INFO DTMF received, discarded")}},{"../Constants":3,"../EventEmitter":7,"../Exceptions":8,"../JsSIP":11,"../RTCSession":16,"../Utils":33,"./RequestSender":21}],18:[function(a,b,c){function d(a,b){b=b||{},this.session=a,this.localMedia=null,this.peerConnection=null,this.init(b)}b.exports=d;var e=a("../WebRTC"),f=a("../JsSIP"),g=f.name+" | RTC SESSION | ";d.prototype={createOffer:function(a,b){var c=this,d=!1;this.onIceCompleted=function(){d||(d=!0,a(c.peerConnection.localDescription.sdp))},this.peerConnection.createOffer(function(a){c.setLocalDescription(a,b)},function(a){console.error(g+"unable to create offer"),console.error(a),b()})},createAnswer:function(a,b){var c=this,d=!1;this.onIceCompleted=function(){d||(d=!0,a(c.peerConnection.localDescription.sdp))},this.peerConnection.createAnswer(function(a){c.setLocalDescription(a,b)},function(a){console.error(g+"unable to create answer"),console.error(a),b()})},setLocalDescription:function(a,b){this.peerConnection.setLocalDescription(a,null,function(a){console.error(g+"unable to set local description"),console.error(a),b()})},addStream:function(a,b,c,d){try{this.peerConnection.addStream(a,d)}catch(e){return console.error(g+"error adding stream"),console.error(e),void c()}b()},init:function(a){var b=this,c=[];this.session.ua.configuration.stun_servers.forEach(function(a){c.push({url:a})}),this.session.ua.configuration.turn_servers.forEach(function(a){var b=a.server,d=b.substr(0,b.indexOf(":"));c.push({url:d+":"+a.username+"@"+b.substr(d.length+1),credential:a.password})}),this.peerConnection=new e.RTCPeerConnection({iceServers:c},a),this.peerConnection.onaddstream=function(a){console.log(g+"stream added: "+a.stream.id)},this.peerConnection.onremovestream=function(a){console.log(g+"stream removed: "+a.stream.id)},this.peerConnection.onicecandidate=function(a){a.candidate?console.log(g+"ICE candidate received: "+a.candidate.candidate):b.onIceCompleted()},this.peerConnection.ongatheringchange=function(a){"complete"===a.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState&&b.onIceCompleted()},this.peerConnection.onicechange=function(){console.log(g+'ICE connection state changed to "'+this.iceConnectionState+'"')},this.peerConnection.onstatechange=function(){console.log(g+'PeerConnection state changed to "'+this.readyState+'"')}},close:function(){console.log(g+"closing PeerConnection"),this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.stop())},getUserMedia:function(a,b,c){var d=this;console.log(g+"requesting access to local media"),e.getUserMedia(c,function(b){console.log(g+"got local media stream"),d.localMedia=b,a(b)},function(a){console.error(g+"unable to get user media"),console.error(a),b()})},onMessage:function(a,b,c,d){this.peerConnection.setRemoteDescription(new e.RTCSessionDescription({type:a,sdp:b}),c,d)}}},{"../JsSIP":11,"../WebRTC":34}],19:[function(a,b,c){function d(a){var b=["accepted","failed","notify"];this.session=a,this.ua=a.ua,this.closed=!1,this.request=null,this.id=null,this.contact=a.contact,this.notify_timer=null,this.dialog=a.dialog,this.subscription_state="pending",this.subscription_expires=null,this.expire_timer=null,this.last_notify_body=null,this.accepted=!1,this.rejected=!1,this.direction=null,this.refer_uri=null,this.data={},this.initEvents(b)}b.exports=d;var e=a("../URI"),f=a("../Utils"),g=a("../JsSIP"),h=a("../Timers"),i=a("../Parser"),j=a("../Notify"),k=a("../Constants"),l=a("../RTCSession"),m=a("../Exceptions"),n=a("../SIPMessage"),o=a("../EventEmitter"),p=a("./RequestSender"),q=g.name+" | IN-DIALOG REFER | ",r=18e4;d.prototype=new o,d.prototype.send=function(a,b){var c,d,g,i,j,n,o=null;if(void 0===a)throw new TypeError("Not enough arguments");if(this.session.status!==l.C.STATUS_CONFIRMED&&this.session.status!==l.C.STATUS_WAITING_FOR_ACK)throw new m.InvalidStateError(this.session.status);b=b||{},j=b.extraHeaders||[],i=b.eventHandlers||{},g=b.contentType||"text/plain";for(d in i)i.hasOwnProperty(d)&&this.on(d,i[d]);try{a=f.normalizeURI(a,this.ua.configuration.hostport_params)}catch(r){a=e.parse(k.INVALID_TARGET_URI),o=k.causes.INVALID_REFER_TO_TARGET}this.direction="outgoing",this.refer_uri=a,n=this.dialog.createRequest(k.REFER,j),this.request=n,this.id=n.call_id+this.dialog.id.local_tag,n.setHeader("contact",this.contact),n.setHeader("refer-to",a),b.body&&(n.setHeader("content-type",g),n.body=b.body),c=new p(this),this.ua.emit("newRefer",this.ua,{originator:"local",refer:this,request:this.request}),o?this.emit("failed",this,{originator:"local",cause:o}):(c.send(),console.log(q+this.id+" sent"),this.notify_timer=setTimeout(this.onNotifyTimeout.bind(this),h.TIMER_F))},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):console.log(q+this.id+" accepted"),this.emit("accepted",this,{originator:"remote",response:a});break;default:console.log(q+this.id+" rejected (early)"),this.close(),b=f.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",message:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||(console.log(q+this.id+" request timeout"),this.close(),this.emit("failed",this,{originator:"system",cause:k.causes.REQUEST_TIMEOUT}))},d.prototype.onTransportError=function(){this.closed||(console.log(q+this.id+" transport error"),this.close(),this.emit("failed",this,{originator:"system",cause:k.causes.CONNECTION_ERROR}))},d.prototype.onNotifyTimeout=function(){this.closed||"pending"!==this.subscription_state||(console.log(q+this.id+" notify timeout"),this.emitFinalNotify(),this.close())},d.prototype.emitFinalNotify=function(){var a,b=this.last_notify_body;b||(b=i.parseMessage("SIP/2.0 100 Trying\r\n",!0)),a=b.status_code<200?"progress":b.status_code<300?"started":"failed",this.emit("notify",this,{originator:"system",request:null,sipFrag:b,sessionEvent:a,finalNotify:!0})},d.prototype.close=function(){"active"===this.subscription_state&&(console.warn(q+this.id+" closed with active subscription"),"incoming"===this.direction?this.notify({body:this.last_notify_body,finalNotify:!0}):this.emitFinalNotify()),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),this.closed=!0,console.log(q+this.id+" closed")},d.prototype.subscriptionExpired=function(){"terminated"!==this.subscription_state&&(this.notify({body:this.last_notify_body,finalNotify:!0,terminateReason:"timeout"}),this.expire_timer=null,console.log(q+this.id+" subscription expired"))},d.prototype.init_incoming=function(a){return this.direction="incoming",this.request=a,this.id=a.call_id+a.from_tag,a.hasHeader("refer-to")?a.countHeader("refer-to")>1?(a.reply(400,"Too many Refer-To header fields"),!1):(this.refer_uri=a.parseHeader("refer-to").uri,console.log(q+this.id+" received"),this.ua.emit("newRefer",this.ua,{originator:"remote",refer:this,request:a,session:this.session}),this.accepted||this.rejected||this.accept(),this.accepted):(a.reply(400,"Missing Refer-To header field"),!1)},d.prototype.call=function(a){var b,c=this.refer_uri;if(c.scheme!==k.SIP)throw new m.InvalidTargetError(c);return this.accepted||this.accept(),b=new l(this.ua),b.connect(c,a),this.addSessionNotifyHandlers(b),b},d.prototype.addSessionNotifyHandlers=function(a){var b=this;a.on("progress",function(a){var c=a.data.response;b.notify({status_code:c.status_code,reason_phrase:c.reason_phrase})}),a.once("started",function(a){var c=a.data.response;b.notify({status_code:c.status_code,reason_phrase:c.reason_phrase}),b.close()}),a.once("failed",function(a){var c=500,d=null,e=a.data.message;e&&e instanceof n.IncomingResponse&&(c=e.status_code,d=e.reason_phrase),b.notify({status_code:c,reason_phrase:d}),b.close()})},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing refer');this.closed||(this.subscription_state="active",this.subscription_expires=Date.now()+r,this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),r),b.push("Contact: "+this.contact),this.request.reply(202,null,b,c),this.notify(),this.accepted=!0,console.log(q+this.id+" accepted"))},d.prototype.reject=function(a){a=a||{};var b=a.status_code||603,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing refer');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.closed||(this.accepted?(console.log(q+this.id+" rejected (late)"),this.notify({status_code:b,reason_phrase:c})):(console.log(q+this.id+" rejected (early)"),this.request.reply(b,c,d,e),this.rejected=!0),this.close())},d.prototype.notify=function(a){var b,c,d,e,f,g,h,i,l=this;if("incoming"!==this.direction)throw new TypeError('Invalid method "notify" for an outgoing refer');if(a=a||{},a.body&&"undefined"==typeof a.finalNotify)throw new TypeError("Must specify finalNotify when providing notify body");"active"===this.subscription_state&&(b=a.status_code||100,c=a.reason_phrase||k.REASON_PHRASE[b]||"",d=a.finalNotify||b>=200,d?(e="terminated",f=a.terminateReason||"noresource",g=e+";reason="+f):(e="active",g=e+";expires="+Math.round((this.subscription_expires-Date.now())/1e3)),h=a.body||"SIP/2.0 "+b+" "+c+"\r\n",this.last_notify_body=h,i=new j(this),i.send("refer;id="+this.request.cseq,g,{extraHeaders:a.extraHeaders,eventHandlers:a.eventHandlers,content_type:"message/sipfrag",body:h}),this.subscription_state=e,d||i.on("failed",function(){l.subscription_state="terminated",console.log(q+l.id+" unsubscribed (rejected notify)"),l.close()}))},d.prototype.receiveRequest=function(a){switch(a.method){case k.NOTIFY:return this.receiveNotify(a);case k.SUBSCRIBE:return this.receiveSubscribe(a)}return a.reply(405,null,["Allow: "+f.getAllowedMethods(this.ua)]),!1},d.prototype.receiveNotify=function(a){var b,c,d,e,f,g,j,k=!1;return"outgoing"!==this.direction||"active"!==this.subscription_state&&"pending"!==this.subscription_state?(a.reply(481,"Subscription Does Not Exist"),!1):(b=a.parseHeader("event"),b&&"refer"===b.event?(c=a.parseHeader("subscription-state"))?(d=a.getHeader("content-type"),d&&d.indexOf("message/sipfrag")<0?(a.reply(415),this.close(),!1):(j=a.body,/\r\n$/.test(j)||(j+="\r\n"),e=i.parseMessage(j,!0),e&&e instanceof n.IncomingResponse?0===this.listeners("notify").length?(console.log(q+this.id+" no notify listeners; unsubscribing"),a.reply(603),this.subscription_state="terminated",this.close(),!1):(this.subscription_state=c.state,this.subscription_expires=Date.now()+1e3*c.expires,this.last_notify_body=e,null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),g=["Contact: "+this.contact],a.reply(200,null,g),f=e.status_code<200?"progress":e.status_code<300?"started":"failed",console.log(q+this.id+" notify: "+f),"terminated"===this.subscription_state?(k=!0,this.close()):this.expire_timer=setTimeout(this.close.bind(this),1e3*(c.expires+h.T4)),this.emit("notify",this,{originator:"remote",request:a,sipFrag:e,sessionEvent:f,finalNotify:k}),!0):(a.reply(400,"Bad Message Body"),this.close(),!1))):(a.reply(400,"Missing Subscription-State Header"),this.close(),!1):(a.reply(489),this.close(),!1))},d.prototype.receiveSubscribe=function(a){var b,c,d;return"incoming"!==this.direction?(a.reply(481),!1):"active"!==this.subscription_state&&"terminated"!==this.subscription_state?(a.reply(403),!1):(b=a.parseHeader("event"),b&&"refer"===b.event?(c=a.parseHeader("expires"),0===c?(console.log(q+this.id+" unsubscribed (expires=0)"),this.notify({body:this.last_notify_body,finalNotify:!0}),d=["Contact: "+this.contact],a.reply(200,null,d),this.close(),!0):(c=c>0?1e3*c:r,this.subscription_state="active",this.subscription_expires=Date.now()+c,null!==this.expire_timer&&clearTimeout(this.expire_timer),this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),c),d=["Contact: "+this.contact,"Expires: "+c/1e3],a.reply(200,null,d),console.log(q+this.id+" subscription extended"),!0)):(a.reply(489),!1))}},{"../Constants":3,"../EventEmitter":7,"../Exceptions":8,"../JsSIP":11,"../Notify":14,"../Parser":15,"../RTCSession":16,"../SIPMessage":26,"../Timers":28,"../URI":32,"../Utils":33,"./RequestSender":21}],20:[function(a,b,c){(function(c){function d(a){var b=["succeeded","failed","completed"];this.session=a,this.direction=null,this.status=e.C.STATUS_NULL,this.timers={},this.initEvents(b)}b.exports=d;var e=a("../RTCSession"),f=a("./RequestSender"),g=a("../EventEmitter"),h=a("../Exceptions"),i=a("../Constants"),j=a("../Utils"),k=a("../Timers"),l=a("../JsSIP"),m=l.name+" | REINVITE | ";d.prototype=new g,d.prototype.send=function(a,b){var c,d,g,j;if(void 0===a)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==e.C.STATUS_CONFIRMED)throw new h.InvalidStateError(this.session.status);b=b||{},j=b.extraHeaders?b.extraHeaders.slice():[],g=b.eventHandlers||{};for(d in g)g.hasOwnProperty(d)&&this.on(d,g[d]);j.push("Contact: "+this.session.contact),a&&j.push("Content-Type: application/sdp"),this.request=this.session.dialog.createRequest(i.INVITE,j),this.request.body=a,c=new f(this),this.session.emit("reinvite",this.session,{originator:"local",reinvite:this,request:this.request}),c.send(),this.status=e.C.STATUS_INVITE_SENT},d.prototype.receiveResponse=function(a){var b,c=a.status_code;switch(this.status){case e.C.STATUS_CONFIRMED:case e.C.STATUS_CANCELED:return void(this.session.status===e.C.STATUS_CONFIRMED&&(console.info(m+"Retransmitting ACK"),this.session.sendACK()))}return c>=100&&200>c?void(this.status=e.C.STATUS_1XX_RECEIVED):(c>=200&&300>c?(this.status=e.C.STATUS_CONFIRMED,this.session.status===e.C.STATUS_CONFIRMED&&(this.session.sendACK(),console.log(m+"re-INVITE ACK sent",Date.now()),this.session.dialog.processSessionTimerHeaders(a),this.emit("succeeded",this,{originator:"remote",response:a,sdp:a.body}))):(this.status=e.C.STATUS_CANCELED,b=j.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})),void this.emit("completed",this,{originator:"local"}))},d.prototype.receiveAck=function(){this.status=e.C.STATUS_CONFIRMED,console.log(m+"re-INVITE ACK received",Date.now()),this.timers.invite2xxTimer&&(c.clearTimeout(this.timers.invite2xxTimer),delete this.timers.invite2xxTimer),this.timers.ackTimer&&(c.clearTimeout(this.timers.ackTimer),delete this.timers.ackTimer),this.emit("completed",this,{originator:"remote"})},d.prototype.onRequestTimeout=function(){this.status=e.C.STATUS_TERMINATED,this.emit("failed",this,{originator:"system",cause:i.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){switch(this.status){case e.C.STATUS_CONFIRMED:case e.C.STATUS_CANCELED:case e.C.STATUS_TERMINATED:return}this.status=e.C.STATUS_TERMINATED,this.emit("failed",this,{originator:"system",cause:i.causes.CONNECTION_ERROR})},d.prototype.init_incoming=function(a){var b=null,c=a.getHeader("Content-Type");this.direction="incoming",this.request=a,this.status=e.C.STATUS_INVITE_RECEIVED,a.body&&"application/sdp"===c&&(b=a.body),this.session.emit("reinvite",this.session,{originator:"remote",reinvite:this,request:a,sdp:b})},d.prototype.successResponseSent=function(a,b,d){var f=this.session,g=1,h=k.T1;this.timers.invite2xxTimer=c.setTimeout(function j(){f.status===e.C.STATUS_WAITING_FOR_ACK&&(console.log(m+"Retransmitting 2xx:",g++),a.reply(200,null,b,d),h<k.T2&&(h=2*h,h>k.T2&&(h=k.T2)),f.timers.invite2xxTimer=c.setTimeout(j,h))},h),console.log(m+"re-INVITE response sent",Date.now()),this.timers.ackTimer=c.setTimeout(function(){f.status===e.C.STATUS_WAITING_FOR_ACK&&(console.log(m+"no ACK received, terminating the call"),f.timers.invite2xxTimer&&(c.clearTimeout(f.timers.invite2xxTimer),delete f.timers.invite2xxTimer),f.session.sendBye(),f.session.ended("remote",null,i.causes.NO_ACK))},k.TIMER_H)},d.prototype.sdpValid=function(){var a=this,b=this.request,d=null,f=a.session.ua.configuration.no_answer_timeout;if("incoming"!==this.direction)throw new TypeError('Invalid method "sdpValid" for an outgoing reINVITE');this.status=e.C.STATUS_WAITING_FOR_ANSWER,b.hasHeader("expires")&&(d=1e3*b.getHeader("expires")),this.timers.provisionalResponse=c.setTimeout(function(){b.reply(180,null,["Contact: "+a.session.contact]),delete a.timers.provisionalResponse},1e3),d&&f>d?this.timers.answer=c.setTimeout(function(){b.reply(487),a.emit("failed",a,{originator:"system",cause:i.causes.EXPIRES
})},d):this.timers.answer=c.setTimeout(function(){b.reply(480),a.emit("failed",a,{originator:"local",cause:i.causes.NO_ANSWER})},f)},d.prototype.sdpInvalid=function(){if("incoming"!==this.direction)throw new TypeError('Invalid method "sdpInvalid" for an outgoing reINVITE');this.request.reply(488),this.status=e.C.STATUS_WAITING_FOR_ACK,this.emit("failed",this,{originator:"remote",cause:i.causes.BAD_MEDIA_DESCRIPTION})},d.prototype.accept=function(a){a=a||{};var b=this,d=this.request,f=a.extraHeaders||[],g=a.sdp;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing reINVITE');this.timers.provisionalResponse&&(c.clearTimeout(this.timers.provisionalResponse),delete this.timers.provisionalResponse),this.timers.answer&&(c.clearTimeout(this.timers.answer),delete this.timers.answer),this.session.dialog.processSessionTimerHeaders(d),this.session.dialog.addSessionTimerResponseHeaders(f),f.push("Contact: "+b.session.contact),f.push("Allow: "+j.getAllowedMethods(b.session.ua)),f.push("Content-Type: application/sdp");var h=function(){b.session.onTransportError(),b.onTransportError()};d.reply(200,null,f,g,this.successResponseSent.bind(this,d,f,g),h),this.status=e.C.STATUS_WAITING_FOR_ACK},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,d=a.reason_phrase,f=a.extraHeaders||[];if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing reINVITE');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.timers.provisionalResponse&&(c.clearTimeout(this.timers.provisionalResponse),delete this.timers.provisionalResponse),this.timers.answer&&(c.clearTimeout(this.timers.answer),delete this.timers.answer),this.request.reply(b,d,f),this.status=e.C.STATUS_WAITING_FOR_ACK}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../Constants":3,"../EventEmitter":7,"../Exceptions":8,"../JsSIP":11,"../RTCSession":16,"../Timers":28,"../Utils":33,"./RequestSender":21}],21:[function(a,b,c){(function(c){function d(a,b){this.applicant=a,this.request=b||a.request,this.session=a instanceof e?a:a.session,this.reattempt=!1,this.reatemptTimer=null,this.request_sender=new g(this)}b.exports=d;var e=a("../RTCSession"),f=a("../Constants"),g=a("../InDialogRequestSender");d.prototype={receiveResponse:function(a){var b=this,d=a.status_code;a.method===f.INVITE&&491===d?this.reattempt?this.applicant.receiveResponse(a):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=c.setTimeout(function(){b.session.status!==e.C.STATUS_TERMINATED&&(b.reattempt=!0,b.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(a)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../Constants":3,"../InDialogRequestSender":10,"../RTCSession":16}],22:[function(a,b,c){function d(a){var b=["succeeded","failed"];this.session=a,this.direction=null,this.accepted=null,this.initEvents(b)}b.exports=d;var e=a("../RTCSession"),f=a("../EventEmitter"),g=a("../Exceptions"),h=a("../Constants"),i=a("../Utils"),j=a("./RequestSender");d.prototype=new f,d.prototype.send=function(a){var b,c,d,f,i;if(this.direction="outgoing",this.session.status!==e.C.STATUS_CONFIRMED&&this.session.status!==e.C.STATUS_WAITING_FOR_ACK)throw new g.InvalidStateError(this.session.status);a=a||{},f=a.extraHeaders?a.extraHeaders.slice():[],d=a.eventHandlers||{},i=a.sdp;for(c in d)d.hasOwnProperty(c)&&this.on(c,d[c]);f.push("Contact: "+this.session.contact),i&&f.push("Content-Type: application/sdp"),this.request=this.session.dialog.createRequest(h.UPDATE,f),this.request.body=i,b=new j(this),this.session.emit("update",this.session,{originator:"local",update:this,request:this.request}),b.send()},d.prototype.receiveResponse=function(a){var b;if(this.session.status===e.C.STATUS_CONFIRMED)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.session.dialog.processSessionTimerHeaders(a),this.emit("succeeded",this,{originator:"remote",response:a});break;default:b=i.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",response:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:h.causes.REQUEST_TIMEOUT})},d.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:h.causes.CONNECTION_ERROR})},d.prototype.init_incoming=function(a){if(this.direction="incoming",this.request=a,this.session.emit("update",this.session,{originator:"remote",update:this,request:a}),null===this.accepted){var b=a.getHeader("content-type");b||a.body?this.reject({status_code:488}):this.accept()}return this.accepted},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing update');this.session.dialog.processSessionTimerHeaders(this.request),this.session.dialog.addSessionTimerResponseHeaders(b),b.push("Contact: "+this.session.contact),this.request.reply(200,null,b,c),this.accepted=!0},d.prototype.reject=function(a){a=a||{};var b=a.status_code||480,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing update');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.request.reply(b,c,d,e),this.accepted=!1}},{"../Constants":3,"../EventEmitter":7,"../Exceptions":8,"../RTCSession":16,"../Utils":33,"./RequestSender":21}],23:[function(a,b,c){function d(a){var b=["accepted","failed","notify"];this.ua=a,this.targetDialog=null,this.closed=!1,this.request=null,this.local_tag=null,this.remote_tag=null,this.id=null,this.contact=null,this.notify_timer=null,this.dialog=null,this.subscription_state="pending",this.subscription_expires=null,this.expire_timer=null,this.last_notify_body=null,this.accepted=!1,this.rejected=!1,this.direction=null,this.local_identity=null,this.remote_identity=null,this.refer_uri=null,this.data={},this.initEvents(b)}b.exports=d;var e=a("./URI"),f=a("./Utils"),g=a("./JsSIP"),h=a("./Timers"),i=a("./Parser"),j=a("./Dialog"),k=a("./Notify"),l=a("./DialogId"),m=a("./Constants"),n=a("./RTCSession"),o=a("./Exceptions"),p=a("./SIPMessage"),q=a("./EventEmitter"),r=a("./RequestSender"),s=g.name+" | REFER | ",t=18e4;d.prototype=new q,d.prototype.send=function(a,b,c){var d,g,i,j,k,l,n=null;if(void 0===a||void 0===b)throw new TypeError("Not enough arguments");c=c||{},k=c.extraHeaders||[],j=c.eventHandlers||{},i=c.contentType||"text/plain";for(g in j)this.on(g,j[g]);try{a=f.normalizeURI(a,this.ua.configuration.hostport_params)}catch(o){a=e.parse(m.INVALID_TARGET_URI),n=m.causes.INVALID_TARGET}try{b=f.normalizeURI(b,this.ua.configuration.hostport_params)}catch(o){b=e.parse(m.INVALID_TARGET_URI),n=m.causes.INVALID_REFER_TO_TARGET}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=a,this.refer_uri=b,this.local_tag=f.newTag(),this.contact=this.ua.contact.toString({outbound:!0}),l=new p.OutgoingRequest(m.REFER,a,this.ua,{from_tag:this.local_tag},k,c.body),this.request=l,this.id=l.call_id+this.local_tag,this.ua.refers[this.id]=this,l.setHeader("contact",this.contact),l.setHeader("refer-to",b),c.targetDialog&&(this.targetDialog=c.targetDialog,l.setHeader("require",m.SIP_EXTENSIONS.TARGET_DIALOG),l.setHeader("target-dialog",c.targetDialog.id.toTargetDialogHeader())),c.body&&l.setHeader("content-type",i),d=new r(this,this.ua),this.ua.emit("newRefer",this.ua,{originator:"local",refer:this,request:this.request}),n?this.emit("failed",this,{originator:"local",cause:n}):(d.send(),console.log(s+this.id+" sent"),this.notify_timer=setTimeout(this.onNotifyTimeout.bind(this),h.TIMER_F))},d.prototype.receiveResponse=function(a){var b;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):console.log(s+this.id+" accepted"),this.emit("accepted",this,{originator:"remote",response:a});break;default:console.log(s+this.id+" rejected (early)"),this.close(),b=f.sipErrorCause(a.status_code),this.emit("failed",this,{originator:"remote",message:a,cause:b})}},d.prototype.onRequestTimeout=function(){this.closed||(console.log(s+this.id+" request timeout"),this.close(),this.emit("failed",this,{originator:"system",cause:m.causes.REQUEST_TIMEOUT}))},d.prototype.onTransportError=function(){this.closed||(console.log(s+this.id+" transport error"),this.close(),this.emit("failed",this,{originator:"system",cause:m.causes.CONNECTION_ERROR}))},d.prototype.onNotifyTimeout=function(){this.closed||"pending"!==this.subscription_state||(console.log(s+this.id+" notify timeout"),this.emitFinalNotify(),this.close())},d.prototype.emitFinalNotify=function(){var a,b=this.last_notify_body;b||(b=i.parseMessage("SIP/2.0 100 Trying\r\n",!0)),a=b.status_code<200?"progress":b.status_code<300?"started":"failed",this.emit("notify",this,{originator:"system",request:null,sipFrag:b,sessionEvent:a,finalNotify:!0})},d.prototype.close=function(){"active"===this.subscription_state&&(console.warn(s+this.id+" closed with active subscription"),"incoming"===this.direction?this.notify({body:this.last_notify_body,finalNotify:!0}):this.emitFinalNotify()),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),this.dialog&&(this.dialog.terminate(),delete this.dialog),this.closed=!0,delete this.ua.refers[this],console.log(s+this.id+" closed")},d.prototype.subscriptionExpired=function(){"terminated"!==this.subscription_state&&(this.notify({body:this.last_notify_body,finalNotify:!0,terminateReason:"timeout"}),this.expire_timer=null,console.log(s+this.id+" subscription expired"))},d.prototype.init_incoming=function(a){var b=null;if(this.direction="incoming",this.request=a,this.remote_tag=a.from_tag,this.id=a.call_id+a.from_tag,this.contact=this.ua.contact.toString(),this.local_identity=a.to.uri,this.remote_identity=a.from.uri,!a.hasHeader("refer-to"))return void a.reply(400,"Missing Refer-To header field");if(a.countHeader("refer-to")>1)return void a.reply(400,"Too many Refer-To header fields");if(this.refer_uri=a.parseHeader("refer-to").uri,a.hasHeader("target-dialog")){var c=a.parseHeader("target-dialog"),d=new l(c.call_id,c.local_tag,c.remote_tag);this.targetDialog=this.ua.dialogs[d.toString()]||null}return this.targetDialog&&this.targetDialog.isConfirmed()&&(b=this.targetDialog.owner,b.dialog===this.targetDialog&&b instanceof n||(b=null)),this.local_tag=a.to_tag=f.newTag(),this.dialog=new j(this,a,"UAS"),this.dialog.id?(this.ua.refers[this.id]=this,console.log(s+this.id+" received"),this.ua.emit("newRefer",this.ua,{originator:"remote",refer:this,request:a,session:b}),void(this.accepted||this.rejected||this.accept())):void a.reply(500,"Missing Contact header field")},d.prototype.call=function(a){var b,c=this.refer_uri;if(c.scheme!==m.SIP)throw new o.InvalidTargetError(c);return this.accepted||this.accept(),b=new n(this.ua),b.connect(c,a),this.addSessionNotifyHandlers(b),b},d.prototype.addSessionNotifyHandlers=function(a){var b=this;a.on("progress",function(a){var c=a.data.response;b.notify({status_code:c.status_code,reason_phrase:c.reason_phrase})}),a.once("started",function(a){var c=a.data.response;b.notify({status_code:c.status_code,reason_phrase:c.reason_phrase}),b.close()}),a.once("failed",function(a){var c=500,d=null,e=a.data.message;e&&e instanceof p.IncomingResponse&&(c=e.status_code,d=e.reason_phrase),b.notify({status_code:c,reason_phrase:d}),b.close()})},d.prototype.accept=function(a){a=a||{};var b=a.extraHeaders||[],c=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing refer');this.closed||(this.subscription_state="active",this.subscription_expires=Date.now()+t,this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),t),b.push("Contact: "+this.contact),this.request.reply(202,null,b,c),this.notify(),this.accepted=!0,console.log(s+this.id+" accepted"))},d.prototype.reject=function(a){a=a||{};var b=a.status_code||603,c=a.reason_phrase,d=a.extraHeaders||[],e=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing refer');if(300>b||b>=700)throw new TypeError("Invalid status_code: "+b);this.closed||(this.accepted?(console.log(s+this.id+" rejected (late)"),this.notify({status_code:b,reason_phrase:c})):(console.log(s+this.id+" rejected (early)"),this.request.reply(b,c,d,e),this.rejected=!0),this.close())},d.prototype.notify=function(a){var b,c,d,e,f,g,h,i,j=this;if("incoming"!==this.direction)throw new TypeError('Invalid method "notify" for an outgoing refer');if(a=a||{},a.body&&"undefined"==typeof a.finalNotify)throw new TypeError("Must specify finalNotify when providing notify body");"active"===this.subscription_state&&(b=a.status_code||100,c=a.reason_phrase||m.REASON_PHRASE[b]||"",d=a.finalNotify||b>=200,d?(e="terminated",f=a.terminateReason||"noresource",g=e+";reason="+f):(e="active",g=e+";expires="+Math.round((this.subscription_expires-Date.now())/1e3)),h=a.body||"SIP/2.0 "+b+" "+c+"\r\n",this.last_notify_body=h,i=new k(this),i.send("refer",g,{extraHeaders:a.extraHeaders,eventHandlers:a.eventHandlers,content_type:"message/sipfrag",body:h}),this.subscription_state=e,d||i.on("failed",function(){j.subscription_state="terminated",console.log(s+j.id+" unsubscribed (rejected notify)"),j.close()}))},d.prototype.receiveRequest=function(a){switch(a.method){case m.NOTIFY:return void this.receiveNotify(a);case m.SUBSCRIBE:return void this.receiveSubscribe(a)}a.reply(405,null,["Allow: "+f.getAllowedMethods(this.ua)])},d.prototype.receiveNotify=function(a){var b,c,d,e,f,g,k,l=!1;return"outgoing"!==this.direction||"active"!==this.subscription_state&&"pending"!==this.subscription_state?void a.reply(481,"Subscription Does Not Exist"):(b=a.parseHeader("event"),b&&"refer"===b.event?(c=a.parseHeader("subscription-state"))?(d=a.getHeader("content-type"),d&&d.indexOf("message/sipfrag")<0?(a.reply(415),void this.close()):(k=a.body,/\r\n$/.test(k)||(k+="\r\n"),e=i.parseMessage(k,!0),e&&e instanceof p.IncomingResponse?0===this.listeners("notify").length?(console.log(s+this.id+" no notify listeners; unsubscribing"),a.reply(603),this.subscription_state="terminated",void this.close()):this.dialog||(this.remote_tag=a.from_tag,this.dialog=new j(this,a,"UAS"),this.dialog.id)?(this.subscription_state=c.state,this.subscription_expires=Date.now()+1e3*c.expires,this.last_notify_body=e,null!==this.notify_timer&&(clearTimeout(this.notify_timer),this.notify_timer=null),null!==this.expire_timer&&(clearTimeout(this.expire_timer),this.expire_timer=null),g=["Contact: "+this.contact],a.reply(200,null,g),f=e.status_code<200?"progress":e.status_code<300?"started":"failed",console.log(s+this.id+" notify: "+f),"terminated"===this.subscription_state?(l=!0,this.close()):this.expire_timer=setTimeout(this.close.bind(this),1e3*(c.expires+h.T4)),void this.emit("notify",this,{originator:"remote",request:a,sipFrag:e,sessionEvent:f,finalNotify:l})):(console.warn(s+this.id+" dialog creation failed"),this.close(),void this.emit("failed",this,{originator:"remote",message:a,cause:m.causes.INTERNAL_ERROR})):(a.reply(400,"Bad Message Body"),void this.close()))):(a.reply(400,"Missing Subscription-State Header"),void this.close()):(a.reply(489),void this.close()))},d.prototype.receiveSubscribe=function(a){var b,c,d;return"incoming"!==this.direction?void a.reply(481):"active"!==this.subscription_state&&"terminated"!==this.subscription_state?void a.reply(403):(b=a.parseHeader("event"),b&&"refer"===b.event?(c=a.parseHeader("expires"),0===c?(console.log(s+this.id+" unsubscribed (expires=0)"),this.notify({body:this.last_notify_body,finalNotify:!0}),d=["Contact: "+this.contact],a.reply(200,null,d),void this.close()):(c=c>0?1e3*c:t,this.subscription_state="active",this.subscription_expires=Date.now()+c,null!==this.expire_timer&&clearTimeout(this.expire_timer),this.expire_timer=setTimeout(this.subscriptionExpired.bind(this),c),d=["Contact: "+this.contact,"Expires: "+c/1e3],a.reply(200,null,d),void console.log(s+this.id+" subscription extended"))):void a.reply(489))}},{"./Constants":3,"./Dialog":4,"./DialogId":5,"./EventEmitter":7,"./Exceptions":8,"./JsSIP":11,"./Notify":14,"./Parser":15,"./RTCSession":16,"./RequestSender":25,"./SIPMessage":26,"./Timers":28,"./URI":32,"./Utils":33}],24:[function(a,b,c){(function(c){function d(a,b){var c=1;this.ua=a,this.transport=b,this.registrar=a.configuration.registrar_server,this.expires=a.configuration.register_expires,this.call_id=e.createRandomToken(22),this.cseq=80,this.to_uri=a.configuration.uri,this.registrationTimer=null,this.registered=this.registered_before=!1,this.ua.registrator=this,this.contact=this.ua.contact.toString(),c&&(this.contact+=";reg-id="+c,this.contact+=';+sip.instance="<urn:'+this.ua.configuration.instance_id+'>"')}b.exports=d;var e=a("./Utils"),f=a("./Constants"),g=a("./SIPMessage"),h=a("./RequestSender"),i=a("./JsSIP"),j=i.name+" | REGISTRATOR | ";d.prototype={register:function(a){var b,d,i,k=this;a=a||{},i=a.extraHeaders||[],i.push("Contact: "+this.contact+";expires="+this.expires),this.request=new g.OutgoingRequest(f.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},i),b=new h(this,this.ua),this.receiveResponse=function(a){var b,g,h=a.countHeader("contact");if(a.cseq===this.cseq)switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):if(a.hasHeader("expires")&&(g=a.getHeader("expires")),!h){console.warn(j+"no Contact header in response to REGISTER, response ignored");break}for(;h--;){if(b=a.parseHeader("contact",h),b.uri.user===this.ua.contact.uri.user){g=b.getParam("expires");break}b=null}if(!b){console.warn(j+"no Contact header pointing to us, response ignored");break}g||(g=this.expires),this.registrationTimer=c.setTimeout(function(){k.register()},1e3*g-3e3),b.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=b.getParam("temp-gruu").replace(/"/g,"")),b.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=b.getParam("pub-gruu").replace(/"/g,"")),this.registered=!0,this.ua.emit("registered",this.ua,{response:a});break;case/^423$/.test(a.status_code):a.hasHeader("min-expires")?(this.expires=a.getHeader("min-expires"),this.registrationTimer=c.setTimeout(function(){k.register()},0)):(console.warn(j+"423 response received for REGISTER without Min-Expires"),this.registrationFailure(a,f.causes.SIP_FAILURE_CODE));break;default:d=e.sipErrorCause(a.status_code),this.registrationFailure(a,d)}},this.onRequestTimeout=function(){this.registrationFailure(null,f.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,f.causes.CONNECTION_ERROR)},b.send()},unregister:function(a){var b;if(!this.registered)return void console.warn(j+"already unregistered");a=a||{},b=a.extraHeaders||[],this.registered=!1,c.clearTimeout(this.registrationTimer),a.all?(b.push("Contact: *"),b.push("Expires: 0"),this.request=new g.OutgoingRequest(f.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b)):(b.push("Contact: "+this.contact+";expires=0"),this.request=new g.OutgoingRequest(f.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},b));var d=new h(this,this.ua);this.receiveResponse=function(a){var b;switch(!0){case/^1[0-9]{2}$/.test(a.status_code):break;case/^2[0-9]{2}$/.test(a.status_code):this.unregistered(a);break;default:b=e.sipErrorCause(a.status_code),this.unregistered(a,b)}},this.onRequestTimeout=function(){this.unregistered(null,f.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,f.causes.CONNECTION_ERROR)},d.send()},registrationFailure:function(a,b){this.ua.emit("registrationFailed",this.ua,{response:a||null,cause:b}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b}))},unregistered:function(a,b){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:b||null})},onTransportClosed:function(){this.registered_before=this.registered,c.clearTimeout(this.registrationTimer),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered,this.unregister()}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./JsSIP":11,"./RequestSender":25,"./SIPMessage":26,"./Utils":33}],25:[function(a,b,c){function d(a,b){this.ua=b,this.applicant=a,this.method=a.request.method,this.request=a.request,this.credentials=null,this.challenged=!1,this.staled=!1,b.status!==f.C.STATUS_USER_CLOSED||this.method===e.BYE&&this.method===e.ACK||this.onTransportError()}b.exports=d;var e=a("./Constants"),f=a("./UA"),g=a("./DigestAuthentication"),h=a("./Transactions"),i=a("./JsSIP"),j=i.name+" | REQUEST SENDER | ";d.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new h.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new h.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new h.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(a){var b,c,d,f=a.status_code;if(401!==f&&407!==f||null===this.ua.configuration.password)this.applicant.receiveResponse(a);else{if(401===a.status_code?(c=a.parseHeader("www-authenticate"),d="authorization"):(c=a.parseHeader("proxy-authenticate"),d="proxy-authorization"),!c)return console.warn(j+a.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(a);if(!this.challenged||!this.staled&&c.stale===!0){if(this.credentials||(this.credentials=new g(this.ua)),!this.credentials.authenticate(this.request,c))return void this.applicant.receiveResponse(a);this.challenged=!0,c.stale&&(this.staled=!0),a.method===e.REGISTER?b=this.applicant.cseq+=1:this.request.dialog?b=this.request.dialog.local_seqnum+=1:(b=this.request.cseq+1,this.request.cseq=b),this.request.setHeader("cseq",b+" "+this.method),this.request.setHeader(d,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(a)}}}},{"./Constants":3,"./DigestAuthentication":6,"./JsSIP":11,"./Transactions":29,"./UA":31}],26:[function(a,b,c){function d(a,b,c,d,e,f){var g,k,m,n,o;return d=d||{},a&&b&&c?(this.headers={},this.method=a,this.ruri=b,this.body=f,this.extraHeaders=e||[],d.route_set?this.setHeader("route",d.route_set):c.configuration.use_preloaded_route&&this.setHeader("route",c.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",l.C.MAX_FORWARDS),g=d.to_display_name||0===d.to_display_name?'"'+d.to_display_name+'" ':"",g+="<"+(d.to_uri||b)+">",g+=d.to_tag?";tag="+d.to_tag:"",this.to=new j.parse(g),this.setHeader("to",g),k=d.from_display_name||0===d.from_display_name?'"'+d.from_display_name+'" ':c.configuration.display_name?'"'+c.configuration.display_name+'" ':"",k+="<"+(d.from_uri||c.configuration.uri)+">;tag=",k+=d.from_tag||i.newTag(),this.from=new j.parse(k),this.setHeader("from",k),m=d.call_id||c.configuration.jssip_id+i.createRandomToken(15),this.call_id=m,this.setHeader("call-id",m),n=d.cseq||Math.floor(1e4*Math.random()),this.cseq=n,this.setHeader("cseq",n+" "+a),a!==h.CANCEL&&a!==h.ACK&&this.setHeader("allow",i.getAllowedMethods(c)),void(a!==h.ACK&&(o=i.getSupportedExtensions(c,d.extra_supported),this.setHeader("supported",o.join(","))))):null}function e(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null}function f(){this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null}function g(){this.headers={},this.status_code=null,this.reason_phrase=null}b.exports={OutgoingRequest:d,IncomingRequest:f,IncomingResponse:g};var h=a("./Constants"),i=a("./Utils"),j=a("./NameAddrHeader"),k=a("./Grammar"),l=a("./UA"),m=a("./JsSIP"),n=m.name+" | SIP MESSAGE | ";d.prototype={setHeader:function(a,b){this.headers[i.headerize(a)]=b instanceof Array?b:[b]},toString:function(){var a,b,c,d="";d+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(a in this.headers)if(this.headers.hasOwnProperty(a))for(c in this.headers[a])this.headers[a].hasOwnProperty(c)&&(d+=a+": "+this.headers[a][c]+"\r\n");for(b=this.extraHeaders.length,c=0;b>c;c++)d+=this.extraHeaders[c]+"\r\n";return d+="User-Agent: "+h.USER_AGENT+"\r\n",this.body?(b=i.str_utf8_length(this.body),d+="Content-Length: "+b+"\r\n\r\n",d+=this.body):d+="Content-Length: 0\r\n\r\n",d}},e.prototype={addHeader:function(a,b){var c={raw:b};a=i.headerize(a),this.headers[a]?this.headers[a].push(c):this.headers[a]=[c]},countHeader:function(a){var b=this.headers[i.headerize(a)];return b?b.length:0},getHeader:function(a,b){var c=this.headers[i.headerize(a)];return b=b||0,c&&c[b]?c[b].raw:void 0},getHeaderAll:function(a){var b,c=this.headers[i.headerize(a)],d=[];if(!c)return[];for(b in c)c.hasOwnProperty(b)&&d.push(c[b].raw);return d},hasHeader:function(a){return this.headers[i.headerize(a)]?!0:!1},parseHeader:function(a,b){var c,d,e;return a=i.headerize(a),b=b||0,this.headers[a]?b>=this.headers[a].length?void console.log(n+'not so many "'+a+'" headers present'):(c=this.headers[a][b],d=c.raw,c.parsed?c.parsed:(e=k.parse(d,a.replace(/-/g,"_")),-1===e?(this.headers[a].splice(b,1),void console.warn(n+'error parsing "'+a+'" header field with value "'+d+'"')):(c.parsed=e,e))):void console.log(n+'header "'+a+'" not present')},s:function(a,b){return this.parseHeader(a,b)},setHeader:function(a,b){var c={raw:b};this.headers[i.headerize(a)]=[c]},toString:function(){return this.data}},f.prototype=new e,f.prototype.reply=function(a,b,c,d,e,f){var g,j,k,l,m,n=this.getHeader("To"),o=0,p=0;if(a=a||null,b=b||null,!a||100>a||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);switch(b=b||h.REASON_PHRASE[a]||"",c=c||[],m="SIP/2.0 "+a+" "+b+"\r\n",this.method){case h.INVITE:case h.REFER:case h.SUBSCRIBE:case h.NOTIFY:if(a>100&&200>=a)for(g=this.countHeader("record-route"),o;g>o;o++)m+="Record-Route: "+this.getHeader("record-route",o)+"\r\n"}for(j=this.countHeader("via"),p;j>p;p++)m+="Via: "+this.getHeader("via",p)+"\r\n";for(this.to_tag&&!this.s("to").hasParam("tag")&&(n+=";tag="+this.to_tag),m+="To: "+n+"\r\n",m+="From: "+this.getHeader("From")+"\r\n",m+="Call-ID: "+this.call_id+"\r\n",m+="CSeq: "+this.cseq+" "+this.method+"\r\n",k=c.length,l=0;k>l;l++)m+=c[l]+"\r\n";m+="User-Agent: "+h.USER_AGENT+"\r\n",d?(k=i.str_utf8_length(d),m+="Content-Type: application/sdp\r\n",m+="Content-Length: "+k+"\r\n\r\n",m+=d):m+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(a,m,e,f)},f.prototype.reply_sl=function(a,b){var c,d,e=this.countHeader("via");if(a=a||null,b=b||null,!a||100>a||a>699)throw new TypeError("Invalid status_code: "+a);if(b&&"string"!=typeof b&&!(b instanceof String))throw new TypeError("Invalid reason_phrase: "+b);b=b||h.REASON_PHRASE[a]||"",d="SIP/2.0 "+a+" "+b+"\r\n";for(var f=0;e>f;f++)d+="Via: "+this.getHeader("via",f)+"\r\n";c=this.getHeader("To"),this.to_tag&&!this.s("to").hasParam("tag")&&(c+=";tag="+this.to_tag),d+="To: "+c+"\r\n",d+="From: "+this.getHeader("From")+"\r\n",d+="Call-ID: "+this.call_id+"\r\n",d+="CSeq: "+this.cseq+" "+this.method+"\r\n",d+="User-Agent: "+h.USER_AGENT+"\r\n",d+="Content-Length: 0\r\n\r\n",this.transport.send(d)},g.prototype=new e},{"./Constants":3,"./Grammar":9,"./JsSIP":11,"./NameAddrHeader":13,"./UA":31,"./Utils":33}],27:[function(a,b,c){function d(){return"sip"!==n.s("to").uri.scheme?(l(416),!1):void 0}function e(){return n.to_tag||n.call_id.substr(0,5)!==o.configuration.jssip_id?void 0:(l(482),!1)}function f(){var a=q.str_utf8_length(n.body),b=n.getHeader("content-length");return b>a?(l(400),!1):void 0}function g(){var a,b,c=n.from_tag,d=n.call_id,e=n.cseq;if(!n.to_tag)if(n.method===s.INVITE){if(a=o.transactions.ist[n.via_branch],!a)return;for(b in o.transactions.ist)if(o.transactions.ist.hasOwnProperty(b)&&(a=o.transactions.ist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e))return l(482),!1}else{if(a=o.transactions.nist[n.via_branch],!a)return;for(b in o.transactions.nist)if(o.transactions.nist.hasOwnProperty(b)&&(a=o.transactions.nist[b],a.request.from_tag===c&&a.request.call_id===d&&a.request.cseq===e))return l(482),!1}}function h(){return n.countHeader("via")>1?(console.warn(u+"More than one Via header field present in the response. Dropping the response"),!1):void 0}function i(){var a=o.configuration.via_host;return n.via.host!==a?(console.warn(u+"Via host in the response does not match UA Via host value. Dropping the response"),!1):void 0}function j(){var a=q.str_utf8_length(n.body),b=n.getHeader("content-length");return b>a?(console.warn(u+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1):void 0}function k(){for(var a=["from","to","call_id","cseq","via"],b=a.length;b--;)if(!n.hasHeader(a[b]))return console.warn(u+"Missing mandatory header field : "+a[b]+". Dropping the response"),!1}function l(a){var b,c="SIP/2.0 "+a+" "+s.REASON_PHRASE[a]+"\r\n",d=n.countHeader("via"),e=0;for(e;d>e;e++)c+="Via: "+n.getHeader("via",e)+"\r\n";b=n.getHeader("To"),n.to_tag||(b+=";tag="+q.newTag()),c+="To: "+b+"\r\n",c+="From: "+n.getHeader("From")+"\r\n",c+="Call-ID: "+n.call_id+"\r\n",c+="CSeq: "+n.cseq+" "+n.method+"\r\n",c+="\r\n",p.send(c)}function m(a,b,c){var d,e;for(n=a,o=b,p=c,d=x.length;d--;)if(e=x[d](n),e===!1)return!1;if(n instanceof t.IncomingRequest){for(d=v.length;d--;)if(e=v[d](n),e===!1)return!1}else if(n instanceof t.IncomingResponse)for(d=w.length;d--;)if(e=w[d](n),e===!1)return!1;return!0}b.exports=m;var n,o,p,q=a("./Utils"),r=a("./JsSIP"),s=a("./Constants"),t=a("./SIPMessage"),u=r.name+" | SANITY CHECK | ",v=[],w=[],x=[];v.push(d),v.push(e),v.push(f),v.push(g),w.push(h),w.push(i),w.push(j),x.push(k)},{"./Constants":3,"./JsSIP":11,"./SIPMessage":26,"./Utils":33}],28:[function(a,b,c){var d=500,e=4e3,f=5e3,g={T1:d,T2:e,T4:f,TIMER_B:64*d,TIMER_D:0*d,TIMER_F:64*d,TIMER_H:64*d,TIMER_I:0*d,TIMER_J:0*d,TIMER_K:0*f,TIMER_L:64*d,TIMER_M:64*d};b.exports=g},{}],29:[function(a,b,c){(function(c){function d(){this.init=function(a,b,c){var d;this.transport=c,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=a,this.request=b,d="SIP/2.0/"+(a.ua.configuration.hack_via_tcp?"TCP":c.server.scheme),d+=" "+a.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",d)}}function e(){this.send=function(){var a=this;this.state=p.STATUS_TRYING,this.F=c.setTimeout(function(){a.timer_F()},r.TIMER_F),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){switch(console.log(t+"transport error occurred, deleting non-INVITE client transaction "+this.id),c.clearTimeout(this.F),c.clearTimeout(this.K),delete this.request_sender.ua.transactions.nict[this.id],this.state){case p.STATUS_COMPLETED:case p.STATUS_TERMINATED:return}this.request_sender.onTransportError()},this.timer_F=function(){console.log(t+"Timer F expired for non-INVITE client transaction "+this.id),
this.state=p.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.nict[this.id]},this.timer_K=function(){this.state=p.STATUS_TERMINATED,delete this.request_sender.ua.transactions.nict[this.id]},this.receiveResponse=function(a){var b=this,d=a.status_code;if(200>d)switch(this.state){case p.STATUS_TRYING:case p.STATUS_PROCEEDING:this.state=p.STATUS_PROCEEDING,this.request_sender.receiveResponse(a)}else switch(this.state){case p.STATUS_TRYING:case p.STATUS_PROCEEDING:this.state=p.STATUS_COMPLETED,c.clearTimeout(this.F),408===d?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(a),this.K=c.setTimeout(function(){b.timer_K()},r.TIMER_K);break;case p.STATUS_COMPLETED:}}}function f(){this.send=function(){var a=this;this.state=p.STATUS_CALLING,this.B=c.setTimeout(function(){a.timer_B()},r.TIMER_B),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){switch(console.log(t+"transport error occurred, deleting INVITE client transaction "+this.id),c.clearTimeout(this.B),c.clearTimeout(this.D),c.clearTimeout(this.M),delete this.request_sender.ua.transactions.ict[this.id],this.state){case p.STATUS_ACCEPTED:case p.STATUS_COMPLETED:case p.STATUS_TERMINATED:return}this.request_sender.onTransportError()},this.timer_M=function(){console.log(t+"Timer M expired for INVITE client transaction "+this.id),this.state===p.STATUS_ACCEPTED&&(this.state=p.STATUS_TERMINATED,c.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_B=function(){console.log(t+"Timer B expired for INVITE client transaction "+this.id),this.state===p.STATUS_CALLING&&(this.state=p.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_D=function(){console.log(t+"Timer D expired for INVITE client transaction "+this.id),this.state=p.STATUS_TERMINATED,c.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id]},this.sendACK=function(a){var b=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+a.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=c.setTimeout(function(){b.timer_D()},r.TIMER_D),this.transport.send(this.ack)},this.cancel_request=function(a,b){var c=a.request;this.cancel=q.CANCEL+" "+c.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+c.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+c.headers.Route.toString()+"\r\n"),this.cancel+="To: "+c.headers.To.toString()+"\r\n",this.cancel+="From: "+c.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+c.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+c.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",b&&(this.cancel+="Reason: "+b+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===p.STATUS_PROCEEDING&&this.transport.send(this.cancel)},this.receiveResponse=function(a){var b=this,d=a.status_code;if(d>=100&&199>=d)switch(this.state){case p.STATUS_CALLING:this.state=p.STATUS_PROCEEDING,this.request_sender.receiveResponse(a),this.cancel&&this.transport.send(this.cancel);break;case p.STATUS_PROCEEDING:this.request_sender.receiveResponse(a)}else if(d>=200&&299>=d)switch(this.state){case p.STATUS_CALLING:case p.STATUS_PROCEEDING:this.state=p.STATUS_ACCEPTED,this.M=c.setTimeout(function(){b.timer_M()},r.TIMER_M),this.request_sender.receiveResponse(a);break;case p.STATUS_ACCEPTED:this.request_sender.receiveResponse(a)}else if(d>=300&&699>=d)switch(this.state){case p.STATUS_CALLING:case p.STATUS_PROCEEDING:this.state=p.STATUS_COMPLETED,this.sendACK(a),this.request_sender.receiveResponse(a);break;case p.STATUS_COMPLETED:this.sendACK(a)}}}function g(){this.init=function(a,b){this.id=a.via_branch,this.request=a,this.transport=a.transport,this.ua=b,this.last_response="",a.server_transaction=this}}function h(){this.timer_J=function(){console.log(t+"Timer J expired for non-INVITE server transaction "+this.id),this.state=p.STATUS_TERMINATED,delete this.ua.transactions.nist[this.id]},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(t+"transport error occurred, deleting non-INVITE server transaction "+this.id),c.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])},this.receiveResponse=function(a,b,d,e){var f=this;if(100===a)switch(this.state){case p.STATUS_TRYING:this.state=p.STATUS_PROCEEDING,this.transport.send(b)||this.onTransportError();break;case p.STATUS_PROCEEDING:this.last_response=b,this.transport.send(b)?d&&d():(this.onTransportError(),e&&e())}else if(a>=200&&699>=a)switch(this.state){case p.STATUS_TRYING:case p.STATUS_PROCEEDING:this.state=p.STATUS_COMPLETED,this.last_response=b,this.J=c.setTimeout(function(){f.timer_J()},r.TIMER_J),this.transport.send(b)?d&&d():(this.onTransportError(),e&&e());break;case p.STATUS_COMPLETED:}}}function i(){this.timer_H=function(){console.log(t+"Timer H expired for INVITE server transaction "+this.id),this.state===p.STATUS_COMPLETED&&(console.warn(t+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=p.STATUS_TERMINATED),delete this.ua.transactions.ist[this.id]},this.timer_I=function(){this.state=p.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id]},this.timer_L=function(){console.log(t+"Timer L expired for INVITE server transaction "+this.id),this.state===p.STATUS_ACCEPTED&&(this.state=p.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])},this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(t+"transport error occurred, deleting INVITE server transaction "+this.id),c.clearInterval(this.resendProvisionalTimer),c.clearTimeout(this.L),c.clearTimeout(this.H),c.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])},this.resend_provisional=function(){this.transport.send(this.last_response)||this.onTransportError()},this.receiveResponse=function(a,b,d,e){var f=this;if(a>=100&&199>=a)switch(this.state){case p.STATUS_PROCEEDING:this.transport.send(b)||this.onTransportError(),this.last_response=b}if(a>100&&199>=a)this.resendProvisionalTimer||(this.resendProvisionalTimer=c.setInterval(function(){f.resend_provisional()},60*r.T1));else if(a>=200&&299>=a)switch(this.state){case p.STATUS_PROCEEDING:this.state=p.STATUS_ACCEPTED,this.last_response=b,this.L=c.setTimeout(function(){f.timer_L()},r.TIMER_L),c.clearInterval(this.resendProvisionalTimer);case p.STATUS_ACCEPTED:this.transport.send(b)?d&&d():(this.onTransportError(),e&&e())}else if(a>=300&&699>=a)switch(this.state){case p.STATUS_PROCEEDING:c.clearInterval(this.resendProvisionalTimer),this.transport.send(b)?(this.state=p.STATUS_COMPLETED,this.H=c.setTimeout(function(){f.timer_H()},r.TIMER_H),d&&d()):(this.onTransportError(),e&&e())}}}function j(a,b,c){this.init(a,b,c),this.request_sender.ua.transactions.nict[this.id]=this}function k(a,b,c){var d=this;this.init(a,b,c),this.request_sender.ua.transactions.ict[this.id]=this,this.request.cancel=function(a){d.cancel_request(d,a)}}function l(a,b,c){this.init(a,b,c),this.send=function(){this.transport.send(b)}}function m(a,b){this.init(a,b),this.state=p.STATUS_TRYING,b.transactions.nist[this.id]=this}function n(a,b){this.init(a,b),this.state=p.STATUS_PROCEEDING,b.transactions.ist[this.id]=this,this.resendProvisionalTimer=null,a.reply(100)}function o(a,b){var d;switch(b.method){case q.INVITE:if(d=a.transactions.ist[b.via_branch]){switch(d.state){case p.STATUS_PROCEEDING:d.transport.send(d.last_response);break;case p.STATUS_ACCEPTED:}return!0}break;case q.ACK:if(d=a.transactions.ist[b.via_branch],!d)return!1;if(d.state===p.STATUS_ACCEPTED)return!1;if(d.state===p.STATUS_COMPLETED)return d.state=p.STATUS_CONFIRMED,d.I=c.setTimeout(function(){d.timer_I()},r.TIMER_I),!0;break;case q.CANCEL:return d=a.transactions.ist[b.via_branch],d&&d.state===p.STATUS_PROCEEDING?!1:(b.reply_sl(481),!0);default:if(d=a.transactions.nist[b.via_branch]){switch(d.state){case p.STATUS_TRYING:break;case p.STATUS_PROCEEDING:case p.STATUS_COMPLETED:d.transport.send(d.last_response)}return!0}}}b.exports={C:null,NonInviteClientTransaction:j,InviteClientTransaction:k,AckClientTransaction:l,NonInviteServerTransaction:m,InviteServerTransaction:n,checkTransaction:o};var p={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};b.exports.C=p;var q=a("./Constants"),r=a("./Timers"),s=a("./JsSIP"),t=s.name+" | TRANSACTION | ";e.prototype=new d,f.prototype=new d,h.prototype=new g,i.prototype=new g,j.prototype=new e,k.prototype=new f,l.prototype=new e,m.prototype=new h,n.prototype=new i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./JsSIP":11,"./Timers":28}],30:[function(a,b,c){(function(c){function d(a,b){this.ua=a,this.ws=null,this.server=b,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.ua.transport=this,this.connect()}b.exports=d;var e={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};d.C=e;var f=a("./Constants"),g=a("./Parser"),h=a("./UA"),i=a("./SIPMessage"),j=a("./SanityCheck"),k="undefined"!=typeof window?window.WebSocket:"undefined"!=typeof c?c.WebSocket:null,l=a("./JsSIP"),m=l.name+" | TRANSPORT | ";k=k.w3cwebsocket||k,d.prototype={send:function(a){var b=a.toString();return this.ws&&this.ws.readyState===this.ws.OPEN?(this.ua.configuration.trace_sip===!0&&console.log(m+"sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0):(console.warn(m+"unable to send message, WebSocket is not open"),!1)},disconnect:function(){this.ws&&(this.closed=!0,console.log(m+"closing WebSocket "+this.server.ws_uri),this.ws.close()),null!==this.reconnectTimer&&(c.clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}))},connect:function(){var a=this;if(this.ws&&(this.ws.readyState===this.ws.OPEN||this.ws.readyState===this.ws.CONNECTING))return console.log(m+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),console.log(m+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new k(this.server.ws_uri,"sip",null,null,null,{fragmentOutgoingMessages:!1})}catch(b){console.warn(m+"error connecting to WebSocket "+this.server.ws_uri+": "+b)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(b){a.onClose(b)},this.ws.onmessage=function(b){a.onMessage(b)},this.ws.onerror=function(b){a.onError(b)}},onOpen:function(){this.connected=!0,console.log(m+"WebSocket "+this.server.ws_uri+" connected"),null!==this.reconnectTimer&&(c.clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.reconnection_attempts=0,this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(a){var b=this.connected;this.connected=!1,this.lastTransportError.code=a.code,this.lastTransportError.reason=a.reason,console.log(m+"WebSocket disconnected (code: "+a.code+(a.reason?"| reason: "+a.reason:"")+")"),a.wasClean===!1&&console.warn(m+"WebSocket abrupt disconnection"),b===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):this.reConnect()):this.ua.onTransportError(this)},onMessage:function(a){var b,c,d=a.data;if("\r\n"===d)return void(this.ua.configuration.trace_sip===!0&&console.log(m+"received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof d){try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(e){return void console.warn(m+"received WebSocket binary message failed to be converted into string, message discarded")}this.ua.configuration.trace_sip===!0&&console.log(m+"received WebSocket binary message:\n\n"+d+"\n")}else this.ua.configuration.trace_sip===!0&&console.log(m+"received WebSocket text message:\n\n"+d+"\n");if(b=g.parseMessage(d),!(this.ua.status===h.C.STATUS_USER_CLOSED&&b instanceof i.IncomingRequest)&&b&&j(b,this.ua,this))if(b instanceof i.IncomingRequest)b.transport=this,this.ua.receiveRequest(b);else if(b instanceof i.IncomingResponse)switch(b.method){case f.INVITE:c=this.ua.transactions.ict[b.via_branch],c&&c.receiveResponse(b);break;case f.ACK:break;default:c=this.ua.transactions.nict[b.via_branch],c&&c.receiveResponse(b)}},onError:function(a){console.warn(m+"WebSocket connection error: "+a)},reConnect:function(){var a=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(m+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(m+"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=c.setTimeout(function(){a.connect(),a.reconnectTimer=null},1e3*this.ua.configuration.ws_server_reconnection_timeout))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./JsSIP":11,"./Parser":15,"./SIPMessage":26,"./SanityCheck":27,"./UA":31}],31:[function(a,b,c){(function(c){function d(a){var b=["connected","disconnected","registered","unregistered","registrationFailed","newRTCSession","newMessage","newOptions","newRefer"];if(e.ACCEPTED_BODY_TYPES=e.ACCEPTED_BODY_TYPES.toString(),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.registrator=null,this.applicants={},this.sessions={},this.refers={},this.transport=null,this.contact=null,this.status=e.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,this.transportRecoverTimer=null,void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a),this.initEvents(b)}catch(c){throw this.status=e.STATUS_NOT_READY,this.error=e.CONFIGURATION_ERROR,c}}b.exports=d;var e={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE,UPDATE",newMessage:"MESSAGE",newRefer:"REFER"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS","NOTIFY"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED_EXTENSIONS:["path","outbound","gruu"],EVENT_EXTENSIONS:{tdialog:"newRefer"},SESSION_EVENT_EXTENSIONS:{timer:"refresh"},MAX_FORWARDS:69,TAG_LENGTH:10};d.C=e;var f=a("./Constants"),g=a("./Registrator"),h=a("./RTCSession"),i=a("./Message"),j=a("./Transport"),k=a("./Transactions"),l=a("./Utils"),m=a("./Exceptions"),n=a("./URI"),o=a("./Grammar"),p=a("./EventEmitter"),q=a("./WebRTC"),r=a("./Refer"),s=a("./JsSIP"),t=s.name+" | UA | ";d.prototype=new p,d.prototype.register=function(a){this.configuration.register=!0,this.registrator.register(a)},d.prototype.unregister=function(a){this.configuration.register=!1,this.registrator.unregister(a)},d.prototype.isRegistered=function(){return this.registrator&&this.registrator.registered?!0:!1},d.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},d.prototype.updateConfiguration=function(a){if(a.ws_servers){var b=d.configuration_check.mandatory.ws_servers(a.ws_servers);b&&(this.configuration.ws_servers=b)}if(a.authorization_user){var c=d.configuration_check.optional.authorization_user(a.authorization_user);c&&(this.configuration.authorization_user=c)}if(a.password){var e=d.configuration_check.optional.password(a.password);e&&(this.configuration.password=e)}},d.prototype.call=function(a,b){var c;c=new h(this),c.connect(a,b)},d.prototype.sendMessage=function(a,b,c){var d;d=new i(this),d.send(a,b,c)},d.prototype.sendRefer=function(a,b,c){var d;d=new r(this),d.send(a,b,c)},d.prototype.stop=function(){var a=this;if(console.log(t+"user requested closure..."),this.status===e.STATUS_USER_CLOSED)return void console.warn("UA already closed");this.transportRecoverTimer&&(c.clearTimeout(this.transportRecoverTimer),this.transportRecoverTimer=null),this.registrator&&(console.log(t+"closing registrator"),this.registrator.close());for(var b in this.sessions)this.sessions.hasOwnProperty(b)&&(console.log(t+"closing session "+b),this.sessions[b].terminate());for(var d in this.refers)this.refers.hasOwnProperty(d)&&this.refers[d].close();for(var f in this.applicants)this.applicants.hasOwnProperty(f)&&this.applicants[f].close();this.status=e.STATUS_USER_CLOSED,this.isAnyTransactionOutstanding()?(this.transactionCheckTimer=c.setInterval(function(){a.isAnyTransactionOutstanding()||(c.clearInterval(a.transactionCheckTimer),c.clearTimeout(a.shutdownGraceTimer),a.transport.disconnect())},500),this.shutdownGraceTimer=c.setTimeout(function(){c.clearInterval(a.transactionCheckTimer),a.transport.disconnect()},"5000")):a.transport.disconnect()},d.prototype.start=function(){var a;console.log(t+"user requested startup..."),this.status===e.STATUS_INIT?(a=this.getNextWsServer(),new j(this,a)):this.status===e.STATUS_USER_CLOSED?(console.log(t+"resuming"),this.status=e.STATUS_READY,this.transport.connect()):this.status===e.STATUS_READY?console.log(t+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")},d.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=this.cache.credentials[a.realm]||{},this.cache.credentials[a.realm][a.uri]=a},d.prototype.getCredentials=function(a){var b,c;return b=a.ruri.host,this.cache.credentials[b]&&this.cache.credentials[b][a.ruri]&&(c=this.cache.credentials[b][a.ruri],c.method=a.method),c},d.prototype.isAnyTransactionOutstanding=function(){for(var a=["nict","ict","nist","ist"],b=0;b<a.length;b++){var c=a[b];for(var d in this.transactions[c])if(this.transactions[c].hasOwnProperty(d))return!0}return!1},d.prototype.onTransportClosed=function(a){var b=["nict","ict","nist","ist"],c=this;a.server.status=j.C.STATUS_DISCONNECTED,console.log(t+"connection state set to "+j.C.STATUS_DISCONNECTED),b.forEach(function(a){for(var b in c.transactions[a])c.transactions[a].hasOwnProperty(b)&&c.transactions[a][b].onTransportError()}),this.contact.pub_gruu||this.closeSessionsOnTransportError()},d.prototype.onTransportError=function(a){var b;console.log(t+"transport "+a.server.ws_uri+" failed | connection state set to "+j.C.STATUS_ERROR),a.server.status=j.C.STATUS_ERROR,this.emit("disconnected",this,{transport:a,code:a.lastTransportError.code,reason:a.lastTransportError.reason}),this.status!==e.STATUS_USER_CLOSED&&(b=this.getNextWsServer(),b?new j(this,b):(this.closeSessionsOnTransportError(),this.error&&this.error===e.NETWORK_ERROR||(this.status=e.STATUS_NOT_READY,this.error=e.NETWORK_ERROR),this.recoverTransport()))},d.prototype.onTransportConnected=function(a){this.transport=a,this.transportRecoverAttempts=0,a.server.status=j.C.STATUS_READY,console.log(t+"connection state set to "+j.C.STATUS_READY),this.status!==e.STATUS_USER_CLOSED&&(this.status=e.STATUS_READY,this.error=null,this.emit("connected",this,{transport:a}),this.configuration.register?this.registrator?this.registrator.onTransportConnected():(this.registrator=new g(this,a),this.register()):this.registrator=new g(this,a))},d.prototype.receiveRequest=function(a){var b,c,d,g,j=a.method;if(a.ruri.user!==this.configuration.uri.user&&a.ruri.user!==this.contact.uri.user)return console.warn(t+"Request-URI does not point to us"),void(a.method!==f.ACK&&a.reply_sl(404));if(!k.checkTransaction(this,a)){if(a.hasHeader("require"))for(var m=l.getSupportedExtensions(this),n=a.parseHeader("require"),o=0,p=n.length;p>o;o++){var s=n[o];if(m.indexOf(s)<0&&!e.SESSION_EVENT_EXTENSIONS[s])return void(a.method!==f.ACK&&a.reply_sl(420))}if(j===f.INVITE?new k.InviteServerTransaction(a,this):j!==f.ACK&&new k.NonInviteServerTransaction(a,this),j===f.OPTIONS){var u=["Allow: "+l.getAllowedMethods(this),"Accept: "+e.ACCEPTED_BODY_TYPES,"Supported: "+l.getSupportedExtensions(this).join(",")];return void(this.checkEvent("newOptions")&&0!==this.listeners("newOptions").length?this.emit("newOptions",this,{originator:"remote",request:a,extraHeaders:u}):a.reply(200,null,u))}if(j===f.MESSAGE)return this.checkEvent("newMessage")&&0!==this.listeners("newMessage").length?(d=new i(this),void d.init_incoming(a)):void a.reply(405,null,["Allow: "+l.getAllowedMethods(this)]);if(a.to_tag){if(b=this.findDialog(a))return void b.receiveRequest(a);if(j===f.NOTIFY)return(c=this.findSession(a))?void c.receiveRequest(a):(g=this.refers[a.call_id+a.to_tag])?void g.receiveRequest(a):(console.warn(t+"received NOTIFY request for a non existent session"),void a.reply(481,"Subscription does not exist"));if(j!==f.ACK)return void a.reply(481)}else{if(!this.isRegistered())return void a.reply(410);switch(j){case f.INVITE:!this.configuration.handle_media||q.isSupported?(c=new h(this),c.init_incoming(a)):(console.warn(t+"INVITE received but WebRTC is not supported"),a.reply(488));break;case f.BYE:a.reply(481);break;case f.CANCEL:c=this.findSession(a),c?c.receiveRequest(a):(a.reply(481),console.warn(t+"received CANCEL request for a non existent session"));break;case f.ACK:break;case f.REFER:g=new r(this),g.init_incoming(a);break;default:a.reply(405,null,["Allow: "+l.getAllowedMethods(this)])}}}},d.prototype.findSession=function(a){var b=a.call_id+a.from_tag,c=this.sessions[b],d=a.call_id+a.to_tag,e=this.sessions[d];return c?c:e?e:null},d.prototype.findDialog=function(a){var b=a.call_id+a.from_tag+a.to_tag,c=this.dialogs[b];return c?c:(b=a.call_id+a.to_tag+a.from_tag,c=this.dialogs[b],c?c:null)},d.prototype.getNextWsServer=function(){var a,b=[];return this.configuration.ws_servers.forEach(function(a){a.status!==j.C.STATUS_ERROR&&(0===b.length?b.push(a):a.weight>b[0].weight?b=[a]:a.weight===b[0].weight&&b.push(a))}),a=Math.floor(Math.random()*b.length),b[a]},d.prototype.closeSessionsOnTransportError=function(){for(var a in this.sessions)this.sessions.hasOwnProperty(a)&&this.sessions[a].onTransportError();this.registrator&&this.registrator.onTransportClosed()},d.prototype.recoverTransport=function(a){var b,d,e,f;a=a||this,e=a.transportRecoverAttempts,a.configuration.ws_servers.forEach(function(a){a.status=0}),f=a.getNextWsServer(),b=Math.floor(Math.random()*Math.pow(2,e)+1),d=b*a.configuration.connection_recovery_min_interval,d>a.configuration.connection_recovery_max_interval&&(console.log(t+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),d=a.configuration.connection_recovery_min_interval,e=0),console.log(t+"next connection attempt in "+d+" seconds"),this.transportRecoverTimer=c.setTimeout(function(){a.transportRecoverAttempts=e+1,a.transportRecoverTimer=null,new j(a,f)},1e3*d)},d.prototype.loadConfig=function(a){var b,e,f,g,h,i={via_host:l.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],handle_media:!0,trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(b in d.configuration_check.mandatory)if(d.configuration_check.mandatory.hasOwnProperty(b)){if(!a.hasOwnProperty(b))throw new m.ConfigurationError(b);if(e=a[b],f=d.configuration_check.mandatory[b](e),void 0===f)throw new m.ConfigurationError(b,e);i[b]=f}for(b in d.configuration_check.optional)if(d.configuration_check.optional.hasOwnProperty(b)&&a.hasOwnProperty(b)){if(e=a[b],null===e||""===e||void 0===e)continue;if("number"==typeof e&&c.isNaN(e))continue;if(f=d.configuration_check.optional[b](e),void 0===f)throw new m.ConfigurationError(b,e);i[b]=f}if(i.connection_recovery_max_interval<i.connection_recovery_min_interval)throw new m.ConfigurationError("connection_recovery_max_interval",i.connection_recovery_max_interval);0===i.display_name&&(i.display_name="0"),i.instance_id||(i.instance_id="uuid:"+l.newUUID()),i.jssip_id=l.createRandomToken(5),g=i.uri.clone(),g.user=null,i.hostport_params=g.toString().replace(/^sip:/i,""),i.authorization_user||(i.authorization_user=i.uri.user),i.registrar_server||(h=i.uri.clone(),h.user=null,i.registrar_server=h),i.no_answer_timeout=1e3*i.no_answer_timeout,i.hack_ip_in_contact&&(i.via_host=l.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new n("sip",l.createRandomToken(8),i.via_host,null,{transport:"ws"}),toString:function(a){a=a||{};var b=a.anonymous||null,c=a.outbound||null,d="<";return d+=b?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),c&&(d+=";ob"),d+=">"}},console.log(t+"configuration parameters after validation:");for(b in i)if(i.hasOwnProperty(b)){switch(b){case"uri":case"registrar_server":console.log("Â· "+b+": "+i[b]);break;default:console.log("Â· "+b+": "+c.JSON.stringify(i[b]))}d.configuration_skeleton[b].value=i[b]}Object.defineProperties(this.configuration,d.configuration_skeleton);for(b in i)i.hasOwnProperty(b)&&(d.configuration_skeleton[b].value="")},d.configuration_skeleton=function(){var a={},b=["jssip_id","register_min_expires","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_ip_in_contact","handle_media","instance_id","no_answer_timeout","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","via_core_value","via_host"],c=["ws_servers","authorization_user","password","register"];return b.forEach(function(b){a[b]={value:"",writable:!1,configurable:!1}}),c.forEach(function(b){a[b]={value:"",writable:!0,configurable:!1}}),a}(),d.configuration_check={mandatory:{uri:function(a){var b;return/^sip:/i.test(a)||(a=f.SIP+":"+a),b=n.parse(a),b&&b.user?b:void 0},ws_servers:function(a){if("string"==typeof a)a=[{ws_uri:a}];else{if(!(a instanceof Array))return;a.forEach(function(b,c){"string"==typeof b&&(a[c]={ws_uri:b})})}return 0===a.length?!1:(a.forEach(function(a){var b;return a.ws_uri?a.weight&&!Number(a.weight)?void console.error(t+'"weight" attribute in ws_servers parameter must be a Number'):(b=o.parse(a.ws_uri,"absoluteURI"),-1===b?void console.error(t+'invalid "ws_uri" attribute in ws_servers parameter: '+a.ws_uri):"wss"!==b.scheme&&"ws"!==b.scheme?void console.error(t+"invalid URI scheme in ws_servers parameter: "+b.scheme):(a.sip_uri="<sip:"+b.host+(b.port?":"+b.port:"")+";transport=ws;lr>",a.weight||(a.weight=0),a.status=0,a.scheme=b.scheme.toUpperCase(),void 0)):void console.error(t+'missing "ws_uri" attribute in ws_servers parameter')}),a)}},optional:{authorization_user:function(a){return-1===o.parse('"'+a+'"',"quoted_string")?void 0:a},connection_recovery_max_interval:function(a){var b;return l.isDecimal(a)&&(b=c.Number(a),b>0)?b:void 0},connection_recovery_min_interval:function(a){var b;return l.isDecimal(a)&&(b=c.Number(a),b>0)?b:void 0},display_name:function(a){return-1===o.parse('"'+a+'"',"display_name")?void 0:a},hack_via_tcp:function(a){return"boolean"==typeof a?a:void 0},hack_ip_in_contact:function(a){return"boolean"==typeof a?a:void 0},handle_media:function(a){return"boolean"==typeof a?a:void 0},instance_id:function(a){return/^uuid?:/.test(a)||(a="uuid:"+a),-1===o.parse(a,"uuid_URI")?void 0:a},no_answer_timeout:function(a){var b;return l.isDecimal(a)&&(b=c.Number(a),b>0)?b:void 0},password:function(a){return String(a)},register:function(a){return"boolean"==typeof a?a:void 0},register_expires:function(a){var b;return l.isDecimal(a)&&(b=c.Number(a),b>0)?b:void 0},registrar_server:function(a){var b;return/^sip:/i.test(a)||(a=f.SIP+":"+a),b=n.parse(a),b?b.user?void 0:b:void 0},stun_servers:function(a){if("string"==typeof a)a=[a];else if(!(a instanceof Array))return;return a.forEach(function(b,c){/^stuns?:/.test(b)||(b="stun:"+b),-1!==o.parse(b,"stun_URI")&&(a[c]=b)}),a},trace_sip:function(a){return"boolean"==typeof a?a:void 0},turn_servers:function(a){return a instanceof Array||(a=[a]),a.forEach(function(a){a.server&&a.username&&a.password&&(/^turns?:/.test(a.server)||(a.server="turn:"+a.server),-1!==o.parse(a.server,"turn_URI")&&-1!==o.parse(a.username,"user")&&-1===o.parse(a.password,"password"))}),a},use_preloaded_route:function(a){return"boolean"==typeof a?a:void 0}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./EventEmitter":7,"./Exceptions":8,"./Grammar":9,"./JsSIP":11,"./Message":12,"./RTCSession":16,"./Refer":23,"./Registrator":24,"./Transactions":29,"./Transport":30,"./URI":32,"./Utils":33,"./WebRTC":34}],32:[function(a,b,c){(function(c){function d(a,b,c,d,f,g){var h,i;if(!c)throw new TypeError('missing or invalid "host" parameter');a=a||e.SIP,this.parameters={},this.headers={};for(h in f)f.hasOwnProperty(h)&&this.setParam(h,f[h]);for(i in g)g.hasOwnProperty(i)&&this.setHeader(i,g[i]);Object.defineProperties(this,{scheme:{get:function(){return a},set:function(b){a=b.toLowerCase()}},user:{get:function(){return b},set:function(a){b=a}},host:{get:function(){return c},set:function(a){c=a.toLowerCase()}},port:{get:function(){return d},set:function(a){d=0===a?a:parseInt(a,10)||null}}})}b.exports=d;var e=a("./Constants"),f=a("./Utils"),g=a("./Grammar");d.prototype={setParam:function(a,b){a&&(this.parameters[a.toLowerCase()]="undefined"==typeof b||null===b?null:b.toString().toLowerCase())},getParam:function(a){return a?this.parameters[a.toLowerCase()]:void 0},hasParam:function(a){return a?this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1:void 0},deleteParam:function(a){var b;return a=a.toLowerCase(),this.parameters.hasOwnProperty(a)?(b=this.parameters[a],delete this.parameters[a],b):void 0},clearParams:function(){this.parameters={}},setHeader:function(a,b){this.headers[f.headerize(a)]=b instanceof Array?b:[b]},getHeader:function(a){return a?this.headers[f.headerize(a)]:void 0},hasHeader:function(a){return a?this.headers.hasOwnProperty(f.headerize(a))&&!0||!1:void 0},deleteHeader:function(a){var b;return a=f.headerize(a),this.headers.hasOwnProperty(a)?(b=this.headers[a],delete this.headers[a],b):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new d(this.scheme,this.user,this.host,this.port,c.JSON.parse(c.JSON.stringify(this.parameters)),c.JSON.parse(c.JSON.stringify(this.headers)))},toString:function(){var a,b,c,d,e=[];d=this.scheme+":",this.user&&(d+=f.escapeUser(this.user)+"@"),d+=this.host,(this.port||0===this.port)&&(d+=":"+this.port);for(b in this.parameters)this.parameters.hasOwnProperty(b)&&(d+=";"+b,null!==this.parameters[b]&&(d+="="+this.parameters[b]));for(a in this.headers)if(this.headers.hasOwnProperty(a))for(c in this.headers[a])this.headers[a].hasOwnProperty(c)&&e.push(a+"="+this.headers[a][c]);return e.length>0&&(d+="?"+e.join("&")),d},toAor:function(a){var b;return b=this.scheme+":",this.user&&(b+=f.escapeUser(this.user)+"@"),b+=this.host,a&&(this.port||0===this.port)&&(b+=":"+this.port),b}},d.parse=function(a){return a=g.parse(a,"SIP_URI"),-1!==a?a:void 0}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./Grammar":9,"./Utils":33}],33:[function(a,b,c){(function(c){var d=b.exports={},e=a("./Constants"),f=a("./URI"),g=a("./Grammar"),h=a("./UA"),i=a("./Exceptions");d.str_utf8_length=function(a){return c.unescape(encodeURIComponent(a)).length},d.isFunction=function(a){return void 0!==a&&"[object Function]"===Object.prototype.toString.call(a)?!0:!1;
},d.isDecimal=function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},d.createRandomToken=function(a,b){var c,d,e="";for(b=b||32,c=0;a>c;c++)d=Math.random()*b|0,e+=d.toString(b);return e},d.newTag=function(){return d.createRandomToken(h.C.TAG_LENGTH)},d.newUUID=function(){var a="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)});return a},d.hostType=function(a){return a?(a=g.parse(a,"host"),-1!==a?a.host_type:void 0):void 0},d.normalizeURI=function(a,b){var c,g,h,j,k=a;if(a){if(a instanceof f)return a;if("string"==typeof a){switch(g=a.split("@"),g.length){case 1:if(!b)throw new i.InvalidTargetError(k);h=a,j=b;break;case 2:h=g[0],j=g[1];break;default:h=g.slice(0,g.length-1).join("@"),j=g[g.length-1]}if(h=h.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(h)&&(h=h.replace(/[\-\.\(\)]/g,"")),a=e.SIP+":"+d.escapeUser(h)+"@"+j,c=f.parse(a))return c;throw new i.InvalidTargetError(k)}throw new i.InvalidTargetError(k)}throw new i.InvalidTargetError(k)},d.escapeUser=function(a){return c.encodeURIComponent(c.decodeURIComponent(a)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},d.headerize=function(a){for(var b={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate","Min-Se":"Min-SE"},c=a.toLowerCase().replace(/_/g,"-").split("-"),d="",e=0,f=c.length;f>e;e++)0!==e&&(d+="-"),d+=c[e].charAt(0).toUpperCase()+c[e].substring(1);return b[d]&&(d=b[d]),d},d.sipErrorCause=function(a){var b;for(b in e.SIP_ERROR_CAUSES)if(e.SIP_ERROR_CAUSES.hasOwnProperty(b)&&-1!==e.SIP_ERROR_CAUSES[b].indexOf(a))return e.causes[b];return e.causes.SIP_FAILURE_CODE},d.getRandomTestNetIP=function(){function a(a,b){return c.Math.floor(c.Math.random()*(b-a+1)+a)}return"192.0.2."+a(1,254)},d.getAllowedMethods=function(a){var b,c=h.C.ALLOWED_METHODS.toString();for(b in h.C.EVENT_METHODS)h.C.EVENT_METHODS.hasOwnProperty(b)&&a.checkEvent(b)&&a.listeners(b).length>0&&(c+=","+h.C.EVENT_METHODS[b]);return c},d.getSupportedExtensions=function(a,b){var c,d,e=h.C.SUPPORTED_EXTENSIONS.slice();for(c in h.C.EVENT_EXTENSIONS)h.C.EVENT_EXTENSIONS.hasOwnProperty(c)&&(d=h.C.EVENT_EXTENSIONS[c],a.checkEvent(d)&&a.listeners(d).length>0&&e.push(c));return b?e.concat(b):e},d.getSessionExtensions=function(a){var b,c,d=[];for(b in h.C.SESSION_EVENT_EXTENSIONS)h.C.SESSION_EVENT_EXTENSIONS.hasOwnProperty(b)&&(c=h.C.SESSION_EVENT_EXTENSIONS[b],a.checkEvent(c)&&a.listeners(c).length>0&&d.push(b));return d},d.calculateMD5=function(a){function b(a,b){return a<<b|a>>>32-b}function c(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f}function d(a,b,c){return a&b|~a&c}function e(a,b,c){return a&c|b&~c}function f(a,b,c){return a^b^c}function g(a,b,c){return b^(a|~c)}function h(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)}function i(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)}function j(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)}function k(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)}function l(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g}function m(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d}function n(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b}var o,p,q,r,s,t,u,v,w,x=[],y=7,z=12,A=17,B=22,C=5,D=9,E=14,F=20,G=4,H=11,I=16,J=23,K=6,L=10,M=15,N=21;for(a=n(a),x=l(a),t=1732584193,u=4023233417,v=2562383102,w=271733878,o=0;o<x.length;o+=16)p=t,q=u,r=v,s=w,t=h(t,u,v,w,x[o+0],y,3614090360),w=h(w,t,u,v,x[o+1],z,3905402710),v=h(v,w,t,u,x[o+2],A,606105819),u=h(u,v,w,t,x[o+3],B,3250441966),t=h(t,u,v,w,x[o+4],y,4118548399),w=h(w,t,u,v,x[o+5],z,1200080426),v=h(v,w,t,u,x[o+6],A,2821735955),u=h(u,v,w,t,x[o+7],B,4249261313),t=h(t,u,v,w,x[o+8],y,1770035416),w=h(w,t,u,v,x[o+9],z,2336552879),v=h(v,w,t,u,x[o+10],A,4294925233),u=h(u,v,w,t,x[o+11],B,2304563134),t=h(t,u,v,w,x[o+12],y,1804603682),w=h(w,t,u,v,x[o+13],z,4254626195),v=h(v,w,t,u,x[o+14],A,2792965006),u=h(u,v,w,t,x[o+15],B,1236535329),t=i(t,u,v,w,x[o+1],C,4129170786),w=i(w,t,u,v,x[o+6],D,3225465664),v=i(v,w,t,u,x[o+11],E,643717713),u=i(u,v,w,t,x[o+0],F,3921069994),t=i(t,u,v,w,x[o+5],C,3593408605),w=i(w,t,u,v,x[o+10],D,38016083),v=i(v,w,t,u,x[o+15],E,3634488961),u=i(u,v,w,t,x[o+4],F,3889429448),t=i(t,u,v,w,x[o+9],C,568446438),w=i(w,t,u,v,x[o+14],D,3275163606),v=i(v,w,t,u,x[o+3],E,4107603335),u=i(u,v,w,t,x[o+8],F,1163531501),t=i(t,u,v,w,x[o+13],C,2850285829),w=i(w,t,u,v,x[o+2],D,4243563512),v=i(v,w,t,u,x[o+7],E,1735328473),u=i(u,v,w,t,x[o+12],F,2368359562),t=j(t,u,v,w,x[o+5],G,4294588738),w=j(w,t,u,v,x[o+8],H,2272392833),v=j(v,w,t,u,x[o+11],I,1839030562),u=j(u,v,w,t,x[o+14],J,4259657740),t=j(t,u,v,w,x[o+1],G,2763975236),w=j(w,t,u,v,x[o+4],H,1272893353),v=j(v,w,t,u,x[o+7],I,4139469664),u=j(u,v,w,t,x[o+10],J,3200236656),t=j(t,u,v,w,x[o+13],G,681279174),w=j(w,t,u,v,x[o+0],H,3936430074),v=j(v,w,t,u,x[o+3],I,3572445317),u=j(u,v,w,t,x[o+6],J,76029189),t=j(t,u,v,w,x[o+9],G,3654602809),w=j(w,t,u,v,x[o+12],H,3873151461),v=j(v,w,t,u,x[o+15],I,530742520),u=j(u,v,w,t,x[o+2],J,3299628645),t=k(t,u,v,w,x[o+0],K,4096336452),w=k(w,t,u,v,x[o+7],L,1126891415),v=k(v,w,t,u,x[o+14],M,2878612391),u=k(u,v,w,t,x[o+5],N,4237533241),t=k(t,u,v,w,x[o+12],K,1700485571),w=k(w,t,u,v,x[o+3],L,2399980690),v=k(v,w,t,u,x[o+10],M,4293915773),u=k(u,v,w,t,x[o+1],N,2240044497),t=k(t,u,v,w,x[o+8],K,1873313359),w=k(w,t,u,v,x[o+15],L,4264355552),v=k(v,w,t,u,x[o+6],M,2734768916),u=k(u,v,w,t,x[o+13],N,1309151649),t=k(t,u,v,w,x[o+4],K,4149444226),w=k(w,t,u,v,x[o+11],L,3174756917),v=k(v,w,t,u,x[o+2],M,718787259),u=k(u,v,w,t,x[o+9],N,3951481745),t=c(t,p),u=c(u,q),v=c(v,r),w=c(w,s);var O=m(t)+m(u)+m(v)+m(w);return O.toLowerCase()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Constants":3,"./Exceptions":8,"./Grammar":9,"./UA":31,"./URI":32}],34:[function(a,b,c){(function(a){var c;b.exports=c={},a.navigator&&(a.navigator.webkitGetUserMedia?c.getUserMedia=a.navigator.webkitGetUserMedia.bind(navigator):a.navigator.mozGetUserMedia?c.getUserMedia=a.navigator.mozGetUserMedia.bind(navigator):a.navigator.getUserMedia&&(c.getUserMedia=a.navigator.getUserMedia.bind(navigator))),a.webkitRTCPeerConnection?c.RTCPeerConnection=a.webkitRTCPeerConnection:a.mozRTCPeerConnection?c.RTCPeerConnection=a.mozRTCPeerConnection:a.RTCPeerConnection&&(c.RTCPeerConnection=a.RTCPeerConnection),a.webkitRTCSessionDescription?c.RTCSessionDescription=a.webkitRTCSessionDescription:a.mozRTCSessionDescription?c.RTCSessionDescription=a.mozRTCSessionDescription:a.RTCSessionDescription&&(c.RTCSessionDescription=a.RTCSessionDescription),c.RTCPeerConnection&&c.RTCPeerConnection.prototype&&(c.RTCPeerConnection.prototype.getLocalStreams||(c.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},c.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),c.getUserMedia&&c.RTCPeerConnection&&c.RTCSessionDescription?c.isSupported=!0:c.isSupported=!1}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(a,b,c){b.exports={name:"jssip",title:"JsSIP",description:"the Javascript SIP library",version:"0.3.0-acision-4",homepage:"http://jssip.net",author:{name:"JosÃ© Luis MillÃ¡n",email:"jmillan@aliax.net"},contributors:[{url:"http://jssip.net/authors/"}],repository:{type:"git",url:"git+https://github.com/versatica/JsSIP.git"},main:"lib/JsSIP.js",keywords:["sip","websocket","webrtc","library"],dependencies:{websocket:"^1.0.17"},devDependencies:{grunt:"~0.4.0","grunt-browserify":"^3.2.1","grunt-contrib-concat":"^0.5.1","grunt-contrib-jshint":"^0.11.2","grunt-contrib-qunit":"^0.7.0","grunt-contrib-uglify":"^0.9.1","grunt-include-replace":"^3.0.0",pegjs:"0.7.0"},engines:{node:">=0.8"},license:"MIT",scripts:{test:"grunt travis --verbose"},gitHead:"c7fc7009f9a60867f746c50b9dab5c1e6fa6d160",readme:"<a href=\"http://jssip.net\"><img src=\"http://jssip.net/images/jssip-banner.png\"/></a>\n\n[![Build Status](https://travis-ci.org/versatica/JsSIP.png?branch=master)](https://travis-ci.org/versatica/JsSIP)\n\n## Overview\n\n* SIP over [WebSocket](http://jssip.net/documentation/misc/sip_websocket/) (use real SIP in your web apps)\n* Audio/video calls ([WebRTC](http://jssip.net/documentation/misc/webrtc)), instant messaging and presence\n* Lightweight! (~140KB)\n* Easy to use and powerful user API\n* Works with OverSIP, Kamailio and Asterisk servers ([more info](http://jssip.net/documentation/misc/interoperability))\n* Written by the authors of [draft-ietf-sipcore-sip-websocket](http://tools.ietf.org/html/draft-ietf-sipcore-sip-websocket) and [OverSIP](http://www.oversip.net)\n\n\n## Getting Started\n\nThe following simple JavaScript code creates a JsSIP User Agent instance and makes a SIP call:\n\n```javascript\n// Create our JsSIP instance and run it:\n\nvar configuration = {\n  'outbound_proxy_set': 'ws://sip-ws.example.com',\n  'uri':                'sip:alice@example.com',\n  'password':           'superpassword'\n};\n\nvar coolPhone = new JsSIP.UA(configuration);\n\ncoolPhone.start();\n\n\n// Make an audio/video call:\n\n// HTML5 <video> elements in which local and remote video will be shown\nvar views = {\n  'selfView': document.getElementById('my-video'),\n  'remoteView': document.getElementById('peer-video')\n};\n\n// Register callbacks to desired call events\nvar eventHandlers = {\n  'progress': function(e){\n    console.log('call is in progress');\n  },\n  'failed': function(e){\n    console.log('call failed with cause: '+ e.data.cause);\n  },\n  'ended': function(e){\n    console.log('call ended with cause: '+ e.data.cause);\n  },\n  'started': function(e){\n    var rtcSession = e.data.session;\n\n    console.log('call started');\n\n    // Attach local stream to selfView\n    if (rtcSession.getLocalStreams().length > 0) {\n      selfView.src = window.URL.createObjectURL(rtcSession.getLocalStreams()[0]);\n    }\n\n    // Attach remote stream to remoteView\n    if (rtcSession.getRemoteStreams().length > 0) {\n      remoteView.src = window.URL.createObjectURL(rtcSession.getRemoteStreams()[0]);\n    }\n  }\n};\n\nvar options = {\n  'eventHandlers': eventHandlers,\n  'userMediaTypes': {'audio': true, 'video': true}\n};\n\n\ncoolPhone.call('sip:bob@example.com', options);\n```\n\nWant to see more? Check the full [Getting Started](http://jssip.net/documentation/0.3.x/getting_started/) section in the project website.\n\n\n## Online Demo\n\nCheck our **Tryit JsSIP** online demo:\n\n* [tryit.jssip.net](http://tryit.jssip.net)\n\n\n## Website and Documentation\n\n* [jssip.net](http://jssip.net/)\n\n\n## Download\n\n* [jssip.net/download](http://jssip.net/download/)\n\n\n## Authors\n\n### JosÃ© Luis MillÃ¡n\n\n* Main author. Core Designer and Developer.\n* <jmillan@aliax.net> (Github [@jmillan](https://github.com/jmillan))\n\n### IÃ±aki Baz Castillo\n\n* Core Designer and Developer.\n* <ibc@aliax.net> (Github [@ibc](https://github.com/ibc))\n\n### SaÃºl Ibarra CorretgÃ©\n\n* Core Designer.\n* <saghul@gmail.com> (Github [@saghul](https://github.com/saghul))\n\n\n## License\n\nJsSIP is released under the [MIT license](http://jssip.net/license).\n",readmeFilename:"README.md",bugs:{url:"https://github.com/versatica/JsSIP/issues"},_id:"jssip@0.3.0-acision-4",_shasum:"fe1f4afd60ef351ce9365913d49cc598ff3b6869",_from:"git+ssh://git@at.acision.com:7999/acs/javascript-jssip.git#crocodile",_resolved:"git+ssh://git@at.acision.com:7999/acs/javascript-jssip.git#c7fc7009f9a60867f746c50b9dab5c1e6fa6d160"}},{}],36:[function(b,c,d){(function(){function b(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=o[a])});16>e;)b[d+e++]=0;return b}function d(a,b){var c=b||0,d=n;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function e(a,b,c){var e=b&&c||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:s,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:u+1,j=h-t+(i-u)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>t)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");t=h,u=i,s=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||r,n=0;6>n;n++)f[e+n]=m[n];return b?b:d(f)}function f(a,b,c){var e=b&&c||0;"string"==typeof a&&(b="binary"==a?new m(16):null,a=null),a=a||{};var f=a.random||(a.rng||g)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var h=0;16>h;h++)b[e+h]=f[h];return b||d(f)}var g,h=this;if("function"==typeof h.require)try{var i=h.require("crypto").randomBytes;g=i&&function(){return i(16)}}catch(j){}if(!g&&h.crypto&&crypto.getRandomValues){var k=new Uint8Array(16);g=function(){return crypto.getRandomValues(k),k}}if(!g){var l=new Array(16);g=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),l[b]=a>>>((3&b)<<3)&255;return l}}for(var m="function"==typeof h.Buffer?h.Buffer:Array,n=[],o={},p=0;256>p;p++)n[p]=(p+256).toString(16).substr(1),o[n[p]]=p;var q=g(),r=[1|q[0],q[1],q[2],q[3],q[4],q[5]],s=16383&(q[6]<<8|q[7]),t=0,u=0,v=f;if(v.v1=e,v.v4=f,v.parse=b,v.unparse=d,v.BufferClass=m,"undefined"!=typeof c&&c.exports)c.exports=v;else if("function"==typeof a&&a.amd)a(function(){return v});else{var w=h.uuid;v.noConflict=function(){return h.uuid=w,v},h.uuid=v}}).call(this)},{}],37:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){}c.prototype.name="ANONYMOUS",c.prototype.clientFirst=!0,c.prototype.response=function(a){return a.trace||""},c.prototype.challenge=function(a){},a=b.exports=c})},{}],38:[function(b,c,d){!function(e,f){"object"==typeof d?f(d,c,b("./lib/mechanism")):"function"==typeof a&&a.amd&&a(["exports","module","./lib/mechanism"],f)}(this,function(a,b,c){a=b.exports=c,a.Mechanism=c})},{"./lib/mechanism":37}],39:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){}c.prototype.name="PLAIN",c.prototype.clientFirst=!0,c.prototype.response=function(a){var b="";return b+=a.authzid||"",b+="\x00",b+=a.username,b+="\x00",b+=a.password},c.prototype.challenge=function(a){return this},a=b.exports=c})},{}],40:[function(a,b,c){arguments[4][38][0].apply(c,arguments)},{"./lib/mechanism":39,dup:38}],41:[function(b,c,d){!function(b,e){"object"==typeof d?e(d,c):"function"==typeof a&&a.amd&&a(["exports","module"],e)}(this,function(a,b){function c(){this._mechs=[]}c.prototype.use=function(a,b){return b||(b=a,a=b.prototype.name),this._mechs.push({name:a,mech:b}),this},c.prototype.create=function(a){for(var b=0,c=this._mechs.length;c>b;b++)for(var d=0,e=a.length;e>d;d++){var f=this._mechs[b];if(f.name==a[d])return new f.mech}return null},a=b.exports=c})},{}],42:[function(b,c,d){!function(e,f){"object"==typeof d?f(d,c,b("./lib/factory")):"function"==typeof a&&a.amd&&a(["exports","module","./lib/factory"],f)}(this,function(a,b,c){a=b.exports=c,a.Factory=c})},{"./lib/factory":41}],43:[function(b,c,d){(function(){"use strict";function b(){}function d(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function e(a){return function(){return this[a].apply(this,arguments)}}var f=b.prototype,g=this,h=g.EventEmitter;f.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},f.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},f.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},f.addListener=function(a,b){var c,e=this.getListenersAsObject(a),f="object"==typeof b;for(c in e)e.hasOwnProperty(c)&&-1===d(e[c],b)&&e[c].push(f?b:{listener:b,once:!1});return this},f.on=e("addListener"),f.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},f.once=e("addOnceListener"),f.defineEvent=function(a){return this.getListeners(a),this},f.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},f.removeListener=function(a,b){var c,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(c=d(f[e],b),-1!==c&&f[e].splice(c,1));return this},f.off=e("removeListener"),f.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},f.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},f.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},f.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},f.removeAllListeners=e("removeEvent"),f.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},f.trigger=e("emitEvent"),f.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},f.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},b.noConflict=function(){return g.EventEmitter=h,b},"function"==typeof a&&a.amd?a(function(){return b}):"object"==typeof c&&c.exports?c.exports=b:g.EventEmitter=b}).call(this)},{}],44:[function(a,b,c){(function(c,d){"use strict";function e(a,b,c){this.apiKey=a,this.callbacks=b,this.config=q.defaults({},c,v),this.refreshTimer=null,this.uuid=null,this.initialised=!1,this.allready=!1,this.authenticate()}b.exports=e;var f=a("./src/auth.js"),g=a("./src/sdk-address"),h=null,i=null,j=null,k=null,l=null,m=null,n="undefined"!=typeof c&&c.argv&&/node/.test(c.argv[0]);try{h=a(n?"./src/messaging-node":"./src/messaging"),i=a("./src/rpc")}catch(o){console.error("Could not load Messaging and/or RPC modules",o)}try{j=a("./src/contacts")}catch(o){console.error("Could not load Contacts module",o)}try{k=a("./src/presence")}catch(o){console.error("Could not load Presence module",o)}try{l=a(n?"./src/webrtc-node":"./src/webrtc")}catch(o){console.error("Could not load WebRTC module",o)}try{m=a("./src/group-chat")}catch(o){console.error("Could not load Group Chat module",o)}var p=a("js-logger"),q="undefined"!=typeof window?window._:"undefined"!=typeof d?d._:null,r=a("node-uuid"),s=p.get("SDK"),t=d.localStorage||{},u="sdk.rtc.sip-instance",v={baseUrl:"sdk.acision.com",persistent:!0,resetOnRenegotiate:!0},w=[];null!==k&&w.push("presence"),null!==j&&w.push("contacts"),null!==h&&w.push("messaging"),null!==i&&w.push("rpc"),null!==l&&w.push("webrtc"),null!==m&&w.push("groupChat"),p.useDefaults(),e.version="1.3.14",e.prototype.version=e.version,e.SDKAddress=g,e.prototype.SDKAddress=g;var x="onConnected",y="onAuthFailure",z="onDisconnected";e.prototype.authenticate=function(){var a=this;this.auth=new f(this.apiKey,this.config),this.auth.once("error",function(b){s.warn("Authentication error"),a.fireEvent(y,b),a.disconnect()}),this.initialised?this.auth.on("success",function(b){s.info("Authentication refresh successful"),q.extend(a.config,b),a.refreshTimer=setTimeout(q.bind(a.authenticate,a),1e3*a.config.ttl),a.refreshConfig()}):this.auth.on("success",function(b){s.info("Authentication successful"),q.extend(a.config,b),a.config.refreshToken&&(a.config.password=""),a.refreshTimer=setTimeout(q.bind(a.authenticate,a),1e3*a.config.ttl),a.setDeviceId(),a.initInterfaces(),a.initialised=!0})},e.prototype.setDeviceId=function(){this.uuid=t[u+":"+this.getAddress()],this.uuid||(this.uuid=t[u],delete t[u]),this.uuid||(this.uuid=r.v1()),t[u+":"+this.getAddress()]=this.uuid},e.prototype.fireEvent=function(a,b){var c=this.callbacks[a];if(q.isFunction(c))try{c(b)}catch(d){s.error("Exception encountered for "+a+"callback:",d)}},e.prototype.initInterfaces=function(){var a=q.bind(this.checkInterfaces,this),b=q.bind(this.disconnect,this);null!==h&&(this.messaging=new h(this),this.messaging.once("ready",a),this.messaging.on("error",b)),null!==h&&null!==i&&(this.rpc=new i(this)),null!==j&&(this.contacts=new j(this),this.contacts.once("ready",a),this.contacts.on("error",b)),null!==k&&(this.presence=new k(this),this.presence.once("ready",a),this.presence.on("error",b)),null!==l&&(this.webrtc=new l(this),this.webrtc.once("ready",a),this.webrtc.on("error",b)),null!==m&&(this.groupChat=new m(this),this.groupChat.once("ready",a),this.groupChat.on("error",b)),this.checkInterfaces()},e.prototype.checkInterfaces=function(){var a=this;a.allReady=q.every(w,function(b){return a[b].isReady()}),a.allReady&&q.defer(q.bind(this.fireEvent,this,x))},e.prototype.refreshConfig=function(){var a=this;q.each(w,function(b){a[b].refreshConfig()})},e.prototype.disconnect=function(){var a=this;this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),q.each(w,function(b){a[b]&&a[b].disconnect()}),a.fireEvent(z)},e.prototype.getAddress=function(){var a=this;return a.config.primaryAddress},e.prototype.getDeviceAddress=function(){var a=this;return a.config.primaryAddress+";gr=urn:uuid:"+this.uuid},e.prototype.userAddressFromAddress=function(a){return a.split(";")[0]},e.prototype.getAppConfig=function(){var a=this;return!a.allReady||q.isUndefined(a.config.appConfig)?null:a.config.appConfig}}).call(this,{version:""},"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./src/auth.js":45,"./src/contacts":47,"./src/group-chat":48,"./src/messaging":49,"./src/messaging-node":void 0,"./src/presence":51,"./src/rpc":52,"./src/sdk-address":53,"./src/webrtc":54,"./src/webrtc-node":void 0,"js-logger":2,"node-uuid":36}],45:[function(a,b,c){(function(c,d){"use strict";function e(a){var b={},c=a.slice(1).split("&");return c.forEach(function(a){a=a.split("="),b[a[0]]=decodeURIComponent(a[1]||"")}),b}function f(a,b){var d=this,e=b.baseUrl+"/auth/v1.3";/^wss?:\/\//.test(e)||(e=e.replace(/^.*:\/\//,""),e="wss://"+e),e=e.concat("?apiKey=",a),b.refreshToken&&(e=e.concat("&refreshToken=",b.refreshToken)),this.config=b,this.mech=null,this.state=r,this.ws=new i(e,["wamp"],{autoReconnect:!1,origin:"https://sdk.acision.com",headers:{"User-Agent":"Node.js "+c.version},onConnect:function(){d.onConnect()},onClose:function(){d.onClose()},onError:function(){d.state=u,d.emitEvent(y)}})}b.exports=f;var g="undefined"!=typeof window?window._:"undefined"!=typeof d?d._:null,h=a("wolfy87-eventemitter"),i=a("../lib/wampy"),j=a("js-logger"),k=a("./auth/sasl-x-acision-oauth"),l=a("saslmechanisms"),m=a("sasl-plain"),n=a("sasl-anonymous"),o="undefined"!=typeof window?window.btoa:"undefined"!=typeof d?d.btoa:null,p=j.get("SDK:Auth"),q="http://sdk.acision.com/auth/v1.3",r="connecting",s="authenticating",t="connected",u="disconnecting",v="disconnected",w="PLAIN",x="X-ACISION-OAUTH",y="error",z="success",A=new l.Factory;A.use(m),A.use(k);var B=new l.Factory;B.use(n),f.prototype=new h,f.prototype.constructor=f,f.prototype.onConnect=function(){if(this.config.refreshToken)return this.getBootstrapConfig();var a=this;this.state=s,this.ws.call(q+"/requestMechanisms",{callRes:function(b){a.onReceivedMechs(b)},callErr:g.bind(this.handleCallError,this)})},f.prototype.onClose=function(){this.state!==u&&(p.warn("Unexpected disconnect"),this.emitEvent(y)),this.state=v},f.prototype.onReceivedMechs=function(a){var b=this;if(this.config.anonymous?this.mech=B.create(a):this.mech=A.create(a),!this.mech)return p.warn("No mutually-supported mechanisms:",a),this.state=u,this.ws.disconnect(),void this.emitEvent(y);var c={mechanism:this.mech.name};if(this.mech.clientFirst){var d=this.createCredentials();c.response=o(this.mech.response(d))}this.ws.call(q+"/requestAuthentication",{callRes:function(a){return"challenge"===a.type?void b.onChallenge(a.challenge):void b.onOutcome(a.type,a.data)},callErr:g.bind(this.handleCallError,this)},c)},f.prototype.onChallenge=function(a){var b=this,c=this.mech;if(c.name===x){if(c.challenge(atob(a)),c.immediateUrl){var f,g=function(a){var c=JSON.stringify({authCode:a.code});b.sendResponse(c)},h=function(){b.state=u,b.ws.disconnect(),b.emitEvent(y,[{interactiveUrl:c.interactiveUrl}])};if("frame"===this.config.authDisplay){var i=document.createElement("iframe");i.style.display="none",i.id="acisionsdk-oauth-frame",i.src=c.immediateUrl,document.getElementsByTagName("body")[0].appendChild(i),f=i.contentWindow,f.close=function(){i.remove()}}else this.config.authDisplay&&"popup"!==this.config.authDisplay||(f=d.open(c.immediateUrl,"OAuthPopup"));var j=Date.now()+5e3,k=d.setInterval(function(){if(f.location.origin===d.location.origin){d.clearInterval(k);var a=e(f.location.search);return f.close(),void(a.code?g(a):(p.warn("OAuth error:",a),h()))}Date.now()>j&&(d.clearInterval(k),p.warn("OAuth timeout"),h())},500);return}return p.info("Interactive auth required:",c.interactiveUrl),this.state=u,this.ws.disconnect(),void this.emitEvent(y,[{interactiveUrl:c.interactiveUrl}])}p.warn("Unexpected challenge:",a),this.state=u,this.ws.disconnect(),this.emitEvent(y)},f.prototype.sendResponse=function(a){var b=this,c={response:o(a)};this.ws.call(q+"/sendResponse",{callRes:function(a){return"challenge"===a.type?void b.onChallenge(a.challenge):void b.onOutcome(a.type,a.data)},callErr:g.bind(this.handleCallError,this)},c)},f.prototype.onOutcome=function(a,b){return"success"===a?(this.state=t,void this.getBootstrapConfig()):(p.warn("Unsuccessful outcome:",a,b),this.state=u,this.ws.disconnect(),void this.emitEvent(y))},f.prototype.createCredentials=function(){var a=this.config,b={};return this.mech.name===w?(b.username=a.username,b.password=a.password):this.mech.name===x&&(b.username=a.username,a.authAccessToken?b.authAccessToken=a.password:a.password&&(b.authCode=a.password)),b},f.prototype.getBootstrapConfig=function(){var a=this;this.ws.call(q+"/getBootstrapConfig",{callRes:function(b){a.state=u,a.ws.disconnect(),a.emitEvent(z,[b])},callErr:g.bind(this.handleCallError,this)})},f.prototype.handleCallError=function(a,b,c){p.warn("Auth call error:",a,b,c),this.state=u,this.ws.disconnect(),this.emitEvent(y)}}).call(this,{version:""},"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/wampy":1,"./auth/sasl-x-acision-oauth":46,"js-logger":2,"sasl-anonymous":38,"sasl-plain":40,saslmechanisms:42,"wolfy87-eventemitter":43}],46:[function(a,b,c){function d(){}b.exports=d,d.prototype.name="X-ACISION-OAUTH",d.prototype.clientFirst=!0,d.prototype.response=function(a){return JSON.stringify(a)},d.prototype.challenge=function(a){return a=JSON.parse(a),this.interactiveUrl=a.interactiveUrl,this.immediateUrl=a.immediateUrl,this}},{}],47:[function(a,b,c){(function(c){"use strict";function d(a){var b=a.config.interfaces.contacts,c=null;b&&(c=b.restEndpoints[i]),this.init(a,!!b,null,c)}b.exports=d;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("js-logger"),g=a("./network-api"),h=f.get("SDK:Contacts"),i="1.3";d.prototype=new g(null),d.prototype.constructor=d,d.PRESENCE_ALLOW_GROUP_ID="_allow",d.PRESENCE_BLOCK_GROUP_ID="_block",d.PRESENCE_PENDING_GROUP_ID="_pending",d.GroupType={PRIVATE:"private",SHARED:"shared",SPECIAL:"special"},d.SharedGroupContactStatus={INVITED:"invited",PENDING:"pending",ACCEPTED:"accepted"},d.SharedGroupContactType={FOLLOWER:"follower",MEMBER:"member",OWNER:"owner"},d.prototype.setGroup=function(a,b,c){this.sendRequest("PUT","lists/"+a,b,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.getGroup=function(a,b){this.sendRequest("GET","lists/"+a,null,function(a){b&&e.isFunction(b.onSuccess)&&b.onSuccess(a)},function(a){return"ResourceNotFound"===a.code?void(b&&e.isFunction(b.onSuccess)&&b.onSuccess([])):void(b&&e.isFunction(b.onError)&&b.onError(a.code,a.message))})},d.prototype.deleteGroup=function(a,b){this.sendRequest("DELETE","lists/"+a,null,function(){b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},d.prototype.addToGroup=function(a,b,c){this.sendRequest("POST","lists/"+a+"/add",b,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.removeFromGroup=function(a,b,c){this.sendRequest("POST","lists/"+a+"/remove",b,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.getUserConfig=function(a){this.sendRequest("GET","settings",null,function(b){h.debug("getUserConfig succeeded"),a&&e.isFunction(a.onSuccess)&&a.onSuccess(b)},function(b){h.warn("getUserConfig failed"),a&&e.isFunction(a.onError)&&a.onError(b.code,b.message)})},d.prototype.setUserConfig=function(a,b){this.sendRequest("PUT","settings",a,function(){h.debug("setUserConfig succeeded"),b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){h.warn("setUserConfig failed"),b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},d.prototype.getGroupContacts=function(a,b){this._getGroupContactsImpl(a,b,null)},d.prototype.addContactToGroup=function(a,b,c){if(!e.isString(a)||!e.isString(b))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/addcontacts",f=[{address:b}];this.sendRequest("POST",d,f,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.removeContactFromGroup=function(a,b,c){if(!e.isString(a)||!e.isString(b))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/removecontacts",f=[b];this.sendRequest("POST",d,f,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.getMyGroups=function(a){this._getMyGroupsImpl(a,null)},d.prototype.getContactDetails=function(a,b,c){if(2===arguments.length&&(c=b,b=this.sdk.config.primaryAddress),!(e.isString(a)&&e.isString(b)&&c&&e.isFunction(c.onSuccess)))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/contact/"+encodeURIComponent(b);this.sendRequest("GET",d,null,function(a){c.onSuccess(!0,a.type,a.contact)},function(a){"ResourceNotFound"===a.code?c.onSuccess(!1,null,null):e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.createGroup=function(a,b,c){if(!(e.isString(a)&&e.isString(b)&&c&&e.isFunction(c.onSuccess)))throw new Error("Invalid parameters");if("private"!==b&&"shared"!==b)throw new Error("Invalid parameters");
var d="groups",f={label:a,type:b};this.sendRequest("POST",d,f,function(a){c.onSuccess(a.group_id)},function(a){e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.getGroupDetails=function(a,b){if(!e.isString(a)||!b||!e.isFunction(b.onSuccess))throw new Error("Invalid parameters");var c="groups/"+encodeURIComponent(a)+"/details";this.sendRequest("GET",c,null,function(a){b.onSuccess({id:a.group_id,name:a.label,type:a.type})},function(a){e.isFunction(b.onError)&&b.onError(a.code,a.message)})},d.prototype.setGroupName=function(a,b,c){if(!e.isString(a)||!e.isString(b))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a),f={label:b};this.sendRequest("POST",d,f,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.getSharedGroupPendingContacts=function(a,b){this._getGroupContactsImpl(a,b,"pending=true")},d.prototype.approveSharedGroupContact=function(a,b,c){if(!e.isString(a)||!e.isString(b))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/updatecontact",f={address:b,status:"accepted"};this.sendRequest("POST",d,f,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.rejectSharedGroupContact=function(a,b,c){this.removeContactFromGroup(a,b,c)},d.prototype.changeSharedGroupContact=function(a,b,c,d){if(!e.isString(a)||!e.isString(b)||!e.isString(c))throw new Error("Invalid parameters");var f="groups/"+encodeURIComponent(a)+"/updatecontact",g={address:b,type:c};this.sendRequest("POST",f,g,function(){d&&e.isFunction(d.onSuccess)&&d.onSuccess()},function(a){d&&e.isFunction(d.onError)&&d.onError(a.code,a.message)})},d.prototype.getMyPendingSharedGroups=function(a){this._getMyGroupsImpl(a,"pending=true")},d.prototype.joinSharedGroup=function(a,b,c){if(!e.isString(a)||!e.isString(b))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/join",f={type:b};this.sendRequest("POST",d,f,function(){c&&e.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&e.isFunction(c.onError)&&c.onError(a.code,a.message)})},d.prototype.leaveSharedGroup=function(a,b){if(!e.isString(a))throw new Error("Invalid parameters");var c="groups/"+encodeURIComponent(a)+"/leave";this.sendRequest("POST",c,null,function(){b&&e.isFunction(b.onSuccess)&&b.onSuccess()},function(a){b&&e.isFunction(b.onError)&&b.onError(a.code,a.message)})},d.prototype._getGroupContactsImpl=function(a,b,c){if(!e.isString(a)||!b||!e.isFunction(b.onSuccess))throw new Error("Invalid parameters");var d="groups/"+encodeURIComponent(a)+"/contacts";c&&(d+="?"+c),this.sendRequest("GET",d,null,function(a){b.onSuccess(a.type,a.contacts)},function(a){e.isFunction(b.onError)&&b.onError(a.code,a.message)})},d.prototype._getMyGroupsImpl=function(a,b){if(!a||!e.isFunction(a.onSuccess))throw new Error("Invalid parameters");var c="groups";b&&(c+="?"+b),this.sendRequest("GET",c,null,function(b){a.onSuccess(e.map(b,function(a){return{id:a.group_id,name:a.label,type:a.type}}))},function(b){e.isFunction(a.onError)&&a.onError(b.code,b.message)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":50,"js-logger":2}],48:[function(a,b,c){(function(c){"use strict";function d(a,b){return f.isArray(a)||(a=[a]),f.map(a,function(a){return a.indexOf("@")<0?a.concat("@",b):a})}function e(a){var b=a.config.interfaces.chat,c=null;b&&(c=b.restEndpoints[j]),this.init(a,!!b,null,c),this.groupChatCallbacks={},this.recordingRefreshTasks={}}b.exports=e;var f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,g=a("js-logger"),h=a("./network-api"),i=g.get("SDK:GroupChat"),j="1.3",k="addedToChatRoom",l="chatRoomUpdated";e.prototype=new h(null),e.prototype.constructor=e,e.prototype.disconnect=function(){this._cancelAllRecordingRefreshTasks(),h.prototype.disconnect.call(this)},e.RoomType={AD_HOC:"ad-hoc",SHARED_GROUP:"shared-group"},e.ArchivedRoomEventType={UPDATE:"update",MESSAGE:"message",FILE:"file"},e.prototype.createAdHocChatRoom=function(a,b,c){if(!b||!c)throw new Error("members and callbacks may not be null.");if(f.isEmpty(b))throw new Error("members may not be empty.");this._createChatRoomInternal(b,null,a,c)},e.prototype.createChatRoomForSharedGroup=function(a,b,c){if(!a||!c)throw new Error("groupId and callbacks may not be null.");this._createChatRoomInternal(null,a,b,c)},e.prototype._createChatRoomInternal=function(a,b,c,e){var g=this.sdk.config,h={};b?h.groupId=b:a&&(a=d(a,g.defaultDomain),h.members=a),c&&(h.subject=c),this.sendRequest("POST","rooms/create",h,function(a){i.debug("Create chat room success "+a.roomId),f.isFunction(e.onSuccess)&&e.onSuccess(a.roomId)},function(a){i.warn("Create chat room failed"),f.isFunction(e.onError)&&e.onError(a.code,a.message)})},e.prototype.updateAdHocChatRoom=function(a,b,c,d){if(!a)throw new Error("roomId may not be null.");if(f.isEmpty(a))throw new Error("roomId may not be empty.");if(f.isNull(b)){if(f.isNull(c))throw new Error("subject and additionalMembers may not both be null.");if(f.isEmpty(c))throw new Error("additionalMembers may not be empty.")}this._updateChatRoomInternal(a,b,c,d)},e.prototype.updateSharedGroupChatRoom=function(a,b,c){if(!a)throw new Error("roomId may not be null.");if(f.isEmpty(a))throw new Error("roomId may not be empty.");if(f.isNull(b))throw new Error("subject may not be null.");this._updateChatRoomInternal(a,b,null,c)},e.prototype._updateChatRoomInternal=function(a,b,c,e){var g=this.sdk.config,h={};b&&(h.subject=b),c&&(c=d(c,g.defaultDomain),h.additionalMembers=c),this.sendRequest("POST","rooms/"+a+"/update",h,function(){i.debug("Update chat room success"),e&&f.isFunction(e.onSuccess)&&e.onSuccess()},function(a){i.warn("Update chat room failed"),e&&f.isFunction(e.onError)&&e.onError(a.code,a.message)})},e.prototype.leaveAdHocChatRoom=function(a,b){if(!a)throw new Error("roomId may not be null.");if(f.isEmpty(a))throw new Error("roomId may not be empty.");this.sendRequest("POST","rooms/"+a+"/removeSelf",null,function(){i.debug("Leave chat room success"),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.warn("Leave chat room failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.getChatRoomDetails=function(a,b){if(!a||!b)throw new Error("roomId and callbacks may not be null.");if(f.isEmpty(a))throw new Error("roomId may not be empty.");this.sendRequest("GET","rooms/"+a,null,function(c){i.debug("Get chat room details success");var d,e=c.subject,g=null,h=null;c.groupId?(g=c.groupId,d="shared-group"):c.members&&(h=c.members,d="ad-hoc"),b&&f.isFunction(b.onSuccess)&&b.onSuccess(a,e,d,h,g)},function(a){i.warn("Get chat room details failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.sendToChatRoom=function(a,b,c,d){var e=this;e.sdk.messaging?e.sdk.messaging._sendToChatRoom(a,null,b,c,function(a){d&&f.isFunction(d.onAcknowledged)&&d.onAcknowledged(a)},function(a,b){d&&f.isFunction(d.onError)&&d.onError(a,b)}):i.warn("Attempt to send group chat message with no messaging interface")},e.prototype.sendPrivatelyToChatRoomMember=function(a,b,c,d,e){var g=this;g.sdk.messaging?g.sdk.messaging._sendToChatRoom(a,b,c,d,function(a){e&&f.isFunction(e.onAcknowledged)&&e.onAcknowledged(a)},function(a,b){e&&f.isFunction(e.onError)&&e.onError(a,b)}):i.warn("Attempt to send group chat message with no messaging interface")},e.prototype.replyToChatRoom=function(a,b,c,d){this.sendToChatRoom(a.roomId,b,c,d)},e.prototype.replyPrivatelyToSender=function(a,b,c,d){this.sendPrivatelyToChatRoomMember(a.roomId,a.from,b,c,d)},e.prototype.sendFileToChatRoom=function(a,b,c){var d=this;return d.sdk.messaging?d.sdk.messaging._sendFile({toChatRoomId:a},b,c):(i.warn("Attempt to send group chat message with no messaging interface"),null)},e.prototype.getArchivedAdHocRooms=function(a,b,c){if(!c||!f.isFunction(c.onResult))throw new Error("Invalid parameters");if(f.isNumber(a))a=new Date(1e3*a);else if(a){if(!f.isDate(a))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else a=new Date;var d="archiveRooms";d+="?start="+a.getTime(),d+="&direction="+(b?"before":"after"),this._getArchivedRoomsImpl(d,null,c)},e.prototype.getArchivedSharedGroupRooms=function(a,b,c,d){if(!d||!f.isFunction(d.onResult)||!a)throw new Error("Invalid parameters");if(f.isNumber(b))b=new Date(1e3*b);else if(b){if(!f.isDate(b))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else b=new Date;var e="archiveRooms";e+="?start="+b.getTime(),e+="&direction="+(c?"before":"after"),e+="&groupId="+a,this._getArchivedRoomsImpl(e,null,d)},e.prototype._getArchivedRoomsImpl=function(a,b,c){var d=this,e=a;b&&(e+="&token="+b),this.sendRequest("GET",e,null,function(b){var e=f.map(b.rooms,function(a){var b={roomId:a.roomId,creationTime:new Date(a.created),creator:a.creator,initialSubject:a.initialSubject};return a.groupId?(b.groupId=a.groupId,b.roomType="shared-group"):a.initialMembers&&(b.initialMembers=a.initialMembers,b.roomType="ad-hoc"),b});c.onResult(e,!b.token),b.token&&d._getArchivedRoomsImpl(a,b.token,c)},function(a){f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getArchivedRoomEvents=function(a,b,c,d){if(!f.isString(a)||""===a||!d||!f.isFunction(d.onResult))throw new Error("Invalid parameters");if(f.isNumber(b))b=new Date(1e3*b);else if(b){if(!f.isDate(b))throw new Error("Start date if provided must be an instance of Date or seconds since 1 Jan 1970")}else b=new Date;this._getArchivedRoomEventsImpl(a,b.getTime(),c,null,d)},e.prototype._getArchivedRoomEventsImpl=function(a,b,c,d,e){var g=this,h="archiveRooms/"+a+"/history";h+="?start="+b,h+="&direction="+(c?"before":"after"),d&&(h+="&token="+d),this.sendRequest("GET",h,null,function(d){var h=f.chain(d.events).map(function(b){var c={eventTime:new Date(b.timestamp)};if(b.update)c.type="update",c.user=b.update.user,b.update.subject&&(c.subject=b.update.subject),b.update.added&&(c.addedMembers=b.update.added),b.update.removed&&(c.removedMembers=b.update.removed);else if(b.message)c.type="message",c.from=b.message.from,c.privateMessage=!!b.message.to,c.to=b.message.to,b.message.contentType&&(c.contentType=b.message.contentType),c.content=b.message.content;else{if(!b.file)return!1;c.type="file",c.from=b.file.from,c.ftId=b.file.ftEventId,c.contentType=b.file.contentType,b.file.contentDisposition&&(c.contentDisposition=b.file.contentDisposition),c.fileName=b.file.fileName,b.file.fileSize&&(c.fileSize=b.file.fileSize),c.message=b.file.message,c.getFile=function(c){g.retrieveArchivedFile(a,b.file.ftEventId,c)}}return c}).compact().value();e.onResult(h,!d.token),d.token&&g._getArchivedRoomEventsImpl(a,b,c,d.token,e)},function(a){f.isFunction(e.onError)&&e.onError(a.code,a.message)})},e.prototype.retrieveArchivedFile=function(a,b,c){var d=this,e="archiveRooms/"+a+"/file/"+b;this.sendRequest("GET",e,null,function(a){var b=f.extend({},a.content);return b.from=a.from,b.callbacks=c,d.sdk.messaging?(d.sdk.messaging.pendingFileTransfers[b.serverId]=b,void d.sdk.messaging._getFile(a.content)):(i.warn("Attempt to retrieve archived chat file with no messaging interface"),null)},function(a){f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.setCallbacks=function(a){if(!a)throw new Error("callbacks may not be null.");this.groupChatCallbacks=a},e.prototype.startRecordingChatRoom=function(a,b){this._recordChatRoomInternal(!0,a,b)},e.prototype.stopRecordingChatRoom=function(a,b){this._recordChatRoomInternal(!1,a,b)},e.prototype._recordChatRoomInternal=function(a,b,c){var d=this;if(!b)throw new Error("Must specify the room ID.");var e;a?e="rooms/"+b+"/startRecording":(e="rooms/"+b+"/stopRecording",d._cancelRecordingRefreshTask(b)),this.sendRequest("POST",e,null,function(e){i.debug("start / stop recording succeeded"),c&&f.isFunction(c.onSuccess)&&c.onSuccess(),a&&(f.isUndefined(e.refreshDelay)||d._setRecordingRefreshTask(b,e.refreshDelay))},function(a){i.warn("start / stop recording failed"),c&&f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype._setRecordingRefreshTask=function(a,b){var c=this,d=a,e=this.recordingRefreshTasks[d];e||(this.recordingRefreshTasks[d]=setInterval(function(a){c.startRecordingChatRoom(a,null)},1e3*b,a))},e.prototype._cancelRecordingRefreshTask=function(a){var b=a,c=this.recordingRefreshTasks[b];c&&(clearInterval(c),delete this.recordingRefreshTasks[b])},e.prototype._cancelAllRecordingRefreshTasks=function(){var a=this;i.debug("Cancelling all");var b=f.keys(a.recordingRefreshTasks);f.each(b,function(b){i.debug("Cancelling key "+b),clearInterval(a.recordingRefreshTasks[b]),delete a.recordingRefreshTasks[b]})},e.prototype._handleChatRoomEvent=function(a){var b=this;if(!b.groupChatCallbacks)return void i.warn("Received chat room event, but no callbacks set");if(k===a.event||l===a.event){var c,d=a.roomId,e=a.subject,g=null,h=null;a.groupId?(g=a.groupId,c="shared-group"):a.members&&(h=a.members,c="ad-hoc"),k===a.event?(i.debug("Added to chat room "+d+" (subject "+e+")"),f.isFunction(b.groupChatCallbacks.onAddedToChatRoom)&&b.groupChatCallbacks.onAddedToChatRoom(d,e,c,h,g)):l===a.event?(i.debug("Chat room updated "+d+" (subject "+e+")"),f.isFunction(b.groupChatCallbacks.onChatRoomUpdated)&&b.groupChatCallbacks.onChatRoomUpdated(d,e,c,h,g)):i.warn("Received unknown chat room event - "+a.event)}},e.prototype._handleChatRoomMessage=function(a){var b=this;if(!b.groupChatCallbacks)return void i.warn("Received chat room message, but no callbacks set");var c=f.pick(a,["content","contentType","from","fromDevice"]);a.toChatRoomId?(c.roomId=a.toChatRoomId,c.privateMessage=!1):(c.roomId=a.chatRoomId,c.privateMessage=!0),f.isFunction(b.groupChatCallbacks.onMessage)&&b.groupChatCallbacks.onMessage(c.roomId,c)},e.prototype._handleFileAvailable=function(a){var b=this;f.isFunction(b.groupChatCallbacks.onFileAvailable)&&b.groupChatCallbacks.onFileAvailable(a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":50,"js-logger":2}],49:[function(a,b,c){(function(c){"use strict";function d(a,b){return h.isArray(a)||(a=[a]),h.map(a,function(a){return a.indexOf("@")<0?a.concat("@",b):a})}function e(a){var b=a.config.interfaces.messaging,c=null,d=null;b&&(c=b.wsEndpoints[p],d=b.restEndpoints[p]),this.init(a,!!b,c,d),this.deliveryModes=B,this.pendingFileTransfers={},this.pendingFileUploadIDs={},this.pendingFileUploadAborts={},this.recordingRefreshTasks={}}function f(a){var b=[];if(a&&"deliveryModes"in a)for(var c=a.deliveryModes.length,d=0;c>d;d++)A.indexOf(a.deliveryModes[d])>-1?b.push(a.deliveryModes[d]):m.warn("Found invalid delivery mode "+a.deliveryModes[d]);else a&&"advancedServices"in a&&(m.warn('"advancedServices" option is deprecated use "deliveryModes"'),a.advancedServices===t?b=[y]:a.advancedServices===u?b=[v,w,y]:a.advancedServices===s&&(b=[v,w,x]));return b}function g(a,b,c,d,e){var f={};f.token=b,f.appARN=c,f.notificationMessage=d,a.sendRequest("POST","requestMessageNotification",f,function(){m.debug("requestMessageNotification succeeded"),e&&h.isFunction(e.onAcknowledged)&&e.onAcknowledged()},function(a){m.warn("requestMessageNotification failed"),e&&h.isFunction(e.onError)&&e.onError(a.code,a.message)})}b.exports=e;var h="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,i=a("js-logger"),j=a("./network-api"),k=a("node-uuid"),l="undefined"!=typeof window?window.XMLHttpRequest:"undefined"!=typeof c?c.XMLHttpRequest:null,m=i.get("SDK:Msg"),n=i.get("SDK:Msg:FileXfer"),o="http://sdk.acision.com/messaging/v1.3/",p="1.3",q="application/x-acision-sdk-file-transfer",r="application/x-acision-sdk-chat-room-event",s="never",t="always",u="fallback",v="immediate",w="push",x="offline",y="fallback",z="pushOnly",A=[v,w,x,y,z],B=[v,w,x];e.RPC_RESPONSE_CONTENT_TYPE="application/x-acision-sdk-rpc-response",e.RPC_REQUEST_CONTENT_TYPE="application/x-acision-sdk-rpc-request",e.prototype=new j(o),e.prototype.constructor=e,e.ArchivedMessageStatus={PENDING:"pending",DELIVERED:"delivered"},e.prototype.disconnect=function(){this._cancelAllRecordingRefreshTasks(),j.prototype.disconnect.call(this)},e.prototype._sendMessage=function(a,b,c,d){var e=this.sdk.config,g=h.extend({},a,{from:c&&c.from||e.primaryAddress,fromDevice:this.sdk.getDeviceAddress(),content:b});c&&c.contentType&&(g.contentType=c.contentType),c&&c.subject&&(g.subject=c.subject);var i=f(c);0===i.length&&(i=this.deliveryModes),g.delivery_modes=i,c&&c.ttl&&(g.ttl=c.ttl),c&&c.data&&(g.data=c.data),this.sendRequest("POST","sendMessage",g,function(a){if(m.debug("sendMessage succeeded"),d&&h.isFunction(d.onAcknowledged)){var b;a&&a.msgid?b=a.msgid:(m.debug("v1.0 compatibility: generating local message ID"),b=k.v1()),d.onAcknowledged(b)}},function(a){m.warn("sendMessage failed"),d&&h.isFunction(d.onError)&&d.onError(a.code,a.message)})},e.prototype.sendToDestination=function(a,b,c,e){var f=this.sdk.config;a=d(a,f.defaultDomain),this._sendMessage({to:a},b,c,e)},e.prototype.sendToDestinations=e.prototype.sendToDestination,e.prototype.sendToGroup=function(a,b,c,d){h.isArray(a)||(a=[a]),this._sendMessage({toGroup:a},b,c,d)},e.prototype.sendToGroupId=function(a,b,c,d){h.isArray(a)||(a=[a]),this._sendMessage({toGroupId:a},b,c,d)},e.prototype._sendToChatRoom=function(a,b,c,e,f,g){var i=this.sdk.config,j={};b?(b=d(b,i.defaultDomain),j.to=b,j.chatRoomId=a):j.toChatRoomId=a;var k=h.omit(e,["subject","data"]),l={onAcknowledged:f,onError:g};this._sendMessage(j,c,k,l)},e.prototype.sendFileToDestination=function(a,b,c){var e=this.sdk.config;return a=d(a,e.defaultDomain),this._sendFile({to:a},b,c)},e.prototype.sendFileToDestinations=e.prototype.sendFileToDestination,e.prototype.sendFileToGroup=function(a,b,c){h.isArray(a)||(a=[a]),this._sendFile({toGroup:a},b,c)},e.prototype.sendFileToGroupId=function(a,b,c){h.isArray(a)||(a=[a]),this._sendFile({toGroupId:a},b,c)},e.prototype._sendFile=function(a,b,c){var d=this.sdk.config,e=this,f=h.unique(),g=h.extend({},a,{from:d.primaryAddress,contentType:b.contentType||b.file.type||"application/octet-stream",fileName:b.file.name,message:b.message,fromDevice:e.sdk.getDeviceAddress()});return h.isUndefined(b.file.size)||(g.contentLength=b.file.size),h.isUndefined(b.contentDisposition)||(g.contentDisposition=b.contentDisposition),h.isUndefined(b.subject)||(g.subject=b.subject),n.info("Sending request to upload file\n",b.file),this.sendRequest("POST","allocateFile",g,function(a){return n.info(a.serverId+": Obtained file transfer ID"),e.pendingFileTransfers[a.serverId]={serverId:a.serverId,params:g,file:b.file,callbacks:c,internalId:f,delayAbort:!1},e.pendingFileUploadIDs[f]=a.serverId,e.pendingFileUploadAborts[f]?(delete e.pendingFileUploadAborts[f],void e._sendAbortFile(a.serverId,!0)):void setTimeout(function(){delete e.pendingFileTransfers[a.serverId],delete e.pendingFileUploadIDs[f]},864e5)},function(a){n.warn("Request failed: "+a.code+": "+a.message),c&&h.isFunction(c.onError)&&c.onError(a.code,a.message)}),{abort:function(){h.isUndefined(e.pendingFileUploadIDs[f])?e.pendingFileUploadAborts[f]=!0:e._sendAbortFile(e.pendingFileUploadIDs[f],!0)}}},e.prototype._putFile=function(a){var b=this;if(h.isUndefined(this.pendingFileTransfers[a.content.serverId]))return void n.error(a.content.serverId+": Unknown ID in file upload message");var c=this.pendingFileTransfers[a.content.serverId];return a.content.accept?(c.callbacks&&h.isFunction(c.callbacks.onAccepted)&&c.callbacks.onAccepted(a.from),void(a.content.url&&(n.info(a.content.serverId+": Preparing file upload"),c.xhr=new l,c.xhr.open("PUT",a.content.url),c.xhr.setRequestHeader("Content-Type",c.params.contentType),c.xhr.setRequestHeader("Content-Disposition",c.params.contentDisposition),c.xhr.setRequestHeader("x-awz-meta-filename",c.params.fileName),c.xhr.addEventListener("load",function(){return this.status<200||this.status>=300?void b._fileTransferError(c.serverId,!0,this.response||{code:"RestError",message:"Unknown error: "+this.status}):(n.info(a.content.serverId+": File upload succeeded"),n.info(a.content.serverId+": Notifying server"),void b.sendRequest("POST","sendFile",{serverId:c.serverId},function(){}))}),c.callbacks&&h.isFunction(c.callbacks.onProgress)&&c.xhr.upload.addEventListener("progress",function(a){c.callbacks.onProgress(a.lengthComputable||!h.isUndefined(a.total)?a.total:void 0,a.loaded)}),c.xhr.addEventListener("error",h.bind(b._fileTransferError,b,c.serverId,!0,{code:"NetworkError",message:"A network error was encountered"})),c.xhr.addEventListener("abort",h.bind(b._fileTransferError,b,c.serverId,!0,{code:"AbortError",message:"The request was aborted"})),c.xhr.addEventListener("timeout",h.bind(b._fileTransferError,b,c.serverId,!0,{code:"TimeoutError",message:"The request timed out"})),n.info(a.content.serverId+": Uploading file"),c.xhr.send(c.file)))):void(c.callbacks&&h.isFunction(c.callbacks.onRejected)?c.callbacks.onRejected(a.from):b._fileTransferError(c.serverId,!0,{code:"Rejected",message:"Rejected by recipient"},!0))},e.prototype._getFile=function(a){var b=this;if(h.isUndefined(this.pendingFileTransfers[a.serverId]))return void n.error(a.serverId+": Unknown ID in file download message");var c=this.pendingFileTransfers[a.serverId],d=h.omit(c.params,["contentType","contentDisposition","fileName","message","contentLength"]);h.extend(d,h.pick(a,["contentType","contentDisposition","fileName","message"])),d.fileSize=a.contentLength,n.info(a.serverId+": Preparing file download"),c.xhr=new l,c.xhr.open("GET",a.url),c.xhr.responseType="blob",c.xhr.addEventListener("load",function(){return this.status<200||this.status>=300?void b._fileTransferError(c.serverId,!1,this.response||{code:"RestError",message:"Unknown error: "+this.status}):(n.info(a.serverId+": File download succeeded"),n.info(a.serverId+": Notifying server"),b.sendRequest("POST","receivedFile",{serverId:c.serverId},function(){}),delete b.pendingFileTransfers[a.serverId],delete b.pendingFileUploadIDs[c.internalId],void c.callbacks.onDownloaded(d,c.xhr.response))}),c.callbacks&&h.isFunction(c.callbacks.onProgress)&&c.xhr.addEventListener("progress",function(a){c.callbacks.onProgress(a.lengthComputable||!h.isUndefined(a.total)?a.total:void 0,a.loaded)}),c.xhr.addEventListener("error",h.bind(b._fileTransferError,b,c.serverId,!1,{code:"NetworkError",message:"A network error was encountered"})),c.xhr.addEventListener("abort",h.bind(b._fileTransferError,b,c.serverId,!1,{code:"AbortError",message:"The request was aborted"})),c.xhr.addEventListener("timeout",h.bind(b._fileTransferError,b,c.serverId,!1,{code:"TimeoutError",message:"The request timed out"})),n.info(a.serverId+": Downloading file"),c.xhr.send(c.file)},e.prototype._fileTransferError=function(a,b,c,d){if(n.warn(a+": File transfer failed: "+c.code+": "+c.message),!h.isUndefined(this.pendingFileTransfers[a])){var e=this.pendingFileTransfers[a];d||this._sendAbortFile(a,b),e.callbacks&&h.isFunction(e.callbacks.onError)&&e.callbacks.onError(c.code,"File transfer failed: "+c.message)}},e.prototype._incomingFile=function(a,b){var c=this,d=h.pick(a,["from","to","toChatRoomId","chatRoomId","toGroup","subject"]);h.extend(d,h.pick(a.content,["contentType","contentLength","contentDisposition","fileName","message"])),d.recipients=[c.sdk.config.primaryAddress];var e={params:d,serverId:a.content.serverId,delayAbort:!0};this.pendingFileTransfers[e.serverId]=e;var f=h.omit(d,"contentLength");h.isUndefined(d.contentLength)||(f.fileSize=d.contentLength),f.accept=h.bind(c._sendAcceptFile,c,a.content.serverId),f.reject=h.bind(c._sendRejectFile,c,a.content.serverId),f.abort=h.bind(c._sendAbortFile,c,a.content.serverId,!1),d.toChatRoomId||d.chatRoomId?(h.isUndefined(d.toChatRoomId)?h.isUndefined(d.chatRoomId)||(f.roomId=d.chatRoomId):f.roomId=d.toChatRoomId,c.sdk.groupChat._handleFileAvailable(f)):h.isFunction(b)?b(f):this._sendRejectFile(e.serverId)},e.prototype._downloadedFile=function(a){if(h.isUndefined(this.pendingFileTransfers[a.content.serverId]))return void n.error(a.content.serverId+": Unknown ID in file upload message");var b=this.pendingFileTransfers[a.content.serverId];b.callbacks&&h.isFunction(b.callbacks.onDownloaded)?b.callbacks.onDownloaded(a.from):b.callbacks&&h.isFunction(b.callbacks.onAcknowledged)&&b.callbacks.onAcknowledged()},e.prototype._abortedFile=function(a,b){if(h.isUndefined(this.pendingFileTransfers[a.serverId]))return void n.error(a.serverId+": Unknown ID in file transfer message");n.info(a.serverId+": Aborting file transfer");var c=this.pendingFileTransfers[a.serverId];if(c.delayAbort)return n.info(a.serverId+": Delaying abort until accept/reject"),void(c.pendingAbort=!0);a.senderInitiated&&(delete this.pendingFileTransfers[a.serverId],delete this.pendingFileUploadIDs[c.internalId],c.xhr?c.xhr.abort():c.httpReq&&c.httpReq.abort());var d={serverId:c.serverId,senderInitiated:a.senderInitiated,fromDevice:this.sdk.getDeviceAddress()};this.sendRequest("POST","abortAckFile",d,function(){n.info(c.serverId+": Ack'd abort")},function(a){n.info(c.serverId+": Ack failed: "+a.code+": "+a.message)}),c.callbacks&&(a.senderInitiated?h.isFunction(c.callbacks.onError)&&c.callbacks.onError("Aborted","File transfer failed: Aborted by user"):h.isFunction(c.callbacks.onRejected)?c.callbacks.onRejected(b):h.isFunction(c.callbacks.onError)&&c.callbacks.onError("Aborted","File transfer failed: Aborted by user"))},e.prototype._sendAcceptFile=function(a,b,c){if(2===arguments.length&&(c=arguments[1]),h.isUndefined(this.pendingFileTransfers[a]))return void n.error(a+": Accepting unknown ID");var d=this.pendingFileTransfers[a];if(d.callbacks=c,d.delayAbort=!1,d.pendingAbort)return n.info(a+": Acting on delayed abort"),void this._abortedFile({serverId:d.serverId,senderInitiated:!0},d.params.from);var e={serverId:d.serverId,accept:!0,fromDevice:this.sdk.getDeviceAddress()};n.info(d.serverId+": Accepting file"),this.sendRequest("POST","acceptFile",e,function(){n.info(d.serverId+": Accepted file")},function(a){n.info(d.serverId+": Acceptance failed: "+a.code+": "+a.message),c&&h.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype._sendRejectFile=function(a){if(h.isUndefined(this.pendingFileTransfers[a]))return void n.error(a+": Rejecting unknown ID");var b=this.pendingFileTransfers[a];if(b.delayAbort=!1,b.pendingAbort)return n.info(a+": Acting on delayed abort"),void this._abortedFile({serverId:b.serverId,senderInitiated:!0},b.params.from);delete this.pendingFileTransfers[a],delete this.pendingFileUploadIDs[b.internalId];var c={serverId:b.serverId,accept:!1};n.info(b.serverId+": Rejecting file"),this.sendRequest("POST","acceptFile",c,function(){n.info(b.serverId+": Rejected file")},function(a){n.info(b.serverId+": Rejection failed: "+a.code+": "+a.message)})},e.prototype._sendAbortFile=function(a,b){if(h.isUndefined(this.pendingFileTransfers[a]))return void n.error(a+": Aborting unknown ID");n.info(a+": Aborting file transfer");var c=this.pendingFileTransfers[a];delete this.pendingFileTransfers[a],delete this.pendingFileUploadIDs[c.internalId],c.xhr?c.xhr.abort():c.httpReq&&c.httpReq.abort();var d={serverId:c.serverId,senderInitiated:b,fromDevice:this.sdk.getDeviceAddress()};this.sendRequest("POST","abortFile",d,function(){n.info(c.serverId+": Aborted file")},function(a){n.info(c.serverId+": Abort failed: "+a.code+": "+a.message)})},e.prototype.setCallbacks=function(a){var b=this;if(!this.ws)throw new Error('Cannot set callbacks for a non-persistent connection. Use "requestMessageNotification"');a.onMessage&&this.ws.subscribe(o+"message?device="+this.sdk.uuid,function(c){switch(c.contentType){case q:switch(c.content.state){case"accept":b._putFile(c);break;case"downloaded":b._downloadedFile(c);break;case"request":b._incomingFile(c,a.onFileAvailable);break;case"ready":b._getFile(c.content);break;case"aborted":b._abortedFile(c.content,c.from);break;case"abortedack":break;default:m.error("Unexpected file transfer message",c)}break;case r:b.sdk.groupChat&&b.sdk.groupChat._handleChatRoomEvent(c.content);break;case e.RPC_RESPONSE_CONTENT_TYPE:b.sdk.rpc.handleRpcResponse(c);break;case e.RPC_REQUEST_CONTENT_TYPE:b.sdk.rpc.handleRpcRequest(c);break;default:c.toChatRoomId||c.chatRoomId?b.sdk.groupChat&&b.sdk.groupChat._handleChatRoomMessage(c):a.onMessage(c)}})},e.prototype.requestMessageNotification=function(a,b,c,d){if(this.ws)throw new Error('Do not request Message Notification for a persistent connection. Use "setCallbacks"');if(!a)throw new Error('Must specify "token" parameter');if(!b)throw new Error('Must specify "appARN" parameter');if(!c)throw new Error('Must specify "notificationMessage" parameter');var e=this;g(e,a,b,c,d),setInterval(function(){g(e,a,b,c,d)},3e5)},e.prototype.getMessages=function(a,b){if(this.ws)throw new Error('Do not use getMessages for a persistent connection. Use "setCallbacks"');if(!a)throw new Error("Must specify a unique identifier for this instance.");var c={};c.uniqueId=a,this.sendRequest("GET","getMessages/"+a,c,function(){m.debug("getMessages succeeded"),b&&h.isFunction(b.onAcknowledged)&&b.onAcknowledged()},function(a){m.warn("getMessages failed"),b&&h.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.recallMessage=function(a,b){if(!a)throw new Error("Must specify the message to recall.");var c={msgid:a};this.sendRequest("POST","recallMessage",c,function(a){m.debug("recallMessage succeeded"),b&&h.isFunction(b.onResult)&&b.onResult(a.unread)},function(a){m.warn("recallMessage failed"),b&&h.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.startRecordingConversation=function(a,b,c){this._recordConversationInternal(!0,a,b,c)},e.prototype.stopRecordingConversation=function(a,b,c){this._recordConversationInternal(!1,a,b,c)},e.prototype._recordConversationInternal=function(a,b,c,e){var f=this,g=this.sdk.config;if(!b)throw new Error("Must specify the other party of the conversation.");c||(c=""),b=d(b,g.defaultDomain)[0];var i,j={subject:c,otherParty:b};a?i="startRecording":(i="stopRecording",f._cancelRecordingRefreshTask(b,c)),this.sendRequest("POST",i,j,function(d){m.debug("start / stop recording succeeded"),e&&h.isFunction(e.onSuccess)&&e.onSuccess(),a&&(h.isUndefined(d.refreshDelay)||f._setRecordingRefreshTask(b,c,d.refreshDelay))},function(a){m.warn("start / stop recording failed"),e&&h.isFunction(e.onError)&&e.onError(a.code,a.message)})},e.prototype._setRecordingRefreshTask=function(a,b,c){var d=this,e=a+":"+b,f=this.recordingRefreshTasks[e];f||(this.recordingRefreshTasks[e]=setInterval(function(a,b){d.startRecordingConversation(a,b,null)},1e3*c,a,b))},e.prototype._cancelRecordingRefreshTask=function(a,b){var c=a+":"+b,d=this.recordingRefreshTasks[c];d&&(clearInterval(d),delete this.recordingRefreshTasks[c])},e.prototype._cancelAllRecordingRefreshTasks=function(){var a=this;m.debug("Cancelling all");var b=h.keys(a.recordingRefreshTasks);h.each(b,function(b){m.debug("Cancelling key "+b),clearInterval(a.recordingRefreshTasks[b]),delete a.recordingRefreshTasks[b]})},e.prototype.setOptions=function(a){var b=f(a);0!==b.length&&(this.deliveryModes=b)},e.prototype.setArchivedMessageTags=function(a,b,c){if(!h.isArray(b))throw new Error("Tags must be an array of string tags");this.sendRestRequest("POST","tagArchivedMessage/"+a,{tags:b},function(){c&&h.isFunction(c.onSuccess)&&c.onSuccess()},function(a){c&&h.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype._processArchivedMessage=function(a){var b=this;return a.timestamp=new Date(a.timestamp),a.setTags=function(c,d){b.setArchivedMessageTags(a.msgId,c,d)},a},e.prototype._processArchivedFileTransfer=function(a){var b=this;a.timestamp=new Date(a.timestamp),a.getFile=function(c,d){b.retrieveArchivedFile(a.ftId,c,d)}},e.prototype.retrieveArchivedFile=function(a,b,c){var d=this;2===arguments.length&&(c=arguments[1]),
this.sendRestRequest("GET","retrieveArchivedFile/"+a,null,function(a){var b=a.content;b.from=a.from,b.callbacks=c,d.pendingFileTransfers[b.serverId]=b,d._getFile(a.content)})},e.prototype.getArchivedMessage=function(a,b){var c=this;if(!h.isString(a))throw new Error("You must specify a valid message ID");this.sendRestRequest("GET","getArchivedMessage/"+a,null,function(a){c._processArchivedMessage(a),b&&h.isFunction(b.onSuccess)&&b.onSuccess(a)},function(a){b&&h.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.getArchivedMessages=function(a,b){var c=this,d="";b&&(d+=(d?"&":"?")+"token="+b),this.sendRestRequest("GET","getArchivedMessages"+d,null,function(b){h.each(b.messages,function(a){c._processArchivedMessage(a)}),a&&h.isFunction(a.onResult)&&a.onResult(b.messages,!b.token),b.token&&setTimeout(function(){c.getArchivedMessages(a,b.token)},250)},function(b){a&&h.isFunction(a.onError)&&a.onError(b.code,b.message)})},e.prototype.getArchivedMessagesByTag=function(a,b,c){var d=this;if(!h.isString(a))throw new Error("Tag name must be a string");var e="";c&&(e+=(e?"&":"?")+"token="+c),this.sendRestRequest("GET","getArchivedMessagesByTag/"+a+e,null,function(c){h.each(c.messages,function(a){d._processArchivedMessage(a)}),b&&h.isFunction(b.onResult)&&b.onResult(c.messages,!c.token),c.token&&setTimeout(function(){d.getArchivedMessagesByTag(a,b,c.token)},250)},function(a){b&&h.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.getArchivedMessagesByDate=function(a,b,c,d){var e=this,f=h.isDate(a)?parseInt(a.getTime()/1e3,10):a;if(!h.isNumber(f))throw new Error("Start date must be an instance of Date or seconds since 1 Jan 1970");var g=h.isDate(b)?parseInt(b.getTime()/1e3,10):b;if(!h.isNumber(g))throw new Error("End date must be an instance of Date or seconds since 1 Jan 1970");var i=f+"-"+g,j="";d&&(j+=(j?"&":"?")+"token="+d),this.sendRestRequest("GET","getArchivedMessagesByDate/"+i+j,null,function(d){h.each(d.messages,function(a){e._processArchivedMessage(a)}),c&&h.isFunction(c.onResult)&&c.onResult(d.messages,!d.token),d.token&&setTimeout(function(){e.getArchivedMessagesByDate(a,b,c,d.token)},250)},function(a){c&&h.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getArchivedMessagesByContact=function(a,b,c){var d=this;if(!h.isString(a))throw new Error("Contact must be the address of the contact");var e="";c&&(e+=(e?"&":"?")+"token="+c),this.sendRestRequest("GET","getArchivedMessagesByRecipient/"+a+e,null,function(c){h.each(c.messages,function(a){d._processArchivedMessage(a)}),b&&h.isFunction(b.onResult)&&b.onResult(c.messages,!c.token),c.token&&setTimeout(function(){d.getArchivedMessagesByContact(a,b,c.token)},250)},function(a){b&&h.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.getArchivedFileTransfers=function(a,b){var c=this,d="";b&&(d+=(d?"&":"?")+"token="+b),this.sendRestRequest("GET","getArchivedFileTransfers"+d,null,function(b){h.each(b.transfers,function(a){c._processArchivedFileTransfer(a)}),a&&h.isFunction(a.onResult)&&a.onResult(b.transfers,!b.token),b.token&&setTimeout(function(){c.getArchivedFileTransfers(a,b.token)},250)},function(b){a&&h.isFunction(a.onError)&&a.onError(b.code,b.message)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":50,"js-logger":2,"node-uuid":36}],50:[function(a,b,c){(function(c){"use strict";function d(a){this.wampBaseUri=a}b.exports=d;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("wolfy87-eventemitter"),g=a("../lib/wampy"),h=a("js-logger"),i="undefined"!=typeof window?window.XMLHttpRequest:"undefined"!=typeof c?c.XMLHttpRequest:null,j=h.get("SDK:Net"),k="http://sdk.acision.com/auth/v1.3/setAccessToken",l="error",m="ready",n="reconnected";d.prototype=new f,d.prototype.constructor=d,d.prototype.init=function(a,b,c,d){var f=this;if(this.sdk=a,this.enabled=b,this.ready=!1,b){var h=d;if(e.isArray(h)&&(h=e.sample(h)),"/"!==h.slice(-1)&&(h+="/"),this.restUrl=h,this.wampBaseUri&&c&&a.config.persistent){var i;return i=e.isArray(c)?e.sample(c):c,e.bindAll(f,"onConnect","onError","onReconnect","onClose"),void(this.ws=new g(i,["wamp"],{autoReconnect:!0,onConnect:f.onConnect,onError:f.onError,onReconnect:f.onReconnect,onClose:f.onClose}))}this.ready=!0}},d.prototype.isReady=function(){return!this.enabled||this.ready},d.prototype.onConnect=function(){var a=this;j.info("Connected"),setTimeout(function(){a.refreshConfig()},500)},d.prototype.onError=function(){this.ready=!1},d.prototype.onReconnect=function(){var a=this;j.info("Reconnected"),this.setAccessToken(function(){a.ready=!0,a.ws.resubscribe(),a.emitEvent(n)})},d.prototype.onClose=function(){this.ws&&(j.error("Max retries reached; aborting"),this.emitEvent(l))},d.prototype.refreshConfig=function(){var a=this;this.ws&&this.setAccessToken(function(){a.ready=!0,a.emitEvent(m)})},d.prototype.setAccessToken=function(a){var b=this;this.ws.call(k,{callRes:function(){j.debug("Authentication successful"),a()},callErr:function(){j.debug("Authentication failed"),b.emitEvent(l)}},this.sdk.config.accessToken)},d.prototype.sendRequest=function(a,b,c,d,e){if(!this.enabled)throw new Error("API is disabled");if(this.ws){if(!this.ready)throw new Error("API not ready - did you wait for the onConnected event?");this.ws.call(this.wampBaseUri+b,{callRes:d,callErr:e},c)}else this.sendRestRequest(a,b,c,d,e)},d.prototype.sendRestRequest=function(a,b,c,d,f){if(!this.enabled)throw new Error("API is disabled");var g=new i;g.open(a,this.restUrl+b),g.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.responseType="json",g.onload=function(){this.status>=200&&this.status<300?d(this.response):f(404===this.status?{code:"ResourceNotFound",message:"The resource was not found"}:e.isObject(this.response)&&this.response.code?this.response:{code:"RestError",message:"Unknown error: "+this.status+" "+this.statusText})},g.onerror=function(){f({code:"NetworkError",message:"A network error was encountered"})},g.onabort=function(){f({code:"AbortError",message:"The request was aborted"})},g.ontimeout=function(){f({code:"TimeoutError",message:"The request timed out"})},c&&!e.isString(c)&&(c=JSON.stringify(c)),g.send(c)},d.prototype.disconnect=function(){this.ws&&(this.ws.disconnect(),delete this.ws)},b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../lib/wampy":1,"js-logger":2,"wolfy87-eventemitter":43}],51:[function(a,b,c){(function(c){"use strict";function d(a){function b(a){var b=c.exec(a),d={};return b[4]&&b[4].split(";").forEach(function(a){var b=a.split("=");d[b[0]]=b[1]}),{user:b[1],host:b[2],port:b[3],params:d,headers:b[5]}}var c=/^([^@]+)@([^:;]+)(?::([^;]+))?(?:;([^\?]+))?(?:\?([^$]+))?$/;f.each(a,function(a){var c=b(a.user);c.params.gr?(a.device=a.user,a.user=c.user+"@"+c.host+(c.port?":"+c.port:"")):a.device=null})}function e(a){var b=a.config.interfaces.presence,c=null,d=null;b&&(c=b.wsEndpoints[k],d=b.restEndpoints[k]),this.on("reconnected",f.bind(this._resubscribe,this)),this.init(a,!!b,c,d),this.callbacks={},this.refreshedPresentities={},this.fieldTtl={},this.refreshInterval={},this._removeFromSubscriptionsList(),this.subscriptionFederationTag=null,this.recording=!1,f.isUndefined(a.config.recordPresence)||(this.recording=a.config.recordPresence)}b.exports=e;var f="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,g=a("js-logger"),h=a("./network-api"),i=g.get("SDK:Presence"),j="http://sdk.acision.com/presence/v1.3/",k="1.3",l=300;e.prototype=new h(j),e.prototype.constructor=e,e.prototype.disconnect=function(){this._stopAllRefreshTimers(),h.prototype.disconnect.call(this)},e.prototype._mergeFields=function(a,b){var c=this;f.each(a,function(a,d){a?(c.refreshedPresentities[d]=a,c.fieldTtl[d]=b):(delete c.refreshedPresentities[d],delete c.fieldTtl[d])},this)},e.prototype.getPresentities=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.users=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getPresentities",e,function(a){i.debug("getPresentities succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getPresentities failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getPresentitiesForGroups=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.groups=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getPresentities",e,function(a){i.debug("getPresentitiesForGroups succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getPresentitiesForGroups failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getPresentitiesForGroupIds=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.groupIds=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getPresentities",e,function(a){i.debug("getPresentitiesForGroups succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getPresentitiesForGroups failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getAllPresentities=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.addresses=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getAllPresentities",e,function(a){i.debug("getAllPresentities succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getAllPresentities failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getAllPresentitiesForGroups=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.groups=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getAllPresentities",e,function(a){i.debug("getAllPresentitiesForGroups succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getAllPresentitiesForGroups failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.getAllPresentitiesForGroupIds=function(a,b,c){if(!a||!c)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var e={};f.isArray(a)||(a=[a]),e.groupIds=a,b&&(f.isArray(b)||(b=[b]),e.fields=b),this.sendRequest("POST","getAllPresentities",e,function(a){i.debug("getAllPresentitiesForGroups succeeded"),f.isFunction(c.onSuccess)&&(d(a),c.onSuccess(a))},function(a){i.debug("getAllPresentitiesForGroups failed"),f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.setOwnPresentity=function(a,b,c){this.setPresentity(this.sdk.config.primaryAddress,a,b,c)},e.prototype.setPresentity=function(a,b,c,d){var e=this;if(!b)throw new Error("Missing parameters");if(!f.isObject(b)||c&&!f.isObject(c)||d&&!f.isObject(d))throw new Error("Invalid parameters");if(!f.every(b,f.isString))throw new Error("Non-string field value");c=f.defaults({},c,{refresh:!0});var g=c.ttl,h={};h.user=a,h.device=this.sdk.uuid,h.fields=b,h.record=e.recording,f.isUndefined(g)||null===g?f.isUndefined(this.sdk.config.presenceTTL)||(h.ttl=this.sdk.config.presenceTTL):h.ttl=g,this.sendRequest("POST","setPresentity",h,function(h){if(i.debug("setOwnPresentity succeeded"),a===e.sdk.config.primaryAddress&&c.refresh){var j=l;f.isUndefined(h.refreshDelay)||(j=h.refreshDelay),e._mergeFields(b,g),e._checkRefreshTimer(g,j)}d&&f.isFunction(d.onSuccess)&&d.onSuccess()},function(a){i.warn("setPresentity failed"),d&&f.isFunction(d.onError)&&d.onError(a.code,a.message)})},e.prototype.deleteOwnPresentity=function(a){this.deletePresentity(this.sdk.config.primaryAddress,a)},e.prototype.deletePresentity=function(a,b){var c=this,d={};d.user=a,d.device=this.sdk.uuid,d.record=c.recording,this.sendRequest("POST","deletePresentity",d,function(){i.debug("deletePresentity succeeded"),a===c.sdk.config.primaryAddress&&(c._stopAllRefreshTimers(),c.refreshedPresentities={}),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.warn("deletePresentity failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.refreshOwnPresentity=function(a,b,c){this.refreshPresentity(this.sdk.config.primaryAddress,a,b,c)},e.prototype.refreshPresentity=function(a,b,c,d){var e=this;if(!b)throw new Error("Missing parameters");if(!f.isObject(b)||c&&!f.isObject(c)||d&&!f.isObject(d))throw new Error("Invalid parameters");c=f.defaults({},c,{refresh:!0});var g=c.ttl,h={};h.user=a,h.device=this.sdk.uuid,h.fields=b,f.isUndefined(g)||null===g?f.isUndefined(this.sdk.config.presenceTTL)||(h.ttl=this.sdk.config.presenceTTL):h.ttl=g,this.sendRequest("POST","refreshPresentity",h,function(h){if(i.debug("refreshPresentity succeeded"),a===e.sdk.config.primaryAddress&&c.refresh){var j=l;f.isUndefined(h.refreshDelay)||(j=h.refreshDelay),e._mergeFields(b,g),e._checkRefreshTimer(g,j)}d&&f.isFunction(d.onSuccess)&&d.onSuccess()},function(a){i.warn("refreshPresentity failed"),d&&f.isFunction(d.onError)&&d.onError(a.code,a.message)})},e.prototype._checkRefreshTimer=function(a,b){var c=f.contains(this.fieldTtl,a),d=this.refreshInterval[a];if(c){if(d)return;return void this._startRefreshTimer(a,b)}this._stopRefreshTimer(a)},e.prototype._startRefreshTimer=function(a,b){var c=this;i.debug("Starting refresh interval for TTL "+a),this.refreshInterval[a]=setInterval(function(){if(c.refreshInterval[a]){var b=f.pick(c.refreshedPresentities,function(b,d){return c.fieldTtl[d]===a});f.isEmpty(b)?c._stopRefreshTimer(a):c.refreshOwnPresentity(b,{ttl:a})}},1e3*b)},e.prototype._stopRefreshTimer=function(a){this.refreshInterval[a]&&(i.debug("Stopping refresh interval for TTL "+a),clearInterval(this.refreshInterval[a]),delete this.refreshInterval[a])},e.prototype._stopAllRefreshTimers=function(){var a=this,b=f.keys(this.refreshInterval);f.each(b,function(b){a._stopRefreshTimer(b)})},e.prototype.subscribe=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var d={};f.isArray(a)||(a=[a]),d.users=a,b&&(f.isArray(b)||(b=[b]),d.fields=b),this._addToSubscriptionsList("user",a,b),this.sendRequest("POST","subscribe",d,function(){i.debug("subscribe succeeded"),c&&f.isFunction(c.onSuccess)&&c.onSuccess()},function(a){i.debug("subscribe failed"),c&&f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.subscribeToFederationTag=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");var c={};c.device=this.sdk.uuid,a&&(f.isArray(a)||(a=[a]),c.fields=a),this.subscriptionFederationTag={fields:a?a.slice():null},this.sendRequest("POST","subscribeFederationTag",c,function(){i.debug("subscribe succeeded"),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.debug("subscribe failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.subscribeToGroups=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var d={};f.isArray(a)||(a=[a]),d.groups=a,b&&(f.isArray(b)||(b=[b]),d.fields=b),this._addToSubscriptionsList("group",a,b),this.sendRequest("POST","subscribe",d,function(){i.debug("subscribeToGroups succeeded"),c&&f.isFunction(c.onSuccess)&&c.onSuccess()},function(a){i.debug("subscribeToGroups failed"),c&&f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.subscribeToGroupIds=function(a,b,c){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var d={};f.isArray(a)||(a=[a]),d.groupIds=a,b&&(f.isArray(b)||(b=[b]),d.fields=b),this._addToSubscriptionsList("groupId",a,b),this.sendRequest("POST","subscribe",d,function(){i.debug("subscribeToGroups succeeded"),c&&f.isFunction(c.onSuccess)&&c.onSuccess()},function(a){i.debug("subscribeToGroups failed"),c&&f.isFunction(c.onError)&&c.onError(a.code,a.message)})},e.prototype.unsubscribe=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");var c={};if(a){if(f.isEmpty(a))throw new Error("Invalid parameters");f.isArray(a)||(a=[a]),c.users=a,this._removeFromSubscriptionsList("user",a)}else this._removeFromSubscriptionsList();this.sendRequest("POST","unsubscribe",c,function(){i.debug("unsubscribe succeeded"),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.debug("unsubscribe failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.unsubscribeFromFederationTag=function(a){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");var b={};b.device=this.sdk.uuid,this.subscriptionFederationTag=null,this.sendRequest("POST","unsubscribeFederationTag",b,function(){i.debug("unsubscribe succeeded"),a&&f.isFunction(a.onSuccess)&&a.onSuccess()},function(b){i.debug("unsubscribe failed"),a&&f.isFunction(a.onError)&&a.onError(b.code,b.message)})},e.prototype.unsubscribeFromGroups=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var c={};f.isArray(a)||(a=[a]),c.groups=a,this._removeFromSubscriptionsList("group",a),this.sendRequest("POST","unsubscribe",c,function(){i.debug("unsubscribeFromGroups succeeded"),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.debug("unsubscribeFromGroups failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype.unsubscribeFromGroupIds=function(a,b){if(!this.ws)throw new Error("Cannot subscribe to presentity updates for a non-persistent connection.");if(!a)throw new Error("Missing parameters");if(f.isEmpty(a))throw new Error("Invalid parameters");var c={};f.isArray(a)||(a=[a]),c.groupIds=a,this._removeFromSubscriptionsList("groupId",a),this.sendRequest("POST","unsubscribe",c,function(){i.debug("unsubscribeFromGroups succeeded"),b&&f.isFunction(b.onSuccess)&&b.onSuccess()},function(a){i.debug("unsubscribeFromGroups failed"),b&&f.isFunction(b.onError)&&b.onError(a.code,a.message)})},e.prototype._addToSubscriptionsList=function(a,b,c){this.subscriptions[a].push({names:b.slice(),fields:c?c.slice():null})},e.prototype._removeFromSubscriptionsList=function(a,b){return a?void(this.subscriptions[a]=f.chain(this.subscriptions[a]).map(function(a){return a.names=f.difference(a.names,b),a}).filter(function(a){return a.names.length>0}).value()):void(this.subscriptions={user:[],group:[],groupId:[]})},e.prototype._resubscribe=function(){var a=this;f.chain([f.map(a.subscriptions.user,function(a){return{users:a.names,fields:a.fields}}),f.map(a.subscriptions.group,function(a){return{groups:a.names,fields:a.fields}}),f.map(a.subscriptions.groupId,function(a){return{groupIds:a.names,fields:a.fields}})]).flatten(!0).tap(function(a){i.info("Resubscribing to "+a.length+" users/groups")}).each(function(b){a.sendRequest("POST","subscribe",b,function(){i.debug("resubscribe succeeded")},function(){i.debug("resubscribe failed")})}),a.subscriptionFederationTag&&(i.info("Resubscribing to federation tag"),a.sendRequest("POST","subscribeFederationTag",{device:a.sdk.uuid,fields:a.subscriptionFederationTag.fields},function(){i.debug("resubscribe succeeded")},function(){i.debug("resubscribe failed")}))},e.prototype.setCallbacks=function(a){if(!this.ws)throw new Error("Cannot set callbacks for a non-persistent connection.");if(!a)throw new Error("Missing parameters");this.callbacks=a,a.onPresentity&&this.ws.subscribe(j+"presentity",function(b){d(b),a.onPresentity(b)})},e.prototype.setRecording=function(a){this.recording=a},e.prototype.isRecording=function(){return this.recording}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./network-api":50,"js-logger":2}],52:[function(a,b,c){(function(c){"use strict";function d(a){this.sdk=a,this.rpcCallbacks={},this.pendingRequests={},this.pendingTimeouts={},this.enabled=!0,this.ready=!0}b.exports=d;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("js-logger"),g=a("node-uuid"),h=f.get("SDK:RPC"),i=a("./messaging"),j=60;d.prototype.isReady=function(){return this.sdk.messaging.isReady()},d.prototype.refreshConfig=function(){},d.prototype.disconnect=function(){},d.prototype.call=function(a,b,c,d,e,f){var g=this;h.info("RPC request "+a+" address "+b+" service "+c+" method "+d);var k={requestId:a,service:c,rpcName:d,params:e||{}};this.pendingRequests[a]=f,this.pendingTimeouts[a]=setTimeout(function(){g.pendingRequests[a].onError("TIMEOUT"),delete g.pendingRequests[a],h.info("RPC timeout "+a+": request timed out")},1e3*j);var l={contentType:i.RPC_REQUEST_CONTENT_TYPE,deliveryModes:["immediate"]},m={};m.onError=function(b,c){var d=g.removePendingRequest(a);d.onError&&d.onError("Error sending RPC request"),g.removePendingTimeout(a),h.error("RPC request "+a+" error sending RPC request: "+b+" "+c)},this.sdk.messaging.sendToDestination(b,JSON.stringify(k),l,m)},d.prototype.removePendingTimeout=function(a){return this.pendingTimeouts[a]?(clearTimeout(this.pendingTimeouts[a]),void delete this.pendingTimeouts[a]):null},d.prototype.removePendingRequest=function(a){if(!this.pendingTimeouts[a])return null;var b=this.pendingRequests[a];return delete this.pendingRequests[a],b},d.prototype.handleRpcResponse=function(a){a.content||h.error("RPC response did not contain a JSON body");var b=JSON.parse(a.content);b.requestId||h.error("RPC response: invalid or missing requestId");var c=b.requestId,d=this.removePendingRequest(c);if(null===d)return void h.info("RPC response "+c+": dropping response for unknown or timed out request");if(this.removePendingTimeout(c),!e.isNull(b.errCode)&&!e.isUndefined(b.errCode)){var f=b.errCode;return h.info("RPC response "+c+": server returned error "+f),void d.onError(f)}d.onSuccess(b)},d.prototype.handleRpcError=function(a,b){var c=this.pendingRequests[a];delete this.pendingRequests[a],c.onError(b)},d.prototype.disconnect=function(){var a=this;e.each(this.pendingTimeouts,function(b,c){a.removePendingTimeout(c)}),e.each(this.pendingRequests,function(b,c){a.removePendingRequest(c)})},d.prototype.getClientForAddress=function(a,b,c){return new d.Client(this.sdk,a,b,c)},d.prototype.handleRpcRequest=function(a){if(!a.content)return void h.error("RPC request did not contain a JSON body");var b=JSON.parse(a.content);if(!b.requestId)return void h.error("RPC request: invalid or missing requestId");b.rpcName||h.error("RPC request: invalid or missing rpcName");var c=new d.Request(this.sdk,a.from,b);this.onRequest(c)},d.prototype.onRequest=function(){},d.prototype.setCallbacks=function(a){a.onRequest&&(this.onRequest=a.onRequest)},d.Request=function(a,b,c){this.sdk=a,this.address=b,this.requestId=c.requestId,this.service=c.service,this.name=c.rpcName,this.params=c.params,this.sent=!1},d.Request.prototype.send=function(a,b){this.sent=!0;var c={requestId:this.requestId,errCode:b||null,result:a},d={contentType:i.RPC_RESPONSE_CONTENT_TYPE,deliveryModes:["immediate"]},e={};h.info("RPC response "+this.requestId+" address "+this.address+" service "+this.service+" method "+this.name),this.sdk.messaging.sendToDestination(this.address,JSON.stringify(c),d,e)},d.Client=function(a,b,c,d){this.sdk=a,this.address=b,this.service=c,this.rpcClientOptions=d},d.Client.prototype.call=function(a,b,c){var d=this;if(!a||!e.isString(a))throw new Error("name must not be empty");b||(b={}),c||(c={});var f={};f.onSuccess=function(a){e.isFunction(c.onSuccess)&&(d.rpcClientOptions&&!d.rpcClientOptions.loadshareRequests&&(d.address=a.fromDevice),c.onSuccess(a))},f.onError=function(a){e.isFunction(c.onError)&&c.onError(a)},c.onSuccess||(c.onSuccess=function(){});var h=g.v1();this.sdk.rpc.call(h,this.address,this.service,a,b,f)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./messaging":49,"js-logger":2,"node-uuid":36}],53:[function(a,b,c){(function(c){var d="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,e=a("jssip"),f=function(a,b,c,d,e){this.sdk=a,this.username=b||null,this.domain=c||a.config.defaultDomain,this.parameters=d||{},this.deviceId=e||null};f.prototype.getAddress=function(){var a=this.username+"@"+this.domain;return d.each(this.parameters,function(b,c){"gr"!==c&&(a+=";"+c+"="+b)}),a},f.prototype.getDeviceAddress=function(){var a=this.getAddress();return d.isNull(this.deviceId)||(a+=";gr=urn:uuid:"+this.deviceId),a},f.prototype.toString=function(){var a=this.getDeviceAddress();return a},f.prototype._setDeviceIdFromParameters=function(a){a.gr&&(this.deviceId=d.last(a.gr.split(":")))},f.parse=function(a,b){var c=null;b.indexOf("@")<0&&(b=b.concat("@",a.config.defaultDomain));var g=e.Utils.normalizeURI(b);return g.parameters.gr&&(c=d.last(g.parameters.gr.split(":"))),new f(a,g.user,g.host,g.parameters,c)},b.exports=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jssip:11}],54:[function(a,b,c){(function(c){"use strict";function d(a){var b=this,d=a.config.interfaces.webrtc,e="";if(c.navigator&&(e=c.navigator.userAgent),this.sdk=a,this.enabled=!!d,this.ready=!1,this.sessions=[],this.compat=new n(e),this.enabled){h.C.USER_AGENT.indexOf("Acision")<0&&(h.C.USER_AGENT="Acision SDK v".concat(a.version,"; ",e));var f={ws_servers:d.wsEndpoints[p],uri:"sip:"+(a.config.primaryAddress||"anonymous@anonymous.invalid"),authorization_user:d.credentials.username,password:d.credentials.password,register:!1,handle_media:!1,instance_id:a.uuid,no_answer_timeout:120};this.ua=new h.UA(f),this.ua.on("connected",function(){b.emitEvent(r)}),this.ua.on("registrationFailed",function(){b.emitEvent(q)}),this.ua.on("newRTCSession",function(a){var c=a.data;"remote"===c.originator&&b._handleIncoming(c)}),this.ua.on("newRefer",this._handleRefer.bind(this)),this.ua.start()}}b.exports=d;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("wolfy87-eventemitter"),g=a("js-logger"),h=a("jssip"),i=a("jssip/lib/RTCSession"),j=a("jssip/lib/WebRTC"),k=a("./webrtc/sdp"),l=a("./webrtc/session"),m=a("./webrtc/util"),n=a("./webrtc/compat"),o=g.get("SDK:RTC"),p="1.3",q="error",r="ready";d.prototype=new f,d.prototype.constructor=d,d.prototype.isReady=function(){return!this.enabled||this.ua.isConnected()},d.prototype.refreshConfig=function(){if(this.enabled){var a=this.sdk.config.interfaces.webrtc,b={ws_servers:a.wsEndpoints[p],authorization_user:a.credentials.username,password:a.credentials.password};this.ua.updateConfiguration(b);for(var c=0,d=this.sessions.length;d>c;c++)this.sessions[c]._updateIceServers(this.sdk.config.iceServers)}},d.prototype.disconnect=function(){this.ua&&(this.ua.stop(),this.ua=null)},d.prototype.setCallbacks=function(a){a.onIncomingSession?(this.onIncomingSession=a.onIncomingSession,this.ua.register()):(delete this.onIncomingSession,this.ua.unregister())},d.prototype.connect=function(a,b,c){var d=this,e=new i(this.ua);c||(c={}),a.indexOf("@")<0&&(a=a.concat("@",this.sdk.config.defaultDomain));var f=this.sdk.config.iceServers,g=new l(this,e,a,f,c.constraints);return g.setCallbacks(b),g._connect(c.stream,c.streamConfig,c.customHeaders,c.record,c.followRedirects),this.sessions.push(g),g.on("close",function(){var a=d.sessions;a.splice(a.indexOf(this),1)}),g},d.prototype.getMediaStream=function(a,b){if(b&&b.screenOut)return this._createScreenSharingStream(a,b);var c={video:b.videoOut,audio:b.audioOut};e.isObject(b.mandatoryVideoConstraints)&&(c.video.mandatory=b.mandatoryVideoConstraints),e.isArray(b.optionalVideoConstraints)&&(c.video.optional=b.optionalVideoConstraints),j.getUserMedia(c,a.onSuccess,function(b){a.onError(b.name,b.message)})},d.prototype._createScreenSharingStream=function(a,b){var c=this;if(navigator.webkitGetUserMedia)this._chromeCheckScreenSharingExtension(function(){c._chromeCreateScreenSharingStream(a,b)},a.onError);else if(navigator.mozGetUserMedia){var d={video:{mozMediaSource:"screen",mediaSource:"screen"},audio:b.audioOut};j.getUserMedia(d,a.onSuccess,function(b){a.onError(b.name,b.message)})}},d.prototype._chromeCheckScreenSharingExtension=function(a,b){c.chrome&&c.chrome.runtime?c.chrome.runtime.sendMessage(this.sdk.config.chromeScreenShareExtensionId,{action:"getDetails"},function(c){return c&&c.version?void a():void b("ExtensionNotInstalledError","Extension is not installed")}):b("ExtensionNotInstalledError","Extension is not installed")},d.prototype._chromeCreateScreenSharingStream=function(a,b){c.chrome.runtime.sendMessage(this.sdk.config.chromeScreenShareExtensionId,{action:"getScreenSharingStreamId"},function(d){if(!d||!d.streamId){var f="Could not get stream ID";return console.error(f),void a.onError("WebRTCError",f)}if(d.error)return console.error(d.error),void a.onError("WebRTCError",d.error);var g=a.onSuccess;if(b.audioOut){var h=function(b,c){var d=c.getAudioTracks()[0];b.addTrack(d),a.onSuccess(b)};g=function(b){j.getUserMedia({audio:!0},h.bind(null,b),function(b){a.onError(b.name,b.message)})}}var i={video:{mandatory:e.extend({chromeMediaSource:"desktop",chromeMediaSourceId:d.streamId,maxFrameRate:5,maxWidth:c.screen.width>1920?c.screen.width:1920,maxHeight:c.screen.height>1080?c.screen.height:1080},b.mandatoryVideoConstraints||{})}};b.optionalVideoConstraints&&(i.video.optional=b.optionalVideoConstraints);var k=function(){e.isFunction(a.onError)&&a.onError("WebRTCError")};j.getUserMedia(i,g,k)})},d.prototype._handleIncoming=function(a){var b=this,c=new k.Session(a.request.body);if(!c)return void a.sdpInvalid();var d=null;c.attributes.fingerprint||c.media[0].attributes.fingerprint||(d={mandatory:{DtlsSrtpKeyAgreement:!1}});var e=a.session.remote_identity.uri.toAor().replace(/^sip:/,""),f=this.sdk.config.iceServers,g=new l(this,a.session,e,f,d),h=function(){o.log("Remote offer set"),a.sdpValid(),m.fireEvent(b,"onIncomingSession",{session:g})},i=function(b){o.warn("setRemoteDescription failed:",b),a.sdpInvalid(),g.close()};g._handleInitialInvite(a.request,c,h,i),this.sessions.push(g),g.on("close",function(){var a=b.sessions;a.splice(a.indexOf(this),1)})},d.prototype._handleRefer=function(a){var b=a.data;if("remote"===b.originator){b.refer.refer_uri.scheme!==h.C.SIP&&b.refer.reject({status_code:416,reason_phrase:"Unsupported Refer URI Scheme"});var c=b.session;if(!c)return void b.refer.reject({status_code:481,reason_phrase:"Target Session Does Not Exist"});for(var d=null,e=0,f=this.sessions.length;f>e;e++)if(d=this.sessions[e],d.sipSession===c)return void d._handleRefer(b.refer);b.refer.reject({status_code:481,reason_phrase:"Target Session Does Not Exist"})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./webrtc/compat":55,"./webrtc/sdp":59,"./webrtc/session":60,"./webrtc/util":63,"js-logger":2,jssip:11,"jssip/lib/RTCSession":16,"jssip/lib/WebRTC":34,"wolfy87-eventemitter":43}],55:[function(a,b,c){"use strict";function d(a){var b=/Chrome\/([0-9]*)/.exec(a);b&&b[1]&&(this.flavour="chrome",this.version=parseInt(b[1],10)),b=/Firefox\/([0-9]*)/.exec(a),b&&b[1]&&(this.flavour="firefox",this.version=parseInt(b[1],10)),f.info("Detected "+this.flavour+" version "+this.version);
}b.exports=d;var e=a("js-logger"),f=e.get("SDK:Compat");d.prototype.supportsRTCOfferOptionsDict=function(){switch(this.flavour){case"chrome":if(this.version<39)return!1;break;case"firefox":if(this.version<33)return!1}return!0},d.prototype.requiresInactiveStreams=function(){return"chrome"===this.flavour&&this.version<38},d.prototype.supportsIceServerUrlsArray=function(){return"firefox"===this.flavour?!1:!0},d.prototype.supportsIncomingRTXcodec=function(){return"chrome"===this.flavour&&this.version<37?!1:!0}},{"js-logger":2}],56:[function(a,b,c){"use strict";function d(a){if(a instanceof f.IncomingRequest)this.fromJsSipHeaders(a.headers);else if(a instanceof f.OutgoingRequest)this.fromExtraHeaders(a.extraHeaders);else if(a){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=a[b],this.isValidCustomHeader(b,c)?this[b]=c:h.warn("Ignored custom header:",b,c))}}b.exports=d;var e=a("js-logger"),f=a("jssip/lib/SIPMessage"),g=a("./util"),h=e.get("SDK:RTC:CustomHeaders");d.prototype.isValidCustomHeader=function(a,b){var c=/[^a-zA-Z0-9\-\.!%\*_\+`'~]/;return a.match(c)?!1:g.isType(b,"string")?b.match(/[\r\n]/)?!1:!0:!1},d.prototype.equals=function(a){var b=Object.keys(this);if(b.length!==Object.keys(a).length)return!1;for(var c=0,d=b.length;d>c;c++){var e=b[c];if(a[e]!==this[e])return!1}return!0},d.prototype.fromJsSipHeaders=function(a){for(var b in a)if(a.hasOwnProperty(b)&&"X-"===b.slice(0,2).toUpperCase()&&"X-ACISION"!==b.slice(0,9).toUpperCase()){var c=a[b][0].raw;this.isValidCustomHeader(b,c)?this[b.slice(2)]=c:h.warn("Ignored custom header:",b,c)}},d.prototype.fromExtraHeaders=function(a){for(var b=0,c=a.length;c>b;b++){var d=a[b],e=d.match(/([^:]*)\s*:\s*(.*)/),f=e[1],g=e[2];"X-"===f.slice(0,2).toUpperCase()&&"X-ACISION"!==f.slice(0,9).toUpperCase()&&this.isValidCustomHeader(f,g)&&(this[f.slice(2)]=g)}},d.prototype.toExtraHeaders=function(){for(var a=[],b=Object.keys(this),c=0,d=b.length;d>c;c++){var e=b[c],f=this[e];this.isValidCustomHeader(e,f)?a.push("X-"+e+": "+f):h.warn("Ignored invalid custom header:",e,f)}return a},d.prototype.isEmpty=function(){var a=Object.keys(this);return 0===a.length}},{"./util":63,"js-logger":2,"jssip/lib/SIPMessage":26}],57:[function(a,b,c){"use strict";var c=b.exports={},d=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unexpected value error"};d.prototype=new Error,d.prototype.constructor=d,d.prototype.name="ValueError";var e=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unexpected state error"};e.prototype=new Error,e.prototype.constructor=e,e.prototype.name="StateError";var f=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Version error"};f.prototype=new Error,f.prototype.constructor=f,f.prototype.name="VersionError";var g=function(a){var b=new Error;b.stack&&(this.stack=b.stack),this.message=a||"Unsupported error"};g.prototype=new Error,g.prototype.constructor=g,g.prototype.name="UnsupportedError",c.ValueError=d,c.StateError=e,c.VersionError=f,c.UnsupportedError=g},{}],58:[function(a,b,c){(function(c){"use strict";function d(a,b,c){var d=a.config.interfaces[b],e=null;if(!d)return null;var f=d.restEndpoints[c];if(h.isArray(f))e=h.sample(f);else{if(!h.isString(f))return null;e=f}return e&&"/"!==e.slice(-1)&&(e+="/"),e}function e(a,b){this.sdk=a,this.baseUrl=d(a,"recording",l),this.id=b}function f(a){return!!d(a,"recording",l)}function g(a,b,c){var f=d(a,"recording",l);if(!f)return void c("The recording feature is not enabled for this API key");var g=new j;g.open("POST",f+"sessions"),g.setRequestHeader("Authorization","Bearer "+a.config.accessToken),g.setRequestHeader("Content-Type","application/json"),g.setRequestHeader("Accept","application/json"),g.responseType="json",g.onload=function(){if(this.status>=200&&this.status<300){var b=this.getResponseHeader("Location");if(!b||!this.response.bridgeSdp)return c({code:"RestError",message:"Failed to decode response"});var d=b.slice(b.lastIndexOf("/")+1);if(!d)return c({code:"RestError",message:"Failed to decode response"});k.info("Created session:",d),c(null,new e(a,d),this.response.bridgeSdp)}else c(this.response||{code:"RestError",message:"Unknown error: "+this.status})},g.onerror=function(){c({code:"NetworkError",message:"A network error was encountered"})},g.onabort=function(){c({code:"AbortError",message:"The request was aborted"})},g.ontimeout=function(){c({code:"TimeoutError",message:"The request timed out"})},b&&!h.isString(b)&&(b=JSON.stringify(b)),g.send(b)}b.exports={isEnabled:f,createSession:g,RecordingSession:e};var h="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,i=a("js-logger"),j="undefined"!=typeof window?window.XMLHttpRequest:"undefined"!=typeof c?c.XMLHttpRequest:null,k=i.get("SDK:Recording"),l="1.3";e.prototype.updateEndpoint=function(a,b,c){var d=new j;d.open("PUT",this.baseUrl+"sessions/"+this.id+"/addresses/"+a),d.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),d.setRequestHeader("Content-Type","application/json"),d.setRequestHeader("Accept","application/json"),d.responseType="json",d.onload=function(){if(this.status>=200&&this.status<300){if(!this.response.bridgeSdp)return c({code:"RestError",message:"Failed to decode response"});c(null,this.response.bridgeSdp)}else c(this.response||{code:"RestError",message:"Unknown error: "+this.status})},d.onerror=function(){c({code:"NetworkError",message:"A network error was encountered"})},d.onabort=function(){c({code:"AbortError",message:"The request was aborted"})},d.ontimeout=function(){c({code:"TimeoutError",message:"The request timed out"})},b&&!h.isString(b)&&(b=JSON.stringify(b)),d.send(b)},e.prototype.updateMetadata=function(a,b){var c=new j;c.open("PUT",this.baseUrl+"sessions/"+this.id+"/metadata"),c.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),c.setRequestHeader("Content-Type","application/json"),c.responseType="json",c.onload=function(){b(this.status>=200&&this.status<300?null:this.response||{code:"RestError",message:"Unknown error: "+this.status})},c.onerror=function(){b({code:"NetworkError",message:"A network error was encountered"})},c.onabort=function(){b({code:"AbortError",message:"The request was aborted"})},c.ontimeout=function(){b({code:"TimeoutError",message:"The request timed out"})},a&&!h.isString(a)&&(a=JSON.stringify(a)),c.send(a)},e.prototype.stop=function(a){var b=new j;b.open("DELETE",this.baseUrl+"sessions/"+this.id),b.setRequestHeader("Authorization","Bearer "+this.sdk.config.accessToken),b.onload=function(){a(this.status>=200&&this.status<300?null:this.response||{code:"RestError",message:"Unknown error: "+this.status})},b.onerror=function(){a({code:"NetworkError",message:"A network error was encountered"})},b.onabort=function(){a({code:"AbortError",message:"The request was aborted"})},b.ontimeout=function(){a({code:"TimeoutError",message:"The request timed out"})},b.send()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"js-logger":2}],59:[function(a,b,c){"use strict";function d(a){return new Date(1e3*(parseInt(a,10)-o))}function e(a){return parseInt(a.getTime()/1e3,10)+o}function f(a){return a.replace(/%00/g,"\x00").replace(/%0A/gi,"\n").replace(/%0D/gi,"\r").replace(/%22/g,'"').replace(/%25/g,"%")}function g(a){if(a){if(!this.parse(a))return null}else this.reset()}function h(a){if(a){if(!this.parse(a))return null}else this.reset()}function i(a){if(a){if(!this.parse(a))return null}else this.reset()}function j(a){if(a){if(!this.parse(a))return null}else this.reset()}function k(a){if(a){if(!this.parse(a))return null}else this.reset()}b.exports={Connection:h,Media:j,Session:k};var l=a("js-logger"),m=l.get("SDK:RTC:SDP"),n="\r\n",o=2208988800;g.prototype.reset=function(){this.username="-",this.id=e(new Date),this.version=this.sessId,this.netType="IN",this.addrType="IP4",this.address="address.invalid"},g.prototype.parse=function(a){var b;return b=a.split(" "),6!==b.length?(m.log("Unexpected origin line: "+a),!1):(this.username=b[0],this.id=b[1],this.version=b[2],this.netType=b[3],this.addrType=b[4],this.address=b[5],!0)},g.prototype.toString=function(){var a="";return a+=this.username+" ",a+=this.id+" ",a+=this.version+" ",a+=this.netType+" ",a+=this.addrType+" ",a+=this.address},h.prototype.reset=function(){this.netType="IN",this.addrType="IP4",this.address="address.invalid"},h.prototype.parse=function(a){var b;return b=a.split(" "),3!==b.length?(m.log("Unexpected connection line: "+a),!1):(this.netType=b[0],this.addrType=b[1],this.address=b[2],!0)},h.prototype.toString=function(){var a="";return a+=this.netType+" ",a+=this.addrType+" ",a+=this.address},i.prototype.reset=function(){this.start=null,this.stop=null,this.repeat=[]},i.prototype.parse=function(a){var b,c,e;return b=a.split(n),c=b.shift(),e=c.split(" "),2!==e.length?(m.log("Unexpected timing line: "+c),!1):("0"===e[0]?this.start=null:this.start=d(e[0]),"0"===e[1]?this.stop=null:this.stop=d(e[1]),this.repeat=b,!0)},i.prototype.toString=function(){var a,b,c="";for(c+=this.start?e(this.start):"0",c+=" ",c+=this.stop?e(this.stop):"0",a=0,b=this.repeat.length;b>a;a++)c+=n+this.repeat[a];return c},j.prototype.reset=function(){this.media="message",this.port=2855,this.proto="TCP/MSRP",this.format="*",this.title=null,this.connection=null,this.bandwidth=[],this.key=null,this.resetAttributes()},j.prototype.addAttribute=function(a,b){this.attributes[a]||(this.attributes[a]=[],this.attributeNameOrder.push(a)),this.attributes[a].push(b)},j.prototype.removeAttribute=function(a){this.attributes[a]&&(delete this.attributes[a],this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1))},j.prototype.resetAttributes=function(){this.attributeNameOrder=[],this.attributes={}},j.prototype.replaceAttribute=function(a,b,c){this.attributes[a]&&(delete this.attributes[a],this.addAttribute(b,c),this.attributeNameOrder.splice(this.attributeNameOrder.lastIndexOf(b),1),this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1,b))},j.prototype.parse=function(a){var b,c,d,e,f,g;if(this.reset(),b=a.split(n),c=b.shift(),d=c.split(" "),d.length<4)return m.log("Unexpected media line: "+c),!1;for(this.media=d.shift(),this.port=parseInt(d.shift(),10),this.proto=d.shift(),this.format=d.join(" "),e=0,g=b.length;g>e;e++){var i,j=b[e].substr(2);switch(b[e].substr(0,2)){case"i=":this.title=j;break;case"c=":if(this.connection=new h(j),!this.connection)return!1;break;case"b=":this.bandwidth.push(j);break;case"k=":this.key=j;break;case"a=":i=j.indexOf(":"),-1===i?(f=j,j=null):(f=j.substr(0,i),j=j.substr(i+1)),this.addAttribute(f,j);break;default:return m.log("Unexpected type (within media): "+b[e]),!1}}return!0},j.prototype.toString=function(){var a,b,c,d,e,f,g="";for(g+=this.media+" ",g+=this.port+" ",g+=this.proto+" ",g+=this.format,this.title&&(g+=n+"i="+this.title),this.connection&&(g+=n+"c="+this.connection),a=0,d=this.bandwidth.length;d>a;a++)g+=n+"b="+this.bandwidth[a];for(this.key&&(g+=n+"k="+this.key),a=0,d=this.attributeNameOrder.length;d>a;a++)for(b=this.attributeNameOrder[a],c=this.attributes[b],e=0,f=c.length;f>e;e++)g+=n+"a="+b,c[e]&&(g+=":"+c[e]);return g},j.prototype.parseFileAttributes=function(){var a,b,c,d,e={},g=0,h={};if(!this.attributes["file-selector"])return null;for(var i=this.attributes["file-selector"][0];g<i.length;)if(" "!==i.charAt(g)){if(a=i.indexOf(":",g),-1===a)break;if(b=i.slice(g,a),g=a+1,'"'===i.charAt(g)){if(g++,d=i.indexOf('"',g),-1===d)break;c=i.slice(g,d),g=d+1}else if("type"===b){var j=!1;for(d=g;d<i.length&&(j||" "!==i.charAt(d));)'"'===i.charAt(d)&&(j=!j),d++;c=i.slice(g,d),g=d+1}else d=i.indexOf(" ",g),-1===d&&(d=i.length),c=i.slice(g,d),g=d+1;switch(b){case"name":h.name=f(c);break;case"size":h.size=parseInt(c,10);break;case"type":h.type=c;break;case"hash":h.hash||(h.hash={}),a=c.indexOf(":"),h.hash[c.substring(0,a)]=c.substring(a+1);break;default:continue}}else g++;return e.selector=h,e.id=this.attributes["file-transfer-id"][0],e.disposition=this.attributes["file-disposition"][0]||"render",this.title&&(e.description=this.title),this.attributes["file-icon"]&&(e.icon=this.attributes["file-icon"][0]),e},j.prototype.isSending=function(){return this.attributes.recvonly||this.attributes.inactive?!1:!0},j.prototype.isReceiving=function(){return this.attributes.sendonly||this.attributes.inactive?!1:!0},k.prototype.reset=function(){this.version=0,this.origin=new g,this.sessionName=" ",this.sessionInfo=null,this.uri=null,this.email=null,this.phone=null,this.connection=new h,this.bandwidth=[],this.timing=[new i],this.timezone=null,this.key=null,this.resetAttributes(),this.media=[]},k.prototype.addAttribute=function(a,b){this.attributes[a]||(this.attributes[a]=[],this.attributeNameOrder.push(a)),this.attributes[a].push(b)},k.prototype.removeAttribute=function(a){this.attributes[a]&&(delete this.attributes[a],this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1))},k.prototype.replaceAttribute=function(a,b,c){this.attributes[a]&&(delete this.attributes[a],this.addAttribute(b,c),this.attributeNameOrder.splice(this.attributeNameOrder.lastIndexOf(b),1),this.attributeNameOrder.splice(this.attributeNameOrder.indexOf(a),1,b))},k.prototype.resetAttributes=function(){this.attributeNameOrder=[],this.attributes={}},k.prototype.parse=function(a){var b,c,d,e,f=a.split(n);if(this.reset(),""===f[f.length-1]&&f.pop(),f.length<4)return m.log("Unexpected SDP length: "+f.length),!1;if(b=f.shift(),"v=0"!==b)return m.log("Unexpected SDP version: "+b),!1;if(b=f.shift(),"o="!==b.substr(0,2)||!(this.origin=new g(b.substr(2))))return m.log("Unexpected SDP origin: "+b),!1;if(b=f.shift(),"s="!==b.substr(0,2))return m.log("Unexpected SDP session name: "+b),!1;for(this.sessionName=b.substr(2);f.length>0&&"t"!==f[0].charAt(0);)switch(b=f.shift(),c=b.substr(2),b.substr(0,2)){case"i=":this.sessionInfo=c;break;case"u=":this.uri=c;break;case"e=":this.email=c;break;case"p=":this.phone=c;break;case"c=":if(c=new h(c),!c)return!1;this.connection=c;break;case"b=":this.bandwidth.push(c);break;default:return m.log("Unexpected SDP line (pre-timing): "+b),!1}if(0===f.length)return m.log("Unexpected end of SDP (pre-timing)"),!1;for(this.timing=[];f.length>0&&"t"===f[0].charAt(0);){for(b=f.shift().substr(2);f.length>0&&"r"===f[0].charAt(0);)b+=n+f.shift();if(c=new i(b),!c)return!1;this.timing.push(c)}if(0===this.timing.length)return m.log("No timing line found"),!1;for(;f.length>0&&"m"!==f[0].charAt(0);)switch(b=f.shift(),c=b.substr(2),b.substr(0,2)){case"z=":this.timezone=c;break;case"k=":this.key=c;break;case"a=":d=c.indexOf(":"),-1===d?(e=c,c=null):(e=c.substr(0,d),c=c.substr(d+1)),this.addAttribute(e,c);break;default:return m.log("Unexpected SDP line (pre-media): "+b),!1}for(;f.length>0&&"m"===f[0].charAt(0);){for(b=f.shift().substr(2);f.length>0&&"m"!==f[0].charAt(0);)b+=n+f.shift();if(c=new j(b),!c)return!1;this.media.push(c)}return!0},k.prototype.toString=function(){var a,b,c,d,e,f,g="";for(g+="v="+this.version+n,g+="o="+this.origin+n,g+="s="+this.sessionName+n,this.sessionInfo&&(g+="i="+this.sessionInfo+n),this.uri&&(g+="u="+this.uri+n),this.email&&(g+="e="+this.email+n),this.phone&&(g+="p="+this.phone+n),this.connection&&(g+="c="+this.connection+n),a=0,d=this.bandwidth.length;d>a;a++)g+="b="+this.bandwidth[a]+n;for(a=0,d=this.timing.length;d>a;a++)g+="t="+this.timing[a]+n;for(this.timezone&&(g+="z="+this.timezone+n),this.key&&(g+="k="+this.key+n),a=0,d=this.attributeNameOrder.length;d>a;a++)for(b=this.attributeNameOrder[a],c=this.attributes[b],e=0,f=c.length;f>e;e++)g+="a="+b,c[e]&&(g+=":"+c[e]),g+=n;for(a=0,d=this.media.length;d>a;a++)g+="m="+this.media[a]+n;return g},k.prototype.isHeld=function(){var a,b,c;for(a=0,b=this.media.length;b>a;a++)switch(c=this.media[a],c.media){case"audio":case"video":if(c.isReceiving())return!1}return!0}},{"js-logger":2}],60:[function(a,b,c){(function(c){"use strict";function d(a,b){for(var c,d,e=new r.Session(a.sdp),f=["sendrecv","sendonly","recvonly","inactive"],g=!1,h=0,i=e.media.length;i>h;h++){var j=e.media[h],k=b[j.media+"Out"],l=b[j.media+"In"];if("application"!==j.media){c=null;for(var m=0,n=f.length;n>m;m++){var o=f[m];j.attributes[o]&&(c=o)}null===c&&(c="sendrecv",j.addAttribute(c,null),g=!0),d=k?l?"sendrecv":"sendonly":l?"recvonly":"inactive",c!==d&&(j.replaceAttribute(c,d,null),g=!0)}}g&&(a.sdp=e.toString())}function e(a,b){if(!a.compat.supportsIncomingRTXcodec()){var c=b.match(/a=ssrc-group:FID.* ([0-9]+)\r?\n/);if(c&&c.length>=2){var d=c[1];b=b.replace(/a=rtpmap:96 rtx.*\r?\n/,""),b=b.replace(/a=fmtp:96 apt=100.*\r?\n/,""),b=b.replace(/a=ssrc-group:FID.*\r?\n/,"");var e=new RegExp("a=ssrc:"+d+".*\r?\n","g");b=b.replace(e,"")}}return b}function f(a,b){return a.compat.supportsIceServerUrlsArray()?b:k.map(b,function(a){return k.isArray(a.urls)?a.url=a.urls[0]:a.url=a.urls,a})}function g(a,b){var c=Date.now(),d=!1,e=setTimeout(function(){F.log("Proceeding without null candidate!",Date.now()-c),e=null,d||(d=!0,b(a.localDescription.sdp))},5e3);a.onicecandidate=function(f){F.log("onicecandidate",Date.now()-c,f.candidate),f.candidate||(e&&(clearTimeout(e),e=null),this.onicecandidate=null,d||(d=!0,b(a.localDescription.sdp)))}}function h(a){var b=function(){F.log("PC: signalling state change:",this.signalingState)};"onsignalingstatechange"in a?a.onsignalingstatechange=b:"onstatechange"in a&&(a.onstatechange=b);var c=function(){F.log("PC: ICE connection state change:",this.iceConnectionState)};"oniceconnectionstatechange"in a?a.oniceconnectionstatechange=c:"onicechange"in a&&(a.onicechange=c)}function i(a,b){a.srcObject=b,c.URL.createObjectURL&&(a.src=c.URL.createObjectURL(b)),a.play()}function j(a,b,c,d,e){this.webrtcApi=a,this.sipSession=b,this.state=y.PENDING,this.pcConfig={iceServers:f(a,d)},this.pcConstraints=e,this.peerConnection=null,this.oldPeerConnection=null,this.videoConstraints=null,this.audioConstraints=null,this.localStream=null,this.externalStream=null,this.accepted=!1,this.offerOutstanding=!1,this.remoteHold=!1,this.remoteHoldStreams=null,this.localHold=!1,this.localHoldStreams=null,this.dtmfSender=null,this.transferFeedback=null,this.recordingSession=null,this.recordingInitiator=!1,this.renegotiateRecording=null,this.remoteCapabilities={},this.renegotiatingMedia=!1,this.remoteWebrtcStreams=null,this.oldRemoteWebrtcStreams=null,this.localWebrtcStream=null,this.address=c,this.remoteAddress=c,this.localAddress=this.webrtcApi.sdk.getDeviceAddress(),this.displayName=null,this.customHeaders=null,this.streamConfig=null,this.followRedirects=!1,this.remoteAudioElement=null,this.remoteVideoElement=null,this.localVideoElement=null,this._initPeerConnection(),this._initSipSession()}b.exports=j;var k="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,l=a("js-logger"),m=a("wolfy87-eventemitter"),n=a("jssip"),o=a("jssip/lib/WebRTC"),p=a("jssip/lib/RTCSession"),q=a("../sdk-address"),r=a("./sdp"),s=a("./stream-config"),t=a("./stream"),u=a("./custom-headers"),v=a("./exceptions"),w=a("./util"),x=a("./recording"),y={PENDING:"pending",ESTABLISHED:"established",CLOSED:"closed"},z=90,A=90,B="X-AcisionSDK-RecordingSession",C="X-AcisionSDK-MediaStreamData",D="+changefp",E="toggle-recording",F=l.get("SDK:RTC:Session"),G=function(a){this.session=a};G.prototype.onAccepted=function(){this.session.close()},G.prototype.onRejected=function(){this.session.close()},G.prototype._getJsSipHandlers=function(){var a=this;return{accepted:function(){w.fireEvent(a,"onAccepted",{},!0)},failed:function(){a.session.transferFeedback=null,w.fireEvent(a,"onRejected",{},!0)},notify:function(b){var c=b.data;if(c.finalNotify)switch(a.session.transferFeedback=null,c.sessionEvent){case"started":w.fireEvent(a,"onTransferSucceeded",{});break;case"failed":w.fireEvent(a,"onTransferFailed",{});break;default:w.fireEvent(a,"onTransferResultUnknown",{})}}}};var H=function(a,b){var c=this;this.session=a,this.refer=b,this.timer=setTimeout(function(){c.reject(),c.timer=null},3e4),this.address=b.refer_uri.toString().replace(/^sip:/,"")};H.prototype.accept=function(a,b){if(null!==this.timer){clearTimeout(this.timer),this.timer=null,b=b||{},b.streamConfig||(b.streamConfig=this.session.streamConfig);var c=this.session.webrtcApi.connect(this.address,a,b);return this.refer.addSessionNotifyHandlers(c.sipSession),c}},H.prototype.reject=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null,this.refer.reject({status_code:603}))},j.prototype=new m,j.prototype.constructor=j,j.prototype._initPeerConnection=function(){var a=this.peerConnection=new o.RTCPeerConnection(this.pcConfig,this.pcConstraints);h(a),a.onnegotiationneeded=this._handleNegotiationNeeded.bind(this),a.onaddstream=this._handleAddStream.bind(this),a.onremovestream=this._handleRemoveStream.bind(this)},j.prototype._initSipSession=function(){var a=this;this.sipSession.on("progress",function(){w.fireEvent(a,"onProvisional",{})}),this.sipSession.on("started",this._handleStarted.bind(this)),this.sipSession.on("ended",function(b){var c=b.data;if("local"!==c.originator){var d=w.jsSipCauseToSdkStatus(c.cause);a.sipSession=null,"system"===c.originator&&c.cause===n.C.causes.SESSION_TIMER&&a.recordingSession&&(a.recordingInitiator=!0),a.close(d)}}),this.sipSession.on("failed",function(b){if(b.data.cause!==n.C.causes.REDIRECTED||!b.data.message.hasHeader("contact")||!a._handleRedirect(b.data.message)){var c=w.jsSipCauseToSdkStatus(b.data.cause);a.sipSession=null,a.close(c)}}),this.sipSession.on("reinvite",this._handleReinvite.bind(this)),this.sipSession.on("refresh",this._handleRefresh.bind(this)),this.sipSession.contact&&this.webrtcApi.sdk.config.resetOnRenegotiate&&(this.sipSession.contact+=";"+D)},j.prototype._replacePeerConnection=function(){this.oldPeerConnection=this.peerConnection,this._initPeerConnection()},j.prototype._rollbackPeerConnection=function(){this.oldPeerConnection&&(this.peerConnection.close(),this.peerConnection=this.oldPeerConnection,this.oldPeerConnection=null),this.oldRemoteWebrtcStreams&&(this.remoteWebrtcStreams=this.oldRemoteWebrtcStreams,this.oldRemoteWebrtcStreams=null)},j.prototype._acceptRecordingChange=function(){"disabling"===this.renegotiateRecording&&(this.recordingInitiator&&this.recordingSession.stop(function(a){a&&F.warn("Failed to stop recording session")}),this.recordingSession=null,this.recordingInitiator=!1),this.renegotiateRecording=null},j.prototype._rollbackRecordingChange=function(){"enabling"===this.renegotiateRecording&&(this.recordingInitiator&&this.recordingSession.stop(function(a){a&&F.warn("Failed to stop recording session")}),this.recordingSession=null,this.recordingInitiator=!1),this.renegotiateRecording=null},j.prototype._getUserMedia=function(a,b){var c=this,d=a||this.streamConfig,e={audio:d.audioOut,video:d.videoOut};d.videoOut&&(d.mandatoryVideoConstraints||d.optionalVideoConstraints)&&(e.video={mandatory:d.mandatoryVideoConstraints||{},optional:d.optionalVideoConstraints||[]});var f=this.localStream;if(f){var g=this.oldPeerConnection||this.peerConnection;g.removeStream(f),f.stop(),this.localStream=null,this.renegotiatingMedia=!0}var h=function(a){if(c.state===y.CLOSED)return void a.stop();c._setLocalWebrtcStream(a);var d=c.localVideoElement;F.log("Got local media stream"),c.localStream=a,c.peerConnection.addStream(a),e.video&&d&&(i(d,a),d.muted=!0),b()},j=function(a){F.warn("getUserMedia failed:",a),c.close()};return e.audio&&(this.audioConstraints&&w.isType(e.audio,"boolean")?e.audio=this.audioConstraints:w.isType(e.audio,"object")&&(this.audioConstraints=e.audio)),e.video&&(this.videoConstraints&&w.isType(e.video,"boolean")?e.video=this.videoConstraints:w.isType(e.video,"object")&&(this.videoConstraints=e.video)),e.audio||e.video?(F.log("Requesting user media:",e),void o.getUserMedia(e,h,j)):void setTimeout(function(){b()},0)},j.prototype._createOffer=function(a,b){var c,e=this,f=this.peerConnection,h=a||this.streamConfig,i=function(){if(!e.recordingInitiator||"disabling"===e.renegotiateRecording)return void b(f.localDescription.sdp);var a=e.webrtcApi.sdk,c={endpointSdp:f.localDescription.sdp,sdpType:"offer"};return e.recordingSession?(F.debug("Updating recording session, local endpoint"),void e.recordingSession.updateEndpoint(a.getDeviceAddress(),c,function(a,c){return a?(F.warn("Failed to update recording session:",a),void e.close()):void b(c)})):(F.debug("Requesting recording session"),c.localAddress=a.getDeviceAddress(),c.remoteAddress=e.address,c.sdpSource="local",c.timeout=z,e.sipSession.id&&(c.callid=e.sipSession.id.slice(0,-e.sipSession.from_tag.length)),void x.createSession(a,c,function(a,c,d){return a?(F.warn("Failed to create recording session:",a),void e.close()):(e.recordingSession=c,void b(d))}))},j=function(){F.log("Local description set, ice gathering state:",f.iceGatheringState),"complete"===f.iceGatheringState?i():g(f,i)},k=function(a){F.warn("setLocalDescription failed:",a),e.close()},l=function(a){F.log("Offer created"),d(a,h),f.setLocalDescription(a,j,k)},m=function(a){F.warn("createOffer failed:",a),e.close()};c=this.webrtcApi.compat.supportsRTCOfferOptionsDict()?{offerToReceiveAudio:h.audioIn?1:0,offerToReceiveVideo:h.videoIn?1:0}:this.webrtcApi.compat.requiresInactiveStreams()?{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}:{mandatory:{OfferToReceiveAudio:h.audioIn,OfferToReceiveVideo:h.videoIn}};try{f.createOffer(l,m,c)}catch(n){F.warn("createOffer failed:",n.stack),e.close()}},j.prototype._handleAnswer=function(a,b,c){var d=this,f=function(a){F.log("Setting remote description");var f=new o.RTCSessionDescription({type:"answer",sdp:e(d.webrtcApi,a)});d.peerConnection.setRemoteDescription(f,b,c)};if(!this.recordingInitiator)return void f(a);if(!this.recordingSession)return F.error("Unexpected recording state - handling answer with no session"),void this.close();F.debug("Updating recording session, remote endpoint");var g={endpointSdp:a,sdpType:"answer"};this.recordingSession.updateEndpoint(this.address,g,function(a,b){return a?void c("Failed to update recording session:",a):void f(b)})},j.prototype._handleOffer=function(a,b,c){var d=this,f=function(a){F.log("Setting remote description");var f=new o.RTCSessionDescription({type:"offer",sdp:e(d.webrtcApi,a)});d.peerConnection.setRemoteDescription(f,b,c)};if(!d.recordingInitiator||"disabling"===d.renegotiateRecording)return void f(a);var g={endpointSdp:a,sdpType:"offer"};if(!d.recordingSession){var h=d.webrtcApi.sdk;return F.debug("Requesting recording session"),g.localAddress=h.getDeviceAddress(),g.remoteAddress=d.address,g.sdpSource="remote",d.sipSession.id&&(g.callid=d.sipSession.id.slice(0,-d.sipSession.from_tag.length)),void x.createSession(h,g,function(a,b,c){return a?(F.warn("Failed to create recording session:",a),void d.close()):(d.recordingSession=b,void f(c))})}F.debug("Updating recording session, remote endpoint"),this.recordingSession.updateEndpoint(this.address,g,function(a,b){return a?void c("Failed to update recording session:",a):void f(b)})},j.prototype._createAnswer=function(a){var b=this,c=this.peerConnection,e=function(){if(!b.recordingInitiator)return void a(c.localDescription.sdp);if(!b.recordingSession)return F.error("Unexpected recording state - creating answer with no session"),void b.close();F.debug("Updating recording session, local endpoint");var d=b.webrtcApi.sdk,e={endpointSdp:c.localDescription.sdp,sdpType:"answer"};b.recordingSession.updateEndpoint(d.getDeviceAddress(),e,function(c,d){return c?(F.warn("Failed to update recording session:",c),void b.close()):void a(d)})},f=function(){F.log("Local description set, ice gathering state:",c.iceGatheringState),"complete"===c.iceGatheringState?e():g(c,e)},h=function(a){F.warn("setLocalDescription failed:",a),b.close()},i=function(a){F.log("Answer created"),d(a,b.streamConfig),c.setLocalDescription(a,f,h)},j=function(a){F.warn("createOffer failed:",a),b.close()},k=null;c.createAnswer(i,j,k)},j.prototype._updateIceServers=function(a){if(this.pcConfig.iceServers=f(this.webrtcApi,a),this.peerConnection.setConfiguration)this.peerConnection.setConfiguration(this.pcConfig);else try{this.peerConnection.updateIce(this.pcConfig)}catch(b){F.warn("Could not update ICE:",b.message)}},j.prototype._setRemoteStreamOutput=function(){var a,b=this.peerConnection;if(!this.hasOwnProperty("onAddStream")){a=b.getRemoteStreams?b.getRemoteStreams():b.remoteStreams;for(var c=0,d=a.length;d>c;c++)this._handleAddStream({stream:a[c]})}},j.prototype._handleAddStream=function(a){var b=a.stream.id;if(!this.remoteWebrtcStreams[b]){var c=this.address,d=this.address;this.remoteWebrtcStreams[b]=new t(this,b,c,d)}a.webrtcStream=this.remoteWebrtcStreams[b],this.remoteWebrtcStreams[b].setStream(a.stream),w.fireEvent(this,"onAddStream",a,!0)},j.prototype._handleRemoveStream=function(a){a.webrtcStream=this.remoteWebrtcStreams[a.stream.id],null==a.webrtcStream&&null!=this.oldRemoteWebrtcStreams&&(a.webrtcStream=this.oldRemoteWebrtcStreams[a.stream.id]),w.fireEvent(this,"onRemoveStream",a,!1)},j.prototype._connect=function(a,b,c,d,e){var f=this;this.streamConfig=b||new s,this.customHeaders=new u(c),e&&(this.followRedirects=!0),d&&x.isEnabled(this.webrtcApi.sdk)&&(this.recordingInitiator=!0),a?(this.setLocalStream(a),this._sendInvite()):this._getUserMedia(null,function(){f._sendInvite()})},j.prototype._sendInvite=function(){var a=this;this._createOffer(null,function(b){var c={};if(c.sdp=b,c.extraHeaders=a.customHeaders.toExtraHeaders(),c.extraHeaders.push("Expires: "+z),c.extraHeaders.push("Session-Expires: "+A),a.recordingInitiator&&a.recordingSession&&c.extraHeaders.push(B+": "+a.recordingSession.id),c.featureTags=a.webrtcApi.sdk.config.resetOnRenegotiate?";"+D:"",a.sipSession.connect(a.address,c),a.recordingInitiator&&a.recordingSession){var d={callid:a.sipSession.id.slice(0,-a.sipSession.from_tag.length)};a.recordingSession.updateMetadata(d,function(a){return a?void F.warn("Failed to update recording session metadata: "+a):void F.debug("Update recording session metadata")})}w.fireEvent(a,"onConnecting",{})})},j.prototype._sendReinvite=function(a,b){var c=this;b=b||this.customHeaders,this._createOffer(a,function(a){var d={};d.sdp=a,d.extraHeaders=b.toExtraHeaders(),c.recordingSession&&"disabling"!==c.renegotiateRecording&&d.extraHeaders.push(B+": "+c.recordingSession.id),c.sipSession.sendReinvite(d)})},j.prototype._handleNegotiationNeeded=function(){return this.state!==y.ESTABLISHED?void F.log("Ignoring negotiationneeded event - session not established"):this.offerOutstanding?void F.log("Ignoring negotiationneeded event - already due"):(F.log("Starting O/A negotiation at PC's request"),this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&this._replacePeerConnection(),void this._sendReinvite())},j.prototype._updateRemoteWebrtcStreams=function(a){var b;this.oldRemoteWebrtcStreams=this.remoteWebrtcStreams,this.remoteWebrtcStreams={},k.each(a,function(a,c){null!=this.oldRemoteWebrtcStreams&&(b=this.oldRemoteWebrtcStreams[c])?(this.remoteWebrtcStreams[c]=b,b.address=a.address,b.deviceAddress=a.deviceAddress):this.remoteWebrtcStreams[c]=new t(this,c,a.address,a.deviceAddress)},this)},j.prototype._commitRemoteWebrtcStreams=function(){var a=this;k.each(this.oldRemoteWebrtcStreams,function(b){if(!(b.streamId in a.remoteWebrtcStreams)){var c={stream:b.stream,webrtcStream:b};w.fireEvent(a,"onRemoveStream",c,!1)}}),this.oldRemoteWebrtcStreams=null},j.prototype._handleInitialInvite=function(a,b,c,d){this.streamConfig=new s(b),this.customHeaders=new u(a);var e=a.parseHeader("contact");this.remoteCapabilities=e.parameters;var f=q.parse(this.webrtcApi.sdk,this.localAddress);f.parameters=a.parseHeader("to").uri.parameters,this.localAddress=f.toString();var g=q.parse(this.webrtcApi.sdk,this.remoteAddress);g._setDeviceIdFromParameters(e.uri.parameters),this.remoteAddress=g.toString();var h=a.getHeader(B);h&&(this.recordingSession=new x.RecordingSession(this.webrtcApi.sdk,h));var i=a.getHeader(C);try{this._updateRemoteWebrtcStreams(JSON.parse(i||null));
}catch(j){return void d(j)}return!this.recordingSession&&x.isEnabled(this.webrtcApi.sdk)?(this.initialInvite=a,void c()):void this._handleOffer(a.body,c,d)},j.prototype._handleStarted=function(a){var b=a.data.response;if(this.state=y.ESTABLISHED,b){var c=this,d=b.body;this.streamConfig=new s(new r.Session(d),this.streamConfig);var e=b.parseHeader("contact");this.remoteCapabilities=e.parameters;var f=q.parse(this.webrtcApi.sdk,this.remoteAddress);if(f._setDeviceIdFromParameters(e.uri.parameters),this.remoteAddress=f.toString(),!this.recordingSession){var g=b.getHeader(B);g&&(this.recordingSession=new x.RecordingSession(this.webrtcApi.sdk,g))}var h=function(){F.log("Remote answer set"),w.fireEvent(c,"onConnect",{})},i=function(a){F.warn("setRemoteDescription failed:",a),c.sipSession.terminate({status_code:488}),c.sipSession=null,c.close()},j=b.getHeader(C);try{this._updateRemoteWebrtcStreams(JSON.parse(j||null))}catch(k){return void i(k)}this._handleAnswer(d,h,i)}},j.prototype._handleReinvite=function(a){var b,c,d=this,e=a.data;if("remote"===e.originator){this.offerOutstanding=!0;var f=e.sdp,g=new r.Session(f),h=!1,i=!1;g||e.reinvite.sdpInvalid();var j=new s(g,this.streamConfig),k=new u(e.request);if(this.remoteHold&&j.isSending()){var l=this.remoteHoldStreams,m=j.getSendingStreams();for(b=0,c=m.length;c>b;b++)-1===l.indexOf(m[b])&&(F.warn("Remote UA tried to activate additional stream during resume:",m[b]),e.reinvite.sdpInvalid())}else j.equals(this.streamConfig)||(F.log("re-INVITE changing stream configuration from %s to %s",JSON.stringify(j),JSON.stringify(this.streamConfig)),h=!0),k.equals(this.customHeaders)||(F.log("re-INVITE changing custom headers"),i=!0);var n=e.request.getHeader(B);n?this.recordingSession?this.recordingSession.id!==n&&(F.warn("Recording session ID changed"),this.recordingSession=new x.RecordingSession(this.webrtcApi.sdk,n)):(this.renegotiateRecording="enabling",this.recordingSession=new x.RecordingSession(this.webrtcApi.sdk,n)):this.recordingSession&&this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&(this.renegotiateRecording="disabling"),this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&(this.renegotiateRecording||!this.recordingSession)&&this._replacePeerConnection();var o=function(){var a=d.streamConfig;F.log("Remote offer set"),e.reinvite.sdpValid();var b=function(b){b?d.streamConfig=new s(b,d.streamConfig):d.streamConfig=j,d.customHeaders=k,d._acceptRecordingChange();var c=function(){d._createAnswer(function(a){e.reinvite.accept({sdp:a})})};d.externalStream||d.remoteHold||d.streamConfig.sendingStreamsEqual(a)?(d.oldPeerConnection&&d.peerConnection.addStream(d.localStream||d.externalStream),c()):d._getUserMedia(null,c)};if(d.renegotiateRecording||!a.isSending()||j.isSending())if(!d.renegotiateRecording&&d.remoteHold&&j.isSending())b(),d.remoteHold=!1,w.fireEvent(d,"onResume",{});else{var c=function(){e.reinvite.reject({status_code:488}),d._rollbackRecordingChange(),d._rollbackPeerConnection()},f=!0;a.isSafeChange(j)||(f=!1),"enabling"===d.renegotiateRecording&&(f=!1),w.fireEvent(d,"onRenegotiateRequest",{streamConfig:h?j:null,customHeaders:i?k:null,safe:f,recording:(null!==d.recordingSession||"enabling"===d.renegotiateRecording)&&"disabling"!==d.renegotiateRecording,accept:b,reject:c},!0)}else d.remoteHold=!0,d.remoteHoldStreams=a.getSendingStreams(),b(),w.fireEvent(d,"onHold",{})},p=function(a){F.warn("setRemoteDescription failed:",a),e.reinvite.sdpInvalid(),d._rollbackRecordingChange(),d._rollbackPeerConnection()},q=e.request.getHeader(C);if(q)try{this._updateRemoteWebrtcStreams(JSON.parse(q))}catch(t){return void p(t)}this._handleOffer(f,o,p)}else e.reinvite.on("succeeded",function(a){var b=function(){F.log("Remote answer set")},c=function(a){F.warn("setRemoteDescription failed:",a),d.sipSession.terminate({status_code:488}),d.sipSession=null,d.close()},f=a.data.sdp;F.log("Received remote description"),d.streamConfig=new s(new r.Session(f),d.streamConfig),d.customHeaders=new u(e.request);var g=a.data.response,h=g.getHeader(C);if(h)try{d._updateRemoteWebrtcStreams(JSON.parse(h))}catch(i){return void c(i)}d._acceptRecordingChange(),d._handleAnswer(f,b,c),w.fireEvent(d,"onRenegotiateResponse",{accepted:!0})}),e.reinvite.on("failed",function(a){F.log("Reinvite failed",a.data),d._rollbackPeerConnection(),w.fireEvent(d,"onRenegotiateResponse",{accepted:!1}),"stable"!==d.peerConnection.signalingState||d.renegotiatingMedia?(F.log("PeerConnection unstable, closing session",d.peerConnection.signalingState,d.renegotiatingMedia),d.close()):F.log("PeerConnection stable, continuing session")});e.reinvite.on("completed",function(){d.offerOutstanding=!1,d.oldPeerConnection&&(d.oldPeerConnection.close(),d.oldPeerConnection=null),d.oldRemoteWebrtcStreams&&d._commitRemoteWebrtcStreams(),d.renegotiatingMedia=!1,d.peerConnection&&"stable"!==d.peerConnection.signalingState&&F.warn("Renegotiation left PeerConnection in unstable state:",d.peerConnection.signalingState),w.fireEvent(d,"onRenegotiateComplete",{})})},j.prototype._handleRefresh=function(){this.sipSession.isMethodAllowed(n.C.UPDATE,!1)?this.sipSession.sendUpdate():this._sendReinvite()},j.prototype._handleRefer=function(a){var b=new H(this,a);w.fireEvent(this,"onTransferRequest",b,!0)},j.prototype._handleRedirect=function(a){var b=a.getHeader("contact").replace(/^</,"").replace(/>.*/,"").replace(/^sip:/,"").replace(/;transport=ws$/,"");return w.fireEvent(this,"onRedirect",{target:b}),this.followRedirects?(F.info("Redirecting to: ",b),this.address=b,this.recordingInitiator&&this.recordingSession&&(this.recordingSession.stop(function(a){a&&F.warn("Failed to stop recording session:",a)}),this.recordingSession=null),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this._initPeerConnection(),this.externalStream?this.peerConnection.addStream(this.externalStream):this.peerConnection.addStream(this.localStream),this.sipSession=new p(this.webrtcApi.ua),this._initSipSession(),this._sendInvite(),!0):!1};var I={onConnecting:!0,onProvisional:!0,onConnect:!0,onClose:!0,onRenegotiateRequest:!0,onRenegotiateResponse:!0,onRenegotiateComplete:!0,onHold:!0,onResume:!0,onTransferRequest:!0,onRedirect:!0,onAddStream:!0,onRemoveStream:!0};j.prototype.setCallbacks=function(a){for(var b in a)a.hasOwnProperty(b)&&(I[b]?this[b]=a[b]:F.warn("Unsupported callback: ",b))},j.prototype.setLocalStream=function(a){var b,c;if(this.localStream)throw new v.StateError("Cannot mix external and internal streams");this._setLocalWebrtcStream(a),this.externalStream=a;var d=this.peerConnection.getLocalStreams();for(b=0,c=d.length;c>b;b++)d[b]!==a&&this.peerConnection.removeStream(d[b]);this.peerConnection.addStream(a)},j.prototype.getLocalStreams=function(){if(!this.peerConnection)throw new v.StateError("Cannot get streams for closed session");return this.peerConnection.getLocalStreams()},j.prototype.getRemoteStreams=function(){if(!this.peerConnection)throw new v.StateError("Cannot get streams for closed session");return this.peerConnection.getRemoteStreams()},j.prototype._setLocalWebrtcStream=function(a){var b=a.id,c=this.webrtcApi.sdk.getAddress(),d=this.webrtcApi.sdk.getDeviceAddress();this.localWebrtcStream=new t(this,b,c,d)},j.prototype.getLocalWebrtcStream=function(){return this.localWebrtcStream},j.prototype.getRemoteWebrtcStreams=function(){return k.toArray(this.remoteWebrtcStreams)},j.prototype.accept=function(a,b){var d=this;if(a&&(a instanceof s?this.streamConfig=a:this.streamConfig=new s(a)),this.state!==y.PENDING)throw new v.StateError("Session cannot be accepted in state",this.state);if("incoming"!==this.sipSession.direction)throw new v.StateError("Cannot call accept() on outgoing sessions");var e=function(){d._createAnswer(function(a){if(d.state===y.PENDING){/Firefox/.test(c.navigator&&navigator.userAgent)&&d._setRemoteStreamOutput();var b=[];d.recordingInitiator&&b.push(B+": "+d.recordingSession.id),d.sipSession.answer({sdp:a,extraHeaders:b}),w.fireEvent(d,"onConnect",{})}})},f=function(){d.externalStream?e():d._getUserMedia(null,e),d._setRemoteStreamOutput()};if(!this.recordingSession&&x.isEnabled(this.webrtcApi.sdk)){var g=this.initialInvite.body,h=function(a){F.warn("setRemoteDescription failed:",a),d.sipSession.terminate({status_code:488}),d.sipSession=null,d.close()};return b&&b.record&&!this.recordingSession&&(this.recordingInitiator=!0),void this._handleOffer(g,f,h)}f()},j.prototype.isRecording=function(){return null!==this.recordingSession&&"enabling"!==this.renegotiateRecording},j.prototype.checkRemoteFeature=function(a){if(a===E)return this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate;throw new v.ValueError("Unknown feature: "+a)},j.prototype.hold=function(){if(!this.localHold){if(this.offerOutstanding)throw new v.StateError("Existing renegotiation still in progress");this.localHold=!0,this.offerOutstanding=!0;for(var a=this.localStream.getVideoTracks(),b=this.localStream.getAudioTracks(),c=a.concat(b),d=0,e=c.length;e>d;d++)c[d].enabled=!1;var f=new s(this.streamConfig);this.localHoldStreams=f.hold(),this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&!this.recordingSession&&this._replacePeerConnection(),this._sendReinvite(f)}},j.prototype.resume=function(){if(this.localHold){if(this.offerOutstanding)throw new v.StateError("Existing renegotiation still in progress");this.offerOutstanding=!0;var a=new s(this.streamConfig);a.resume(this.localHoldStreams),this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&!this.recordingSession&&this._replacePeerConnection(),this._sendReinvite(a);for(var b=this.localStream.getVideoTracks(),c=this.localStream.getAudioTracks(),d=b.concat(c),e=0,f=d.length;f>e;e++)d[e].enabled=!0;this.localHold=!1}},j.prototype.renegotiate=function(a){a||(a={});var b=a.streamConfig,c=a.customHeaders,d=null;if(!this.recordingSession&&a.record?d="enabling":this.recordingSession&&a.record===!1&&(d="disabling"),b&&(b=new s(b,this.streamConfig)),c&&(c=new u(c)),(this.localHold||this.remoteHold)&&b)throw new v.StateError("Cannot modify streams whilst on hold");if(this.offerOutstanding)throw new v.StateError("Existing renegotiation still in progress");if(this.offerOutstanding=!0,this.remoteCapabilities.hasOwnProperty(D)&&this.webrtcApi.sdk.config.resetOnRenegotiate&&(d||!this.recordingSession))this._replacePeerConnection();else if(d)throw new v.UnsupportedError("Remote party does not fully support renegotiation");if(a.stream&&this.setLocalStream(a.stream),d&&(this.renegotiateRecording=d,"enabling"===d&&(this.recordingInitiator=!0)),b&&!this.externalStream){var e=this;this._getUserMedia(b,function(){e._sendReinvite(b,c)})}else a.stream||this.peerConnection.addStream(this.localStream),this._sendReinvite(b,c)},j.prototype.mute=function(){if(this.localStream)for(var a=this.localStream.getAudioTracks(),b=0,c=a.length;c>b;b++)a[b].enabled=!1},j.prototype.unmute=function(){if(this.localStream){if(this.localHold)throw new v.StateError("Cannot unmute a held call");for(var a=this.localStream.getAudioTracks(),b=0,c=a.length;c>b;b++)a[b].enabled=!0}},j.prototype.sendDTMF=function(a,b){b=b||{};var c=b.type||"pc",d=b.duration||200,e=b.interToneGap||"info"===c?500:50,f=this;if(a=a.toString().toUpperCase(),/[^0-9A-D\*#,]/.test(a))throw new v.ValueError("Invalid characters in DTMF tones:",a);if(d=Math.max(d,70),d=Math.min(d,6e3),e=Math.max(e,50),"info"===c)this.sipSession.sendDTMF(a,{duration:d,interToneGap:e});else{var g=this.dtmfSender;if(g)return void g.insertDTMF(g.toneBuffer+a,g.duration,g.interToneGap);var h=this.localStream.getAudioTracks();if(h.length<1)throw new v.ValueError("Cannot send DTMF without an audio track");g=this.peerConnection.createDTMFSender(h[0]),g.insertDTMF(a,d,e),g.ontonechange=function(a){a.tone||(f.dtmfSender=null)},this.dtmfSender=g}},j.prototype.transfer=function(a){if(this.state!==y.ESTABLISHED)throw new v.StateError("Media session not established: "+this.state);if(this.transferFeedback)throw new v.StateError("Previous transfer outstanding");var b=new G(this),c={};c.eventHandlers=b._getJsSipHandlers();try{this.sipSession.sendRefer(a,c)}catch(d){if(d instanceof n.Exceptions.RemoteSupportError)throw new v.UnsupportedError("Remote party does not support transfers")}return this.transferFeedback=b,b},j.prototype.close=function(a){if(this.state!==y.CLOSED){var b=this.state;if(this.state=y.CLOSED,a||(a="normal"),this.recordingInitiator&&this.recordingSession&&this.recordingSession.stop(function(a){a&&F.warn("Failed to stop recording session:",a)}),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.oldPeerConnection&&(this.oldPeerConnection.close(),this.oldPeerConnection=null),this.localStream&&(this.localStream.stop(),this.localStream=null),this.sipSession){var c=null;if(b===y.PENDING&&"incoming"===this.sipSession.direction){var d=w.sdkStatusToSipStatus("invite",a);c={status_code:d}}try{this.sipSession.terminate(c)}catch(e){F.error("Error terminating SIP session:\n",e.stack)}}this.emitEvent("close"),w.fireEvent(this,"onClose",{status:a})}},j.prototype.redirect=function(a){if(this.sipSession&&this.state===y.PENDING&&"incoming"===this.sipSession.direction){this.state=y.CLOSED;var b="normal";a.indexOf("@")<0&&(a=a.concat("@",this.webrtcApi.sdk.config.defaultDomain));var c={status_code:302,extraHeaders:["Contact: <sip:"+a+">"]};try{this.sipSession.terminate(c)}catch(d){F.error("Error terminating SIP session for redirect:\n",d.stack)}this.emitEvent("close"),w.fireEvent(this,"onClose",{status:b})}},j.prototype.onConnecting=function(){},j.prototype.onProvisional=function(){},j.prototype.onConnect=function(){},j.prototype.onAddStream=function(a){var b,c,d;b=a.stream,c=b.getAudioTracks(),d=b.getVideoTracks(),d.length>0?this.remoteVideoElement?i(this.remoteVideoElement,b):F.log("Video received, but no remoteVideoElement provided"):c.length>0&&(this.remoteAudioElement?i(this.remoteAudioElement,b):F.log("Audio stream received, but no remoteAudioElement provided"))},j.prototype.onRenegotiateRequest=function(a){return a.safe?(F.log("Auto-accepting re-INVITE (no significant changes)"),void a.accept()):(F.log("Auto-rejecting re-INVITE (significant changes)"),void a.reject())},j.prototype.onTransferRequest=function(a){a.reject()},j.prototype.onClose=function(){},j.prototype.onRedirect=function(){}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../sdk-address":53,"./custom-headers":56,"./exceptions":57,"./recording":58,"./sdp":59,"./stream":62,"./stream-config":61,"./util":63,"js-logger":2,jssip:11,"jssip/lib/RTCSession":16,"jssip/lib/WebRTC":34,"wolfy87-eventemitter":43}],61:[function(a,b,c){(function(c){"use strict";function d(a,b){if(a instanceof f.Session)return void this.fromSdp(a);if(a||(a=l),"object"!=typeof a)throw new TypeError("Unexpected streamConfig type: "+typeof a);b&&e.each(h,function(a){b[a]&&(this[a]=b[a])},this),e.each(i,function(b){a[b]?this[b]=!0:this[b]=!1},this),e.each(j,function(b){e.isString(a[b])&&a[b].length>0&&(this[b]=a[b])},this),e.each(k,function(b){a[b]&&(this[b]=a[b])},this)}b.exports=d;var e="undefined"!=typeof window?window._:"undefined"!=typeof c?c._:null,f=a("./sdp"),g=["audio","video"],h=["mandatoryVideoConstraints","optionalVideoConstraints","mediaDescription","_origRemoteDescription","_remoteParsedSdp"],i=["audioIn","audioOut","videoIn","videoOut"],j=["mediaDescription"],k=["mandatoryVideoConstraints","optionalVideoConstraints"],l={audioIn:!0,audioOut:!0,videoIn:!1,videoOut:!1};d.prototype.useSdp=function(){return this.mediaDescription&&this.mediaDescription!==this._origRemoteDescription},d.prototype.fromSdp=function(a){this._remoteParsedSdp=a,e.each(g,function(a){this[a+"In"]=!1,this[a+"Out"]=!1},this),e.each(a.media,function(a){-1!==g.indexOf(a.media)&&0!==a.port&&(this[a.media+"In"]=a.isSending(),this[a.media+"Out"]=a.isReceiving())},this),this.setRemoteSdp(a)},d.prototype.setRemoteSdp=function(a){this.mediaDescription=a.toString(),this._origRemoteDescription=this.mediaDescription},d.prototype.resetRemoteSdp=function(){this.mediaDescription=this._origRemoteDescription},d.prototype.isSending=function(){return this.audioOut||this.videoOut?!0:!1},d.prototype.getSendingStreams=function(){var a=[];return e.each(g,function(b){this[b+"Out"]&&a.push(b)},this),a},d.prototype.hold=function(){var a=[];return e.each(g,function(b){this[b+"In"]&&(a.push(b),this[b+"In"]=!1)},this),a},d.prototype.resume=function(a){e.each(g,function(b){a.indexOf(b)>=0&&(this[b+"In"]=!0)},this)},d.prototype.equals=function(a){return e.every(i,function(b){return this[b]===a[b]},this)},d.prototype.sendingStreamsEqual=function(a){return e.every(g,function(b){return this[b+"Out"]===a[b+"Out"]},this)},d.prototype.isSafeChange=function(a){return e.every(g,function(b){return!a[b+"Out"]||this[b+"Out"]},this)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./sdp":59}],62:[function(a,b,c){"use strict";function d(a,b,c,d){this.session=a,this.streamId=b,this.address=c,this.deviceAddress=d,this.stream=null}b.exports=d,d.prototype.setStream=function(a){this.stream=a},d.prototype.getDeviceAddress=function(){return this.deviceAddress},d.prototype.hasAudio=function(){return this.stream.getAudioTracks().length>0},d.prototype.hasVideo=function(){return this.stream.getVideoTracks().length>0},d.prototype.getMediaStream=function(){return this.stream},d.prototype.attachVideoToView=function(a){var b=URL.createObjectURL(this.stream);a.src=b},d.prototype.getSession=function(){return this.session}},{}],63:[function(a,b,c){"use strict";var d=b.exports={},e=a("js-logger"),f=a("jssip"),g=e.get("SDK:RTC:Util"),h={string:String,"boolean":Boolean,number:Number,"function":Function};d.isType=function(a,b){if(-1===b.lastIndexOf("[]")){if(typeof a===b)return!0;if("object"==typeof a&&a instanceof h[b])return!0}else if(a instanceof Array){for(var c=b.slice(0,-2),e=0,f=a.length;f>e;e++)if(!d.isType(a[e],c))return!1;return!0}return!1},d.jsSipCauseToSdkStatus=function(a){switch(a){case f.C.causes.BUSY:return"normal";case f.C.causes.CONNECTION_ERROR:return"error";case f.C.causes.REQUEST_TIMEOUT:return"offline";case f.C.causes.REJECTED:return"blocked";case f.C.causes.NOT_FOUND:return"notfound";case f.C.causes.UNAVAILABLE:return"offline";default:return"normal"}};var i={options:{normal:200,blocked:403,notfound:404,offline:480},invite:{normal:486,blocked:403,notfound:404,offline:480}};d.sdkStatusToSipStatus=function(a,b){return i[a][b]},d.fireEvent=function(a,b,c,d){if(d||a.hasOwnProperty(b))try{g.log("Firing event "+a.constructor.name+"."+b+":",c),a[b](c)}catch(e){g.warn(a.constructor.name+"."+b+" handler threw exception:\n",e.stack)}else g.log("No handler registered for event "+a.constructor.name+"."+b+":",c)},b.exports=d},{"js-logger":2,jssip:11}]},{},[44])(44)});
//# sourceMappingURL=sdk.min.map