/*!
 * Copyright 2004-2015, AfterLogic Corp.
 * Licensed under AGPLv3 license or AfterLogic license
 * if commerical version of the product was purchased.
 * See the LICENSE file for a full license statement.
 */
!function(e,t,i,n,s){"use strict";function a(){this.ie11=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./),this.ie=/msie/.test(navigator.userAgent.toLowerCase())&&!t.opera||this.ie11,this.ieVersion=this.getIeVersion(),this.ie8AndBelow=this.ie&&this.ieVersion<=8,this.ie9AndBelow=this.ie&&this.ieVersion<=9,this.ie10AndAbove=this.ie&&this.ieVersion>=10,this.opera=!!t.opera||/opr/.test(navigator.userAgent.toLowerCase()),this.firefox=/firefox/.test(navigator.userAgent.toLowerCase()),this.chrome=/chrome/.test(navigator.userAgent.toLowerCase())&&!/opr/.test(navigator.userAgent.toLowerCase()),this.chromeIos=/crios/.test(navigator.userAgent.toLowerCase()),this.safari=/safari/.test(navigator.userAgent.toLowerCase())&&!this.chromeIos}function o(){this.sUrl="?/Ajax/",this.requests=i.observableArray([]),this.openedRequestsCount=i.observable(0),this.requests.subscribe(function(){this.openedRequestsCount(this.requests().length)},this),this.aActionsWithoutAuthForSend=["SystemLogin","SystemUpdateLanguageOnLogin","SystemLogout","AccountCreate","SystemSetMobile","AccountRegister","AccountGetForgotQuestion","AccountValidateForgotQuestion","AccountChangeForgotPassword"],this.aActionsWithoutAuthForSendExt=["SocialRegister","HelpdeskRegister","HelpdeskForgot","HelpdeskLogin","HelpdeskForgotChangePassword","SystemLogout","CalendarList","CalendarEventList","FilesPub"]}function r(){this.openPgp=null,this.openPgpCallbacks=[]}function l(){this.bHtml5=!0,this.init()}function c(e,t){this.pgp=e,this.pgpKeyring=new this.pgp.Keyring(new this.pgp.Keyring.localstore(t)),this.keys=i.observableArray([]),this.reloadKeysFromStorage()}function d(e){this.pgpKey=e;var t=this.pgpKey.getPrimaryUser();this.user=t&&t.user?t.user.userId.userid:this.pgpKey.users&&this.pgpKey.users[0]?this.pgpKey.users[0].userId.userid:"",this.emailParts=F.Address.getEmailParts(this.user)}function u(){this.result=!0,this.errors=null,this.notices=null,this.exceptions=null}function h(){this.alertDesc=i.observable(""),this.closeCallback=null,this.title=i.observable(""),this.okButtonText=i.observable(F.i18n("MAIN/BUTTON_OK"))}function p(){this.fConfirmCallback=null,this.confirmDesc=i.observable(""),this.title=i.observable(""),this.okButtonText=i.observable(F.i18n("MAIN/BUTTON_OK")),this.cancelButtonText=i.observable(F.i18n("MAIN/BUTTON_CANCEL")),this.shown=!1}function m(){this.pgp=null,this.keyArmor=i.observable(""),this.keyArmorFocused=i.observable(!1),this.keys=i.observableArray([]),this.hasExistingKeys=i.observable(!1),this.headlineText=i.computed(function(){return F.i18n("OPENPGP/INFO_TEXT_INCLUDES_KEYS_PLURAL",{},null,this.keys().length)},this)}function f(){this.fCallback=null,this.calendarId=i.observable(null),this.calendarName=i.observable(""),this.calendarDescription=i.observable(""),this.calendarNameFocus=i.observable(!1),this.calendarDescriptionFocus=i.observable(!1),this.colors=i.observableArray([]),this.selectedColor=i.observable(this.colors()[0]),this.popupTitle=i.observable("")}function g(){this.fCallback=null,this.oJua=null,this.allowDragNDrop=i.observable(!1),this.visibility=i.observable(!1),this.importing=i.observable(!1),this.color=i.observable(""),this.calendarId=i.observable("")}function b(){this.guestsDom=i.observable(),this.guestsDom.subscribe(function(e){this.initInputosaurus(this.guestsDom,this.guests,this.guestsLock)},this),this.ownersDom=i.observable(),this.ownersDom.subscribe(function(){this.initInputosaurus(this.ownersDom,this.owners,this.ownersLock)},this),this.guestsLock=i.observable(!1),this.guests=i.observable("").extend({reversible:!0}),this.guests.subscribe(function(){this.guestsLock()||(e(this.guestsDom()).val(this.guests()),e(this.guestsDom()).inputosaurus("refresh"))},this),this.ownersLock=i.observable(!1),this.owners=i.observable("").extend({reversible:!0}),this.owners.subscribe(function(){this.ownersLock()||(e(this.ownersDom()).val(this.owners()),e(this.ownersDom()).inputosaurus("refresh"))},this),this.defaultAccount=H.Accounts.getDefault(),this.fCallback=null,this.calendarId=i.observable(null),this.selectedColor=i.observable(""),this.calendarUrl=i.observable(""),this.exportUrl=i.observable(""),this.icsLink=i.observable(""),this.isPublic=i.observable(!1),this.shares=i.observableArray([]),this.owner=i.observable(""),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.whomAnimate=i.observable(""),this.newShare=i.observable(""),this.newShareFocus=i.observable(!1),this.newShareAccess=i.observable(M.CalendarAccess.Read),this.sharedToAll=i.observable(!1),this.sharedToAllAccess=i.observable(M.CalendarAccess.Read),this.canAdd=i.observable(!1),this.aAccess=[{value:M.CalendarAccess.Read,display:F.i18n("CALENDAR/CALENDAR_ACCESS_READ")},{value:M.CalendarAccess.Write,display:F.i18n("CALENDAR/CALENDAR_ACCESS_WRITE")}],this.showGlobalContacts=!!H.User.ShowGlobalContacts}function v(){this.fCallback=null,this.calendarId=i.observable(null),this.selectedColor=i.observable(""),this.calendarUrl=i.observable(""),this.exportUrl=i.observable(""),this.icsLink=i.observable(""),this.isPublic=i.observable(!1),this.pubUrl=i.observable("")}function y(){this.defaultAccount=H.Accounts?H.Accounts.getDefault():null,this.modified=!1,this.isPublic=U,this.isEditable=i.observable(!1),this.isEditableReminders=i.observable(!1),this.selectedCalendarIsShared=i.observable(!1),this.selectedCalendarIsEditable=i.observable(!1),this.callbackSave=null,this.callbackDelete=null,this.timeFormatMoment="HH:mm",this.dateFormatMoment="MM/DD/YYYY",this.dateFormatDatePicker="mm/dd/yy",this.ampmTimeFormat=i.observable(!1),this.calendarId=i.observable(null),this.id=i.observable(null),this.uid=i.observable(null),this.recurrenceId=i.observable(null),this.allEvents=i.observable(M.CalendarEditRecurrenceEvent.AllEvents),this.FCMoment=null,this.isMyEvent=i.observable(!1),this.startDom=i.observable(null),this.endDom=i.observable(null),this.repeatEndDom=i.observable(null),this.yearlyDayText=i.observable(""),this.monthlyDayText=i.observable(""),this.subject=i.observable(""),this.description=i.observable(""),this.lockSelectStartEndDate=i.observable(!1),this.startDate=i.observable(""),this.startTime=i.observable(""),this.startTime.subscribe(function(){this.selectStartDate()},this),this.allDay=i.observable(!1),this.allDay.subscribe(function(e){e||this.setActualTime()},this),this.endDate=i.observable(""),this.endTime=i.observable(""),this.endTime.subscribe(function(){this.selectEndDate()},this),this.repeatEndDate=i.observable(""),this.isEvOneDay=i.observable(!0),this.isEvOneTime=i.observable(!0),this.isRepeat=i.observable(!1),this.location=i.observable(""),this.repeatPeriodOptions=i.observableArray(this.getDisplayedPeriods()),this.repeatWeekIntervalOptions=i.observableArray([1,2,3,4]),this.repeatMonthIntervalOptions=i.observableArray(this.getDisplayedIntervals()),this.defaultAlarms=i.observableArray([5,10,15,30,60,120,180,240,300,360,420,480,540,600,660,720,1080,1440,2880,4320,5760,10080,20160]),this.alarmOptions=i.observableArray([]),this.timeOptions=i.observableArray(F.Calendar.getTimeListStepHalfHour(H.User.defaultTimeFormat()!==M.TimeFormat.F24?"hh:mm A":"HH:mm")),H.User.defaultTimeFormat.subscribe(function(){this.timeOptions(F.Calendar.getTimeListStepHalfHour(H.User.defaultTimeFormat()!==M.TimeFormat.F24?"hh:mm A":"HH:mm"))},this),this.displayedAlarms=i.observableArray([]),this.displayedAlarms.subscribe(function(){this.disableAlarms()},this),this.excluded=i.observable(!1),this.repeatPeriod=i.observable(M.CalendarRepeatPeriod.None),this.repeatPeriod.subscribe(function(e){this.setDayOfWeek(),this.isRepeat(!!e)},this),this.repeatInterval=i.observable(1),this.repeatCount=i.observable(null),this.repeatWeekNum=i.observable(null),this.weekMO=i.observable(!1),this.weekTU=i.observable(!1),this.weekWE=i.observable(!1),this.weekTH=i.observable(!1),this.weekFR=i.observable(!1),this.weekSA=i.observable(!1),this.weekSU=i.observable(!1),this.always=i.observable(1),this.appointment=i.observable(!1),this.attendees=i.observableArray([]),this.attenderStatus=i.observable(0),this.owner=i.observable(""),this.ownerName=i.observable(""),this.recivedAnim=i.observable(!1).extend({autoResetToFalse:500}),this.whomAnimate=i.observable(""),this.guestAutocompleteItem=i.observable(null),this.guestAutocomplete=i.observable(""),this.guestEmailFocus=i.observable(!1),this.guestAutocomplete.subscribe(function(e){""===e&&this.guestAutocompleteItem(null)},this),this.condition=i.observable(""),this.autosizeTrigger=i.observable(!0),this.calendars=null,this.calendarsList=i.observableArray([]),this.calendarColor=i.observable(""),this.selectedCalendarId=i.observable(""),this.selectedCalendarName=i.observable(""),this.selectedCalendarId.subscribe(function(e){if(e){var t=this.calendars.getCalendarById(e);this.selectedCalendarName(t.name()),this.selectedCalendarIsShared(t.isShared()),this.selectedCalendarIsEditable(t.isEditable()),this.changeCalendarColor(e)}},this),this.subjectFocus=i.observable(!1),this.descriptionFocus=i.observable(!1),this.locationFocus=i.observable(!1),this.dateEdit=i.observable(!1),this.repeatEdit=i.observable(!1),this.guestsEdit=i.observable(!1),this.defaultOptionsAfterRender=F.defaultOptionsAfterRender,this.isEditForm=i.computed(function(){return!!this.id()},this),this.callbackAttendeeActionDecline=null,this.calendarAppointments=H.User.AllowCalendar&&H.User.CalendarAppointments,this.allChanges=i.computed(function(){this.subject(),this.description(),this.location(),this.isRepeat(),this.allDay(),this.repeatPeriod(),this.repeatInterval(),this.repeatCount(),this.repeatWeekNum(),this.startDate(),this.startTime(),this.endDate(),this.endTime(),this.repeatEndDate(),this.displayedAlarms(),this.weekMO(),this.weekTU(),this.weekWE(),this.weekTH(),this.weekFR(),this.weekSA(),this.weekSU(),this.always(),this.attendees(),this.selectedCalendarId(),this.modified=!0},this),this.phaseArray=[""],_.each(F.i18n("CALENDAR/REMINDER_PHRASE").split(/\s/),function(e){var t=this.phaseArray.length-1;"%"===e.substr(0,1)||"%"===this.phaseArray[t].substr(-1,1)?this.phaseArray.push(e):this.phaseArray[t]+=" "+e},this),this.isAppointmentButtonsVisible=i.observable(!1)}function C(){this.fCallback=null,this.confirmDesc=F.i18n("CALENDAR/EDIT_RECURRENCE_CONFIRM_DESCRIPTION"),this.onlyThisInstanceButtonText=i.observable(F.i18n("CALENDAR/ONLY_THIS_INSTANCE")),this.allEventsButtonText=i.observable(F.i18n("CALENDAR/ALL_EVENTS_IN_THE_SERIES")),this.cancelButtonText=i.observable(F.i18n("MAIN/BUTTON_CANCEL"))}function E(){this.fCallback=null,this.fProceedUploading=null,this.calendars=null,this.calendarsList=i.observableArray([]),this.calendarColor=i.observable(""),this.selectedCalendarName=i.observable(""),this.selectedCalendarId=i.observable(""),this.selectedCalendarId.subscribe(function(e){if(e){var t=this.calendars.getCalendarById(e);this.selectedCalendarName(t.name()),this.selectedCalendarIsEditable(t.isEditable()),this.changeCalendarColor(e)}},this),this.selectedCalendarIsEditable=i.observable(!1)}function A(){this.displayName=i.observable(""),this.email=i.observable(""),this.phone=i.observable(""),this.address=i.observable(""),this.skype=i.observable(""),this.facebook=i.observable(""),this.focusDisplayName=i.observable(!1),this.loading=i.observable(!1),this.fCallback=null,this.oContext=null}function D(){this.iframe=i.observable("")}function S(){this.IdUser=1,this.MailsPerPage=20,this.ContactsPerPage=20,this.iInterval=-1,this.AutoCheckMailInterval=0,this.DefaultTheme="Default",this.DefaultLanguage="English",this.DefaultLanguageShort="en",this.DefaultDateFormat="MM/DD/YYYY",this.defaultTimeFormat=i.observable(M.TimeFormat.F24),this.ThreadsEnabled=!0,this.useThreads=i.observable(!0),this.SaveRepliedToCurrFolder=!0,this.AllowChangeInputDirection=!1,this.DesktopNotifications=!1,this.EmailNotification="",this.AllowCompose=!0,this.AllowReply=!0,this.AllowForward=!0,this.SaveMail=M.SaveMail.Checked,this.AllowFetcher=!1,this.OutlookSyncEnable=!0,this.MobileSyncEnable=!0,this.ShowPersonalContacts=!0,this.ShowGlobalContacts=!1,this.IsFilesSupported=!1,this.IsHelpdeskSupported=!1,this.IsHelpdeskAgent=!1,this.HelpdeskIframeUrl="",this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.LastLogin=0,this.LoginsCount=0,this.SocialName=0,this.IsDemo=!1,this.AllowVoice=!1,this.SipRealm="",this.SipWebsocketProxyUrl="",this.SipOutboundProxyUrl="",this.SipCallerID="",this.SipImpi="",this.SipImpu="",this.SipPassword="",this.VoiceProvider="",this.AllowCalendar=!0,this.CalendarSharing=!1,this.CalendarAppointments=!1,this.CalendarShowWeekEnds=!1,this.CalendarShowWorkDay=!1,this.CalendarWorkDayStarts=0,this.CalendarWorkDayEnds=0,this.CalendarWeekStartsOn=0,this.CalendarDefaultTab=M.CalendarDefaultTab.Month,this.mobileSync=i.observable(null),this.MobileSyncDemoPass="demo",this.outlookSync=i.observable(null),this.OutlookSyncDemoPass="demo",this.AllowHelpdeskNotifications=!1,this.IsCollaborationSupported=!1,this.AllowFilesSharing=!1,this.DefaultFontName="Tahoma",this.fillDefaultFontName(),this.DefaultFontSize=3,this.fillDefaultFontSize(),this.enableOpenPgp=i.observable(!1),this.AllowAutosaveInDrafts=!0,this.AutosignOutgoingEmails=!1,this.filesEnable=i.observable(!0),this.helpdeskSignature=i.observable(""),this.helpdeskSignatureEnable=i.observable(!1),this.SocialAccounts=i.observableArray([]),this.CanLoginWithPassword=!0}function k(){this.id=0,this.cTag=0,this.name=i.observable(""),this.description=i.observable(""),this.owner=i.observable(""),this.isDefault=!1,this.isShared=i.observable(!1),this.isSharedToAll=i.observable(!1),this.sharedToAllAccess=M.CalendarAccess.Read,this.isPublic=i.observable(!1),this.url=i.observable(""),this.davUrl=i.observable(""),this.exportUrl=i.observable(""),this.pubUrl=i.observable(""),this.shares=i.observableArray([]),this.events=i.observableArray([]),this.eventsCount=i.computed(function(){return this.events().length},this),this.access=i.observable(M.CalendarAccess.Write),this.control=i.computed(function(){return!(this.access()===M.CalendarAccess.Read&&this.isSharedToAll())},this),this.color=i.observable(""),this.color.subscribe(function(){this.events(_.map(this.events(),function(e){return e.backgroundColor=e.borderColor=this.color(),e},this)),this.name.valueHasMutated()},this),this.active=i.observable(!0),this.startDateTime=0,this.endDateTime=0,this.account=H.Accounts?H.Accounts.getDefault():null}function T(e){this.parentOnCalendarActiveChange=e.onCalendarActiveChange,this.parentOnCalendarCollectionChange=e.onCalendarCollectionChange,this.defaultCal=i.observable(null),this.currentCal=i.observable(null),this.collection=i.observableArray([]),this.collection.subscribe(function(){this.pickCurrentCalendar(this.defaultCal()),this.parentOnCalendarCollectionChange&&this.parentOnCalendarCollectionChange()},this),this.count=i.computed(function(){return this.collection().length},this),this.own=i.computed(function(){var e=_.filter(this.collection(),function(e){return!e.isShared()});return e},this),this.ownCount=i.computed(function(){return this.own().length},this),this.shared=i.computed(function(){var e=_.filter(this.collection(),function(e){return e.isShared()&&!e.isSharedToAll()});return e},this),this.sharedCount=i.computed(function(){return this.shared().length},this),this.sharedToAll=i.computed(function(){var e=_.filter(this.collection(),function(e){return e.isShared()&&e.isSharedToAll()});return e},this),this.sharedToAllCount=i.computed(function(){return this.sharedToAll().length},this),this.ids=i.computed(function(){return _.map(this.collection(),function(e){return e.id},this)},this)}function w(){var e=this;this.initialized=i.observable(!1),this.isPublic=U,this.uploaderArea=i.observable(null),this.bDragActive=i.observable(!1),this.bDragActiveComp=i.computed(function(){return this.bDragActive()},this),this.defaultAccount=H.Accounts?H.Accounts.getDefault():null,this.todayDate=new Date,this.aDayNames=F.i18n("DATETIME/DAY_NAMES").split(" "),this.popUpStatus=!1,this.linkRow=0,this.linkColumn=0,this.publicCalendarId=this.isPublic?H.CalendarPubHash:"",this.publicCalendarName=i.observable(""),this.timeFormat=H.User.defaultTimeFormat()===M.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=H.User.DefaultDateFormat,this.topPositionToday=i.observable(".fc-widget-content.fc-today"),this.loadOnce=!1,this.scrollModel=i.observable(null),this.scrollHeight=0,this.dateTitle=i.observable(""),this.dateTitleHelper=i.observableArray(F.i18n("DATETIME/MONTH_NAMES").split(" ")),this.selectedView=i.observable(""),this.visibleWeekdayHeader=i.computed(function(){return"month"===this.selectedView()},this),this.selectedView.subscribe(function(){this.resize()},this),this.$calendarGrid=null,this.calendarGridDom=i.observable(null),this.$datePicker=null,this.datePickerDom=i.observable(null),this.calendars=new T({onCalendarCollectionChange:function(){e.refreshView()},onCalendarActiveChange:function(){e.refreshView()}}),this.colors=["#f09650","#f68987","#6fd0ce","#8fbce2","#b9a4f5","#f68dcf","#d88adc","#4afdb4","#9da1ff","#5cc9c9","#77ca71","#aec9c9"],this.busyDays=i.observableArray([]),this.$inlineEditedEvent=null,this.inlineEditedEventText=null,this.checkStarted=i.observable(!1),this.loaded=!1,this.startDateTime=0,this.endDateTime=0,this.needsToReload=!1,this.calendarListClick=function(e){e.active(!e.active())},this.currentCalendarDropdown=i.observable(!1),this.currentCalendarDropdownOffset=i.observable(0),this.calendarDropdownToggle=function(t,i){if(i&&t){var n=i.position(),s=i.outerHeight();e.currentCalendarDropdownOffset(parseInt(n.top,10)+s)}e.currentCalendarDropdown(t)},this.dayNamesResizeBinding=_.throttle(_.bind(this.resize,this),50),this.customscrollTop=i.observable(0),this.fullcalendarOptions={handleWindowResize:!0,eventLimit:10,header:!1,editable:!this.isPublic,selectable:!this.isPublic,allDayText:F.i18n("CALENDAR/TITLE_ALLDAY"),dayNames:this.aDayNames,isRTL:F.isRTL(),scrollTime:moment.duration(8,"hours"),forceEventDuration:!0,columnFormat:{month:"dddd",week:"dddd D",day:"dddd D"},titleFormat:{month:"MMMM YYYY",week:"MMMM D[ YYYY]{ '-'[ MMMM] D YYYY}",day:"MMMM D, YYYY"},displayEventEnd:{month:!0,basicWeek:!0,"default":!0},select:_.bind(this.createEventFromGrid,this),eventClick:_.bind(this.eventClickCallback,this),eventDragStart:_.bind(this.onEventDragStart,this),eventDragStop:_.bind(this.onEventDragStop,this),eventResizeStart:_.bind(this.onEventResizeStart,this),eventResizeStop:_.bind(this.onEventResizeStop,this),eventDrop:_.bind(this.moveEvent,this),eventResize:_.bind(this.resizeEvent,this),eventAfterRender:_.bind(function(e,t){},this),eventAfterAllRender:_.bind(this.updateAllEvents,this),viewRender:_.bind(this.viewRenderCallback,this),events:_.bind(this.eventsSource,this)},this.revertFunction=null,this.calendarSharing=H.User.AllowCalendar&&H.User.CalendarSharing,this.defaultViewName=i.computed(function(){var e="month";switch(H.User.CalendarDefaultTab){case M.CalendarDefaultTab.Day:e="agendaDay";break;case M.CalendarDefaultTab.Week:e="agendaWeek";break;case M.CalendarDefaultTab.Month:e="month"}return e},this),this.iAutoReloadTimer=-1,this.dragEventTrigger=!1,this.delayOnEventResult=!1,this.delayOnEventResultData=[],this.refreshView=_.throttle(_.bind(this.refreshViewSingle,this),100),this.defaultCalendarId=i.computed(function(){var e=this.calendars.defaultCal();return e?e.id:void 0},this),this.uploadCalendarId=i.observable(""),this.changeFullCalendarDate=!0,this.domScrollWrapper=null,this.hotKeysBind()}function R(){this.iAnimationDuration=500,this.iReportDuration=5e3,this.iErrorDuration=1e4,this.loadingMessage=i.observable(""),this.loadingHidden=i.observable(!0),this.loadingVisible=i.observable(!1),this.reportMessage=i.observable(""),this.reportHidden=i.observable(!0),this.reportVisible=i.observable(!1),this.reportVisibleClose=i.observable(!1),this.iReportTimeout=-1,this.errorMessage=i.observable(""),this.errorHidden=i.observable(!0),this.errorVisible=i.observable(!1),this.iErrorTimeout=-1,this.isHtmlError=i.observable(!1),this.gray=i.observable(!1)}function I(){var n=e(t);this.resizeAll=_.debounce(function(){n.resize()},100),this.oScreens={},this.currentScreen=i.observable(""),this.informationScreen=i.observable(null),this.popups=[]}function P(){this.browser=new a;try{this.favico=!this.browser.ie8AndBelow&&t.Favico?new t.Favico({animation:"none"}):null}catch(e){this.favico=null}this.Ajax=new o,this.Screens=new I,this.Api=new r,this.Storage=new l,this.helpdeskUnseenCount=i.observable(0),this.helpdeskPendingCount=i.observable(0),this.mailUnseenCount=i.observable(0),this.InternetConnectionError=!1}function N(){P.call(this),this.init()}var M={},F={},O=t.pSevenI18N||{},x={},L={},H=t.pSevenAppData||{},U=!1,B=!1,K=e("html"),Y=-1<navigator.userAgent.indexOf("Windows Phone"),G=!Y&&(-1<navigator.userAgent.indexOf("iPhone")||-1<navigator.userAgent.indexOf("iPod")||-1<navigator.userAgent.indexOf("iPad")),V=!Y&&-1<navigator.userAgent.toLowerCase().indexOf("android"),W=Y||G||V,z=["image/jpeg","image/png","image/gif","text/html","text/plain","text/css","text/rfc822-headers","message/delivery-status","application/x-httpd-php","application/javascript","application/pdf"];if(t.Modernizr&&navigator&&t.Modernizr.addTest("pdf",function(){for(var e=navigator.mimeTypes,t=0,i=e.length;i>t;t++)if("application/pdf"===e[t].type)return!0;return!1}),Date.now||(Date.now=function(){return(new Date).getTime()}),U=!0,a.prototype.getIeVersion=function(){var e=navigator.userAgent.toLowerCase(),t=F.pInt(e.slice(e.indexOf("msie")+4,e.indexOf(";",e.indexOf("msie")+4)));return this.ie11&&(t=11),t},o.prototype.AddActionsWithoutAuthForSendExt=function(e){e=F.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSendExt,e)&&this.aActionsWithoutAuthForSendExt.push(e)},o.prototype.AddActionsWithoutAuthForSend=function(e){e=F.isUnd(e)?"":e,""!==e&&-1===_.indexOf(this.aActionsWithoutAuthForSend,e)&&this.aActionsWithoutAuthForSend.push(e)},o.prototype.hasOpenedRequests=function(e){return e=F.isUnd(e)?"":e,this.requests(_.filter(this.requests(),function(t){var i=t&&4===t.Xhr.readyState,n=!t||0===t.Xhr.readyState&&"abort"===t.Xhr.statusText,s=""===e||t&&t.Parameters.Action===e;return t&&!i&&!n&&s})),this.requests().length>0},o.prototype.isSearchMessages=function(){var e=!1;return _.each(this.requests(),function(t){t&&t.Parameters&&"MessagesGetList"===t.Parameters.Action&&""!==t.Parameters.Search&&(e=!0)},this),e},o.prototype.isAllowedActionWithoutAuth=function(e){return-1!==_.indexOf(this.aActionsWithoutAuthForSend,e)},o.prototype.isAllowedExtAction=function(e){return"SocialRegister"===e||"HelpdeskRegister"===e||"HelpdeskForgot"===e||"HelpdeskLogin"===e||"SystemLogout"===e},o.prototype.doSend=function(t,i,n,s){var a=_.bind(s||null,this,t,i,n),o=_.bind(this.fail,this,t,i,n),r=_.bind(this.always,this,t),l=null;L.runPluginHook&&L.runPluginHook("ajax-default-request",[t.Action,t]),H.Token&&(t.Token=H.Token),this.abortRequests(t),F.log("Ajax request send",t.Action,t),l=e.ajax({url:this.sUrl,type:"POST",async:!0,dataType:"json",data:t,success:a,error:o,complete:r,timeout:"MessagesGetBodies"===t.Action?1e5:5e4}),this.requests().push({Parameters:t,Xhr:l})},o.prototype.send=function(e,t,i){var n=void 0===e.AccountID,s=n||H.Accounts.hasAccountWithId(e.AccountID);e&&(H.Auth&&s||this.isAllowedActionWithoutAuth(e.Action))&&(n&&"Login"!==e.Action&&(e.AccountID=H.Accounts.currentId()),this.doSend(e,t,i,this.done))},o.prototype.sendExt=function(e,t,i){var n=-1!==_.indexOf(this.aActionsWithoutAuthForSendExt,e.Action);e&&(H.Auth||n)&&(H.TenantHash&&(e.TenantHash=H.TenantHash),this.doSend(e,t,i,this.doneExt))},o.prototype.abortRequests=function(e){switch(e.Action){case"MessageMove":case"MessageDelete":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessageGet");break;case"MessagesGetList":case"MessageSetSeen":case"MessageSetFlagged":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder});break;case"MessagesSetAllSeen":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("MessagesGetListByUids",{Folder:e.Folder});break;case"FolderClear":this.abortRequestByActionName("MessagesGetList",{Folder:e.Folder}),this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"FoldersGetRelevantInformation":this.abortRequestByActionName("FoldersGetRelevantInformation");break;case"MessagesGetFlags":this.abortRequestByActionName("MessagesGetFlags");break;case"ContactList":case"ContactGlobalList":this.abortRequestByActionName("ContactList"),this.abortRequestByActionName("ContactGlobalList");break;case"ContactGet":case"ContactGlobal":this.abortRequestByActionName("ContactGet"),this.abortRequestByActionName("ContactGlobal");break;case"CalendarEventUpdate":this.abortRequestByActionName("CalendarEventUpdate",{calendarId:e.calendarId,uid:e.uid});break;case"CalendarList":this.abortRequestByActionName("CalendarList");break;case"CalendarEventList":this.abortRequestByActionName("CalendarEventList")}},o.prototype.abortRequestByActionName=function(e,t){var i;_.each(this.requests(),function(n,s){if(i=!1,n&&n.Parameters.Action===e)switch(e){case"MessagesGetList":t.Folder===n.Parameters.Folder&&(i=!0);break;case"CalendarEventUpdate":t.calendarId===n.Parameters.calendarId&&t.uid===n.Parameters.uid&&(i=!0);break;default:i=!0}i&&(n.Xhr.abort(),this.requests()[s]=void 0)},this),this.requests(_.compact(this.requests()))},o.prototype.abortAllRequests=function(){_.each(this.requests(),function(e){e&&e.Xhr.abort()},this),this.requests([])},o.prototype.done=function(e,t,i,n,s,a){var o=this.isAllowedActionWithoutAuth(e.Action),r=H.Accounts.hasAccountWithId(e.AccountID),l=e.AccountID===H.Accounts.defaultId();if(F.log("Ajax request done",e.Action,s,F.getAjaxDataForLog(e.Action,n),e),o||r){if(n&&!n.Result)switch(n.ErrorCode){case M.Errors.InvalidToken:o||x.tokenProblem();break;case M.Errors.AuthError:l&&!o&&(this.abortAllRequests(),x.authProblem())}this.executeResponseHandler(t,i,n,e)}},o.prototype.doneExt=function(e,t,i,n,s,a){this.executeResponseHandler(t,i,n,e)},o.prototype.fail=function(e,t,i,n,s,a){var o={Result:!1,ErrorCode:0};switch(F.log("Ajax request fail",e.Action,s,e),s){case"abort":o={Result:!1,ErrorCode:M.Errors.NotDisplayedError};break;default:case"error":case"parseerror":o=""===a?{Result:!1,ErrorCode:M.Errors.NotDisplayedError}:{Result:!1,ErrorCode:M.Errors.DataTransferFailed}}this.executeResponseHandler(t,i,o,e)},o.prototype.executeResponseHandler=function(e,t,i,n){i||(i={Result:!1,ErrorCode:0}),L.runPluginHook&&L.runPluginHook("ajax-default-response",[n.Action,i]),"function"!=typeof e||i.StopExecuteResponse||e.apply(t,[i,n])},o.prototype.always=function(e,t,i){"abort"!==i&&(_.each(this.requests(),function(t,i){t&&_.isEqual(t.Parameters,e)&&(this.requests()[i]=void 0)},this),this.requests(_.compact(this.requests())),F.checkConnection(e.Action,i),x.Prefetcher&&"parsererror"!==i&&!this.hasOpenedRequests()&&x.Prefetcher.start())},M.Screens={Login:"login",Information:"information",Header:"header",Mailbox:"mailbox",SingleMessageView:"single-message-view",Compose:"compose",SingleCompose:"single-compose",Settings:"settings",Contacts:"contacts",Calendar:"calendar",FileStorage:"files",Helpdesk:"helpdesk",SingleHelpdesk:"single-helpdesk"},M.CalendarDefaultTab={Day:1,Week:2,Month:3},M.TimeFormat={F24:"0",F12:"1"},M.Errors={InvalidToken:101,AuthError:102,DataBaseError:104,LicenseProblem:105,DemoLimitations:106,Captcha:107,AccessDenied:108,CanNotGetMessage:202,ImapQuota:205,NotSavedInSentItems:304,NoRequestedMailbox:305,CanNotChangePassword:502,AccountOldPasswordNotCorrect:503,FetcherIncServerNotAvailable:702,FetcherLoginNotCorrect:703,HelpdeskThrowInWebmail:805,HelpdeskUserNotExists:807,HelpdeskUserNotActivated:808,IncorrectFileExtension:811,MailServerError:901,DataTransferFailed:1100,NotDisplayedError:1155},M.FolderTypes={Inbox:1,Sent:2,Drafts:3,Spam:4,Trash:5,Virus:6,Starred:7,System:9,User:10},M.FolderFilter={Flagged:"flagged",Unseen:"unseen"},M.LoginFormType={Email:0,Login:3,Both:4},M.LoginSignMeType={DefaultOff:0,DefaultOn:1,Unuse:2},M.ReplyType={Reply:"reply",ReplyAll:"reply-all",Resend:"resend",Forward:"forward"},M.Importance={Low:5,Normal:3,High:1},M.Sensitivity={Nothing:0,Confidential:1,Private:2,Personal:3},M.ContactEmailType={Personal:"Personal",Business:"Business",Other:"Other"},M.ContactPhoneType={Mobile:"Mobile",Personal:"Personal",Business:"Business"},M.ContactAddressType={Personal:"Personal",Business:"Business"},M.ContactSortType={Email:"Email",Name:"Name",Frequency:"Frequency"},M.SaveMail={Hidden:0,Checked:1,Unchecked:2},M.SettingsTab={Common:"common",EmailAccounts:"accounts",Calendar:"calendar",MobileSync:"mobile_sync",OutLookSync:"outlook_sync",Helpdesk:"helpdesk",Pgp:"pgp",Services:"services",CloudStorage:"cloud-storage"},M.AccountSettingsTab={Properties:"properties",Signature:"signature",Filters:"filters",Autoresponder:"autoresponder",Forward:"forward",Folders:"folders",FetcherInc:"fetcher-inc",FetcherOut:"fetcher-out",FetcherSig:"fetcher-sig",IdentityProperties:"identity-properties",IdentitySignature:"identity-signature"},M.AccountCreationPopupType={OneStep:1,TwoSteps:2,ConnectToMail:3},M.ContactsGroupListType={Personal:0,SubGroup:1,Global:2,SharedToAll:3,All:4},M.IcalType={Request:"REQUEST",Reply:"REPLY",Cancel:"CANCEL",Save:"SAVE"},M.IcalConfig={Accepted:"ACCEPTED",Declined:"DECLINED",Tentative:"TENTATIVE",NeedsAction:"NEEDS-ACTION"},M.IcalConfigInt={Accepted:1,Declined:2,Tentative:3,NeedsAction:0},M.Key={Tab:9,Enter:13,Shift:16,Ctrl:17,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Up:38,Down:40,Left:37,Right:39,Del:46,Six:54,a:65,b:66,c:67,f:70,i:73,k:75,n:78,p:80,q:81,r:82,s:83,u:85,v:86,y:89,z:90,F5:116,Comma:188,Dot:190,Dash:192,Apostrophe:222},M.MouseKey={Left:0,Middle:1,Right:2},M.FileStorageType={Personal:"personal",Corporate:"corporate",Shared:"shared",GoogleDrive:"google",Dropbox:"dropbox"},M.FileStorageLinkType={Unknown:0,GoogleDrive:1,Dropbox:2,YouTube:3,Vimeo:4,SoundCloud:5},M.HelpdeskThreadStates={None:0,Pending:1,Waiting:2,Answered:3,Resolved:4,Deferred:5},M.HelpdeskPostType={Normal:0,Internal:1,System:2},M.HelpdeskFilters={All:0,Pending:1,Resolved:2,InWork:3,Open:4,Archived:9},M.CalendarAccess={Full:0,Write:1,Read:2},M.CalendarEditRecurrenceEvent={None:0,OnlyThisInstance:1,AllEvents:2},M.CalendarRepeatPeriod={None:0,Daily:1,Weekly:2,Monthly:3,Yearly:4},M.CalendarAlways={Disable:0,Enable:1},M.PhoneAction={Offline:"offline",OfflineError:"offline_error",OfflineInit:"offline_init",OfflineActive:"offline_active",Online:"online",OnlineActive:"online_active",Incoming:"incoming",IncomingConnect:"incoming_connect",Outgoing:"outgoing",OutgoingConnect:"outgoing_connect",Settings:"settings"},M.HtmlEditorImageSizes={Small:"small",Medium:"medium",Large:"large",Original:"original"},M.MobilePanel={Groups:1,Items:2,View:3},M.PgpAction={Import:"import",Generate:"generate",Encrypt:"encrypt",Sign:"sign",EncryptSign:"encrypt-sign",Verify:"ferify",DecryptVerify:"decrypt-ferify"},M.SocialType={Unknown:0,Google:1,Dropbox:2,Facebook:3,Twitter:4,Vkontakte:5},M.notificationPermission={Granted:"granted",Denied:"denied",Default:"default"},M.AnotherMessageComposedAnswer={Discard:"Discard",SaveAsDraft:"SaveAsDraft",Cancel:"Cancel"},i.bindingHandlers.command={init:function(t,n,s,a){var o=e(t),r=n();if(!r||!r.enabled||!r.canExecute)throw new Error("You are not using command function");o.addClass("command"),i.bindingHandlers[o.is("form")?"submit":"click"].init.apply(a,arguments)},update:function(t,i){var n=!0,s=e(t),a=i();n=a.enabled(),s.toggleClass("command-not-enabled",!n),n&&(n=a.canExecute(),s.toggleClass("unavailable",!n)),s.toggleClass("command-disabled disable disabled",!n),s.toggleClass("command-disabled",!n)}},i.bindingHandlers.simpleTemplate={init:function(t,i){var n=e(t);n.length>0&&"replaced"!==n.data("replaced")&&(n.html(n.html().replace(/&lt;script(.*?)&gt;/i,"<script$1>").replace(/&lt;\/script(.*?)&gt;/i,"</script>")),n.data("replaced","replaced"))}},i.bindingHandlers.findFocused={init:function(t){
var i=e(t),n=null;n=i.find(".catch-focus"),n&&1===n.length&&n[0]&&n.on("blur",function(){i.removeClass("focused")}).on("focus",function(){i.addClass("focused")})}},i.bindingHandlers.findFilled={init:function(t){var i=e(t),n=null,s=null;n=i.find(".catch-filled"),n&&1===n.length&&n[0]&&(s=function(){i.toggleClass("filled",""!==n.val())},s(),_.delay(s,200),n.on("change",s))}},i.bindingHandlers.alert={init:function(e,n){t.alert(i.utils.unwrapObservable(n()))},update:function(e,n){t.alert(i.utils.unwrapObservable(n()))}},i.bindingHandlers.onEnter={init:function(n,s,a,o){i.bindingHandlers.event.init(n,function(){return{keyup:function(i,a){a&&13===t.parseInt(a.keyCode,10)&&(e(n).trigger("change"),s().call(this,i))}}},a,o)}},i.bindingHandlers.onCtrlEnter={init:B?null:function(n,s,a,o){i.bindingHandlers.event.init(n,function(){return{keydown:function(i,a){return a&&13===t.parseInt(a.keyCode,10)&&a.ctrlKey?(e(n).trigger("change"),s().call(this,i),!1):!0}}},a,o)}},i.bindingHandlers.onEsc={init:B?null:function(n,s,a,o){i.bindingHandlers.event.init(n,function(){return{keyup:function(i,a){a&&27===t.parseInt(a.keyCode,10)&&(e(n).trigger("change"),s().call(this,i))}}},a,o)}},i.bindingHandlers.onFocusSelect={init:function(e,t,n,s){i.bindingHandlers.event.init(e,function(){return{focus:function(){e.select()}}},n,s)}},i.bindingHandlers.onEnterChange={init:function(n,s,a,o){i.bindingHandlers.event.init(n,function(){return{keyup:function(i,s){s&&13===t.parseInt(s.keyCode,10)&&e(n).trigger("change")}}},a,o)}},i.bindingHandlers.fadeIn={update:function(t,n){i.utils.unwrapObservable(n())&&e(t).hide().fadeIn("fast")}},i.bindingHandlers.fadeOut={update:function(t,n){i.utils.unwrapObservable(n())&&e(t).fadeOut()}},i.bindingHandlers.csstext={init:function(t,n){t&&t.styleSheet&&!F.isUnd(t.styleSheet.cssText)?t.styleSheet.cssText=i.utils.unwrapObservable(n()):e(t).text(i.utils.unwrapObservable(n()))},update:function(t,n){t&&t.styleSheet&&!F.isUnd(t.styleSheet.cssText)?t.styleSheet.cssText=i.utils.unwrapObservable(n()):e(t).text(i.utils.unwrapObservable(n()))}},i.bindingHandlers.i18n={init:function(t,i){var n=e(t).data("i18n"),s=n?F.i18n(n):n;if(""!==s)switch(i()){case"value":e(t).val(s);break;case"text":e(t).text(s);break;case"html":e(t).html(s);break;case"title":e(t).attr("title",s);break;case"placeholder":e(t).attr({placeholder:s})}}},i.bindingHandlers.link={init:function(t,n){e(t).attr("href",i.utils.unwrapObservable(n()))}},i.bindingHandlers.title={init:function(t,n){e(t).attr("title",i.utils.unwrapObservable(n()))},update:function(t,n){e(t).attr("title",i.utils.unwrapObservable(n()))}},i.bindingHandlers.initDom={init:function(t,i){if(i())if(_.isArray(i()))for(var n=i(),s=n.length-1;s>=0;s--)n[s](e(t));else i()(e(t))}},i.bindingHandlers.customScrollbar={init:B?null:function(t,i,n,s){if(!W){var a=e(t),o=_.defaults(i(),{oScroll:null,scrollToTopTrigger:null,scrollToBottomTrigger:null,scrollTo:null}),r=null;o=o,a.addClass("scroll-wrap").customscroll(o),r=a.data("customscroll"),o.oScroll&&F.isFunc(o.oScroll.subscribe)?o.oScroll(r):o.oScroll=r,F.isUnd(o.reset)||(t._customscroll_reset=_.throttle(function(){r.reset()},100)),o.scrollToTopTrigger&&F.isFunc(o.scrollToTopTrigger.subscribe)&&o.scrollToTopTrigger.subscribe(function(){r&&r.scrollToTop()}),o.scrollToBottomTrigger&&F.isFunc(o.scrollToBottomTrigger.subscribe)&&o.scrollToBottomTrigger.subscribe(function(){r&&r.scrollToBottom()}),o.scrollTo&&F.isFunc(o.scrollTo.subscribe)&&o.scrollTo.subscribe(function(){r&&r.scrollTo(o.scrollTo())})}},update:B?null:function(t,i,n,s,a){W||(t._customscroll_reset&&t._customscroll_reset(),F.isUnd(i().top)||e(t).data("customscroll").vertical.set(i().top))}},i.bindingHandlers.customOptions={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,s,a){for(var o=0,r=0,l=i.utils.arrayMap(i.utils.arrayFilter(e.childNodes,function(e){return e.tagName&&"OPTION"===e.tagName&&e.selected}),function(e){return i.selectExtensions.readValue(e)||e.innerText||e.textContent}),c=e.scrollTop,d=i.utils.unwrapObservable(t());e.length>0;)i.cleanNode(e.options[0]),e.remove(0);if(d){"number"!=typeof d.length&&(d=[d]);var u=n().optionsBind;for(o=0,r=d.length;r>o;o++){var h=document.createElement("OPTION"),p=i.utils.unwrapObservable(d[o]);i.selectExtensions.writeValue(h,p),h.appendChild(document.createTextNode(p)),e.appendChild(h),u&&(h.setAttribute("data-bind",u),i.applyBindings(a.createChildContext(p),h))}var m=e.getElementsByTagName("OPTION"),f=0,g=navigator.userAgent.indexOf("MSIE 6")>=0;for(o=0,r=m.length;r>o;o++)i.utils.arrayIndexOf(l,i.selectExtensions.readValue(m[o]))>=0&&(g?m[o].setAttribute("selected",!0):m[o].selected=!0,f++);e.scrollTop=c,f<l.length&&i.utils.triggerEvent(e,"change")}}},i.bindingHandlers.splitter={init:B?null:function(t,i){setTimeout(function(){e(t).splitter(i())},1)}},i.bindingHandlers.dropdown={update:function(i,n,s,a){var o,r,l,c=e(i),d=_.defaults(n(),{disabled:"disabled",expand:"expand",control:!0,container:".dropdown_content",scrollToTopContainer:".scroll-inner",passClick:!0,trueValue:!0}),u="function"==typeof d.control?d.control():d.control,h=c.find(".control"),p=c.find(".dropdown"),m=c.find(".dropdown_helper"),f=c.find(".dropdown_arrow"),g=c.find(".dropdown_arrow.bottom"),b=e(document),v=!1,y=function(){F.isUnd(d.callback)||d.callback.call(a,c.hasClass(d.expand)?d.trueValue:!1,c)},C=function(e){e.stopPropagation()},E=function(){d.scrollToTopContainer&&c.find(d.scrollToTopContainer).scrollTop(0)},A=function(e){F.isUnd(e)&&(e=!c.hasClass(d.expand)),!e&&c.hasClass(d.expand)&&E(),c.toggleClass(d.expand,e),g.length>0&&c.hasClass(d.expand)&&p.css({top:c.position().top-m.height()+"px",left:c.position().left+"px",width:"auto"})},D=function(i){o=m.offset(),F.isUnd(o)||(r=o.left+10,l=e(t).width()-(r+m.outerWidth(!0)),l>0&&(l=0),m.css("left",i||l+"px"),f.css("left",i||Math.abs(l?l+parseInt(f.css("margin-left")):0)+"px"))},S=function(t){var i=e(t.originalEvent.originalTarget).parents(".dropdown"),n=i.length>0;n||c.hasClass(d.disabled)||v||(A(),_.defer(function(){y()}),c.hasClass(d.expand)&&(d.close&&d.close.subscribe&&d.close(!0),_.defer(function(){b.on("click.dropdown",function(e){!d.passClick&&e.button===M.MouseKey.Right||v||(b.unbind("click.dropdown"),d.close&&d.close.subscribe&&d.close(!1),A(!1),y(),D(0)),v=!1})}),D()))};c.off(),h.off(),d.passClick||(c.find(d.container).on("click",C),c.on("click",C),h.on("click",C)),A(!1),d.close&&d.close.subscribe&&d.close.subscribe(function(e){e||(b.unbind("click.dropdown"),A(!1)),y()}),c.on("mousedown",function(t,i){v=e(t.target).hasClass("customscroll-scrollbar")||e(t.target.parentElement).hasClass("customscroll-scrollbar")}),c.on("click",function(e){u||S(e)}),h.on("click",function(e){u&&S(e)})}},i.bindingHandlers.customSelect={init:function(t,i,n,s){var a=e(t),o=_.defaults(i(),{disabled:"disabled",selected:"selected",expand:"expand",control:!0,input:!1,expandState:function(){}}),r=[],l=o.control?a.find(".control"):a,c=a.find(".dropdown_content"),d=a.find(".link"),u=function(t){_.each(r,function(e){e.removeClass(o.selected)});var i=_.find(o.options,function(e){return e[o.optionsValue]===t});return F.isUnd(i)?i=o.options[0]:(r[_.indexOf(o.options,i)].addClass(o.selected),d.text(e.trim(i[o.optionsText]))),i[o.optionsValue]},h=function(t){c.empty(),r=[],_.each(t?t:o.options,function(t){var i=e('<span class="item"></span>').text(t[o.optionsText]).data("value",t[o.optionsValue]),n=t.isDisabled;n?i.data("isDisabled",n).addClass("disabled"):i.data("isDisabled",n).removeClass("disabled"),r.push(i),c.append(i)},this)};h(),c.on("click",".item",function(){var t=e(this);t.data("isDisabled")||o.value(t.data("value"))}),!o.input&&o.value&&o.value.subscribe&&(o.value.subscribe(function(){var e=u(o.value());o.value()!==e&&o.value(e)},s),o.value.valueHasMutated()),o.input&&o.value&&o.value.subscribe&&(o.value.subscribe(function(){u(o.value())},s),o.value.valueHasMutated()),o.input&&o.value&&o.value.subscribe&&(o.value.subscribe(function(){u(o.value())},s),o.value.valueHasMutated()),o.alarmOptions&&o.alarmOptions.subscribe(function(){h()},s),o.timeOptions&&o.timeOptions.subscribe(function(e){h(e)},s),a.removeClass(o.expand),l.click(function(t){if(!a.hasClass(o.disabled)&&(a.toggleClass(o.expand),o.expandState(a.hasClass(o.expand)),a.hasClass(o.expand))){var i=a.find(".dropdown_content"),n=i.find(".selected");n.position()&&(i.scrollTop(0),i.scrollTop(n.position().top-100)),_.defer(function(){e(document).one("click",function(){a.removeClass(o.expand),o.expandState(!1)})})}})}},i.bindingHandlers.moveToFolderFilter={init:function(t,i,n,s,a){var o=e(t),r=i(),l=e(t).find(r.container),c=_.isArray(r.options)?r.options:r.options(),d=r.value?r.value():"",u=_.find(c,function(e){return e[r.optionsValue]===d});u||(d="",r.value("")),o.removeClass("expand"),l.empty(),_.each(c,function(t){var i=e('<span class="item"></span>').text(t[r.optionsText]).data("value",t[r.optionsValue]);d===t[r.optionsValue]&&i.addClass("selected"),t.jq=i,l.append(i)}),l.on("click",".item",function(){var t=e(this).data("value");r.value(t)}),o.click(function(){o.toggleClass("expand"),o.hasClass("expand")&&_.defer(function(){e(document).one("click",function(){o.removeClass("expand")})})})},update:function(t,i){var n=e(t),s=i(),a=_.isArray(s.options)?s.options:s.options(),o=s.value?s.value():"",r=_.find(a,function(e){return e[s.optionsValue]===o}),l=n.find(".link");_.each(a,function(e){e.jq&&e.jq.toggleClass("selected",o===e[s.optionsValue])}),r&&l.text(e.trim(r[s.optionsText]))}},i.bindingHandlers.contactCardInMessage={update:B||W?null:function(i,n,s,a){var o=e(i),r=n(),l=r.address,c=e("div.item_viewer[data-email='"+l+"']"),d=!1,u=0,h=function(){c&&o&&(d=!0,clearTimeout(u),setTimeout(function(){var i,n,s,a=o.offset();d&&a.left+a.top!==0&&(i=a.left+10,n=a.top+o.height()+6,s=e(t).width()-(i+396),s>0&&(s=0),c.addClass("expand").offset({top:n,left:i+s}))},180))},p=function(){d&&c&&o&&(d=!1,u=setTimeout(function(){d||c.removeClass("expand")},200))};c.length>0?(o.off().on("mouseover",function(){c.off().on("mouseenter",h).on("mouseleave",p).find(".link, .button").off(".links").on("click.links",function(){d=!1,c.removeClass("expand")}),setTimeout(function(){c.find(".link, .button").off("click.links").on("click.links",function(){d=!1,c.removeClass("expand")})}.bind(this),100),h()}).on("mouseout",p),d=!1,c.removeClass("expand")):o.off()}},i.bindingHandlers.contactcard={init:B||W?null:function(t,i,n,s){var a=e(t),o=!1,r=_.defaults(i(),{disabled:"disabled",expand:"expand",control:!0}),l=r.control?a.find(".control"):a;void 0!==r.trigger&&void 0!==r.trigger.subscribe&&(a.removeClass(r.expand),l.bind({mouseover:function(){!a.hasClass(r.disabled)&&r.trigger()&&(o=!0,_.delay(function(){o&&(void 0!==r.controlWidth&&void 0!==r.controlWidth.subscribe&&r.controlWidth(l.width()),a.addClass(r.expand))},200))},mouseout:function(){r.trigger()&&(o=!1,_.delay(function(){o||a.removeClass(r.expand)},200))}}))}},i.bindingHandlers.checkmail={update:function(t,i,n,s,a){var o=t.oOptions||null,r=t.jqElement||null,l=t.oIconIE||null,c=i(),d=c.state;void 0!==c.state&&(r||(t.jqElement=r=e(t)),o||(t.oOptions=o=_.defaults(c,{activeClass:"process",duration:800})),F.deferredUpdate(r,d,o.duration,function(e,i){if(x.browser.ie9AndBelow)if(l||(t.oIconIE=l=r.find(".icon")),!l.__intervalIE&&i){var n=0,s="";l.__intervalIE=setInterval(function(){s="0px -"+20*n+"px",n=7>n?n+1:0,l.css({"background-position":s})},1e3/12)}else l.css({"background-position":"0px 0px"}),clearInterval(l.__intervalIE),l.__intervalIE=null;else e.toggleClass(o.activeClass,i)}))}},i.bindingHandlers.heightAdjust={update:function(t,i,n){var s=t.jqElement||null,a=0,o=i().location,r=i().delay||400;s||(t.jqElement=s=e(t)),_.delay(function(){_.each(i().elements,function(e){var t=e();t&&(a+=t.is(":visible")?t.outerHeight():0)}),"top"===o||void 0===o?s.css({"padding-top":a,"margin-top":-a}):"bottom"===o&&s.css({"padding-bottom":a,"margin-bottom":-a})},r)}},i.bindingHandlers.minHeightAdjust={update:function(t,i,n){var s=e(t),a=i(),o=a.adjustElement||e("body"),r=a.minHeight||0;a.removeTrigger&&o.css("min-height","inherit"),a.trigger&&_.delay(function(){o.css({"min-height":s.outerHeight(!0)+r})},100)}},i.bindingHandlers.watchWidth={init:function(t,i){var n=!1;n||i().subscribe(function(){i()(e(t).outerWidth()),n=!0},this)}},i.bindingHandlers.columnCalc={init:function(i,n){var s=e(i),a=n().prop,o=null,r=0;o=s.find(n().itemSelector),void 0!==o[0]&&(r=o.outerWidth(!0),r=1>=r?1:r,a&&e(t).bind("resize",function(){var e=s.width();a(e>0?Math.floor(e/r):1)}))}},i.bindingHandlers.listWithMoreButton={init:function(t,i){var n=e(t),s=!1;n.closest("div.panel.left_panel").resize(function(){var t=n.find("span.hotkey"),i=n.find("span.item"),a=n.find("span.more_hints").show(),o=n.width(),r=a.width(),l=!0;s?s=!1:(_.each(t,function(t,n){var a=e(t),c=a.width();l&&o>r+c?(s=!1,a.show(),e(i[n]).hide(),r+=c):(s=!0,l=!1,a.hide(),e(i[n]).show())}),l&&a.hide())})}},i.bindingHandlers.quickReplyAnim={update:B?null:function(t,i,n,s,a){var o=t.jqTextarea||null,r=t.jqStatus||null,l=t.jqButtons||null,c=t.jqElement||null,d=t.oPrevActions||null,u=i(),h=null;h=_.defaults(u,{saveAction:!1,sendAction:!1,activeAction:!1}),c||(t.jqElement=c=e(t),t.jqTextarea=o=c.find("textarea"),t.jqStatus=r=c.find(".status"),t.jqButtons=l=c.find(".buttons"),t.oPrevActions=d={saveAction:null,sendAction:null,activeAction:null}),x.browser.ie9AndBelow?(!o||c.defualtHeight||o.defualtHeight||(c.defualtHeight=c.outerHeight(),o.defualtHeight=o.outerHeight(),r.defualtHeight=l.outerHeight(),l.defualtHeight=l.outerHeight()),_.defer(function(){var e=d.activeAction!==h.activeAction,t=d.sendAction!==h.sendAction,i=d.saveAction!==h.saveAction;e&&(h.activeAction?(o.animate({height:o.defualtHeight+50},300),c.animate({"max-height":c.defualtHeight+l.defualtHeight+50},300)):(o.animate({height:o.defualtHeight},300),c.animate({"max-height":c.defualtHeight},300))),(t||i)&&(h.sendAction?(c.animate({"max-height":"30px"},300),r.animate({"max-height":"30px",opacity:1},300)):h.saveAction?c.animate({"max-height":0},300):(c.animate({"max-height":c.defualtHeight+l.defualtHeight+50},300),r.animate({"max-height":0,opacity:0},300)))})):(c.toggleClass("saving",h.saveAction),c.toggleClass("sending",h.sendAction),c.toggleClass("active",h.activeAction)),_.defer(function(){d=h})}},i.extenders.reversible=function(e){var t=e();return e.commit=function(){t=e()},e.revert=function(){e(t)},e.commitedValue=function(){return t},e.changed=function(){return t!==e()},e},i.extenders.autoResetToFalse=function(e,i){return e.iTimeout=0,e.subscribe(function(n){n&&(t.clearTimeout(e.iTimeout),e.iTimeout=t.setTimeout(function(){e.iTimeout=0,e(!1)},F.pInt(i)))}),e},F.createCommand=function(e,t,n){var s=t?function(){return s.canExecute&&s.canExecute()?t.apply(e,Array.prototype.slice.call(arguments)):!1}:function(){};return s.enabled=i.observable(!0),n=F.isUnd(n)?!0:n,s.canExecute=i.computed(F.isFunc(n)?function(){return s.enabled()&&n.call(e)}:function(){return s.enabled()&&!!n}),s},i.bindingHandlers.autocomplete={init:function(t,i){function n(e){return e.split(/,\s*/)}function s(e){return n(e).pop()}var a=i(),o=e(t);a&&o&&o[0]&&o.autocomplete({minLength:0,autoFocus:!0,source:function(e,t){a(s(e.term),t)},search:function(){return s(this.value).length>0},focus:function(){return!1},select:function(e,t){var i=n(this.value),s=null;return i.pop(),i.push(t.item.value),i.push(""),this.value=i.join(", ").slice(0,-2),o.trigger("change"),s=function(e){var t=e.value.length;e.blur(),e.focus(),e.setSelectionRange&&e.setSelectionRange(t,t)},s(o[0]),!1}}).on("click",function(){""===o.val()&&(e(o.autocomplete("widget")).is(":visible")?o.autocomplete("close"):(o.autocomplete("option","minLength",0),o.autocomplete("search"),o.autocomplete("option","minLength",1)))})}},i.bindingHandlers.autocompleteSimple={init:function(t,i,n,s,a){var o=e(t),r=i(),l=r.callback,c=r.dataAccessor?r.dataAccessor:F.emptyFunction(),d=r.deleteAccessor?r.deleteAccessor:F.emptyFunction(),u=F.emptyFunction(),h=function(){d(m),e.ui.autocomplete.prototype.__response.call(o.data("autocomplete"),_.filter(p,function(e){return e.value!==m.value}))},p=null,m=null;l&&o&&o[0]&&o.autocomplete({minLength:1,autoFocus:!0,position:{collision:"flip"},source:function(e,t){u=t,l(e.term,function(e){p=e,u(e)})},focus:function(e,t){m=t.item},open:function(t,i){e(o.autocomplete("widget")).find("span.del").on("click",function(e,t){F.calmEvent(e),h()})},select:function(e,t){return _.delay(function(){o.trigger("change")},5),c(t.item),!0}}).on("click",function(t,i){""===o.val()&&(e(o.autocomplete("widget")).is(":visible")?o.autocomplete("close"):(o.autocomplete("option","minLength",0),o.autocomplete("search"),o.autocomplete("option","minLength",1)))}).on("keydown",function(e,t){p&&m&&!m.global&&e.keyCode===M.Key.Del&&e.shiftKey&&(F.calmEvent(e),h())})}},i.bindingHandlers.draggablePlace={init:B?null:function(t,n,s,a,o){if(null===n())return null;var r=s?s():null;e(t).draggable({distance:20,handle:".dragHandle",cursorAt:{top:0,left:0},helper:function(e){return n().apply(a,e&&e.target?[i.dataFor(e.target),e.ctrlKey]:null)},start:r&&r.draggableDragStartCallback?r.draggableDragStartCallback:F.emptyFunction,stop:r&&r.draggableDragStopCallback?r.draggableDragStopCallback:F.emptyFunction}).on("mousedown",function(){F.removeActiveFocus()})}},i.bindingHandlers.droppable={init:B?null:function(t,i){var n=i(),s=n.valueFunc,a=n.switchObserv;!1!==s&&e(t).droppable({hoverClass:"droppableHover",drop:function(e,t){s(e,t)}}),a&&s!==!1&&(a.subscribe(function(i){e(t).data().droppable&&e(t).droppable(i?"disable":"enable")},this),a.valueHasMutated())}},i.bindingHandlers.draggable={init:B?null:function(t,n){e(t).attr("draggable",i.utils.unwrapObservable(n()))}},i.bindingHandlers.autosize={init:function(t,i,n,s,a){var o=e(t),r=i(),l=o.height(),c=o.outerHeight(),d=o.innerHeight(),u=c-d,h=d-l,p=r.minHeight?r.minHeight:0,m=r.maxHeight?r.maxHeight:0,f=r.scrollableHeight?r.scrollableHeight:1e3,g=r.autosizeTrigger?r.autosizeTrigger:null,b=function(e){var t=0;x.browser.firefox&&(t=2*parseInt(o.css("padding-top"),10)),m?setTimeout(function(){o.prop("scrollHeight")<m?(o.height(p-h-u),o.height(o.prop("scrollHeight")+t-h)):o.height(m-h-u)},100):(e||o.prop("scrollHeight")<f)&&setTimeout(function(){o.height(p-h-u),o.height(o.prop("scrollHeight")+t-h)},100)};o.on("keydown",function(e,t){b()}),o.on("paste",function(e,t){b()}),g&&g.subscribe(function(e){b(e)},this),b()}},i.bindingHandlers.customBind={init:function(e,t,n,s,a){var o=t(),r=o.onKeydown?o.onKeydown:null,l=o.onKeyup?o.onKeyup:null,c=o.onPaste?o.onPaste:null,d=o.onInput?o.onInput:null,u=o.valueObserver?o.valueObserver:null;i.bindingHandlers.event.init(e,function(){return{keydown:function(t,i){return r&&r.call(this,e,i,u),!0},keyup:function(t,i){return l&&l.call(this,e,i,u),!0},paste:function(t,i){return c&&c.call(this,e,i,u),!0},input:function(t,i){return d&&d.call(this,e,i,u),!0}}},n,s)}},i.bindingHandlers.fade={init:function(t,i,n,s,a){var o=e(t),r=e('<span class="faded"></span>'),l=_.defaults(i(),{color:null,css:"fadeout"}),c=l.color,d=l.css,u=function(e){if(""!==e){var t=h(e),i="rgba("+t.r+","+t.g+","+t.b;p(e,i)}},h=function(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return e=e.replace(t,function(e,t,i,n){return t+t+i+i+n+n}),i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null},p=function(e,t){F.isRTL()?r.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",1)), color-stop(100%,"+t+",0)))").css("background-image","-moz-linear-gradient(left, "+t+",1)0%, "+t+",0)100%)").css("background-image","-webkit-linear-gradient(left, "+t+"1)0%,"+t+",0)100%)").css("background-image","-o-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","-ms-linear-gradient(left, "+t+",1)0%,"+t+",0)100%)").css("background-image","linear-gradient(left, "+t+",1)0%,"+t+",0)100%)"):r.css("filter","progid:DXImageTransform.Microsoft.gradient(startColorstr='"+e+"', endColorstr='"+e+"',GradientType=1 )").css("background-image","-webkit-gradient(linear, left top, right top, color-stop(0%,"+t+",0)), color-stop(100%,"+t+",1)))").css("background-image","-moz-linear-gradient(left, "+t+",0)0%, "+t+",1)100%)").css("background-image","-webkit-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-o-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","-ms-linear-gradient(left, "+t+",0)0%,"+t+",1)100%)").css("background-image","linear-gradient(left, "+t+",0)0%,"+t+",1)100%)")};o.parent().addClass(d),o.after(r),void 0!==l.color.subscribe&&(u(c()),c.subscribe(function(e){u(e)},this))}},i.bindingHandlers.highlighter={init:function(n,s,a,o,r){function l(t){if(A){var i=0,n=u.text(),s=n.split(b),a=[],o='<span class="search_highlight">$&</span>';e.each(s,function(t,i){_.any(g,function(e){return e===i})?e.each(i,function(t,i){a.push(e(i.replace(/(.)/,o)))}):e.each(i,function(e,t){a.push(" "===t?document.createTextNode(" "):document.createTextNode(t))})}),t?u.empty().append(a):(i=c(),u.empty().append(a),d(i))}}function c(){var e,i,s,a,o=0;return"undefined"!=typeof t.getSelection?(e=t.getSelection().getRangeAt(0),i=e.cloneRange(),i.selectNodeContents(n),i.setEnd(e.endContainer,e.endOffset),o=i.toString().length):"undefined"!=typeof document.selection&&"Control"!==document.selection.type&&(s=document.selection.createRange(),a=document.body.createTextRange(),a.moveToElementText(n),a.setEndPoint("EndToEnd",s),o=a.text.length),o}function d(e){var i,s,a;if(!n)return!1;if(document.createRange)i=document.createRange(),i.selectNodeContents(n),i.setStart(n,e),i.setEnd(n,e),s=t.getSelection(),s.removeAllRanges(),s.addRange(i);else{if(n.createTextRange)return a=n.createTextRange(),a.collapse(!0),a.moveEnd(e),a.moveStart(e),a.select(),!0;if(n.setSelectionRange)return n.setSelectionRange(e,e),!0}return!1}var u=e(n),h=s(),p=h.valueObserver?h.valueObserver:null,m=h.highlighterValueObserver?h.highlighterValueObserver:null,f=h.highlightTrigger?h.highlightTrigger:null,g=["from:","to:","subject:","text:","email:","has:","date:","text:","body:"],b=function(){var t="";return e.each(g,function(e,i){t=e?t+"|\\b"+i:t+"\\b"+i}),new RegExp("("+t+")","g")}(),v=function(e){return e.replace(/\xC2\xA0/g," ").replace(/\xA0/g," ").replace(/[\s]+/g," ")},y=-1,C=t.navigator.language||t.navigator.userLanguage,E=["zh","zh-TW","zh-CN","zh-HK","zh-SG","zh-MO","ja","ja-JP","ko","ko-KR","vi","vi-VN","th","th-TH"],A=!_.include(E,C);i.bindingHandlers.event.init(n,function(){return{keydown:function(e,t){return t.keyCode!==M.Key.Enter},keyup:function(e,t){var i=[M.Key.Left,M.Key.Right,M.Key.Home,M.Key.End],n=-1!==F.inArray(t.keyCode,i);return t.keyCode===M.Key.Shift||t.keyCode===M.Key.Ctrl||t.keyCode===M.Key.Dash||t.keyCode===M.Key.Apostrophe||t.keyCode===M.Key.Six&&t.shiftKey||n||(t.ctrlKey||y===M.Key.Ctrl)&&t.keyCode===M.Key.a||(p(v(u.text())),l(!1)),y=t.keyCode,!0},paste:function(e,t){return setTimeout(function(){p(v(u.text())),l(!1)},0),!0}}},a,o),setTimeout(function(){l(!0)},0),f.notifySubscribers(),f.subscribe(function(e){setTimeout(function(){l(!!e)},0)},this),m.subscribe(function(){u.text(p())},this)}},i.bindingHandlers.quoteText={init:function(t,i,n,s,a){var o=(e(t),e('<span class="button_quote">'+F.i18n("HELPDESK/BUTTON_QUOTE")+"</span>")),r=i(),l=r.actionHandler,c=!1,d=null,u="";e("#pSevenContent").append(o),e(document.body).on("click",function(t){c=!!e(t.target).parents(".posts")[0],document.getSelection?(d=document.getSelection(),d&&(u=d.toString())):u=document.selection.createRange().text,c&&""!==u.replace(/[\n\r\s]/,"")?o.css({top:t.clientY+20,left:t.clientX+20}).show():o.hide()}),o.on("click",function(e){l.call(s,u)})}},i.bindingHandlers.adjustHeightToContent={init:function(t,i,n,s,a){var o=e(t),r=null,l=null,c=null;_.delay(_.bind(function(){r=e(_.max(o.find(".title .text"),function(e){return e.offsetWidth})),l=r.parent(),c=l.find(".icon"),o.css("min-width",parseInt(l.css("margin-left"))+parseInt(l.css("padding-left"))+parseInt(c.width())+parseInt(c.css("margin-left"))+parseInt(c.css("margin-right"))+parseInt(c.css("padding-left"))+parseInt(c.css("padding-right"))+parseInt(r.width())+parseInt(r.css("margin-left"))+parseInt(r.css("padding-left"))+10)},this),1)}},i.bindingHandlers.customTooltip={init:W||B?null:function(t,i){var n=F.i18n(i()),s=e(t),a=s.find("span.dropdown"),o=!1,r=function(){var t=e(this);t.hasClass("expand")||(clearTimeout(F.CustomTooltip.iHideTimer),o=!0,clearTimeout(F.CustomTooltip.iTimer),F.CustomTooltip.iTimer=setTimeout(function(){o&&(t.hasClass("expand")?(o=!1,clearTimeout(F.CustomTooltip.iTimer),F.CustomTooltip.hide()):F.CustomTooltip.show(n,t))},100))},l=function(){clearTimeout(F.CustomTooltip.iHideTimer),F.CustomTooltip.iHideTimer=setTimeout(function(){o=!1,clearTimeout(F.CustomTooltip.iTimer),F.CustomTooltip.hide()},10)},c=function(){},d=function(){s.unbind("mouseover",r),s.unbind("mouseout",l),s.unbind("click",l),a.unbind("mouseover",l),a.unbind("mouseout",c),""!==n&&(s.bind("mouseover",r),s.bind("mouseout",l),s.bind("click",l),a.bind("mouseover",l),a.bind("mouseout",c))},u=null;"function"==typeof n&&(n=n()),d(),"function"==typeof i().subscribe&&null===u&&(u=i().subscribe(function(e){n=e,d()}))}},i.bindingHandlers.foreachprop={transformObject:function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push({key:i,value:e[i]});return t},init:function(e,t,n,s,a){var o=i.utils.unwrapObservable(t()),r=i.bindingHandlers.foreachprop.transformObject(o);return i.applyBindingsToNode(e,{foreach:r},a),{controlsDescendantBindings:!0}}},F.inArray=e.inArray,F.isFunc=e.isFunction,F.trim=e.trim,F.emptyFunction=function(){},F.isUnd=function(e){return void 0===e},F.isNull=function(e){return null===e},F.isNormal=function(e){return!F.isUnd(e)&&!F.isNull(e)},F.isNumeric=function(e){return F.isNormal(e)?/^[1-9]+[0-9]*$/.test(e.toString()):!1},F.pInt=function(e){var i=t.parseInt(e,10);return isNaN(i)&&(i=0),i},F.pString=function(e){return F.isNormal(e)?e.toString():""},F.isNonEmptyArray=function(e,t){return t=t||1,_.isArray(e)&&t<=e.length},F.pImport=function(e,t,i){e[t]=i},F.pExport=function(e,t,i){return F.isUnd(e[t])?i:e[t]},F.encodeHtml=function(e){return e?e.toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},F.i18n=function(e,t,i,n){var s="",a=F.isUnd(O[e])?F.isNormal(i)?i:e:O[e];if(F.isUnd(n)||(a=function(e,t){var i=F.getPlural(H.User.DefaultLanguage,e),n=t.split("|");return n&&n[i]?n[i]:n&&n[0]?n[0]:t}(n,a)),F.isNormal(t))for(s in t)if(t.hasOwnProperty(s)){var o=new RegExp("%"+s+"%","g");a=a.replace(o,t[s])}return a},F.roundNumber=function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},F.friendlySize=function(e){var t=1024,i=t*t,n=t*t*t;return e=F.pInt(e),e>=n?F.roundNumber(e/n,1)+F.i18n("MAIN/GIGABYTES"):e>=i?F.roundNumber(e/i,1)+F.i18n("MAIN/MEGABYTES"):e>=t?F.roundNumber(e/t,0)+F.i18n("MAIN/KILOBYTES"):e+F.i18n("MAIN/BYTES")},F.timeOutAction=function(){var e={};return function(i,n,s){F.isUnd(e[i])&&(e[i]=0),t.clearTimeout(e[i]),e[i]=t.setTimeout(n,s)}}(),F.$log=null,F.aLog=[],F.log=function(){function t(e,t){return"string"==typeof t&&t.length>50?t.substring(0,50):t}if(H&&H.ClientDebug&&x.browser&&!x.browser.ie9AndBelow){var i=F.$log||e('<div style="display: none;"></div>').appendTo("body"),n=[];_.each(arguments,function(e){var i="string"==typeof e?e:JSON.stringify(e,t);0===n.length&&(i=" *** "+i+" *** "),n.push(i)}),n.push(moment().format(" *** D MMMM, YYYY, HH:mm:ss *** ")),F.$log=i,F.aLog.length>200&&F.aLog.shift(),F.aLog.push(F.encodeHtml(n.join(", "))),i.html(F.aLog.join("<br /><br />"))}},F.getAjaxDataForLog=function(e,t){var i=t;if(t&&t.Result)switch(e){case"MessagesGetList":case"MessagesGetListByUids":i={Result:{Uids:t.Result.Uids,UidNext:t.Result.UidNext,FolderHash:t.Result.FolderHash,MessageCount:t.Result.MessageCount,MessageUnseenCount:t.Result.MessageUnseenCount,MessageResultCount:t.Result.MessageResultCount}};break;case"MessageGet":i={Result:{Folder:t.Result.Folder,Uid:t.Result.Uid,Subject:t.Result.Subject,Size:t.Result.Size,TextSize:t.Result.TextSize,From:t.Result.From,To:t.Result.To}};break;case"MessagesGetBodies":i={Result:_.map(t.Result,function(e){return{Uid:e.Uid,Subject:e.Subject}})}}else t&&(i={Result:t.Result,ErrorCode:t.ErrorCode});return i},F.getImportContactsLink=function(){return"?/ImportContacts/"},F.getExportContactsLink=function(e){return"?/Raw/Contacts"+e+"/"},F.getExportCalendarLinkByHash=function(e,t){return"?/Raw/Calendar/"+e+"/"+t},F.getDownloadLinkByHash=function(e,t,i,n){return i=F.isUnd(i)?!1:!!i,n=F.isUnd(n)?"":n,"?/Raw/Download/"+e+"/"+t+"/"+(i?"1":"0")+(""===n?"":"/"+n)},F.getIframeLinkByHash=function(e,t,i,n){return i=F.isUnd(i)?!1:!!i,n=F.isUnd(n)?"":n,"?/Raw/Iframe/"+e+"/"+t+"/"+(i?"1":"0")+(""===n?"":"/"+n)},F.getIframeWrappwer=function(e,i){return"?/Raw/Iframe/"+e+"/"+t.encodeURIComponent(i)+"/"},F.getViewThumbnailLinkByHash=function(e,t,i,n){return i=F.isUnd(i)?!1:!!i,n=F.isUnd(n)?"":n,"?/Raw/Thumbnail/"+e+"/"+t+"/"+(i?"1":"0")+(""===n?"":"/"+n)},F.getFilestorageDownloadLinkByHash=function(e,t,i){var n="?/Raw/FilesDownload/"+e+"/"+t;return F.isUnd(i)||(n=n+"/0/"+i),n},F.getFilestorageViewLinkByHash=function(e,t,i){var n="?/Raw/FilesView/"+e+"/"+t;return F.isUnd(i)||(n=n+"/0/"+i),n},F.getFilestorageViewThumbnailLinkByHash=function(e,t,i){var n="?/Raw/FilesThumbnail/"+e+"/"+t;return F.isUnd(i)||(n=n+"/0/"+i),n},F.getFilestoragePublicViewLinkByHash=function(e){return"?/Window/Files/0/"+e},F.getFilestoragePublicDownloadLinkByHash=function(e){return"?/Raw/FilesPub/0/"+e},F.daysInMonth=function(e,t){return e>0&&13>e&&t>0?new Date(t,e,0).getDate():31},F.WindowOpener={_iDefaultRatio:.8,_aOpenedWins:[],openMessage:function(e,t){if(e){var i=e.folder(),n=e.uid(),s="";s=x.Routing.buildHashFromArray(t?[M.Screens.SingleCompose,"drafts",i,n]:[M.Screens.SingleMessageView,i,"msg"+n]),this.openTab(s)}},openTab:function(i,n){e.cookie("aft-cache-ctrl","1");var s=null;return s=t.open(i,"_blank"),s&&(s.focus(),s.name=n?n:H.Accounts?H.Accounts.currentId():0,this._aOpenedWins.push(s)),s},open:function(e,i,n){var s=n?",menubar=yes":",menubar=no",a="location=no,toolbar=no,status=no,scrollbars=yes,resizable=yes"+s,o=null;return i=i.replace(/\W/g,""),a+=this._getSizeParameters(),o=t.open(e,i,a),o.focus(),o.name=H.Accounts?H.Accounts.currentId():0,this._aOpenedWins.push(o),o},getOpenedDraftUids:function(){this._aOpenedWins=_.filter(this._aOpenedWins,function(e){return!e.closed});var e=_.map(this._aOpenedWins,function(e){return e.App?e.App.MailCache.editedDraftUid():""});return x.Screens.hasOpenedMinimizedPopups()&&e.push(x.MailCache.editedDraftUid()),_.uniq(_.compact(e))},closeComposesWithDraftUids:function(e){_.each(this._aOpenedWins,function(t){t.App&&-1!==F.inArray(t.App.MailCache.editedDraftUid(),e)&&t.close()}),-1!==F.inArray(x.MailCache.editedDraftUid(),e)&&x.Api.closeComposePopup()},closeAll:function(){for(var e=this._aOpenedWins.length,t=0,i=null;e>t;t++)i=this._aOpenedWins[t],i.closed||i.close();this._aOpenedWins=[]},_getSizeParameters:function(){var e=t.screen.width,i=Math.ceil(e*this._iDefaultRatio),n=Math.ceil((e-i)/2),s=t.screen.height,a=Math.ceil(s*this._iDefaultRatio),o=Math.ceil((s-a)/2);return",width="+i+",height="+a+",top="+o+",left="+n}},F.delegateRun=function(e,t,i){e&&e[t]&&e[t].apply(e,_.isArray(i)?i:[])},F.strRepeat=function(e,t){return new Array(t+1).join(e)},F.deferredUpdate=function(e,i,n,s){!e.__interval&&i?(e.__state=!0,s(e,!0),e.__interval=t.setInterval(function(){e.__state||(s(e,!1),t.clearInterval(e.__interval),e.__interval=null)},n)):i||(e.__state=!1)},F.draggableMessages=function(){return e('<div class="draggable draggableMessages"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},F.draggableContacts=function(){
return e('<div class="draggable draggableContacts"><div class="content"><span class="count-text"></span></div></div>').appendTo("#pSevenHidden")},F.removeActiveFocus=function(){if(document&&document.activeElement&&document.activeElement.blur){var t=e(document.activeElement);(t.is("input")||t.is("textarea"))&&document.activeElement.blur()}},F.uiDropHelperAnim=function(i,n){var s=0,a=0,o=0,r=0,l=0,c=0,d=n.helper.clone().appendTo("#pSevenHidden"),u=e(i.target).find(".animGoal"),h=null;u=e(u[0]?u[0]:i.target),h=u&&u[0]?u.offset():null,h&&(s=t.Math.round(h.left),a=t.Math.round(h.top),l=u.width(),c=u.height(),o=s,l>0&&(o+=t.Math.round(l/2)),r=a,c>0&&(r+=t.Math.round(c/2)),d.animate({left:o+"px",top:r+"px","font-size":"0px",opacity:0},800,"easeOutQuint",function(){e(this).remove()}))},F.isTextFieldFocused=function(){var e=document&&document.activeElement?document.activeElement:null,t=e?e.tagName:null,i=e&&e.type?e.type.toLowerCase():null,n=e?e.contentEditable:null;return"INPUT"===t&&("text"===i||"password"===i||"email"===i)||"TEXTAREA"===t||"IFRAME"===t||"true"===n},F.removeSelection=function(){t.getSelection?t.getSelection().removeAllRanges():document.selection&&document.selection.empty()},F.getMonthNamesArray=function(){for(var e=F.i18n("DATETIME/MONTH_NAMES").split(" "),t=12,i=e.length;t>i;i++)e[i]="";return e},F.getPlural=function(e,t){var i=0;switch(t=F.pInt(t),e){case"Arabic":i=0===t?0:1===t?1:2===t?2:t%100>=3&&10>=t%100?3:t%100>=11?4:5;break;case"Bulgarian":i=1===t?0:1;break;case"Chinese-Simplified":i=0;break;case"Chinese-Traditional":i=1===t?0:1;break;case"Czech":i=1===t?0:t>=2&&4>=t?1:2;break;case"Danish":i=1===t?0:1;break;case"Dutch":i=1===t?0:1;break;case"English":i=1===t?0:1;break;case"Estonian":i=1===t?0:1;break;case"Finish":i=1===t?0:1;break;case"French":i=1===t?0:1;break;case"German":i=1===t?0:1;break;case"Greek":i=1===t?0:1;break;case"Hebrew":i=1===t?0:1;break;case"Hungarian":i=1===t?0:1;break;case"Italian":i=1===t?0:1;break;case"Japanese":i=0;break;case"Korean":i=0;break;case"Latvian":i=t%10===1&&t%100!==11?0:0!==t?1:2;break;case"Lithuanian":i=t%10===1&&t%100!==11?0:t%10>=2&&(10>t%100||t%100>=20)?1:2;break;case"Norwegian":i=1===t?0:1;break;case"Persian":i=0;break;case"Polish":i=1===t?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Portuguese-Portuguese":i=1===t?0:1;break;case"Portuguese-Brazil":i=1===t?0:1;break;case"Romanian":i=1===t?0:0===t||t%100>0&&20>t%100?1:2;break;case"Russian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Slovenian":i=t%10===1&&t%100!==11?0:t%10===2&&t%100!==12?1:2;break;case"Serbian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Spanish":i=1===t?0:1;break;case"Swedish":i=1===t?0:1;break;case"Thai":i=0;break;case"Turkish":i=1===t?0:1;break;case"Ukrainian":i=t%10===1&&t%100!==11?0:t%10>=2&&4>=t%10&&(10>t%100||t%100>=20)?1:2;break;case"Vietnamese":i=0;break;default:i=0}return i},F.getFileExtension=function(e){var t="",i=e.lastIndexOf(".");return i>-1&&(t=e.substr(i+1)),t},F.getFileNameWithoutExtension=function(e){var t=e,i=e.lastIndexOf(".");return i>-1&&(t=e.substr(0,i)),t},F.defaultOptionsAfterRender=function(e,t){t&&(F.isUnd(t.disable)||i.applyBindingsToNode(e,{disable:t.disable},t))},F.getDateFormatForMoment=function(e){var t="MM/DD/YYYY";switch(e){case"MM/DD/YYYY":t="MM/DD/YYYY";break;case"DD/MM/YYYY":t="DD/MM/YYYY";break;case"DD Month YYYY":t="DD MMMM YYYY"}return t},F.getDateFormatForDatePicker=function(e){var t="mm/dd/yy";switch(e){case"MM/DD/YYYY":t="mm/dd/yy";break;case"DD/MM/YYYY":t="dd/mm/yy";break;case"DD Month YYYY":t="dd MM yy"}return t},F.getDateFormatsForSelector=function(){return _.map(H.App.DateFormats,function(e){switch(e){case"MM/DD/YYYY":return{name:F.i18n("DATETIME/DATEFORMAT_MMDDYYYY"),value:e};case"DD/MM/YYYY":return{name:F.i18n("DATETIME/DATEFORMAT_DDMMYYYY"),value:e};case"DD Month YYYY":return{name:F.i18n("DATETIME/DATEFORMAT_DDMONTHYYYY"),value:e};default:return{name:e,value:e}}})},F.getTitleForEvent=function(e){var t=e?F.trim(e.replace(/[\n\r]/," ")):"",i=t.indexOf(" ",180);return i>=0&&(t=t.substring(0,i)+"..."),t.length>200&&(t=t.substring(0,200)+"..."),t},F.desktopNotify=function(){var e=[];return function(i){if(i&&H.User.DesktopNotifications&&t.Notification&&!x.focused())switch(i.action){case"show":if(t.Notification.permission!==M.notificationPermission.Denied){var n,s={body:i.body||"",dir:i.dir||"auto",lang:i.lang||"",tag:i.tag||Math.floor(900*Math.random()+100),icon:i.icon||!1},a=function(){n=new t.Notification(i.title,s),n.onclick=function(e){i.callback&&i.callback(),n.close()},i.timeout&&setTimeout(function(){n.close()},i.timeout),e.push(n)};t.Notification.permission===M.notificationPermission.Granted?a():t.Notification.permission===M.notificationPermission.Default&&t.Notification.requestPermission(function(e){e===M.notificationPermission.Granted&&a()})}break;case"hide":_.each(e,function(t,n){i.tag===t.tag&&(t.close(),e.splice(n,1))});break;case"hideAll":_.each(e,function(e){e.close()}),e.length=0}}}(),F.isRTL=function(){return K.hasClass("rtl")},F.validateFileOrFolderName=function(e){return e=F.trim(e),""!==e&&!/["\/\\*?<>|:]/.test(e)},F.shadeColor=function(e,i){var n=!1,s=0,a=0,o=0,r=0;return"#"===e[0]&&(e=e.slice(1),n=!0),s=t.parseInt(e,16),a=(s>>16)+i,a>255?a=255:0>a&&(a=0),o=(s>>8&255)+i,o>255?o=255:0>o&&(o=0),r=(255&s)+i,r>255?r=255:0>r&&(r=0),(n?"#":"")+(r|o<<8|a<<16).toString(16)},F.extend=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},F.thumbQueue=function(){var e={},t={},i=2;return function(n,s,a){s&&a?!(n in t)||t[n]>0?(n in t||(t[n]=i,e[n]=[]),t[n]--,a(s)):e[n].push({imageSrc:s,imageSrcObserver:a,messageUid:n}):e[n]&&e[n].length&&(e[n][0].imageSrcObserver(e[n][0].imageSrc),e[n].shift())}}(),F.checkConnection=function(){var e=-1,t=(new Date).getTime(),i=0,n=!1;return setInterval(function(){i=(new Date).getTime(),n=i>t+5e3+1e3,t=i,n&&x.Api.hideError(!0)},5e3),function(t,i){clearTimeout(e),"error"!==i?(x.InternetConnectionError=!1,x.Api.hideError(!0)):"SystemPing"===t?(x.InternetConnectionError=!0,x.Api.showError(F.i18n("WARNING/NO_INTERNET_CONNECTION"),!1,!0,!0),e=setTimeout(function(){x.Ajax.send({Action:"SystemPing"})},6e4)):x.Ajax.send({Action:"SystemPing"})}}(),F.loadScript=function(e,i,n,s){var a=document.createElement("script");!F.isUnd(s)&&i&&(t[s]=i),F.isUnd(n)&&(n={}),_.each(n,function(e,t){a.setAttribute(t,e)}),a.type="text/javascript",a.src=e,document.body.appendChild(a)},F.registerMailto=function(e){!t.navigator||!F.isFunc(t.navigator.registerProtocolHandler)||e&&1===x.Storage.getData("MailtoAsked")||(t.navigator.registerProtocolHandler("mailto",F.Common.getAppPath()+"#"+M.Screens.Compose+"/to/%s",""!==H.App.SiteName?H.App.SiteName:"WebMail"),x.Storage.setData("MailtoAsked",1))},F.CustomTooltip={_$Region:null,_$ArrowTop:null,_$Text:null,_$ArrowBottom:null,_iArrowBorderLeft:0,_iArrowMarginLeft:0,_iLeftShift:0,_bInitialized:!1,_bShown:!1,iHideTimer:0,iTimer:0,init:function(){this._bInitialized||(this._$Region=e('<span class="custom_tooltip"></span>').appendTo("body").hide(),this._$ArrowTop=e('<span class="custom_tooltip_arrow top"></span>').appendTo(this._$Region),this._$Text=e('<span class="custom_tooltip_text"></span>').appendTo(this._$Region),this._$ArrowBottom=e('<span class="custom_tooltip_arrow bottom"></span>').appendTo(this._$Region),this._iArrowMarginLeft=F.pInt(this._$ArrowTop.css("margin-left")),this._iArrowBorderLeft=F.pInt(this._$ArrowTop.css("border-left-width")),this._iLeftShift=F.pInt(this._$Region.css("margin-left"))+this._iArrowMarginLeft+this._iArrowBorderLeft,this._bInitialized=!0),this._$ArrowTop.show(),this._$ArrowBottom.hide(),this._$ArrowTop.css({"margin-left":this._iArrowMarginLeft+"px"}),this._$ArrowBottom.css({"margin-left":this._iArrowMarginLeft+"px"})},show:function(t,i){this.init();var n=i.offset(),s=i.width(),a=70>s?s/2:s/4,o=F.pInt(i.css("padding-left")),r=e("body");this._$Text.html(t),this._bShown=!0,this._$Region.stop().fadeIn(260,_.bind(function(){this._bShown||this._$Region.hide()},this)).css({top:n.top+i.outerHeight()+1,left:n.left+o+a-this._iLeftShift,right:"auto"}),r.outerHeight()<this._$Region.outerHeight()+this._$Region.offset().top&&(this._$ArrowTop.hide(),this._$ArrowBottom.show(),this._$Region.css({top:n.top-this._$Region.outerHeight()})),setTimeout(function(){r.width()<this._$Region.outerWidth(!0)+this._$Region.offset().left&&(this._$Region.css({left:"auto",right:0}),this._$ArrowTop.css({"margin-left":a+n.left-this._$Region.offset().left-this._iArrowBorderLeft+"px"}),this._$ArrowBottom.css({"margin-left":a+n.left-this._$Region.offset().left-this._iArrowBorderLeft+F.pInt(this._$Region.css("margin-right"))+"px"}))}.bind(this),1)},hide:function(){this._bInitialized&&(this._bShown=!1,this._$Region.hide())}},F.htmlStartsWithBlockquote=function(e){var t=e.split("<blockquote"),i=t.length>0?t[0]:"",n=F.trim(i.replace(/<[^>]*>/g,""));return""===n},F.escapeQuotes=function(e){return e.replace(/'/g,"\\'").replace(/"/g,'\\"')},F.changeFavicon=function(t){e("head").append('<link rel="shortcut icon" type="image/x-icon" href='+t+" />")},F.checkCookies=function(){e.cookie("checkCookie","1",{path:"/"});var t="1"===e.cookie("checkCookie");return t||x.Screens.showError(F.i18n("WARNING/COOKIES_DISABLED"),!1,!0),t},F.calmEvent=function(e){e&&(e.stop&&e.stop(),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),e.cancelBubble=!0,e.returnValue=!1)},F.Common={},F.Common.getRequestParam=function(e){var t=[],i=[],n=null;return void 0===this.aGetParams&&(t=""!==location.search?location.search.substr(1).split("&"):[],t.length>0&&_.each(t,function(e){var t=e.split("=");i[t[0]]=t.length>1?t[1]:""}),this.aGetParams=i),void 0!==this.aGetParams[e]&&(n=this.aGetParams[e]),n},F.Common.getAppPath=function(){var e=t.location.origin||t.location.protocol+"//"+t.location.host;return e+t.location.pathname},F.Common.clearAndReloadLocation=function(e,i){if(e||""===t.location.search&&""===t.location.hash)t.location.reload();else{var n=F.Common.getAppPath();i||""===t.location.search||(n+=t.location.search),"replaceState"in history?(history.replaceState("",document.title,n),t.location.reload(!0)):t.location.href=n}},F.Address={},F.Address.isCorrectEmail=function(e){return!!e.match(/^[A-Z0-9\"!#\$%\^\{\}`~&'\+\-=_\.]+@[A-Z0-9\.\-]+$/i)},F.Address.getFullEmail=function(e,t){var i="";return i=t.length>0?e.length>0?F.Address.isCorrectEmail(e)||-1!==e.indexOf(",")?'"'+e+'" <'+t+">":e+" <"+t+">":t:e},F.Address.getEmailParts=function(t,i){for(var n=t.indexOf('"'),s=t.indexOf('"',n+1),a=t.indexOf("<",s),o=-1,r=-1,l="",c="";-1!==a;)o=a,a=t.indexOf("<",a+1);return a=o,r=t.indexOf(">",a+1),-1===a?c=e.trim(t):(n=i?-1:n,l=e.trim(-1===n?t.substring(0,a):t.substring(n+1,s)),c=e.trim(t.substring(a+1,r))),{name:l,email:c,fullEmail:F.Address.getFullEmail(l,c)}},F.Address.getArrayRecipients=function(e,t){for(var i=[",",";"," "],n="",s=e,a=0,o=0,r="",l=null,c=[];s.length>0;){for(a=F.Address._getFirstSeparatorPosition(s,i),o=a;-1!==_.indexOf(i,s[o+1]);)o++;-1===a?(r=n+s,l=F.Address.getEmailParts(r),(t||F.Address.isCorrectEmail(l.email))&&c.push(l),s=""):(r=n+s.substring(0,a),l=F.Address.getEmailParts(r),F.Address.isCorrectEmail(l.email)?(c.push(l),n=""):n+=s.substring(0,o+1),s=s.substring(o+1))}return c},F.Address._getFirstSeparatorPosition=function(e,t){var i=-1;return _.each(t,function(t){var n=e.indexOf(t);-1!==n&&(-1===i||i>n)&&(i=n)}),i},F.Address.getIncorrectEmailsFromAddressString=function(t){for(var i=t.replace(/"[^"]*"/g,"").replace(/;/g,",").split(","),n=[],s=0,a=i.length,o="",r=null;a>s;s++)o=e.trim(i[s]),o.length>0&&(r=F.Address.getEmailParts(e.trim(i[s])),F.Address.isCorrectEmail(r.email)||n.push(r.email));return n},function(e){e.fn.splitter=function(i){return i=i||{},this.each(function(){var n=!1,s=i.collapse?i.collapse:!1,a=i.name,o=0,r=0,l=0,c={},d={},u=function(t){n=!0,C.addClass(b.activeClass),b._posSplit=-((E?v._overallWidth-t[b.eventPos]:t[b.eventPos])-y.get(0)[b.pxSplit]),e("body").attr({unselectable:"on"}).addClass("unselectable"),e(document).bind("mousemove",h).bind("mouseup",p)},h=function(e){var t=(E?v._overallWidth-e[b.eventPos]:e[b.eventPos])+b._posSplit;m(t),F.isFunc(i.resizeFunc)&&i.resizeFunc()},p=function A(t){C.removeClass(b.activeClass),e("body").attr({unselectable:"off"}).removeClass("unselectable"),a&&x.Storage.setData(a+"ResizerWidth",y.get(0)[b.pxSplit]),e(document).unbind("mousemove",h).unbind("mouseup",A),F.isFunc(i.resizeFunc)&&i.resizeFunc()},m=function(e,i){var n=y.get(0)._min;l=e,s&&n-e>150&&(e=5,i=!0),i||(e=t.Math.max(n,v._overallWidth-y.get(1)._max,t.Math.min(e,y.get(0)._max,v._overallWidth-y.get(1)._min))),y.get(0).$.css(b.split,e),y.get(1).$.css(b.split,v._overallWidth-e),x.browser.ie8AndBelow||y.trigger("resize")},f=function(e,i){for(var n=0,s=1;s<arguments.length;s++)n+=t.Math.max(t.parseInt(e.css(arguments[s]),10)||0,0);return n},g=(i.splitHorizontal?"h":i.splitVertical?"v":i.type)||"v",b=e.extend({activeClass:"active",pxPerKey:8,tabIndex:0,accessKey:""},{v:{keyLeft:39,keyRight:37,type:"v",eventPos:"pageX",origin:"left",split:"width",pxSplit:"offsetWidth",side1:"Left",side2:"Right",fixed:"height",pxFixed:"offsetHeight",side3:"Top",side4:"Bottom"},h:{keyTop:40,keyBottom:38,type:"h",eventPos:"pageY",origin:"top",split:"height",pxSplit:"offsetHeight",side1:"Top",side2:"Bottom",fixed:"width",pxFixed:"offsetWidth",side3:"Left",side4:"Right"}}[g],i),v=e(this),y=e(">*:not(css3pie)",v).each(function(){this.$=e(this)}),C=e(".resize_handler",y.get(0)).attr({unselectable:"on"}).bind("mousedown",u),E="rtl"===v.css("direction");y.get(0)._paneName=b.side1,y.get(1)._paneName=b.side2,y.each(function(){this._min=b["min"+this._paneName]||f(this.$,"min-"+b.split),this._max=b["max"+this._paneName]||f(this.$,"max-"+b.split)||9999,this._init=void 0===b["size"+this._paneName]?t.parseInt(e.css(this,b.split),10):b["size"+this._paneName]}),o=a?x.Storage.getData(a+"ResizerWidth")||y.get(0)._init:y.get(0)._init,isNaN(o)&&(o=v[0][b.pxSplit],o=t.Math.round(o/y.length)),b.resizeToWidth&&!x.browser.ie8AndBelow&&e(t).bind("resize",function(e){e.target===this&&v.trigger("resize")}),v.bind("resize",function(e,t,i,s,a){var o=e.target.className+"_"+i;n&&(c={}),e.target===this&&(v._overallWidth=v[0][b.pxSplit],v._overallWidth<=0||(r=b.sizeRight||b.sizeBottom?v._overallWidth-y.get(1)[b.pxSplit]:y.get(0)[b.pxSplit],isNaN(t)?t=r:i&&(a?t=c[o]?c[o]:r:(n=!1,c[o]?(t=c[o],c[o]=null):(t===r?(c[o]=null,t=d[o]):c[o]=d[o]=r,_.each(c,function(e,t){t!==o&&(c[t]=null)})))),m(t,s)))}).trigger("resize",[o])})}}(jQuery),function(e){e.ui.autocomplete.prototype._renderItem=function(t,i){var n=i.label.match(/[a-zA-Z0-9.\-_]+@[a-zA-Z0-9.]+/g);return n&&(i.label=i.label.replace("<"+n[0]+">","<span style='opacity: 0.5'>&lt;"+n[0]+"&gt</span>")),e("<li>").append("<a>"+i.label+(i.global?"":'<span class="del"></span>')+"</a>").appendTo(t)},e.ui.autocomplete.prototype._renderMenu=function(t,i){var n=this,s="";e.each(i,function(e,i){i&&i.category&&i.category!==s&&(s=i.category,t.append('<li class="ui-autocomplete-category">'+i.category+"</li>")),n._renderItemData(t,i)})},e.ui.autocomplete.prototype._move=function(e,t){return this.menu.element.is(":visible")?(this.menu.isFirstItem()&&/^previous/.test(e)?(this._value(this.term),this.menu._move("first","first",t)):this.menu.isLastItem()&&/^next/.test(e)&&(this._value(this.term),this.menu._move("last","last",t)),void this.menu[e](t)):void this.search(null,t)}}(jQuery),r.prototype.composeMessage=function(){x.Routing.setHash([M.Screens.Compose])},r.prototype.composeMessageFromDrafts=function(e,t){var i=x.Links.composeFromMessage("drafts",e,t);x.Routing.setHash(i)},r.prototype.composeMessageAsReplyOrForward=function(e,t,i){var n=x.Links.composeFromMessage(e,t,i);x.Routing.setHash(n)},r.prototype.composeMessageToAddresses=function(e){var t=x.Links.composeWithToField(e);x.Routing.setHash(t)},r.prototype.composeMessageWithVcard=function(e){var t=["vcard",e];x.Routing.goDirectly(x.Links.compose(),t)},r.prototype.composeMessageWithPgpKey=function(e,t){var i=["data-as-file",e,t];x.Routing.goDirectly(x.Links.compose(),i)},r.prototype.composeMessageWithFiles=function(e){var t=["file",e];x.Routing.goDirectly(x.Links.compose(),t)},r.prototype.closeComposePopup=function(){},r.prototype.createMailAccount=function(e){},r.prototype.showChangeDefaultAccountPasswordPopup=function(){},r.prototype.showConfigureMailPopup=function(e){},r.prototype.downloadByUrl=function(i){var n=null;W?t.open(i):(n=e('<iframe style="display: none;"></iframe>').appendTo(document.body),n.attr("src",i),setTimeout(function(){n.remove()},6e4))},r.prototype.isPgpSupported=function(){return!(!t.crypto||!t.crypto.getRandomValues)},r.prototype.pgp=function(i,n){if(F.isFunc(i))if(this.openPgp)i(this.openPgp);else if(this.isPgpSupported()){null!==this.openPgpCallbacks?this.openPgpCallbacks.push(i):i(!1);var s=this;this.openPgpRequest||(this.openPgpRequest=!0,e.ajax({url:"static/js/openpgp.js",dataType:"script",cache:!0,complete:function(){s.openPgp=t.openpgp?new c(t.openpgp,"user_"+(n||"0")+"_"):!1,null!==s.openPgpCallbacks&&_.each(s.openPgpCallbacks,function(e){e(s.openPgp)}),s.openPgpCallbacks=null}}))}else i(!1)},r.prototype.showLoading=function(e){x.Screens.showLoading(e)},r.prototype.hideLoading=function(){x.Screens.hideLoading()},r.prototype.showReport=function(e,t){x.Screens.showReport(e,t)},r.prototype.showError=function(e,t,i,n){x.Screens.showError(e,t,i,n)},r.prototype.hideError=function(e){x.Screens.hideError(e)},r.prototype.showPgpErrorByCode=function(e,t,i){var n=F.isNonEmptyArray(e.errors)?e.errors:[],s=F.isNonEmptyArray(e.notices)?e.notices:[],a=[],o=[],r="",l=!1,c=!0;if(_.each(_.union(n,s),function(e){if(2===e.length)switch(e[0]){case u.Enum.GenerateKeyError:r=F.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case u.Enum.ImportKeyError:r=F.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case u.Enum.ImportNoKeysFoundError:r=F.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND");break;case u.Enum.PrivateKeyNotFoundError:case u.Enum.PrivateKeyNotFoundNotice:o.push(e[1]);break;case u.Enum.PublicKeyNotFoundError:c=!1,a.push(e[1]);break;case u.Enum.PublicKeyNotFoundNotice:a.push(e[1]);break;case u.Enum.KeyIsNotDecodedError:t===M.PgpAction.DecryptVerify?r=F.i18n("OPENPGP/ERROR_DECRYPT")+" "+F.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}):(t===M.PgpAction.Sign||t===M.PgpAction.EncryptSign)&&(r=F.i18n("OPENPGP/ERROR_SIGN")+" "+F.i18n("OPENPGP/ERROR_KEY_NOT_DECODED",{USER:e[1]}));break;case u.Enum.SignError:r=F.i18n("OPENPGP/ERROR_SIGN");break;case u.Enum.VerifyError:r=F.i18n("OPENPGP/ERROR_VERIFY");break;case u.Enum.EncryptError:r=F.i18n("OPENPGP/ERROR_ENCRYPT");break;case u.Enum.DecryptError:r=F.i18n("OPENPGP/ERROR_DECRYPT");break;case u.Enum.SignAndEncryptError:r=F.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case u.Enum.VerifyAndDecryptError:r=F.i18n("OPENPGP/ERROR_DECRYPT_OR_VERIFY");break;case u.Enum.DeleteError:r=F.i18n("OPENPGP/ERROR_DELETE_KEY");break;case u.Enum.VerifyErrorNotice:r=F.i18n("OPENPGP/ERROR_VERIFY");break;case u.Enum.NoSignDataNotice:l=!0}}),a.length>0?(a=_.without(a,""),a.length>0?r=F.i18n("OPENPGP/ERROR_NO_PUBLIC_KEYS_FOR_USERS_PLURAL",{USERS:a.join(", ")},null,a.length):t===M.PgpAction.Verify&&(r=F.i18n("OPENPGP/ERROR_NO_PUBLIC_KEY_FOUND_FOR_VERIFY")),c&&""!==r&&(r+=" "+F.i18n("OPENPGP/ERROR_MESSAGE_WAS_NOT_VERIFIED"))):o.length>0&&(o=_.without(o,""),o.length>0?r=F.i18n("OPENPGP/ERROR_NO_PRIVATE_KEYS_FOR_USERS_PLURAL",{USERS:o.join(", ")},null,o.length):t===M.PgpAction.DecryptVerify&&(r=F.i18n("OPENPGP/ERROR_NO_PRIVATE_KEY_FOUND_FOR_DECRYPT"))),""===r&&!l){switch(t){case M.PgpAction.Generate:r=F.i18n("OPENPGP/ERROR_GENERATE_KEY");break;case M.PgpAction.Import:r=F.i18n("OPENPGP/ERROR_IMPORT_KEY");break;case M.PgpAction.DecryptVerify:r=F.i18n("OPENPGP/ERROR_DECRYPT");break;case M.PgpAction.Verify:r=F.i18n("OPENPGP/ERROR_VERIFY");break;case M.PgpAction.Encrypt:r=F.i18n("OPENPGP/ERROR_ENCRYPT");break;case M.PgpAction.EncryptSign:r=F.i18n("OPENPGP/ERROR_ENCRYPT_OR_SIGN");break;case M.PgpAction.Sign:r=F.i18n("OPENPGP/ERROR_SIGN")}r=i}return""!==r&&x.Api.showError(r),l},r.prototype.showErrorByCode=function(e,t,i){var n=e.ErrorCode,s=e.ErrorMessage||"",a="";switch(n){default:a=t;break;case M.Errors.AuthError:a=F.i18n("WARNING/LOGIN_PASS_INCORRECT");break;case M.Errors.DataBaseError:a=F.i18n("WARNING/DATABASE_ERROR");break;case M.Errors.LicenseProblem:a=F.i18n("WARNING/INVALID_LICENSE");break;case M.Errors.DemoLimitations:a=F.i18n("DEMO/WARNING_THIS_FEATURE_IS_DISABLED");break;case M.Errors.Captcha:a=F.i18n("WARNING/CAPTCHA_IS_INCORRECT");break;case M.Errors.CanNotGetMessage:a=F.i18n("MESSAGE/ERROR_MESSAGE_DELETED");break;case M.Errors.NoRequestedMailbox:a=t+" "+F.i18n("COMPOSE/ERROR_INVALID_ADDRESS",{ADDRESS:e.Mailbox||""});break;case M.Errors.CanNotChangePassword:a=F.i18n("WARNING/UNABLE_CHANGE_PASSWORD");break;case M.Errors.AccountOldPasswordNotCorrect:a=F.i18n("WARNING/CURRENT_PASSWORD_NOT_CORRECT");break;case M.Errors.FetcherIncServerNotAvailable:a=F.i18n("WARNING/FETCHER_SAVE_ERROR");break;case M.Errors.FetcherLoginNotCorrect:a=F.i18n("WARNING/FETCHER_SAVE_ERROR");break;case M.Errors.HelpdeskUserNotExists:a=F.i18n("HELPDESK/ERROR_FORGOT_NO_ACCOUNT");break;case M.Errors.MailServerError:a=F.i18n("WARNING/CANT_CONNECT_TO_SERVER");break;case M.Errors.DataTransferFailed:a=F.i18n("WARNING/DATA_TRANSFER_FAILED");break;case M.Errors.NotDisplayedError:a=""}""!==a?(""!==s&&(a+=" ("+s+")"),this.showError(a,!1,!!i)):""!==s&&this.showError(s)},r.prototype.showErrorIfAttachmentSizeLimit=function(e,t){var i=F.i18n("COMPOSE/UPLOAD_ERROR_FILENAME_SIZE",{FILENAME:e,MAXSIZE:F.friendlySize(H.App.AttachmentSizeLimit)});return H.App.AttachmentSizeLimit>0&&t>H.App.AttachmentSizeLimit?(x.Screens.showPopup(h,[i]),!0):!1},r.prototype.deleteMessages=function(e,t,i){F.isFunc(i)||(i=function(){});var n=x.MailCache.folderList(),s=n.currentFolderFullName(),a=n.trashFolder(),o=a&&s===a.fullName(),r=n.spamFolder(),l=r&&s===r.fullName(),c=function(n){n&&(t.MailCache.deleteMessages(e),i())};l?(t.MailCache.deleteMessages(e),i()):o?x.Screens.showPopup(p,[F.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE"),c]):a?(t.MailCache.moveMessagesToFolder(a.fullName(),e),i()):a||x.Screens.showPopup(p,[F.i18n("MAILBOX/CONFIRM_MESSAGES_DELETE_NO_TRASH_FOLDER"),c])},r.prototype.contactCreate=function(e,t,i,n){},l.prototype.hasData=function(t){var i=this.bHtml5?localStorage.getItem(t):e.cookie(t);return!!i},l.prototype.getData=function(t){var i=this.bHtml5?localStorage.getItem(t):e.cookie(t);return e.parseJSON(i)},l.prototype.setData=function(t,i){var n=JSON.stringify(i);this.bHtml5?localStorage.setItem(t,n):e.cookie(t,n,{expires:30})},l.prototype.removeData=function(t){this.bHtml5?localStorage.removeItem(t):e.cookie(t,null)},l.prototype.init=function(){if("undefined"==typeof Storage)this.bHtml5=!1;else try{localStorage.setItem("check","val"),localStorage.removeItem("check")}catch(e){this.bHtml5=!1}},c.prototype.pgp=null,c.prototype.pgpKeyring=null,c.prototype.keys=[],c.prototype.getKeys=function(){return this.keys()},c.prototype.getKeysObservable=function(){return this.keys},c.prototype.reloadKeysFromStorage=function(){var e=[],t=this.pgpKeyring.getAllKeys();_.each(t,function(t){t&&t.primaryKey&&e.push(new d(t))}),this.keys(e)},c.prototype.convertToNativeKeys=function(e){return _.map(e,function(e){return e&&e.pgpKey?e.pgpKey:e})},c.prototype.cloneKey=function(e){var t=null;return e&&(t=this.pgp.key.readArmored(e.armor()),t&&!t.err&&t.keys&&t.keys[0]?(t=t.keys[0],t&&t.primaryKey||(t=null)):t=null),t},c.prototype.decryptKeyHelper=function(e,t,i,n){if(t)try{t.decrypt(F.pString(i)),t&&t.primaryKey&&t.primaryKey.isDecrypted||e.addError(u.Enum.KeyIsNotDecodedError,n||"")}catch(s){e.addExceptionMessage(s,u.Enum.KeyIsNotDecodedError,n||"")}else e.addError(u.Enum.KeyIsNotDecodedError,n||"")},c.prototype.verifyMessageHelper=function(e,t,i){var n=!1,s=null,a=[],o=[],r=[];if(i&&i.getSigningKeyIds)if(o=i.getSigningKeyIds(),o&&0<o.length)if(r=this.findKeysByEmails([t],!0),r&&0!==r.length){a=[];try{a=i.verify(this.convertToNativeKeys(r))}catch(l){e.addNotice(u.Enum.VerifyErrorNotice,t)}a&&0<a.length&&(s=_.find(a,function(e){return e&&e.keyid&&e.valid}),s&&s.keyid&&r&&r[0]&&s.keyid.toHex().toLowerCase()===r[0].getId()?n=!0:e.addNotice(u.Enum.VerifyErrorNotice,t))}else e.addNotice(u.Enum.PublicKeyNotFoundNotice,t);else e.addNotice(u.Enum.NoSignDataNotice);else e.addError(u.Enum.UnknownError);return n||e.hasNotices()||e.addNotice(u.Enum.VerifyErrorNotice),n},c.prototype.generateKey=function(e,t,i){var n=new u,s=null;try{s=this.pgp.generateKeyPair({userId:e,numBits:F.pInt(i),passphrase:F.trim(t)})}catch(a){n.addExceptionMessage(a)}if(s&&s.privateKeyArmored)try{this.pgpKeyring.privateKeys.importKey(s.privateKeyArmored),this.pgpKeyring.publicKeys.importKey(s.publicKeyArmored),this.pgpKeyring.store()}catch(a){n.addExceptionMessage(a,u.Enum.GenerateKeyError)}else n.addError(u.Enum.GenerateKeyError);return this.reloadKeysFromStorage(),n},c.prototype.splitKeys=function(e){var t=[],i=0,n=30,s=null,a=F.trim(e),o=/[\-]{3,6}BEGIN[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}[\s\S]+?[\-]{3,6}END[\s]PGP[\s](PRIVATE|PUBLIC)[\s]KEY[\s]BLOCK[\-]{3,6}/gi;for(a=a.replace(/[\r\n]([a-zA-Z0-9]{2,}:[^\r\n]+)[\r\n]+([a-zA-Z0-9\/\\+=]{10,})/g,"\n$1---xyx---$2").replace(/[\n\r]+/g,"\n").replace(/---xyx---/g,"\n\n");;){if(s=o.exec(a),!s||0>n)break;s[0]&&s[1]&&s[2]&&s[1]===s[2]&&("PRIVATE"===s[1]||"PUBLIC"===s[1])&&(t.push([s[1],s[0]]),i++),n--}return t},c.prototype.importKeys=function(e){e=F.trim(e);var t=0,i=0,n=new u,s=null,a=[];if(!e)return n.addError(u.Enum.InvalidArgumentErrors);for(a=this.splitKeys(e),t=0;t<a.length;t++)if(s=a[t],"PRIVATE"===s[0])try{this.pgpKeyring.privateKeys.importKey(s[1]),i++}catch(o){n.addExceptionMessage(o,u.Enum.ImportKeyError,"private")}else if("PUBLIC"===s[0])try{this.pgpKeyring.publicKeys.importKey(s[1]),i++}catch(o){n.addExceptionMessage(o,u.Enum.ImportKeyError,"public")}return i>0?this.pgpKeyring.store():n.addError(u.Enum.ImportNoKeysFoundError),this.reloadKeysFromStorage(),n},c.prototype.getArmorInfo=function(e){e=F.trim(e);var t=0,i=0,n=null,s=[],a=null,o=[];if(!e)return!1;for(o=this.splitKeys(e),t=0;t<o.length;t++)if(a=o[t],"PRIVATE"===a[0])try{n=this.pgp.key.readArmored(a[1]),n&&!n.err&&n.keys&&n.keys[0]&&s.push(new d(n.keys[0])),i++}catch(r){s.push(null)}else if("PUBLIC"===a[0])try{n=this.pgp.key.readArmored(a[1]),n&&!n.err&&n.keys&&n.keys[0]&&s.push(new d(n.keys[0])),i++}catch(r){s.push(null)}return s},c.prototype.findKeyByID=function(e,t){t=!!t,e=e.toLowerCase();var i=_.find(this.keys(),function(i){var n=!1,s=null;return i&&t===i.isPublic()&&(s=i.pgpKey.getKeyIds(),s&&(n=_.find(s,function(t){return t&&t.toHex&&e===t.toHex().toLowerCase()}))),!!n});return i?i:null},c.prototype.findKeysByEmails=function(e,t,i){t=!!t;var n=[],s=this.keys();return _.each(e,function(e){var a=_.find(s,function(i){return i&&t===i.isPublic()&&e===i.getEmail()});a?n.push(a):i&&i.addError(t?u.Enum.PublicKeyNotFoundError:u.Enum.PrivateKeyNotFoundError,e)}),n},c.prototype.decryptAndVerify=function(e,t,i,n){var s=this,a=null,o=null,r=null,l=null,c=null,d=new u,h=[];if(a=this.pgp.message.readArmored(e),a&&a.decrypt)if(h=a.getEncryptionKeyIds(),h&&(r=null,o=null,_.each(h,function(e){o||(o=s.findKeyByID(e.toHex(),!1),o&&t!==o.getEmail()&&(o=null))}),o&&(r=o),r||_.each(h,function(e){r||(r=s.findKeyByID(e.toHex(),!1))})),r){if(l=this.cloneKey(this.convertToNativeKeys([r])[0]),this.decryptKeyHelper(d,l,n,r.getEmail()),l&&!d.hasErrors())try{c=a.decrypt(l)}catch(p){d.addExceptionMessage(p,u.Enum.DecryptError),c=null}c&&!d.hasErrors()&&(this.verifyMessageHelper(d,i,c),d.result=c.getText())}else d.addError(u.Enum.PrivateKeyNotFoundError);return d},c.prototype.verify=function(e,t){var i=null,n=new u;return i=this.pgp.cleartext.readArmored(e),i&&i.getText&&i.verify?(this.verifyMessageHelper(n,t,i),n.result=i.getText()):n.addError(u.Enum.CanNotReadMessage),n},c.prototype.encrypt=function(e,t){var i=new u,n=this.findKeysByEmails(t,!0,i);if(!i.hasErrors())try{i.result=this.pgp.encryptMessage(this.convertToNativeKeys(n),e)}catch(s){i.addExceptionMessage(s,u.Enum.EncryptError)}return i},c.prototype.sign=function(e,t,i){var n=new u,s=null,a=null,o=this.findKeysByEmails([t],!1,n);if(!n.hasErrors()&&(s=this.convertToNativeKeys(o)[0],a=this.cloneKey(s),this.decryptKeyHelper(n,a,i,t),a&&!n.hasErrors()))try{n.result=this.pgp.signClearMessage([a],e)}catch(r){n.addExceptionMessage(r,u.Enum.SignError,t)}return n},c.prototype.signAndEncrypt=function(e,t,i,n){var s=null,a=null,o=new u,r=this.findKeysByEmails([t],!1,o),l=this.findKeysByEmails(i,!0,o);if(!o.hasErrors()&&(s=this.convertToNativeKeys(r)[0],a=this.cloneKey(s),this.decryptKeyHelper(o,a,n,t),a&&!o.hasErrors()))try{o.result=this.pgp.signAndEncryptMessage(this.convertToNativeKeys(l),a,e)}catch(c){o.addExceptionMessage(c,u.Enum.SignAndEncryptError)}return o},c.prototype.deleteKey=function(e){var t=new u;if(e)try{this.pgpKeyring[e.isPrivate()?"privateKeys":"publicKeys"].removeForId(e.getFingerprint()),this.pgpKeyring.store()}catch(i){t.addExceptionMessage(i,u.Enum.DeleteError)}else t.addError(e?u.Enum.UnknownError:u.Enum.InvalidArgumentError);return this.reloadKeysFromStorage(),t},d.prototype.pgpKey=null,d.prototype.emailParts=null,d.prototype.user="",d.prototype.getId=function(){return this.pgpKey.primaryKey.getKeyId().toHex().toLowerCase()},d.prototype.getEmail=function(){return this.emailParts.email||this.user},d.prototype.getUser=function(){return this.user},d.prototype.getFingerprint=function(){return this.pgpKey.primaryKey.getFingerprint()},d.prototype.getBitSize=function(){return this.pgpKey.primaryKey.getBitSize()},d.prototype.getArmor=function(){return this.pgpKey.armor()},d.prototype.isPrivate=function(){return!!this.pgpKey.isPrivate()},d.prototype.isPublic=function(){return!this.isPrivate()},u.Enum={UnknownError:0,UnknownNotice:1,InvalidArgumentError:2,GenerateKeyError:10,ImportKeyError:20,ImportNoKeysFoundError:21,PrivateKeyNotFoundError:30,PublicKeyNotFoundError:31,KeyIsNotDecodedError:32,SignError:40,VerifyError:41,EncryptError:42,DecryptError:43,SignAndEncryptError:44,VerifyAndDecryptError:45,CanNotReadMessage:50,CanNotReadKey:51,DeleteError:60,PublicKeyNotFoundNotice:70,PrivateKeyNotFoundNotice:71,VerifyErrorNotice:72,NoSignDataNotice:73},u.prototype.result=!1,u.prototype.errors=null,u.prototype.notices=null,u.prototype.addError=function(e,t){return this.result=!1,this.errors=this.errors||[],this.errors.push([e||u.Enum.UnknownError,t||""]),this},u.prototype.addNotice=function(e,t){return this.notices=this.notices||[],this.notices.push([e||u.Enum.UnknownNotice,t||""]),this},u.prototype.addExceptionMessage=function(e,t,i){return e&&(this.result=!1,this.exceptions=this.exceptions||[],this.exceptions.push(""+(e.name||"unknown")+": "+(e.message||""))),F.isUnd(t)||this.addError(t,i),this},u.prototype.hasErrors=function(){return this.errors&&0<this.errors.length},u.prototype.hasNotices=function(){return this.notices&&0<this.notices.length},h.prototype.onShow=function(e,t,i,n){this.alertDesc(e),this.closeCallback=t||null,this.title(i||""),this.okButtonText(n||F.i18n("MAIN/BUTTON_OK"))},h.prototype.popupTemplate=function(){return"Popups_AlertPopupViewModel"},h.prototype.onEnterHandler=function(){this.close()},h.prototype.close=function(){F.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand()},p.prototype.onShow=function(e,t,i,n,s){this.confirmDesc(e),this.title(i||""),this.okButtonText(n||F.i18n("MAIN/BUTTON_OK")),this.cancelButtonText(s||F.i18n("MAIN/BUTTON_CANCEL")),F.isFunc(t)&&(this.fConfirmCallback=t),this.shown=!0},p.prototype.onHide=function(){this.shown=!1},p.prototype.popupTemplate=function(){return"Popups_ConfirmPopupViewModel"},p.prototype.onEnterHandler=function(){this.yesClick()},p.prototype.yesClick=function(){this.shown&&this.fConfirmCallback&&this.fConfirmCallback(!0),
this.closeCommand()},p.prototype.noClick=function(){this.fConfirmCallback&&this.fConfirmCallback(!1),this.closeCommand()},p.prototype.onEscHandler=function(){this.noClick()},m.prototype.onShow=function(e,t){this.pgp=e,this.keyArmor(t||""),this.keyArmorFocused(!0),this.keys([]),this.hasExistingKeys(!1),""!==this.keyArmor()&&this.checkArmor()},m.prototype.popupTemplate=function(){return"Popups_ImportOpenPgpKeyPopupViewModel"},m.prototype.checkArmor=function(){var e=null,t=[],n=this.pgp,s=!1;""===this.keyArmor()?this.keyArmorFocused(!0):n&&(e=n.getArmorInfo(this.keyArmor()),F.isNonEmptyArray(e)&&_.each(e,function(e){if(e){var a=n.findKeyByID(e.getId(),e.isPublic()),o=null!==a,r=e.isPublic()?"OPENPGP/PUBLIC_KEY_ADD_INFO":"OPENPGP/PRIVATE_KEY_ADD_INFO";s=s||o,t.push({armor:e.getArmor(),email:e.user,id:e.getId(),addInfo:F.i18n(r,{LENGTH:e.getBitSize()}),needToImport:i.observable(!o),disabled:o})}}),0===t.length&&x.Api.showError(F.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_FOUND")),this.keys(t),this.hasExistingKeys(s))},m.prototype.importKey=function(){var e=null,t=[];this.pgp&&(_.each(this.keys(),function(e){e.needToImport()&&t.push(e.armor)}),t.length>0?(e=this.pgp.importKeys(t.join("")),e&&e.result&&x.Api.showReport(F.i18n("OPENPGP/REPORT_KEY_SUCCESSFULLY_IMPORTED_PLURAL",{},null,t.length)),e&&!e.result&&x.Api.showPgpErrorByCode(e,M.PgpAction.Import,F.i18n("OPENPGP/ERROR_IMPORT_KEY")),this.closeCommand()):x.Api.showError(F.i18n("OPENPGP/ERROR_IMPORT_NO_KEY_SELECTED")))},f.prototype.clearFields=function(){this.calendarName(""),this.calendarDescription(""),this.selectedColor(this.colors[0]),this.calendarId(null)},f.prototype.onShow=function(t,i,n){this.clearFields(),F.isFunc(t)&&(this.fCallback=t),F.isUnd(i)||(this.colors(i),this.selectedColor(i[0])),F.isUnd(n)?this.popupTitle(F.i18n("CALENDAR/TITLE_CREATE_CALENDAR")):(this.popupTitle(F.i18n(n.name()?"CALENDAR/TITLE_EDIT_CALENDAR":"CALENDAR/TITLE_CREATE_CALENDAR")),this.calendarName(n.name?n.name():""),this.calendarDescription(n.description?n.description():""),this.selectedColor(n.color?n.color():""),this.calendarId(n.id?n.id:null)),e(document).on("keyup.calendar_create",_.bind(function(e){e.keyCode===M.Key.Enter&&this.onSaveClick()},this))},f.prototype.onHide=function(t,i,n){e(document).off("keyup.calendar_create")},f.prototype.popupTemplate=function(){return"Popups_Calendar_CalendarPopupViewModel"},f.prototype.onSaveClick=function(){""===this.calendarName()?x.Screens.showPopup(h,[F.i18n("CALENDAR/WARNING_BLANK_CALENDAR_NAME")]):(this.fCallback&&(this.fCallback(this.calendarName(),this.calendarDescription(),this.selectedColor(),this.calendarId()),this.clearFields()),this.closeCommand())},f.prototype.onCancelClick=function(){this.closeCommand()},g.prototype.onShow=function(e,t){F.isFunc(e)&&(this.fCallback=e),F.isUnd(t)||(this.color(t.color?t.color():""),this.calendarId(t.id?t.id:""))},g.prototype.popupTemplate=function(){return"Popups_Calendar_ImportPopupViewModel"},g.prototype.onApplyBindings=function(t){var i=this;this.oJua=new Jua({action:"?/Upload/Calendars/",name:"jua-uploader",queueSize:1,clickElement:e("#jue_import_button",t),hiddenElementsPosition:F.isRTL()?"right":"left",disableAjaxUpload:!1,disableDragAndDrop:!0,disableMultiple:!0,hidden:{Token:function(){return H.Token},AccountID:function(){return H.Accounts.currentId()},AdditionalData:function(){return JSON.stringify({CalendarID:i.calendarId()})}}}),this.oJua.on("onStart",_.bind(this.onFileUploadStart,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)),this.allowDragNDrop(this.oJua.isDragAndDropSupported())},g.prototype.onFileUploadStart=function(){this.importing(!0)},g.prototype.onFileUploadComplete=function(e,t,i){var n=!t||!i||i.Error||i.Result.Error||!1;n?x.Api.showError(i.ErrorCode&&i.ErrorCode===M.Errors.IncorrectFileExtension?F.i18n("CONTACTS/ERROR_INCORRECT_FILE_EXTENSION"):F.i18n("WARNING/ERROR_UPLOAD_FILE")):(this.importing(!1),this.fCallback(),this.closeCommand())},g.prototype.onCancelClick=function(){this.closeCommand()},b.prototype.onShow=function(e,t){F.isFunc(e)&&(this.fCallback=e),F.isUnd(t)||(this.selectedColor(t.color()),this.calendarId(t.id),this.calendarUrl(t.davUrl()+t.url()),this.exportUrl(t.exportUrl()),this.icsLink(t.davUrl()+t.url()+"?export"),this.isPublic(t.isPublic()),this.owner(t.owner()),this.populateShares(t.shares()),this.sharedToAll(t.isSharedToAll()),this.sharedToAllAccess(t.sharedToAllAccess))},b.prototype.popupTemplate=function(){return"Popups_Calendar_SharePopupViewModel"},b.prototype.onSaveClick=function(){this.fCallback&&this.fCallback(this.calendarId(),this.isPublic(),this.getShares(),this.sharedToAll(),this.sharedToAllAccess()),this.closePopup()},b.prototype.onCancelClick=function(){this.closePopup()},b.prototype.onEscHandler=function(){this.onCancelClick()},b.prototype.closePopup=function(){this.cleanAll(),this.closeCommand()},b.prototype.cleanAll=function(){this.newShare(""),this.newShareAccess(M.CalendarAccess.Read),this.shareToAllAccess=i.observable(M.CalendarAccess.Read),this.canAdd(!1)},b.prototype.autocompleteCallback=function(e,t){var i={Action:"ContactSuggestions",Search:e,GlobalOnly:"1"};x.Ajax.send(i,function(e){var i=[];e&&e.Result&&e.Result&&e.Result.List&&(i=_.map(e.Result.List,function(e){return e&&e.Email&&e.Email!==this.owner()?e.Name&&0<F.trim(e.Name).length?e.ForSharedToAll?{value:e.Name,name:e.Name,email:e.Email,frequency:e.Frequency}:{value:'"'+e.Name+'" <'+e.Email+">",name:e.Name,email:e.Email,frequency:e.Frequency}:{value:e.Email,name:"",email:e.Email,frequency:e.Frequency}:null},this),i=_.sortBy(_.compact(i),function(e){return e.frequency}).reverse()),t(i)},this)},b.prototype.itsMe=function(e){return e===this.defaultAccount.email()},b.prototype.initInputosaurus=function(t,i,n){t()&&e(t()).length>0&&e(t()).inputosaurus({width:"auto",parseOnBlur:!0,autoCompleteSource:_.bind(function(e,t){this.autocompleteCallback(e.term,t)},this),change:_.bind(function(e){n(!0),this.setRecipient(i,e.target.value),n(!1)},this),copy:_.bind(function(e){this.inputosaurusBuffer=e},this),paste:_.bind(function(){var e=this.inputosaurusBuffer||"";return this.inputosaurusBuffer="",e},this),mobileDevice:W})},b.prototype.setRecipient=function(e,t){e()===t?e.valueHasMutated():e(t)},b.prototype.getShares=function(){return e.merge(_.map(F.Address.getArrayRecipients(this.guests(),!1),function(e){return{name:e.name,email:e.email,access:M.CalendarAccess.Read}}),_.map(F.Address.getArrayRecipients(this.owners(),!1),function(e){return{name:e.name,email:e.email,access:M.CalendarAccess.Write}}))},b.prototype.populateShares=function(e){var t="",i="";_.each(e,function(e){e.access===M.CalendarAccess.Read?t=""!==e.name&&e.name!==e.email?t+'"'+e.name+'" <'+e.email+">,":t+e.email+", ":e.access===M.CalendarAccess.Write&&(i=""!==e.name&&e.name!==e.email?i+'"'+e.name+'" <'+e.email+">,":i+e.email+", ")},this),this.setRecipient(this.guests,t),this.setRecipient(this.owners,i)},v.prototype.onShow=function(e,t){F.isFunc(e)&&(this.fCallback=e),F.isUnd(t)||(this.selectedColor(t.color()),this.calendarId(t.id),this.calendarUrl(t.davUrl()+t.url()),this.exportUrl(t.exportUrl()),this.icsLink(t.davUrl()+t.url()+"?export"),this.isPublic(t.isPublic()),this.pubUrl(t.pubUrl()),this.exportUrl(t.exportUrl()))},v.prototype.popupTemplate=function(){return"Popups_Calendar_GetLinkPopupViewModel"},v.prototype.onCancelClick=function(){this.fCallback&&this.fCallback(this.calendarId(),this.isPublic()),this.closeCommand()},v.prototype.onEscHandler=function(){this.onCancelClick()},y.prototype.createDatePickerObject=function(t,i){e(t).datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:F.getMonthNamesArray(),dayNamesMin:F.i18n("DATETIME/DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",firstDay:H.User.CalendarWeekStartsOn,showOn:"both",buttonText:"",buttonImage:"skins/Default/images/calendar-icon.png",buttonImageOnly:!0,dateFormat:this.dateFormatDatePicker,onSelect:i}),e(t).mousedown(function(){e("#ui-datepicker-div").toggle()})},y.prototype.initializeDatePickers=function(){this.createDatePickerObject(this.startDom(),this.selectStartDate.bind(this)),this.createDatePickerObject(this.endDom(),this.selectEndDate.bind(this)),this.createDatePickerObject(this.repeatEndDom(),F.emptyFunction()),this.startDom().datepicker("option","dateFormat",this.dateFormatDatePicker),this.endDom().datepicker("option","dateFormat",this.dateFormatDatePicker),this.repeatEndDom().datepicker("option","dateFormat",this.dateFormatDatePicker)},y.prototype.onShow=function(e){var t=this.defaultAccount,i=t?t.email():"",n=t?t.friendlyName():"",s=e.End?e.End.clone():null,a=e.Start.clone(),o="",r=null,l="";this.differenceInMinutes=null,this.FCMoment=e.FCMoment,this.calendarId(e.SelectedCalendar),this.calendars=e.Calendars,r=this.calendars.getCalendarById(this.calendarId()),r&&(l=r.owner()),this.callbackSave=e.CallbackSave,this.callbackDelete=e.CallbackDelete,this.callbackAttendeeActionDecline=e.CallbackAttendeeActionDecline,this.timeFormatMoment=e.TimeFormat,this.dateFormatMoment=F.getDateFormatForMoment(e.DateFormat),this.dateFormatDatePicker=F.getDateFormatForDatePicker(e.DateFormat),this.ampmTimeFormat(H.User.defaultTimeFormat()!==M.TimeFormat.F24),this.initializeDatePickers(),this.allDay(e.AllDay),this.setStartDate(a,!0),this.startTime(a.format(this.timeFormatMoment)),s&&this.allDay()&&s.subtract(1,"days"),s||(s=a),this.setEndDate(s,!0),this.endTime(s.format(this.timeFormatMoment)),this.calendars&&this.calendarsList(_.filter(this.calendars.collection(),function(e){return e.isEditable()})),this.selectedCalendarId(e.SelectedCalendar),this.selectedCalendarId.valueHasMutated(),this.changeCalendarColor(this.selectedCalendarId()),this.id(e.ID||null),this.uid(e.Uid||null),this.recurrenceId(e.RecurrenceId||null),this.subject(e.Subject||""),this.location(e.Location||""),this.description(e.Description||""),this.allEvents(e.AllEvents||M.CalendarEditRecurrenceEvent.AllEvents),this.populateAlarms(e.Alarms),this.appointment(e.Appointment),this.attendees(e.Attendees||[]),H.Accounts&&(o=H.Accounts.getAttendee(_.map(this.attendees(),function(e){return e.email},this))),this.isMyEvent(i===e.Owner&&o!==i||i===l&&o!==i),this.editableSwitch(this.selectedCalendarIsShared(),this.selectedCalendarIsEditable(),this.isMyEvent()),this.setCurrentAttenderStatus(o,e.Attendees||[]),this.owner(e.Owner||i),this.ownerName(e.OwnerName||(this.isMyEvent()&&this.owner()===t.email()?n:"")),this.guestAutocomplete(""),this.excluded(e.Excluded||!1),this.repeatRuleParse(e.RRule||null),null===this.id()&&this.subjectFocus(!0),this.autosizeTrigger.notifySubscribers(!0),this.modified=!1,this.isAppointmentButtonsVisible(this.appointment()&&this.selectedCalendarIsEditable()&&_.find(this.attendees(),function(e){return e.email===i}))},y.prototype.popupTemplate=function(){return"Popups_Calendar_EventPopupViewModel"},y.prototype.changeCalendarColor=function(e){if(F.isFunc(this.calendars.getCalendarById)){var t=this.calendars.getCalendarById(e);t&&(this.calendarColor(""),this.calendarColor(t.color()))}},y.prototype.onSaveClick=function(){if(""===this.subject())x.Screens.showPopup(h,[F.i18n("CALENDAR/WARNING_EVENT_BLANK_SUBJECT"),_.bind(function(){this.subjectFocus(!0)},this)]);else{if(this.callbackSave){var e=parseInt(this.repeatPeriod()),t="",i=null,n=0,s=moment(this.getDateTime(this.startDom(),this.startTime())),a=moment(this.getDateTime(this.endDom(),this.endTime())),o={calendarId:this.calendarId(),newCalendarId:this.selectedCalendarId(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:F.getTitleForEvent(this.subject()),start:s,allDay:this.allDay(),location:this.location(),description:this.description(),alarms:this.getAlarmsArray(this.displayedAlarms()),attendees:this.attendees(),owner:this.owner(),modified:this.modified},r=parseInt(this.always());this.allDay()&&a.add(1,"days"),o.end=a,e&&(t=this.repeatEndDom().datepicker("getDate"),i=t?moment(t).unix():null,n=this.repeatInterval(),e===M.CalendarRepeatPeriod.Daily&&r===M.CalendarAlways.Disable?o.rrule={byDays:[],count:null,end:2,interval:1,period:e,until:i,weekNum:null}:e===M.CalendarRepeatPeriod.Weekly&&r===M.CalendarAlways.Disable?(this.setDayOfWeek(),o.rrule={byDays:this.getDays(),count:null,end:2,interval:n,period:e,until:i,weekNum:null}):e===M.CalendarRepeatPeriod.Monthly&&r===M.CalendarAlways.Disable?o.rrule={byDays:[],count:null,end:0,interval:1,period:e,until:null,weekNum:null}:e===M.CalendarRepeatPeriod.Yearly&&r===M.CalendarAlways.Disable?o.rrule={byDays:[],count:null,end:0,interval:1,period:e,until:null,weekNum:null}:e===M.CalendarRepeatPeriod.Daily&&r===M.CalendarAlways.Enable?o.rrule={byDays:[],count:null,end:3,interval:1,period:e,until:i,weekNum:null}:e===M.CalendarRepeatPeriod.Weekly&&r===M.CalendarAlways.Enable&&(this.setDayOfWeek(),o.rrule={byDays:this.getDays(),count:null,end:3,interval:n,period:e,until:i,weekNum:null})),this.callbackSave(o)}this.closePopup()}},y.prototype.onEscHandler=function(){this.dateEdit()?this.dateEdit(!1):this.closePopup()},y.prototype.closePopup=function(){this.hideAll(),this.cleanAll(),this.closeCommand()},y.prototype.hideAll=function(){this.dateEdit(!1),this.repeatEdit(!1),this.guestsEdit(!1)},y.prototype.cleanAll=function(){this.subject(""),this.description(""),this.location(""),this.isRepeat(!1),this.allDay(!1),this.repeatPeriod(M.CalendarRepeatPeriod.None),this.repeatInterval(1),this.repeatCount(null),this.repeatWeekNum(null),this.startDate(""),this.startTime(""),this.endDate(""),this.endTime(""),this.repeatEndDate(""),this.displayedAlarms([]),this.weekMO(!1),this.weekTU(!1),this.weekWE(!1),this.weekTH(!1),this.weekFR(!1),this.weekSA(!1),this.weekSU(!1),this.attendees([]),this.always(1),this.selectedCalendarId(""),this.attendees([])},y.prototype.onDeleteClick=function(){if(this.callbackDelete){var e={calendarId:this.selectedCalendarId(),id:this.id(),uid:this.uid(),recurrenceId:this.recurrenceId(),allEvents:this.allEvents(),subject:this.subject(),title:F.getTitleForEvent(this.subject()),start:moment(this.getDateTime(this.startDom(),this.startTime())),end:moment(this.getDateTime(this.endDom(),this.endTime())),allDay:this.allDay(),location:this.location(),description:this.description()};this.callbackDelete(e)}this.closePopup()},y.prototype.showDates=function(e,t){t.stopPropagation(),this.dateEdit(!this.dateEdit())},y.prototype.showGuests=function(){if(this.attendees().length>0){var e=F.i18n("CALENDAR/CONFIRM_CLOSE_ATTENDEERS"),t=_.bind(function(e){e&&(this.guestsEdit(!1),this.guestEmailFocus(!1),this.attendees([]))},this);x.Screens.showPopup(p,[e,t])}else this.guestsEdit(!this.guestsEdit()),this.guestEmailFocus(!this.guestEmailFocus())},y.prototype.onAddGuestClick=function(){var e=this.guestAutocompleteItem(),t=this.guestAutocomplete(),i=e||{name:"",email:t},n=_.any(this.attendees(),function(e){return e.email===i.email});""===i.email?x.Api.showError(F.i18n("CALENDAR/EVENT_ERROR_ENTER_EMAIL")):i.email===this.owner()?this.recivedAnim(!0):n?this.recivedAnim(!0):this.attendees.push({status:0,name:i.name,email:i.email}),this.whomAnimate(i.email),this.guestAutocomplete(""),this.guestEmailFocus(!0)},y.prototype.populateAlarms=function(e){e?(this.alarmOptions(this.getDisplayedAlarms(_.union(this.defaultAlarms(),e))),this.displayedAlarms(this.getDisplayedAlarms(e))):this.alarmOptions(this.getDisplayedAlarms(this.defaultAlarms()))},y.prototype.getDisplayedAlarms=function(e){var t,n,s=[];return e&&_.each(e,function(e,a){t=this["alarm"+e]=i.observable(e),t.subscribe(function(){this.disableAlarms()},this),n=e>0&&60>e?F.i18n("CALENDAR/ALARM_MINUTES_PLURAL",{COUNT:e},null,e):e>=60&&1440>e?F.i18n("CALENDAR/ALARM_HOURS_PLURAL",{COUNT:e/60},null,e/60):e>=1440&&10080>e?F.i18n("CALENDAR/ALARM_DAYS_PLURAL",{COUNT:e/1440},null,e/1440):F.i18n("CALENDAR/ALARM_WEEKS_PLURAL",{COUNT:e/10080},null,e/10080),s.push({value:e,alarm:t,text:n,isDisabled:!1})},this),_.sortBy(s,function(e){return e.value})},y.prototype.getDisplayedPeriods=function(){return[{label:F.i18n("CALENDAR/EVENT_REPEAT_NEVER"),value:0},{label:F.i18n("CALENDAR/EVENT_REPEAT_DAILY"),value:1},{label:F.i18n("CALENDAR/EVENT_REPEAT_WEEKLY"),value:2},{label:F.i18n("CALENDAR/EVENT_REPEAT_MONTHLY"),value:3},{label:F.i18n("CALENDAR/EVENT_REPEAT_YEARLY"),value:4}]},y.prototype.getDisplayedIntervals=function(){for(var e=1,t=[];30>=e;e++)t.push({label:e+F.i18n("th"),value:e});return t},y.prototype.getAlarmsArray=function(e){var t=[];return _.each(e,function(e,i){t.push(e.alarm())},this),_.sortBy(t,function(e){return-e})},y.prototype.addFirstAlarm=function(){if(this.displayedAlarms().length){var e=F.i18n("CALENDAR/CONFIRM_CLOSE_ALARMS"),t=_.bind(function(e){e&&this.displayedAlarms.removeAll()},this);x.Screens.showPopup(p,[e,t])}else this.displayedAlarms(this.getDisplayedAlarms([this.alarmOptions()[0].value]))},y.prototype.addAlarm=function(){var e,t,n=0;t=_.sortBy(this.displayedAlarms(),function(e){return e.alarm()}),_.each(t,function(e){var t=e.alarm();5!==t&&5>=n?n=5:10!==t&&10>=n?n=10:15!==t&&15>=n?n=15:30!==t&&30>=n?n=30:1440!==t&&1440>=n&&(n=1440)}),e=this.getDisplayedAlarms([n])[0],this["alarm"+n]=i.observable(n),this.displayedAlarms.push(e)},y.prototype.removeAlarm=function(e){this.displayedAlarms.remove(e)},y.prototype.removeGuest=function(e){this.attendees.remove(e)},y.prototype.disableAlarms=function(){_.each(this.alarmOptions(),function(e,t){e.isDisabled=_.any(this.displayedAlarms(),function(t){return t.alarm()===e.value})},this),this.alarmOptions.valueHasMutated()},y.prototype.autocompleteCallback=function(e,t){var i={Action:"ContactSuggestions",Search:e,GlobalOnly:"0"};this.guestAutocompleteItem(null),x.Ajax.send(i,function(e){var i=[];e&&e.Result&&e.Result&&e.Result.List&&(i=_.map(e.Result.List,function(e){return e&&e.Email&&e.Email!==this.owner()?{value:e.Name&&0<F.trim(e.Name).length?'"'+e.Name+'" <'+e.Email+">":e.Email,name:e.Name,email:e.Email,frequency:e.Frequency,id:e.Id,global:e.Global,sharedToAll:e.SharedToAll}:null},this),i=_.sortBy(_.compact(i),function(e){return e.frequency}).reverse()),t(i)},this)},y.prototype.repeatRuleParse=function(e){var t=this.allEvents();this.repeatEndDom().datepicker("option","minDate",this.getDateTime(this.endDom())),e&&t===M.CalendarEditRecurrenceEvent.AllEvents&&(e.until&&this.repeatEndDom().datepicker("setDate",new Date(1e3*e.until)),e.byDays.length&&_.each(e.byDays,function(e){this["week"+e](!0)},this),this.repeatPeriod(e.period),this.repeatInterval(e.interval),this.repeatCount(e.count),this.repeatWeekNum(e.weekNum),this.always(3===e.end?1:0))},y.prototype.getDays=function(){var e=[];return this.weekMO()&&e.push("MO"),this.weekTU()&&e.push("TU"),this.weekWE()&&e.push("WE"),this.weekTH()&&e.push("TH"),this.weekFR()&&e.push("FR"),this.weekSA()&&e.push("SA"),this.weekSU()&&e.push("SU"),e},y.prototype.onMainPanelClick=function(){this.dateEdit()&&this.dateEdit(!1)},y.prototype.onKeydown=function(e,t){t.keyCode===M.Key.Enter&&t.preventDefault()},y.prototype.onKeyup=function(e,t){t.keyCode===M.Key.Enter&&this.onSaveClick()},y.prototype.onPaste=function(e,t,i){var n=i().replace(/[\r\n\t]+/gm," ");i(n)},y.prototype.getDateWithoutYearIfMonthWord=function(e){var t=e.split(" "),i=moment(),n=i.format("YYYY");return 3===t.length&&n===t[2]?t[0]+" "+t[1]:e},y.prototype.setStartDate=function(t,i){i&&this.startDom().datepicker("setDate",t.toDate()),this.startDate(this.getDateWithoutYearIfMonthWord(e(this.startDom()).val())),this.yearlyDayText(F.i18n("CALENDAR/EVENT_REPEAT_YEARLY_DAYMONTH",{DAYMONTH:t.format(this.getDateMonthFormat())})),this.monthlyDayText(F.i18n("CALENDAR/EVENT_REPEAT_MONTHLY_DAY",{DAY:t.format("DD")}))},y.prototype.selectStartDate=function(){if(!this.lockSelectStartEndDate()&&this.startDate()&&this.endDate()){this.lockSelectStartEndDate(!0);var e=this.FCMoment||moment,t=this.getDateTime(this.startDom(),this.startTime()),i=e(t),n=this.getDateTime(this.endDom(),this.endTime()),s=e(n);F.isNormal(this.differenceInMinutes)&&(s=i.clone().add(this.differenceInMinutes,"minutes"),n=s.toDate(),this.setEndDate(s,!0),this.endTime(s.format(this.timeFormatMoment))),s.diff(i,"minutes")<0&&(this.setEndDate(i,!0),this.endTime(i.format(this.timeFormatMoment))),this.isEvOneDay(0===s.diff(i,"days")),this.isEvOneTime(0===s.diff(i,"minutes")),this.setStartDate(i,!1),this.startTime(i.format(this.timeFormatMoment)),this.lockSelectStartEndDate(!1)}},y.prototype.getDateMonthFormat=function(){var e=this.dateFormatMoment.slice(0,-5);return-1===F.inArray(e,["MM/DD","DD/MM","DD MMMM"])&&(e="MM/DD"),e},y.prototype.setEndDate=function(t,i){i&&this.endDom().datepicker("setDate",t.toDate()),this.endDate(this.getDateWithoutYearIfMonthWord(e(this.endDom()).val()))},y.prototype.selectEndDate=function(){if(!this.lockSelectStartEndDate()&&this.endDate()&&this.startDate()){this.lockSelectStartEndDate(!0);var e=this.FCMoment||moment,t=this.getDateTime(this.startDom(),this.startTime()),i=e(t),n=this.getDateTime(this.endDom(),this.endTime()),s=e(n);this.differenceInMinutes=s.diff(i,"minutes"),this.differenceInMinutes<0&&(this.setStartDate(s,!0),this.startTime(s.format(this.timeFormatMoment)),this.differenceInMinutes=0),this.isEvOneDay(0===s.diff(i,"days")),this.isEvOneTime(0===s.diff(i,"minutes")),this.setEndDate(s,!1),this.endTime(s.format(this.timeFormatMoment)),this.repeatEndDom().datepicker("option","minDate",n),this.isRepeat()||this.repeatEndDom().datepicker("setDate",s.add(7,"days").toDate()),this.lockSelectStartEndDate(!1)}},y.prototype.getDateTime=function(e,t){t=t?moment(t,this.timeFormatMoment).format("HH:mm"):"";var i=e.datepicker("getDate"),n=t?t.split(":"):[];return 2===n.length&&(i.setHours(n[0]),i.setMinutes(n[1])),i},y.prototype.setActualTime=function(){if(!this.lockSelectStartEndDate()&&this.endDate()&&this.startDate()){this.lockSelectStartEndDate(!0);var e=this.FCMoment||moment,t=e(),i=t.format(this.timeFormatMoment),n=this.getDateTime(this.startDom(),i),s=e(n),a=this.getDateTime(this.endDom(),i),o=e(a);s.minutes()>30?(s.add(60-s.minutes(),"minutes"),o.add(90-o.minutes(),"minutes")):(s.add(30-s.minutes(),"minutes"),o.add(60-o.minutes(),"minutes")),this.differenceInMinutes=o.diff(s,"minutes"),this.setStartDate(s,!0),this.startTime(s.format(this.timeFormatMoment)),this.setEndDate(o,!0),this.endTime(o.format(this.timeFormatMoment)),this.lockSelectStartEndDate(!1)}},y.prototype.onCalendarAppointmentSetActionResponse=function(e,t){e.Result||x.Api.showErrorByCode(e,F.i18n("WARNING/UNKNOWN_ERROR"))},y.prototype.setAppointmentAction=function(e){var t=M.IcalConfigInt.NeedsAction,i=this.attendees(),n=H.Accounts?H.Accounts.getAttendee(_.map(this.attendees(),function(e){return e.email},this)):"",s=_.find(this.attendees(),function(e){return e.email===n},this),a=this.calendars.getCalendarById(this.selectedCalendarId()),o={Action:"CalendarAppointmentSetAction",AppointmentAction:e,CalendarId:this.selectedCalendarId(),EventId:this.uid(),Attendee:n};if(s){switch(e){case M.IcalConfig.Accepted:t=M.IcalConfigInt.Accepted,x.CalendarCache.markIcalAccepted(this.uid());break;case M.IcalConfig.Tentative:t=M.IcalConfigInt.Tentative,x.CalendarCache.markIcalTentative(this.uid());break;case M.IcalConfig.Declined:t=M.IcalConfigInt.Declined,x.CalendarCache.markIcalNonexistent(this.uid())}x.Ajax.send(o,this.onCalendarAppointmentSetActionResponse,this),s.status=t,this.attendees([]),this.attendees(i),this.setCurrentAttenderStatus(s.email,this.attendees()),e===M.IcalConfig.Declined&&a&&this.callbackAttendeeActionDecline&&F.isFunc(this.callbackAttendeeActionDecline)&&(this.callbackAttendeeActionDecline(a,this.id()),this.closePopup())}},y.prototype.editableSwitch=function(e,t,i){this.isEditable(e&&t&&i||!e&&t&&i||e&&!t&&!i),this.isEditableReminders(t)},y.prototype.setCurrentAttenderStatus=function(e,t){var i=_.find(t,function(t){return t.email===e});this.attenderStatus(i?i.status:0)},y.prototype.getAttenderTextStatus=function(e){switch(e){case 0:e="pending";break;case 1:e="accepted";break;case 2:e="declined";break;case 3:e="tentative"}return e},y.prototype.setDayOfWeek=function(){if(this.repeatPeriod()===M.CalendarRepeatPeriod.Weekly&&!this.getDays().length){var e=this.getDateTime(this.startDom()).getUTCDay();switch(e){case 0:this.weekMO(!0);break;case 1:this.weekTU(!0);break;case 2:this.weekWE(!0);break;case 3:this.weekTH(!0);break;case 4:this.weekFR(!0);break;case 5:this.weekSA(!0);break;case 6:this.weekSU(!0)}}},y.prototype.displayReminderPart=function(e,t){var i="";return i="%REMINDERS%"===e?"Reminders":"Text",t+i},y.prototype.autocompleteDeleteItem=function(e){var t={Action:"ContactSuggestionDelete",ContactId:e.id,SharedToAll:e.sharedToAll?"1":"0"};x.Ajax.send(t,function(e){return!0},this)},C.prototype.onShow=function(e){F.isFunc(e)&&(this.fCallback=e)},C.prototype.popupTemplate=function(){return"Popups_Calendar_EditRecurrenceEventPopupViewModel"},C.prototype.onlyThisInstanceButtonClick=function(){this.fCallback&&this.fCallback(M.CalendarEditRecurrenceEvent.OnlyThisInstance),this.closeCommand()},C.prototype.allEventsButtonClick=function(){this.fCallback&&this.fCallback(M.CalendarEditRecurrenceEvent.AllEvents),this.closeCommand()},C.prototype.cancelButtonClick=function(){this.fCallback&&this.fCallback(M.CalendarEditRecurrenceEvent.None),this.closeCommand()},C.prototype.onEscHandler=function(){this.cancelButtonClick()},E.prototype.onShow=function(e){this.fCallback=e.CallbackSave,this.fProceedUploading=e.ProceedUploading,this.calendars=e.Calendars,this.calendarsList(e.EditableCalendars),this.selectedCalendarId(e.DefaultCalendarId),this.changeCalendarColor(this.selectedCalendarId())},E.prototype.popupTemplate=function(){return"Popups_Calendar_CalendarSelectCalendarsPopupViewModel"},E.prototype.onSaveClick=function(){this.fCallback&&this.fCallback(this.selectedCalendarId(),this.fProceedUploading),this.closeCommand()},E.prototype.onCancelClick=function(){this.closeCommand()},E.prototype.changeCalendarColor=function(e){if(F.isFunc(this.calendars.getCalendarById)){var t=this.calendars.getCalendarById(e);t&&(this.calendarColor(""),this.calendarColor(t.color()))}},A.prototype.popupTemplate=function(){return"Popups_ContactCreatePopupViewModel"},A.prototype.onShow=function(e,t,i,n){(this.displayName()!==e||this.email()!==t)&&(this.displayName(e),this.email(t),this.phone(""),this.address(""),this.skype(""),this.facebook("")),F.isFunc(i)&&(this.fCallback=i),n&&(this.oContext=n)},A.prototype.onSaveClick=function(){if(this.canBeSave()){if(!this.loading()){var e={Action:"ContactCreate",PrimaryEmail:"Home",UseFriendlyName:"1",FullName:this.displayName(),HomeEmail:this.email(),HomePhone:this.phone(),HomeStreet:this.address(),Skype:this.skype(),Facebook:this.facebook()};this.loading(!0),x.Ajax.send(e,this.onContactCreateResponse,this)}}else x.Api.showError(F.i18n("CONTACTS/ERROR_EMPTY_CONTACT"))},A.prototype.onCancelClick=function(){this.loading(!1),this.closeCommand()},A.prototype.onContactCreateResponse=function(e,t){this.loading(!1),e.Result?(x.Api.showReport(F.i18n("CONTACTS/REPORT_CONTACT_SUCCESSFULLY_ADDED")),x.ContactsCache.clearInfoAboutEmail(t.HomeEmail),x.ContactsCache.getContactsByEmails([t.HomeEmail],this.fCallback,this.oContext),this.closeCommand()):x.Api.showErrorByCode(e,F.i18n("WARNING/CREATING_ACCOUNT_ERROR"))},A.prototype.canBeSave=function(){return""!==this.displayName()||""!==this.email()},A.prototype.goToContacts=function(){x.ContactsCache.newContactParams={displayName:this.displayName(),email:this.email(),phone:this.phone(),address:this.address(),skype:this.skype(),facebook:this.facebook()},this.closeCommand(),x.Routing.replaceHash(x.Links.contacts())},D.prototype.onShow=function(e){this.iframe(e)},D.prototype.popupTemplate=function(){return"Popups_PlayerPopupViewModel"},D.prototype.onClose=function(){F.isFunc(this.closeCallback)&&this.closeCallback(),this.closeCommand(),this.iframe("")},S.prototype.fillDefaultFontName=function(){var e=F.pString(H.HtmlEditorDefaultFontName);""!==e&&(this.DefaultFontName=e)},S.prototype.fillDefaultFontSize=function(){var e=F.pInt(H.HtmlEditorDefaultFontSize);-1!==F.inArray(e,[2,3,5,7])&&(this.DefaultFontSize=e)},S.prototype.getSaveMailInSentItems=function(){var e=!0;switch(this.SaveMail){case M.SaveMail.Unchecked:e=!1;break;case M.SaveMail.Checked:case M.SaveMail.Hidden:e=!0}return e},S.prototype.getUseSaveMailInSentItems=function(){var e=!1;switch(this.SaveMail){case M.SaveMail.Unchecked:case M.SaveMail.Checked:e=!0;break;case M.SaveMail.Hidden:e=!1}return e},S.prototype.parse=function(e){var t=null;null!==e&&(this.IdUser=F.pInt(e.IdUser),this.MailsPerPage=F.pInt(e.MailsPerPage),this.ContactsPerPage=F.pInt(e.ContactsPerPage),this.AutoCheckMailInterval=F.pInt(e.AutoCheckMailInterval),this.DefaultTheme=F.pString(e.DefaultTheme),this.DefaultLanguage=F.pString(e.DefaultLanguage),this.DefaultLanguageShort=F.pString(e.DefaultLanguageShort),this.DefaultDateFormat=F.pString(e.DefaultDateFormat),this.defaultTimeFormat(F.pString(e.DefaultTimeFormat)),this.ThreadsEnabled=!!e.ThreadsEnabled,this.useThreads(!!e.UseThreads),this.SaveRepliedToCurrFolder=!!e.SaveRepliedMessagesToCurrentFolder,this.DesktopNotifications=!!e.DesktopNotifications,this.EmailNotification=F.pString(e.EmailNotification),this.AllowChangeInputDirection=!!e.AllowChangeInputDirection,this.AllowCompose=!!e.AllowCompose,this.AllowReply=!!e.AllowReply,this.AllowForward=!!e.AllowForward,this.SaveMail=F.pInt(e.SaveMail),this.AllowFetcher=!!e.AllowFetcher,this.OutlookSyncEnable=!!e.OutlookSyncEnable,this.MobileSyncEnable=!!e.MobileSyncEnable,this.ShowPersonalContacts=!!e.ShowPersonalContacts,this.ShowGlobalContacts=!!e.ShowGlobalContacts,this.ShowContacts=this.ShowPersonalContacts||this.ShowGlobalContacts,this.IsFilesSupported=!!e.IsFilesSupported&&!B,this.filesEnable(!!e.FilesEnable&&!B),this.IsHelpdeskSupported=!!e.IsHelpdeskSupported&&!B,this.IsHelpdeskAgent=!!e.IsHelpdeskAgent,this.helpdeskSignature(F.pString(e.HelpdeskSignature)),this.helpdeskSignatureEnable(e.HelpdeskSignatureEnable?"1":"0"),this.LastLogin=F.pInt(e.LastLogin),this.LoginsCount=F.pInt(e.LoginsCount),this.SocialName=F.pString(e.SocialName),this.AllowCalendar=!!e.AllowCalendar&&!B,this.CalendarSharing=!!e.CalendarSharing,this.CalendarAppointments=!!e.CalendarAppointments,this.IsDemo=!!e.IsDemo,this.AllowVoice=!!e.AllowVoice,this.SipRealm=e.SipRealm,this.SipWebsocketProxyUrl=e.SipWebsocketProxyUrl,this.SipOutboundProxyUrl=e.SipOutboundProxyUrl,this.SipCallerID=e.SipCallerID,this.SipImpi=e.SipImpi,this.SipImpu=e.SipImpu,this.SipPassword=e.SipPassword,this.VoiceProvider=e.VoiceProvider,this.AllowHelpdeskNotifications=e.AllowHelpdeskNotifications,this.IsCollaborationSupported=!!e.IsCollaborationSupported,this.AllowFilesSharing=!!e.AllowFilesSharing,this.enableOpenPgp(!!e.EnableOpenPgp),this.AllowAutosaveInDrafts=!!e.AllowAutosaveInDrafts&&(H.App?H.App.AutoSave:!1),t=e.Calendar,t&&(this.CalendarShowWeekEnds=!!t.ShowWeekEnds,this.CalendarShowWorkDay=!!t.ShowWorkDay,this.CalendarWorkDayStarts=F.pInt(t.WorkDayStarts),this.CalendarWorkDayEnds=F.pInt(t.WorkDayEnds),this.CalendarWeekStartsOn=F.pInt(t.WeekStartsOn),this.CalendarDefaultTab=F.pInt(t.DefaultTab)),this.SocialAccounts(e.SocialAccounts),this.CanLoginWithPassword=!!e.CanLoginWithPassword)},S.prototype.updateCommonSettings=function(e,t,i,n,s,a,o,r,l,c,d,u){var h=this.defaultTimeFormat()!==o;this.MailsPerPage=e,this.ContactsPerPage=t,this.AutoCheckMailInterval=i,x.MailCache.setAutocheckmailTimer(),this.DefaultTheme=n,this.DefaultLanguage=s,this.DefaultDateFormat=a,this.defaultTimeFormat(o),this.useThreads("1"===r),this.SaveRepliedToCurrFolder="1"===l,this.AllowChangeInputDirection="1"===d,this.DesktopNotifications="1"===c,this.EmailNotification=u,h&&x.nowDateNumber.valueHasMutated()},S.prototype.updateOpenPgpSettings=function(e,t,i){this.enableOpenPgp("1"===e),this.AllowAutosaveInDrafts="1"===t},S.prototype.updateCalendarSettings=function(e,t,i,n,s,a){this.CalendarShowWeekEnds=e,this.CalendarShowWorkDay=t,this.CalendarWorkDayStarts=i,this.CalendarWorkDayEnds=n,this.CalendarWeekStartsOn=s,
this.CalendarDefaultTab=a},S.prototype.updateHelpdeskSettings=function(e,t,i){this.AllowHelpdeskNotifications=e,this.helpdeskSignature(t),this.helpdeskSignatureEnable(i)},S.prototype.onUserSettingsGetSyncResponse=function(e,t){e.Result?(this.mobileSync(e.Result.Mobile),this.outlookSync(e.Result.Outlook)):x.Api.showErrorByCode(e)},S.prototype.requestSyncSettings=function(){(null===this.mobileSync()||null===this.outlookSync())&&x.Ajax.send({Action:"UserSettingsGetSync"},this.onUserSettingsGetSyncResponse,this)},k.prototype.parseCssColor=function(e){var t=F.pString(e);return t.length>7?t=t.substr(0,7):t.length>4&&t.length<7&&(t=t.substr(0,4)),4===t.length&&(t=t[0]+t[1]+t[1]+t[2]+t[2]+t[3]+t[3]),t.match(/^#[A-Fa-f0-9]{6}$/i)||(t="#f09650"),t},k.prototype.parse=function(e){this.id=F.pString(e.Id),this.cTag=e.CTag,this.name(F.pString(e.Name)),this.description(F.pString(e.Description)),this.owner(F.pString(e.Owner)),this.active(x.Storage.hasData(this.id)?x.Storage.getData(this.id):!0),this.isDefault=!!e.IsDefault,this.access(e.Access),this.isShared(!!e.Shared),this.isSharedToAll(!!e.SharedToAll),this.sharedToAllAccess=e.SharedToAllAccess,this.isPublic(!!e.IsPublic),this.color(this.parseCssColor(e.Color)),this.url(F.pString(e.Url)),this.davUrl(F.pString(e.ServerUrl)),this.exportUrl(F.Common.getAppPath()+"?/Raw/Calendars/0/"+F.pString(e.ExportHash)),this.pubUrl(F.Common.getAppPath()+"?calendar-pub="+F.pString(e.PubHash)),this.shares(e.Shares||[]),_.each(e.Events,function(e){this.addEvent(e)},this)},k.prototype.eventExists=function(e){return _.find(this.events(),function(t){return e===t.id})},k.prototype.updateEvent=function(e){var t=!1;return e&&(this.removeEvent(e.id),this.addEvent(e)),t},k.prototype.addEvent=function(e){e&&!this.eventExists(e.id)&&this.events.push(this.parseEvent(e))},k.prototype.getEvent=function(e){return _.find(this.events(),function(t){return t.id===e},this)},k.prototype.getEvents=function(e,t){var i=_.filter(this.events(),function(i){var n=e.unix(),s=t.unix(),a=moment.utc(i.start).unix(),o=moment.utc(i.end).unix();return a>=n&&s>=o||n>=a&&o>=s||a>=n&&s>=a||s>=o&&o>=n},this);return F.isUnd(i)&&(i=[]),i},k.prototype.removeEvent=function(e){this.events(_.filter(this.events(),function(t){return t.id!==e},this))},k.prototype.removeEventByUid=function(e,t){F.isUnd(t)&&(t=!1),this.events(_.filter(this.events(),function(i){return!(i.uid===e||t&&i.excluded)},this))},k.prototype.removeEvents=function(){this.events([])},k.prototype.expungeEvents=function(e,t,i){var n=[];_.each(this.getEvents(moment.unix(t),moment.unix(i)),function(t){_.include(e,t.id)||n.push(t.id)},this),this.events(_.filter(this.events(),function(e){return!_.include(n,e.id)},this))},k.prototype.isEditable=function(){return this.access()!==M.CalendarAccess.Read},k.prototype.isOwner=function(){return this.account&&this.account.email()===this.owner()},k.prototype.parseEvent=function(e){if(e.title=F.getTitleForEvent(e.subject),e.editable=e.appointment?!1:!0,e.backgroundColor=e.borderColor=this.color(),!_.isArray(e.className)){var t=e.className;e.className=[t]}return this.access()===M.CalendarAccess.Read?(e.className.push("fc-event-readonly"),e.editable=!1):e.className=_.filter(e.className,function(e){return"fc-event-readonly"!==e}),e.rrule&&!e.excluded?e.className.push("fc-event-repeat"):e.className=_.filter(e.className,function(e){return"fc-event-repeat"!==e}),F.isNonEmptyArray(e.attendees)?e.className.push("fc-event-appointment"):e.className=_.filter(e.className,function(e){return"fc-event-appointment"!==e}),e},k.prototype.reloadEvents=function(){this.events(_.map(this.events(),function(e){return this.parseEvent(e)},this))},k.prototype.canShare=function(){return!this.isShared()||this.isShared()&&this.access()===M.CalendarAccess.Write||this.isOwner()},T.prototype.pickCurrentCalendar=function(e){var t=_.find(this.collection(),function(e){return e.active()&&e.access()===M.CalendarAccess.Write},this);this.currentCal()&&this.currentCal().active()||(e&&e.active()?this.currentCal(e):!this.defaultCal()||!this.defaultCal().active()&&t?t&&this.currentCal(t):this.currentCal(this.defaultCal()))},T.prototype.hideOtherCalendars=function(e){_.each(this.collection(),function(t){t.active(t.id===e)},this)},T.prototype.getCalendarById=function(e){var t=_.find(this.collection(),function(t){return t.id===e},this);return t},T.prototype.getEvents=function(e,t){var i=[],n=[];return _.each(this.collection(),function(s){s&&s.active()&&(n=F.isUnd(e)||F.isUnd(t)?s.events():s.getEvents(e,t),i=_.union(i,n))},this),i},T.prototype.parseCalendar=function(e){var t=new k;return t.parse(e),t},T.prototype.parseAndAddCalendar=function(e){var t=0,i=null,n=this.parseCalendar(e);return n.active.subscribe(function(e){this.parentOnCalendarActiveChange(n);var t=n.active()?n:this.defaultCal();this.pickCurrentCalendar(t),x.Storage.setData(n.id,e)},this),n.isDefault&&this.defaultCal(n),t=this.calendarExists(n.id),t||0===t?(i=this.getCalendarById(n.id),n.events(i.events()),this.collection.splice(t,1,n)):this.collection.push(n),n},T.prototype.calendarExists=function(e){var t=_.indexOf(_.map(this.collection(),function(e){return e.id}),e);return 0>t?!1:t},T.prototype.removeCalendar=function(e){this.collection(_.filter(this.collection(),function(t){return t.id!==e},this))},T.prototype.clearCollection=function(){this.collection.removeAll()},T.prototype.getColors=function(){return _.map(this.collection(),function(e){return e.color().toLowerCase()},this)},T.prototype.setDefault=function(e){_.each(this.collection(),function(t){t.id!==e?(t.isDefault=!0,this.defaultCal(t)):t.isDefault=!1},this)},T.prototype.sort=function(){var e=_.sortBy(this.collection(),function(e){return e.name()});this.collection(_.sortBy(e,function(e){return e.isShared()}))},T.prototype.expunge=function(e){this.collection(_.filter(this.collection(),function(t){return _.include(e,t.id)},this))},w.prototype.hotKeysBind=function(){var t=this;e(document).on("keyup",function(i){var n=i.keyCode;t.calendars.getEvents().length>0&&"month"===t.selectedView()&&27===n&&t.popUpStatus&&(e("body").trigger("click"),t.popUpStatus||e("body").trigger("mousedown"))})},w.prototype.getFCObject=function(){return this.$calendarGrid.fullCalendar("getCalendar")},w.prototype.getDateFromCurrentView=function(e){var t=this.$calendarGrid.fullCalendar("getView"),i=t&&t[e]?t[e]:null;return i&&"end"===e&&"agendaDay"===t.name&&i.add(1,"d"),i&&i.unix?t[e].unix():0},w.prototype.eventsSource=function(e,t,i,n){n(this.calendars.getEvents(e,t))},w.prototype.initFullCalendar=function(){this.$calendarGrid.fullCalendar(this.fullcalendarOptions)},w.prototype.applyCalendarSettings=function(){this.timeFormat=H.User.defaultTimeFormat()===M.TimeFormat.F24?"HH:mm":"hh:mm A",this.dateFormat=H.User.DefaultDateFormat,this.calendarGridDom().removeClass("fc-show-weekends"),H.User.CalendarShowWeekEnds&&this.calendarGridDom().addClass("fc-show-weekends"),this.fullcalendarOptions.timeFormat=this.timeFormat,this.fullcalendarOptions.axisFormat=this.timeFormat,this.fullcalendarOptions.defaultView=this.defaultViewName(),this.fullcalendarOptions.lang=moment.locale(),this.applyFirstDay(),this.$calendarGrid.fullCalendar("destroy"),this.$calendarGrid.fullCalendar(this.fullcalendarOptions),this.changeView(this.defaultViewName())},w.prototype.applyFirstDay=function(){var e=[],t="",i="";switch(H.Auth&&(this.fullcalendarOptions.firstDay=H.User.CalendarWeekStartsOn),_.each(this.aDayNames,function(t){e.push(t)}),H.User.CalendarWeekStartsOn){case 1:i=e.shift(),e.push(i);break;case 6:t=e.pop(),e.unshift(t)}this.$datePicker.datepicker("option","firstDay",H.User.CalendarWeekStartsOn)},w.prototype.initDatePicker=function(){this.$datePicker.datepicker({showOtherMonths:!0,selectOtherMonths:!0,monthNames:F.getMonthNamesArray(),dayNamesMin:F.i18n("DATETIME/DAY_NAMES_MIN").split(" "),nextText:"",prevText:"",onChangeMonthYear:_.bind(this.changeMonthYearFromDatePicker,this),onSelect:_.bind(this.selectDateFromDatePicker,this),beforeShowDay:_.bind(this.getDayDescription,this)})},w.prototype.onApplyBindings=function(){var t=this;this.$calendarGrid=e(this.calendarGridDom()),this.$datePicker=e(this.datePickerDom()),this.isPublic||this.initUploader(),e("body").on("click",function(i){if(t.calendars.getEvents().length>0&&"month"===t.selectedView())if(e(i.target).hasClass("fc-more")){var n=e(i.target);e(".fc-more-cell.active").removeClass("active"),e(".fc-row.fc-week.active").removeClass("active"),n.closest(".fc-more-cell").addClass("active"),n.closest(".fc-row.fc-week").addClass("active");var s=e("body").find(".fc-popover.fc-more-popover"),a=n.closest("tr"),o=n.closest(".fc-day-grid"),r=parseInt(a.find(".fc-more-cell.active").index(".fc-more-cell")),l=parseInt(o.find(".fc-row.fc-week.active").index(".fc-row.fc-week"));s.length>0?(t.linkRow=l,t.linkColumn=r,t.popUpStatus=!0):(t.popUpStatus=!1,t.linkRow=0,t.linkColumn=0)}else e(i.target).hasClass("checkmail")||e(i.target).parent().hasClass("checkmail")?i.preventDefault():(t.popUpStatus=!1,t.linkRow=0,t.linkColumn=0)})},w.prototype.onShow=function(){this.initialized()||(this.initDatePicker(),this.applyCalendarSettings(),this.highlightWeekInDayPicker(),this.initialized(!0)),x.CalendarCache?(x.CalendarCache.calendarSettingsChanged()||x.CalendarCache.calendarChanged())&&(x.CalendarCache.calendarSettingsChanged()&&this.applyCalendarSettings(),x.CalendarCache.calendarSettingsChanged(!1),x.CalendarCache.calendarChanged(!1),this.getCalendars()):this.isPublic&&this.$calendarGrid.fullCalendar("render"),this.refetchEvents()},w.prototype.setTimeline=function(){var t=(this.$calendarGrid.fullCalendar("getView"),new Date),i=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n=new Date(this.todayDate.getFullYear(),this.todayDate.getMonth(),this.todayDate.getDate()),s=null,a=null,o=0,r=0,l=0;i>n&&(this.execCommand("today"),this.todayDate=this.$calendarGrid.fullCalendar("getDate").toDate(),this.$calendarGrid.fullCalendar("render")),s=e(".fc-slats:visible").parent(),a=s.children(".timeline"),0===a.length&&(a=e("<hr>").addClass("timeline"),s.prepend(a)),a.css("left",e("td .fc-axis").width()+10),a.show(),o=60*t.getHours()*60+60*t.getMinutes()+t.getSeconds(),r=o/86400,l=Math.floor(s.height()*r),a.css("top",l+"px")},w.prototype.updateAllEvents=function(t){this.calendars.getEvents().length>0&&"month"===this.selectedView()&&(this.loadOnce?this.scrollModel().vertical.set(this.scrollHeight):(this.topPositionToday.valueHasMutated(),this.loadOnce=!0),this.popUpStatus&&e("body").find(".fc-row.fc-week").eq(this.linkRow).find(".fc-more-cell").eq(this.linkColumn).find("a.fc-more").click())},w.prototype.viewRenderCallback=function(i,n){var s,a=null,o="01/01/1971 ";this.changeDate(),this.loaded||this.initResizing(),"undefined"!=typeof s&&t.clearInterval(s),s=t.setInterval(_.bind(function(){this.setTimeline()},this),6e4);try{this.setTimeline()}catch(r){}"month"!==i.name&&H.User.CalendarShowWorkDay&&e(".fc-slats tr").each(function(){e("tr .fc-time span").each(function(){var t=e(this).eq(0).text(),i=""!==t?Date.parse(o+t):a,n=Date.parse(o+H.User.CalendarWorkDayStarts+":00"),s=Date.parse(o+H.User.CalendarWorkDayEnds+":00");a=i,(n>i||i>=s)&&(e(this).parent().parent().addClass("fc-non-working-time"),e(this).parent().parent().next().addClass("fc-non-working-time"))})}),this.activateCustomScrollInDayAndWeekView()},w.prototype.collectBusyDays=function(){var e=[],t=null,i=null,n=0,s=0;_.each(this.calendars.getEvents(),function(a){for(t=moment(a.start),i=a.end?moment(a.end):null,a.allDay&&i&&i.subtract(1,"days"),n=i?i.diff(t,"days"):0,s=0;n>=s;s++)e.push(t.clone().add(s,"days").toDate())},this),this.busyDays(e)},w.prototype.refreshDatePicker=function(){var e=this;_.defer(function(){e.collectBusyDays(),e.$datePicker.datepicker("refresh"),e.highlightWeekInDayPicker()})},w.prototype.getDayDescription=function(e){var t=!0,i=_.find(this.busyDays(),function(t){return t.getDate()===e.getDate()&&t.getMonth()===e.getMonth()&&t.getYear()===e.getYear()},this),n=i?"day_with_events":"",s="";return[t,n,s]},w.prototype.initResizing=function(){var i=_.throttle(_.bind(this.resize,this),50);e(t).bind("resize",function(e){(e.target===this||x.browser.ie8AndBelow)&&i()}),i()},w.prototype.resize=function(){var e=this.$calendarGrid.parent();e&&this.$calendarGrid.fullCalendar("option","height",e.height()),this.dayNamesResize()},w.prototype.dayNamesResize=function(){if("month"===this.selectedView()){var t=e("div.weekday-header-item"),i=e("tr.fc-first td.fc-day"),n=e(i[0]).width(),s=0;if(7===t.length&&7===i.length&&0!==n)for(;7>s;s++)e(t[s]).width(n)}},w.prototype.changeMonthYearFromDatePicker=function(e,t,i){if(this.changeFullCalendarDate){var n=this.$calendarGrid.fullCalendar("getDate");n.month(t-1).year(e),this.$calendarGrid.fullCalendar("gotoDate",n)}},w.prototype.selectDateFromDatePicker=function(e,t){var i=this.getFCObject().moment(e,"MM/DD/YYYY");this.$calendarGrid.fullCalendar("gotoDate",i),_.defer(_.bind(this.highlightWeekInDayPicker,this))},w.prototype.highlightWeekInDayPicker=function(){var e=this.$datePicker.find("td.ui-datepicker-current-day"),t=e.parent(),i=this.$datePicker.find("table.ui-datepicker-calendar"),n=this.$calendarGrid.fullCalendar("getView");switch(n.name){case"agendaDay":i.addClass("highlight_day").removeClass("highlight_week");break;case"agendaWeek":i.removeClass("highlight_day").addClass("highlight_week");break;default:i.removeClass("highlight_day").removeClass("highlight_week")}t.addClass("current_week")},w.prototype.changeDateTitle=function(){var e=this.$calendarGrid.fullCalendar("getDate"),t=this.$calendarGrid.fullCalendar("getView"),i=e.format("MMMM YYYY"),n=t.intervalStart,s=t.intervalEnd?t.intervalEnd.add(-1,"days"):null;switch(t.name){case"agendaDay":i=e.format("MMMM D, YYYY");break;case"agendaWeek":n&&s&&(i=n.format("MMMM D, YYYY")+" - "+s.format("MMMM D, YYYY"))}this.dateTitle(i)},w.prototype.changeDate=function(){this.changeDateInDatePicker(),this.changeDateTitle(),this.getTimeLimits(),this.getCalendars()},w.prototype.changeDateInDatePicker=function(){var e=this.$calendarGrid.fullCalendar("getDate");this.changeFullCalendarDate=!1,this.$datePicker.datepicker("setDate",e.local().toDate()),this.changeFullCalendarDate=!0,this.highlightWeekInDayPicker()},w.prototype.activateCustomScrollInDayAndWeekView=function(){if(!W){var t=this.$calendarGrid.fullCalendar("getView"),n="month"===t.name?"day":"time",s=e(".fc-"+n+"-grid-container"),a=e("<div></div>");s.parent().append(a),s.appendTo(a),a.hasClass("scroll-wrap")||(a.attr("data-bind","customScrollbar: {x: false, y: true, top: 0, scrollTo: topPositionToday, oScroll: scrollModel}"),s.css({overflow:"hidden"}).addClass("scroll-inner"),i.applyBindings(this,a[0])),this.domScrollWrapper=a}},w.prototype.execCommand=function(e,t){t?this.$calendarGrid.fullCalendar(e,t):this.$calendarGrid.fullCalendar(e)},w.prototype.displayToday=function(){this.execCommand("today")},w.prototype.displayPrev=function(){this.execCommand("prev")},w.prototype.displayNext=function(){this.execCommand("next")},w.prototype.changeView=function(e){this.selectedView(e),"month"===e&&(this.loadOnce=!1),this.$calendarGrid.fullCalendar("changeView",e)},w.prototype.setAutoReloadTimer=function(){var e=this;clearTimeout(this.iAutoReloadTimer),H.User.AutoCheckMailInterval>0&&(this.iAutoReloadTimer=setTimeout(function(){e.getCalendars()},60*H.User.AutoCheckMailInterval*1e3))},w.prototype.reloadAll=function(){this.needsToReload=!0,this.getCalendars()},w.prototype.getTimeLimits=function(){var e=this.getDateFromCurrentView("start"),t=this.getDateFromCurrentView("end");this.startDateTime=e,this.endDateTime=t,this.needsToReload=!0},w.prototype.getCalendars=function(){this.checkStarted(!0),this.setCalendarGridVisibility(),x.Ajax.sendExt({Action:"CalendarList",IsPublic:this.isPublic?1:0,PublicCalendarId:this.publicCalendarId},this.onCalendarsResponse,this)},w.prototype.onCalendarsResponse=function(e,t){var i=[],n=[],s=null,a=null;this.scrollHeight=this.loadOnce&&"month"===this.selectedView()?this.scrollModel().vertical.get():0,e.Result?(this.loaded=!0,_.each(e.Result,function(e){s=this.calendars.parseCalendar(e),i.push(s.id),a=this.calendars.getCalendarById(s.id),(!a||s&&a&&a.cTag!==s.cTag)&&(s=this.calendars.parseAndAddCalendar(e),s&&(this.isPublic&&(x.setTitle(s.name()),this.publicCalendarName(s.name())),n.push(s.id)))},this),0===this.calendars.count()&&this.isPublic&&this.needsToReload&&(x.setTitle(F.i18n("CALENDAR/NO_CALENDAR_FOUND")),x.Api.showErrorByCode(0,F.i18n("CALENDAR/NO_CALENDAR_FOUND"))),this.needsToReload=!1,this.calendars.expunge(i),_.each(i,function(e){s=this.calendars.getCalendarById(e),s&&s.eventsCount()>0&&s.reloadEvents()},this),this.getEvents(i)):(this.setCalendarGridVisibility(),this.checkStarted(!1))},w.prototype.getEvents=function(e){e.length>0?x.Ajax.sendExt({Action:"CalendarEventList",CalendarIds:JSON.stringify(e),Start:this.startDateTime,End:this.endDateTime,IsPublic:this.isPublic?1:0,TimezoneOffset:moment().utcOffset(),Timezone:t.jstz?t.jstz.determine().name():""},this.onEventsResponse,this):(this.setAutoReloadTimer(),this.checkStarted(!1))},w.prototype.onEventsResponse=function(e,t){var i=null,n=t.CalendarIds?JSON.parse(t.CalendarIds):[],s=[];e.Result&&(_.each(e.Result,function(e){if(i=this.calendars.getCalendarById(e.calendarId)){s.push(e.id);var t=i.eventExists(e.id);F.isUnd(t)?i.addEvent(e):t.lastModified!==e.lastModified&&i.updateEvent(e)}},this),_.each(n,function(e){i=this.calendars.getCalendarById(e),i&&i.eventsCount()>0&&i.active()&&i.expungeEvents(s,this.startDateTime,this.endDateTime)},this),this.refreshView()),this.setAutoReloadTimer(),this.checkStarted(!1)},w.prototype.setCalendarGridVisibility=function(){this.$calendarGrid.css("visibility","").find(".fc-view div").first().css("visibility","")},w.prototype.getUnusedColor=function(){var e=_.difference(this.colors,this.calendars.getColors());return e.length>0?e[0]:this.colors[0]},w.prototype.openCreateCalendarForm=function(){if(!this.isPublic){var e=new k;e.color(this.getUnusedColor()),x.Screens.showPopup(f,[_.bind(this.createCalendar,this),this.colors,e])}},w.prototype.createCalendar=function(e,t,i){this.isPublic||x.Ajax.send({Name:e,Description:t,Color:i,Action:"CalendarCreate"},this.onCalendarCreateResponse,this)},w.prototype.onCalendarCreateResponse=function(e,t){e.Result&&this.calendars.parseAndAddCalendar(e.Result)},w.prototype.openImportCalendarForm=function(e){this.isPublic||x.Screens.showPopup(g,[_.bind(this.reloadAll,this),e])},w.prototype.openUpdateCalendarForm=function(e){this.isPublic||x.Screens.showPopup(f,[_.bind(this.updateCalendar,this),this.colors,e])},w.prototype.updateCalendar=function(e,t,i,n){this.isPublic||x.Ajax.send({Name:e,Description:t,Color:i,Id:n,Action:"CalendarUpdate"},this.onCalendarUpdateResponse,this)},w.prototype.onCalendarUpdateResponse=function(e,t){var i=null;e.Result&&(i=this.calendars.getCalendarById(t.Id),i&&(i.name(t.Name),i.description(t.Description),i.color(t.Color),this.refetchEvents()))},w.prototype.updateCalendarColor=function(e,t){this.isPublic||x.Ajax.send({Color:e,Id:t,Action:"CalendarUpdateColor"},this.onCalendarUpdateColorResponse,this)},w.prototype.onCalendarUpdateColorResponse=function(e,t){if(e.Result){var i=this.calendars.getCalendarById(t.Id);i&&(i.color(t.Color),this.refetchEvents())}},w.prototype.openGetLinkCalendarForm=function(e,t){t.preventDefault(),t.stopPropagation(),this.isPublic||x.Screens.showPopup(v,[_.bind(this.publicCalendar,this),e])},w.prototype.openShareCalendarForm=function(e){this.isPublic||x.Screens.showPopup(b,[_.bind(this.shareCalendar,this),e])},w.prototype.shareCalendar=function(e,t,i,n,s){this.isPublic||x.Ajax.send({Action:"CalendarShareUpdate",Id:e,IsPublic:t?1:0,Shares:JSON.stringify(i),ShareToAll:n?1:0,ShareToAllAccess:s},this.onCalendarShareUpdateResponse,this)},w.prototype.onCalendarShareUpdateResponse=function(e,t){if(e.Result){var i=this.calendars.getCalendarById(t.Id);i&&(i.shares(JSON.parse(t.Shares)),1===t.ShareToAll?(i.isShared(!0),i.isSharedToAll(!0),i.sharedToAllAccess=t.ShareToAllAccess):i.isSharedToAll(!1))}},w.prototype.publicCalendar=function(e,t){this.isPublic||x.Ajax.send({Action:"CalendarPublicUpdate",Id:e,IsPublic:t?1:0},this.onCalendarPublicUpdateResponse,this)},w.prototype.onCalendarPublicUpdateResponse=function(e,t){if(e.Result){var i=this.calendars.getCalendarById(t.Id);i&&i.isPublic(t.IsPublic)}},w.prototype.deleteCalendar=function(e,t){var i=this.calendars.getCalendarById(e),n=i?t?F.i18n("CALENDAR/CONFIRM_UNSUBSCRIBE_CALENDAR",{CALENDARNAME:i.name()}):F.i18n("CALENDAR/CONFIRM_REMOVE_CALENDAR",{CALENDARNAME:i.name()}):"",s=_.bind(function(t){t&&x.Ajax.send({Id:e,Action:"CalendarDelete"},this.onCalendarDeleteResponse,this)},this);!this.isPublic&&i&&x.Screens.showPopup(p,[n,s])},w.prototype.onCalendarDeleteResponse=function(e,t){if(e.Result){var i=this.calendars.getCalendarById(t.Id);i&&!i.isDefault&&(this.calendars.currentCal().id===i.id&&this.calendars.currentCal(null),this.calendars.removeCalendar(i.id),this.refetchEvents())}},w.prototype.onEventDragStart=function(){this.dragEventTrigger=!0,this.refreshDatePicker()},w.prototype.onEventDragStop=function(e){var t=this;this.dragEventTrigger=!1,this.delayOnEventResult&&this.delayOnEventResultData&&0<this.delayOnEventResultData.length?(this.delayOnEventResult=!1,_.each(this.delayOnEventResultData,function(e){t.onEventActionResponse(e[0],e[1],!1)}),this.delayOnEventResultData=[],this.refreshView()):this.refreshDatePicker()},w.prototype.onEventResizeStart=function(){this.dragEventTrigger=!0},w.prototype.onEventResizeStop=function(){var e=this;this.dragEventTrigger=!1,this.delayOnEventResult&&this.delayOnEventResultData&&0<this.delayOnEventResultData.length?(this.delayOnEventResult=!1,_.each(this.delayOnEventResultData,function(t){e.onEventActionResponse(t[0],t[1],!1)}),this.delayOnEventResultData=[],this.refreshView()):this.refreshDatePicker()},w.prototype.createEventInCurrentCalendar=function(){this.createEventToday(this.calendars.currentCal())},w.prototype.createEventInCalendar=function(e){this.createEventToday(this.calendars.getCalendarById(e))},w.prototype.createEventToday=function(e){var t=this.getFCObject().moment();t.minutes()>30?t.add(60-t.minutes(),"minutes"):t.minutes(30),t.seconds(0).milliseconds(0),this.openEventPopup(e,t,t.clone().add(30,"minutes"),!1)},w.prototype.getParamsFromEventData=function(e){return{id:e.id,uid:e.uid,calendarId:e.calendarId,newCalendarId:F.isUnd(e.newCalendarId)?e.calendarId:e.newCalendarId,subject:e.subject,allDay:e.allDay?1:0,location:e.location,description:e.description,alarms:e.alarms?JSON.stringify(e.alarms):"[]",attendees:e.attendees?JSON.stringify(e.attendees):"[]",owner:e.owner,recurrenceId:e.recurrenceId,excluded:e.excluded,allEvents:e.allEvents,modified:e.modified?1:0,start:e.start.local().toDate(),end:e.end.local().toDate(),startTS:e.start.unix(),endTS:(e.end,e.end.unix()),rrule:e.rrule?JSON.stringify(e.rrule):null}},w.prototype.getEventDataFromParams=function(e){var t=e;return t.alarms=e.alarms?JSON.parse(e.alarms):[],t.attendees=e.attendees?JSON.parse(e.attendees):[],e.rrule&&(t.rrule=JSON.parse(e.rrule)),t},w.prototype.createEventFromGrid=function(e,t){var i=!e.hasTime();this.openEventPopup(this.calendars.currentCal(),e.local(),t.local(),i)},w.prototype.openEventPopup=function(e,t,i,n){!this.isPublic&&e&&x.Screens.showPopup(y,[{CallbackSave:_.bind(this.createEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),FCMoment:this.getFCObject().moment,Calendars:this.calendars,SelectedCalendar:e?e.id:0,Start:t,End:i,AllDay:n,TimeFormat:this.timeFormat,DateFormat:this.dateFormat,CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)}])},w.prototype.createEvent=function(e){var t=this.getParamsFromEventData(e);this.isPublic||(t.calendarId=e.newCalendarId,t.selectStart=this.getDateFromCurrentView("start"),t.selectEnd=this.getDateFromCurrentView("end"),t.Action="CalendarEventCreate",x.Ajax.send(t,this.onEventActionResponseWithSubThrottle,this))},w.prototype.eventClickCallback=function(e){var t=_.bind(function(t){var i={ID:e.id,Uid:e.uid,RecurrenceId:e.recurrenceId,Calendars:this.calendars,SelectedCalendar:e.calendarId,AllDay:e.allDay,Location:e.location,Description:e.description,Subject:e.subject,Alarms:e.alarms,Attendees:e.attendees,RRule:e.rrule?e.rrule:null,Excluded:e.excluded?e.excluded:!1,Owner:e.owner,Appointment:e.appointment,OwnerName:e.ownerName,TimeFormat:this.timeFormat,DateFormat:this.dateFormat,AllEvents:t,CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),CallbackAttendeeActionDecline:_.bind(this.attendeeActionDecline,this)};t!==M.CalendarEditRecurrenceEvent.None&&(t===M.CalendarEditRecurrenceEvent.AllEvents&&e.rrule?(i.Start=moment.unix(e.rrule.startBase),i.End=moment.unix(e.rrule.endBase)):(i.Start=e.start.clone(),i.Start=i.Start.local(),i.End=e.end.clone(),i.End=i.End.local()),x.Screens.showPopup(y,[i]))},this);e.rrule?e.excluded?t(M.CalendarEditRecurrenceEvent.OnlyThisInstance):x.Screens.showPopup(C,[t]):t(M.CalendarEditRecurrenceEvent.AllEvents)},w.prototype.eventAction=function(e,t,i){var n=this.calendars.getCalendarById(t.calendarId);n.access()===M.CalendarAccess.Read?i&&i():this.isPublic||(i&&(this.revertFunction=i),t.Action=e,x.Ajax.send(t,this.onEventActionResponseWithSubThrottle,this))},w.prototype.updateEvent=function(e){var t=this.getParamsFromEventData(e);t.selectStart=this.getDateFromCurrentView("start"),t.selectEnd=this.getDateFromCurrentView("end"),e.modified&&(this.calendars.setDefault(e.newCalendarId),this.eventAction("CalendarEventUpdate",t))},w.prototype.moveEvent=function(e,t,i){var n=this.getParamsFromEventData(e);n.selectStart=this.getDateFromCurrentView("start"),n.selectEnd=this.getDateFromCurrentView("end"),this.isPublic||(n.rrule?i(!1):(n.allEvents=M.CalendarEditRecurrenceEvent.AllEvents,this.eventAction("CalendarEventUpdate",n,i)))},w.prototype.resizeEvent=function(e,t,i){var n=this.getParamsFromEventData(e),s=_.bind(function(e){e!==M.CalendarEditRecurrenceEvent.None?(n.allEvents=e,this.eventAction("CalendarEventUpdate",n,i)):i()},this);n.selectStart=this.getDateFromCurrentView("start"),n.selectEnd=this.getDateFromCurrentView("end"),e.rrule?n.excluded?s(M.CalendarEditRecurrenceEvent.OnlyThisInstance):x.Screens.showPopup(C,[s]):s(M.CalendarEditRecurrenceEvent.AllEvents)},w.prototype.deleteEvent=function(e){this.eventAction("CalendarEventDelete",this.getParamsFromEventData(e))},w.prototype.onEventActionResponseWithSubThrottle=function(e,t){this.dragEventTrigger?(this.delayOnEventResult=!0,this.delayOnEventResultData.push([e,t])):this.onEventActionResponse(e,t)},w.prototype.onEventActionResponse=function(t,i,n){var s=this.calendars.getCalendarById(i.calendarId),a=null,o=null,r=0;n=F.isUnd(n)?!0:!!n,t&&t.Result&&!F.isUnd(s)?(r=e(".calendar .fc-widget-content .scroll-inner").scrollTop(),"CalendarEventCreate"===i.Action||"CalendarEventUpdate"===i.Action?(o=s.getEvent(i.id),(F.isUnd(o)||F.isUnd(o.rrule))&&!i.rrule||i.allEvents!==M.CalendarEditRecurrenceEvent.AllEvents?s.removeEvent(i.id):s.removeEventByUid(i.uid,!0),i.newCalendarId&&i.newCalendarId!==i.calendarId&&(s=this.calendars.getCalendarById(i.newCalendarId)),_.each(t.Result.Events,function(e){s.addEvent(e)},this),s.cTag=t.Result.CTag,s.active()||s.active(!0),n&&this.refreshView(),this.restoreScroll(r),this.calendars.currentCal(s)):"CalendarEventDelete"===i.Action?(s.cTag=t.Result,i.allEvents===M.CalendarEditRecurrenceEvent.OnlyThisInstance?s.removeEvent(i.id):s.removeEventByUid(i.uid),n&&this.refreshView(),this.restoreScroll(r)):"CalendarEventBase"===i.Action&&(a=t.Result,x.Screens.showPopup(y,[{CallbackSave:_.bind(this.updateEvent,this),CallbackDelete:_.bind(this.deleteEvent,this),ID:a.id,Uid:a.uid,RecurrenceId:a.recurrenceId,Calendars:this.calendars,SelectedCalendar:a.calendarId,Start:moment(1e3*a.start),End:moment(1e3*a.end),AllDay:a.allDay,Location:a.location,Description:a.description,Subject:a.subject,Alarms:a.alarms,Attendees:a.attendees,RRule:a.rrule?a.rrule:null,Excluded:a.excluded?a.excluded:!1,Owner:a.owner,Appointment:a.appointment,TimeFormat:this.timeFormat,DateFormat:this.dateFormat,AllEvents:M.CalendarEditRecurrenceEvent.AllEvents}]))):"CalendarEventUpdate"!==i.Action||t.Result||1155!==F.pInt(t.ErrorCode)?this.revertFunction&&this.revertFunction():this.revertFunction=null,this.revertFunction=null},w.prototype.attendeeActionDecline=function(e,t){e.removeEvent(t),this.refreshView()},w.prototype.refetchEvents=function(){this.$calendarGrid.fullCalendar("refetchEvents")},w.prototype.refreshViewSingle=function(){this.refetchEvents(),this.refreshDatePicker()},w.prototype.refreshView=function(){},w.prototype.initUploader=function(){var e=this;this.uploaderArea()&&(this.oJua=new Jua({action:"?/Upload/Calendars/",name:"jua-uploader",queueSize:2,dragAndDropElement:this.uploaderArea(),disableAjaxUpload:!1,disableFolderDragAndDrop:!1,disableDragAndDrop:!1,disableAutoUploadOnDrop:!0,hidden:{Token:function(){return H.Token},AccountID:function(){return H.Accounts.currentId()},AdditionalData:function(){return JSON.stringify({CalendarID:e.uploadCalendarId()})}}}),this.oJua.on("onDrop",_.bind(this.onFileDrop,this)).on("onComplete",_.bind(this.onFileUploadComplete,this)).on("onBodyDragEnter",_.bind(this.bDragActive,this,!0)).on("onBodyDragLeave",_.bind(this.bDragActive,this,!1)))},w.prototype.onFileDrop=function(e,t,i){var n=_.filter(this.calendars.collection(),function(e){return e.isEditable()});n.length>1?x.Screens.showPopup(E,[{CallbackSave:_.bind(this.uploadToSelectedCalendar,this),ProceedUploading:i,Calendars:this.calendars,EditableCalendars:n,DefaultCalendarId:this.defaultCalendarId()}]):this.uploadToSelectedCalendar(this.defaultCalendarId(),i)},w.prototype.onFileUploadComplete=function(e,t,i){var n=!t||!i||i.Error||i.Result.Error||!1;n?x.Api.showError(i.ErrorCode&&i.ErrorCode===M.Errors.IncorrectFileExtension?F.i18n("CONTACTS/ERROR_INCORRECT_FILE_EXTENSION"):F.i18n("WARNING/ERROR_UPLOAD_FILE")):this.reloadAll()},w.prototype.uploadToSelectedCalendar=function(e,t){this.uploadCalendarId(e),this.checkStarted(!0),t()},w.prototype.restoreScroll=function(e){this.domScrollWrapper&&this.domScrollWrapper.data("customscroll").vertical.set(e)},R.prototype.showLoading=function(e){this.loadingMessage(e&&""!==e?e:F.i18n("MAIN/LOADING")),this.loadingVisible(!0),_.defer(_.bind(function(){this.loadingHidden(!1)},this))},R.prototype.hideLoading=function(){this.loadingHidden(!0),setTimeout(_.bind(function(){this.loadingHidden()&&this.loadingVisible(!1)},this),this.iAnimationDuration)},R.prototype.showReport=function(e,t){0!==t&&(t=t||this.iReportDuration),e&&""!==e?(this.reportMessage(e),this.reportVisible(!0),_.defer(_.bind(this.reportHidden,this,!1)),clearTimeout(this.iReportTimeout),0===t?this.reportVisibleClose(!0):(this.reportVisibleClose(!1),this.iReportTimeout=setTimeout(_.bind(this.selfHideReport,this),t))):(this.reportHidden(!0),this.reportVisible(!1))},R.prototype.selfHideReport=function(){this.reportHidden(!0),setTimeout(_.bind(function(){this.reportHidden()&&this.reportVisible(!1)},this),this.iAnimationDuration)},R.prototype.showError=function(e,t,i,n){e&&""!==e?(this.gray(!!n),this.errorMessage(e),this.isHtmlError(t),this.errorVisible(!0),_.defer(_.bind(function(){this.errorHidden(!1)},this)),clearTimeout(this.iErrorTimeout),i||(this.iErrorTimeout=setTimeout(_.bind(function(){this.selfHideError()},this),this.iErrorDuration))):this.selfHideError()},R.prototype.selfHideError=function(){this.errorHidden(!0),setTimeout(_.bind(function(){this.errorHidden()&&this.errorVisible(!1)},this),this.iAnimationDuration)},R.prototype.hideError=function(e){e=F.isUnd(e)?!1:!!e,e===this.gray()&&this.selfHideError()},I.prototype.initScreens=function(){},I.prototype.initLayout=function(){},I.prototype.init=function(){this.initScreens(),this.initLayout(),e("#pSevenContent").addClass("single_mode"),_.defer(function(){H.SingleMode||e("#pSevenContent").removeClass("single_mode")}),this.informationScreen(this.showNormalScreen(M.Screens.Information));

},I.prototype.hasOpenedMinimizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()&&(e=!0)}),e},I.prototype.hasOpenedMaximizedPopups=function(){var e=!1;return _.each(this.popups,function(t){var i=t.__vm;i.minimized&&i.minimized()||(e=!0)}),e},I.prototype.getCurrentScreenModel=function(){var e=this.oScreens[this.currentScreen()],t="undefined"!=typeof e?e.Model:null;return t},I.prototype.showCurrentScreen=function(e,t){var i=this.oScreens[this.currentScreen()],n="undefined"!=typeof i?i.Model:null;this.currentScreen()!==e&&(n&&i.bInitialized&&n.hideViewModel(),this.currentScreen(e)),this.showNormalScreen(e,t),this.resizeAll()},I.prototype.showNormalScreen=function(e,t){var i=e,n=this.oScreens[i];return n&&(n.bInitialized="boolean"!=typeof n.bInitialized?!1:n.bInitialized,n.bInitialized||(n.Model=this.initViewModel(n.Model,n.TemplateName),n.bInitialized=!0),n.Model.showViewModel(t)),n?n.Model:null},I.prototype.initViewModel=function(t,n){var s=null,a=null;return s=new t,a=e('div[data-view-model="'+n+'"]').attr("data-bind","template: {name: '"+n+"'}").hide(),s.$viewModel=a,s.bShown=!1,s.showViewModel=function(e){B&&(Y||x.browser.ie)?_.defer(_.bind(function(){this.$viewModel.show()},this)):this.$viewModel.show(),"function"==typeof this.onRoute&&this.onRoute(e),this.bShown||("function"==typeof this.onShow&&this.onShow(e),L.runPluginHook&&this.__name&&L.runPluginHook("view-model-on-show",[this.__name,this]),this.bShown=!0)},s.hideViewModel=function(){this.$viewModel.hide(),"function"==typeof this.onHide&&this.onHide(),this.bShown=!1},i.applyBindings(s,a[0]),"function"==typeof s.onApplyBindings&&s.onApplyBindings(a),s},I.prototype.showPopup=function(t,n){if(t){if(!t.__builded){var s=null,a=new t,o=a.popupTemplate?a.popupTemplate():"";""!==o&&(s=e('div[data-view-model="'+o+'"]').attr("data-bind","template: {name: '"+o+"'}").removeClass("visible").hide(),s&&1===s.length&&(a.visibility=i.observable(!1),t.__builded=!0,t.__vm=a,a.$viewModel=s,t.__dom=s,a.showViewModel=F.createCommand(a,function(){x&&x.Screens&&x.Screens.showPopup(t)}),a.closeCommand=F.createCommand(a,function(){x&&x.Screens&&x.Screens.hidePopup(t)}),i.applyBindings(a,s[0]),F.delegateRun(a,"onApplyBindings",[s])))}t.__vm&&t.__dom&&(t.__vm.visibility()||(t.__dom.show(),_.delay(function(){t.__dom.addClass("visible")},50),t.__vm.visibility(!0),this.popups.push(t),1===this.popups.length&&(this.keyupPopupBinded=_.bind(this.keyupPopup,this),e(document).on("keyup",this.keyupPopupBinded))),F.delegateRun(t.__vm,"onShow",n))}},I.prototype.keyupPopup=function(e){var i=this.popups.length>0?this.popups[this.popups.length-1].__vm:null;if(e&&i&&(!i.minimized||!i.minimized())){var n=t.parseInt(e.keyCode,10);M.Key.Esc===n&&(i.onEscHandler?i.onEscHandler(e):i.closeCommand()),M.Key.Enter!==n&&M.Key.Space!==n||!i.onEnterHandler||i.onEnterHandler()}},I.prototype.hidePopup=function(t){t&&t.__vm&&t.__dom&&(this.keyupPopupBinded&&1===this.popups.length&&(e(document).off("keyup",this.keyupPopupBinded),this.keyupPopupBinded=void 0),t.__dom.removeClass("visible").hide(),t.__vm.visibility(!1),F.delegateRun(t.__vm,"onHide"),this.popups=_.without(this.popups,t))},I.prototype.showLoading=function(e){this.informationScreen()&&this.informationScreen().showLoading(e)},I.prototype.hideLoading=function(){this.informationScreen()&&this.informationScreen().hideLoading()},I.prototype.showReport=function(e,t){this.informationScreen()&&this.informationScreen().showReport(e,t)},I.prototype.showError=function(e,t,i,n){this.informationScreen()&&this.informationScreen().showError(e,t,i,n)},I.prototype.hideError=function(e){this.informationScreen()&&this.informationScreen().hideError(e)},I.prototype.initHelpdesk=function(){var e=this.oScreens[M.Screens.Helpdesk];H.User.IsHelpdeskSupported&&e&&!e.bInitialized&&(e.Model=this.initViewModel(e.Model,e.TemplateName),e.bInitialized=!0)},I.prototype.initScreens=function(){this.oScreens[M.Screens.Information]={Model:R,TemplateName:"Common_InformationViewModel"},this.oScreens[M.Screens.Calendar]={Model:w,TemplateName:"Calendar_CalendarViewModel"}},I.prototype.initLayout=function(){e("#pSevenContent").append(e("#CalendarPubLayout").html())},P.prototype.init=function(){},P.prototype.collectScreensData=function(){},P.prototype.run=function(){},P.prototype.momentDateTriggerCallback=function(){var e=i.dataFor(this);e&&e.updateMomentDate&&e.updateMomentDate()},P.prototype.fastMomentDateTrigger=function(){e(".moment-date-trigger-fast").each(this.momentDateTriggerCallback)},P.prototype.setTitle=function(e){document.title=".",document.title=e||""},P.prototype.tokenProblem=function(){var e="window.location.reload(); return false;",t=F.i18n("WARNING/TOKEN_PROBLEM_HTML",{RELOAD_FUNC:e});H.Auth=!1,x.Api.showError(t,!0,!0)},_.extend(N.prototype,P.prototype),N.prototype.init=function(){var e=H.User,t=new S;t.parse(e),H.User=t,H.Auth||(H.User.CalendarWeekStartsOn=parseInt(moment().weekday(0).format("d")))},N.prototype.authProblem=function(){},N.prototype.run=function(){this.Screens.init(),this.Screens.showCurrentScreen(M.Screens.Calendar)},x=new N,t.App=x,H.AllowMobile&&-1===H.IsMobile){var j=t.matchMedia("all and (min-width: 768px)").matches?0:1;t.App.Ajax.send({Action:"SystemSetMobile",Mobile:j},function(){j?t.location.reload():e(function(){_.defer(function(){x.run()})})},this)}else e(function(){_.defer(function(){x.run()})});t.Modernizr&&navigator&&t.Modernizr.addTest("mobile",function(){return B}),t.AfterLogicApi=L,t.Enums=M,K.removeClass("no-js").addClass("js"),K.hasClass("pdf")&&(z.push("application/pdf"),z.push("application/x-pdf"))}(jQuery,window,ko,crossroads,hasher);
